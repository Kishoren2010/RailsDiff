diff -Nru v3.0.1/.gitignore v3.0.12/.gitignore
--- v3.0.1/.gitignore	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/.gitignore	2012-08-01 09:41:46.000000000 -0400
@@ -1,4 +1,4 @@
 .bundle
 db/*.sqlite3
 log/*.log
-tmp/**/*
+tmp/
diff -Nru v3.0.1/Gemfile v3.0.12/Gemfile
--- v3.0.1/Gemfile	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/Gemfile	2012-08-01 09:41:46.000000000 -0400
@@ -1,11 +1,11 @@
 source 'http://rubygems.org'
 
-gem 'rails', '3.0.1'
+gem 'rails', '3.0.12'
 
 # Bundle edge Rails instead:
 # gem 'rails', :git => 'git://github.com/rails/rails.git'
 
-gem 'sqlite3-ruby', :require => 'sqlite3'
+gem 'sqlite3'
 
 # Use unicorn as the web server
 # gem 'unicorn'
@@ -13,8 +13,9 @@
 # Deploy with Capistrano
 # gem 'capistrano'
 
-# To use debugger
+# To use debugger (ruby-debug for Ruby 1.8.7+, ruby-debug19 for Ruby 1.9.2+)
 # gem 'ruby-debug'
+# gem 'ruby-debug19', :require => 'ruby-debug'
 
 # Bundle the extra gems:
 # gem 'bj'
diff -Nru v3.0.1/README v3.0.12/README
--- v3.0.1/README	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/README	2012-08-01 09:41:46.000000000 -0400
@@ -158,6 +158,7 @@
   |-- app
   |   |-- controllers
   |   |-- helpers
+  |   |-- mailers
   |   |-- models
   |   `-- views
   |       `-- layouts
@@ -175,7 +176,6 @@
   |   |-- javascripts
   |   `-- stylesheets
   |-- script
-  |   `-- performance
   |-- test
   |   |-- fixtures
   |   |-- functional
diff -Nru v3.0.1/config/boot.rb v3.0.12/config/boot.rb
--- v3.0.1/config/boot.rb	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/config/boot.rb	2012-08-01 09:41:46.000000000 -0400
@@ -1,13 +1,6 @@
 require 'rubygems'
 
 # Set up gems listed in the Gemfile.
-gemfile = File.expand_path('../../Gemfile', __FILE__)
-begin
-  ENV['BUNDLE_GEMFILE'] = gemfile
-  require 'bundler'
-  Bundler.setup
-rescue Bundler::GemNotFound => e
-  STDERR.puts e.message
-  STDERR.puts "Try running `bundle install`."
-  exit!
-end if File.exist?(gemfile)
+ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../../Gemfile', __FILE__)
+
+require 'bundler/setup' if File.exists?(ENV['BUNDLE_GEMFILE'])
diff -Nru v3.0.1/config/database.yml v3.0.12/config/database.yml
--- v3.0.1/config/database.yml	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/config/database.yml	2012-08-01 09:41:46.000000000 -0400
@@ -1,5 +1,5 @@
 # SQLite version 3.x
-#   gem install sqlite3-ruby (not necessary on OS X Leopard)
+#   gem install sqlite3
 development:
   adapter: sqlite3
   database: db/development.sqlite3
diff -Nru v3.0.1/config/environments/development.rb v3.0.12/config/environments/development.rb
--- v3.0.1/config/environments/development.rb	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/config/environments/development.rb	2012-08-01 09:41:46.000000000 -0400
@@ -1,5 +1,5 @@
 Railsdiff::Application.configure do
-  # Settings specified here will take precedence over those in config/environment.rb
+  # Settings specified here will take precedence over those in config/application.rb
 
   # In the development environment your application's code is reloaded on
   # every request.  This slows down response time but is perfect for development
diff -Nru v3.0.1/config/environments/production.rb v3.0.12/config/environments/production.rb
--- v3.0.1/config/environments/production.rb	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/config/environments/production.rb	2012-08-01 09:41:46.000000000 -0400
@@ -1,5 +1,5 @@
 Railsdiff::Application.configure do
-  # Settings specified here will take precedence over those in config/environment.rb
+  # Settings specified here will take precedence over those in config/application.rb
 
   # The production environment is meant for finished, "live" apps.
   # Code is not reloaded between requests
diff -Nru v3.0.1/config/environments/test.rb v3.0.12/config/environments/test.rb
--- v3.0.1/config/environments/test.rb	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/config/environments/test.rb	2012-08-01 09:41:46.000000000 -0400
@@ -1,5 +1,5 @@
 Railsdiff::Application.configure do
-  # Settings specified here will take precedence over those in config/environment.rb
+  # Settings specified here will take precedence over those in config/application.rb
 
   # The test environment is used exclusively to run your application's
   # test suite.  You never need to work with it otherwise.  Remember that
diff -Nru v3.0.1/config/initializers/session_store.rb v3.0.12/config/initializers/session_store.rb
--- v3.0.1/config/initializers/session_store.rb	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/config/initializers/session_store.rb	2012-08-01 09:41:46.000000000 -0400
@@ -4,5 +4,5 @@
 
 # Use the database for sessions instead of the cookie-based default,
 # which shouldn't be used to store highly confidential information
-# (create the session table with "rake db:sessions:create")
+# (create the session table with "rails generate session_migration")
 # Railsdiff::Application.config.session_store :active_record_store
diff -Nru v3.0.1/public/javascripts/rails.js v3.0.12/public/javascripts/rails.js
--- v3.0.1/public/javascripts/rails.js	2012-08-01 09:40:39.000000000 -0400
+++ v3.0.12/public/javascripts/rails.js	2012-08-01 09:41:46.000000000 -0400
@@ -1,4 +1,14 @@
 (function() {
+  Ajax.Responders.register({
+    onCreate: function(request) {
+      var token = $$('meta[name=csrf-token]')[0];
+      if (token) {
+        if (!request.options.requestHeaders) request.options.requestHeaders = {};
+        request.options.requestHeaders['X-CSRF-Token'] = token.readAttribute('content');
+      }
+    }
+  });
+
   // Technique from Juriy Zaytsev
   // http://thinkweb2.com/projects/prototype/detecting-event-support-without-browser-sniffing/
   function isEventSupported(eventName) {
@@ -14,33 +24,33 @@
   }
 
   function isForm(element) {
-    return Object.isElement(element) && element.nodeName.toUpperCase() == 'FORM'
+    return Object.isElement(element) && element.nodeName.toUpperCase() == 'FORM';
   }
 
   function isInput(element) {
     if (Object.isElement(element)) {
-      var name = element.nodeName.toUpperCase()
-      return name == 'INPUT' || name == 'SELECT' || name == 'TEXTAREA'
+      var name = element.nodeName.toUpperCase();
+      return name == 'INPUT' || name == 'SELECT' || name == 'TEXTAREA';
     }
-    else return false
+    else return false;
   }
 
   var submitBubbles = isEventSupported('submit'),
-      changeBubbles = isEventSupported('change')
+      changeBubbles = isEventSupported('change');
 
   if (!submitBubbles || !changeBubbles) {
     // augment the Event.Handler class to observe custom events when needed
     Event.Handler.prototype.initialize = Event.Handler.prototype.initialize.wrap(
       function(init, element, eventName, selector, callback) {
-        init(element, eventName, selector, callback)
+        init(element, eventName, selector, callback);
         // is the handler being attached to an element that doesn't support this event?
         if ( (!submitBubbles && this.eventName == 'submit' && !isForm(this.element)) ||
              (!changeBubbles && this.eventName == 'change' && !isInput(this.element)) ) {
           // "submit" => "emulated:submit"
-          this.eventName = 'emulated:' + this.eventName
+          this.eventName = 'emulated:' + this.eventName;
         }
       }
-    )
+    );
   }
 
   if (!submitBubbles) {
@@ -49,26 +59,26 @@
       // special handler for the real "submit" event (one-time operation)
       if (!form.retrieve('emulated:submit')) {
         form.on('submit', function(submitEvent) {
-          var emulated = form.fire('emulated:submit', submitEvent, true)
+          var emulated = form.fire('emulated:submit', submitEvent, true);
           // if custom event received preventDefault, cancel the real one too
-          if (emulated.returnValue === false) submitEvent.preventDefault()
-        })
-        form.store('emulated:submit', true)
+          if (emulated.returnValue === false) submitEvent.preventDefault();
+        });
+        form.store('emulated:submit', true);
       }
-    })
+    });
   }
 
   if (!changeBubbles) {
     // discover form inputs on the page
-    document.on('focusin', 'input, select, texarea', function(focusEvent, input) {
+    document.on('focusin', 'input, select, textarea', function(focusEvent, input) {
       // special handler for real "change" events
       if (!input.retrieve('emulated:change')) {
         input.on('change', function(changeEvent) {
-          input.fire('emulated:change', changeEvent, true)
-        })
-        input.store('emulated:change', true)
+          input.fire('emulated:change', changeEvent, true);
+        });
+        input.store('emulated:change', true);
       }
-    })
+    });
   }
 
   function handleRemote(element) {
@@ -80,7 +90,10 @@
     if (element.tagName.toLowerCase() === 'form') {
       method = element.readAttribute('method') || 'post';
       url    = element.readAttribute('action');
-      params = element.serialize();
+      // serialize the form with respect to the submit button that was pressed
+      params = element.serialize({ submit: element.retrieve('rails:submit-button') });
+      // clear the pressed submit button information
+      element.store('rails:submit-button', null);
     } else {
       method = element.readAttribute('data-method') || 'get';
       url    = element.readAttribute('href');
@@ -92,14 +105,19 @@
       parameters: params,
       evalScripts: true,
 
-      onComplete:    function(request) { element.fire("ajax:complete", request); },
-      onSuccess:     function(request) { element.fire("ajax:success",  request); },
-      onFailure:     function(request) { element.fire("ajax:failure",  request); }
+      onCreate:   function(response) { element.fire("ajax:create",   response); },
+      onComplete: function(response) { element.fire("ajax:complete", response); },
+      onSuccess:  function(response) { element.fire("ajax:success",  response); },
+      onFailure:  function(response) { element.fire("ajax:failure",  response); }
     });
 
     element.fire("ajax:after");
   }
 
+  function insertHiddenField(form, name, value) {
+    form.insert(new Element('input', { type: 'hidden', name: name, value: value }));
+  }
+
   function handleMethod(element) {
     var method = element.readAttribute('data-method'),
         url = element.readAttribute('href'),
@@ -107,69 +125,78 @@
         csrf_token = $$('meta[name=csrf-token]')[0];
 
     var form = new Element('form', { method: "POST", action: url, style: "display: none;" });
-    element.parentNode.insert(form);
+    $(element.parentNode).insert(form);
 
     if (method !== 'post') {
-      var field = new Element('input', { type: 'hidden', name: '_method', value: method });
-      form.insert(field);
+      insertHiddenField(form, '_method', method);
     }
 
     if (csrf_param) {
-      var param = csrf_param.readAttribute('content'),
-          token = csrf_token.readAttribute('content'),
-          field = new Element('input', { type: 'hidden', name: param, value: token });
-      form.insert(field);
+      insertHiddenField(form, csrf_param.readAttribute('content'), csrf_token.readAttribute('content'));
     }
 
     form.submit();
   }
 
+  function disableFormElements(form) {
+    form.select('input[type=submit][data-disable-with]').each(function(input) {
+      input.store('rails:original-value', input.getValue());
+      input.setValue(input.readAttribute('data-disable-with')).disable();
+    });
+  }
+  
+  function enableFormElements(form) {
+    form.select('input[type=submit][data-disable-with]').each(function(input) {
+      input.setValue(input.retrieve('rails:original-value')).enable();
+    });
+  }
 
-  document.on("click", "*[data-confirm]", function(event, element) {
+  function allowAction(element) {
     var message = element.readAttribute('data-confirm');
-    if (!confirm(message)) event.stop();
-  });
+    return !message || confirm(message);
+  }
 
-  document.on("click", "a[data-remote]", function(event, element) {
-    if (event.stopped) return;
-    handleRemote(element);
-    event.stop();
+  document.on('click', 'a[data-confirm], a[data-remote], a[data-method]', function(event, link) {
+    if (!allowAction(link)) {
+      event.stop();
+      return false;
+    }
+
+    if (link.readAttribute('data-remote')) {
+      handleRemote(link);
+      event.stop();
+    } else if (link.readAttribute('data-method')) {
+      handleMethod(link);
+      event.stop();
+    }
   });
 
-  document.on("click", "a[data-method]", function(event, element) {
-    if (event.stopped) return;
-    handleMethod(element);
-    event.stop();
+  document.on("click", "form input[type=submit], form button[type=submit], form button:not([type])", function(event, button) {
+    // register the pressed submit button
+    event.findElement('form').store('rails:submit-button', button.name || false);
   });
 
   document.on("submit", function(event) {
-    var element = event.findElement(),
-        message = element.readAttribute('data-confirm');
-    if (message && !confirm(message)) {
+    var form = event.findElement();
+
+    if (!allowAction(form)) {
       event.stop();
       return false;
     }
 
-    var inputs = element.select("input[type=submit][data-disable-with]");
-    inputs.each(function(input) {
-      input.disabled = true;
-      input.writeAttribute('data-original-value', input.value);
-      input.value = input.readAttribute('data-disable-with');
-    });
-
-    var element = event.findElement("form[data-remote]");
-    if (element) {
-      handleRemote(element);
+    if (form.readAttribute('data-remote')) {
+      handleRemote(form);
       event.stop();
+    } else {
+      disableFormElements(form);
     }
   });
 
-  document.on("ajax:after", "form", function(event, element) {
-    var inputs = element.select("input[type=submit][disabled=true][data-disable-with]");
-    inputs.each(function(input) {
-      input.value = input.readAttribute('data-original-value');
-      input.removeAttribute('data-original-value');
-      input.disabled = false;
-    });
+  document.on('ajax:create', 'form', function(event, form) {
+    if (form == event.findElement()) disableFormElements(form);
+  });
+  
+  document.on('ajax:complete', 'form', function(event, form) {
+    if (form == event.findElement()) enableFormElements(form);
   });
 })();
