<!DOCTYPE html>
<html>
  <head>
    <title>Rails v2.3.15 - v3.0.1 diff - RailsDiff</title>
    <link href='/assets/pygment_trac.css' rel='stylesheet'>
    <link href='/assets/app.css' rel='stylesheet'>
  </head>
  <body>
    <header>
      <h1>
        <a href='/'>RailsDiff</a>
      </h1>
      <form>
        <label>
          Source
          <select name='source'></select>
        </label>
        <a class='switch' href='#'><img src='/assets/arrow_refresh.png'></a>
        <label>
          Target
          <select name='target'></select>
        </label>
        <input type='submit' value='View Diff'>
      </form>
    </header>
    <div class='content'>
      <div class='diff'>
        <h2 id='-gitignore'>.gitignore</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,4 @@</span>
        <span class="gi">+.bundle</span>
        <span class="gi">+db/*.sqlite3</span>
        <span class="gi">+log/*.log</span>
        <span class="gi">+tmp/**/*</span>
        </pre></div>
        <h2 id='Gemfile'>Gemfile</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,30 @@</span>
        <span class="gi">+source &#39;http://rubygems.org&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+gem &#39;rails&#39;, &#39;3.0.1&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Bundle edge Rails instead:</span>
        <span class="gi">+# gem &#39;rails&#39;, :git =&gt; &#39;git://github.com/rails/rails.git&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+gem &#39;sqlite3-ruby&#39;, :require =&gt; &#39;sqlite3&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Use unicorn as the web server</span>
        <span class="gi">+# gem &#39;unicorn&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Deploy with Capistrano</span>
        <span class="gi">+# gem &#39;capistrano&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# To use debugger</span>
        <span class="gi">+# gem &#39;ruby-debug&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Bundle the extra gems:</span>
        <span class="gi">+# gem &#39;bj&#39;</span>
        <span class="gi">+# gem &#39;nokogiri&#39;</span>
        <span class="gi">+# gem &#39;sqlite3-ruby&#39;, :require =&gt; &#39;sqlite3&#39;</span>
        <span class="gi">+# gem &#39;aws-s3&#39;, :require =&gt; &#39;aws/s3&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# Bundle gems for the local environment. Make sure to</span>
        <span class="gi">+# put test-only gems in this group so their generators</span>
        <span class="gi">+# and rake tasks are available in development mode:</span>
        <span class="gi">+# group :development, :test do</span>
        <span class="gi">+#   gem &#39;webrat&#39;</span>
        <span class="gi">+# end</span>
        </pre></div>
        <h2 id='README'>README</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,243 +1,256 @@</span>
         == Welcome to Rails
         
        <span class="gd">-Rails is a web-application framework that includes everything needed to create </span>
        <span class="gd">-database-backed web applications according to the Model-View-Control pattern. </span>
        <span class="gi">+Rails is a web-application framework that includes everything needed to create</span>
        <span class="gi">+database-backed web applications according to the Model-View-Control pattern.</span>
         
        <span class="gd">-This pattern splits the view (also called the presentation) into &quot;dumb&quot; templates</span>
        <span class="gd">-that are primarily responsible for inserting pre-built data in between HTML tags.</span>
        <span class="gd">-The model contains the &quot;smart&quot; domain objects (such as Account, Product, Person,</span>
        <span class="gd">-Post) that holds all the business logic and knows how to persist themselves to</span>
        <span class="gd">-a database. The controller handles the incoming requests (such as Save New Account,</span>
        <span class="gd">-Update Product, Show Post) by manipulating the model and directing data to the view.</span>
        <span class="gi">+This pattern splits the view (also called the presentation) into &quot;dumb&quot;</span>
        <span class="gi">+templates that are primarily responsible for inserting pre-built data in between</span>
        <span class="gi">+HTML tags. The model contains the &quot;smart&quot; domain objects (such as Account,</span>
        <span class="gi">+Product, Person, Post) that holds all the business logic and knows how to</span>
        <span class="gi">+persist themselves to a database. The controller handles the incoming requests</span>
        <span class="gi">+(such as Save New Account, Update Product, Show Post) by manipulating the model</span>
        <span class="gi">+and directing data to the view.</span>
         
         In Rails, the model is handled by what&#39;s called an object-relational mapping
         layer entitled Active Record. This layer allows you to present the data from
         database rows as objects and embellish these data objects with business logic
         methods. You can read more about Active Record in
         link:files/vendor/rails/activerecord/README.html.
         
         The controller and view are handled by the Action Pack, which handles both
         layers by its two parts: Action View and Action Controller. These two layers
         are bundled in a single package due to their heavy interdependence. This is
         unlike the relationship between the Active Record and Action Pack that is much
         more separate. Each of these packages can be used independently outside of
        <span class="gd">-Rails.  You can read more about Action Pack in</span>
        <span class="gi">+Rails. You can read more about Action Pack in</span>
         link:files/vendor/rails/actionpack/README.html.
         
         
         == Getting Started
         
        <span class="gd">-1. At the command prompt, start a new Rails application using the &lt;tt&gt;rails&lt;/tt&gt; command</span>
        <span class="gd">-   and your application name. Ex: rails myapp</span>
        <span class="gd">-2. Change directory into myapp and start the web server: &lt;tt&gt;script/server&lt;/tt&gt; (run with --help for options)</span>
        <span class="gd">-3. Go to http://localhost:3000/ and get &quot;Welcome aboard: You&#39;re riding the Rails!&quot;</span>
        <span class="gd">-4. Follow the guidelines to start developing your application</span>
        <span class="gd">-</span>
        <span class="gd">-</span>
        <span class="gd">-== Web Servers</span>
        <span class="gd">-</span>
        <span class="gd">-By default, Rails will try to use Mongrel if it&#39;s are installed when started with script/server, otherwise Rails will use WEBrick, the webserver that ships with Ruby. But you can also use Rails</span>
        <span class="gd">-with a variety of other web servers.</span>
        <span class="gd">-</span>
        <span class="gd">-Mongrel is a Ruby-based webserver with a C component (which requires compilation) that is</span>
        <span class="gd">-suitable for development and deployment of Rails applications. If you have Ruby Gems installed,</span>
        <span class="gd">-getting up and running with mongrel is as easy as: &lt;tt&gt;gem install mongrel&lt;/tt&gt;.</span>
        <span class="gd">-More info at: http://mongrel.rubyforge.org</span>
        <span class="gd">-</span>
        <span class="gd">-Say other Ruby web servers like Thin and Ebb or regular web servers like Apache or LiteSpeed or</span>
        <span class="gd">-Lighttpd or IIS. The Ruby web servers are run through Rack and the latter can either be setup to use</span>
        <span class="gd">-FCGI or proxy to a pack of Mongrels/Thin/Ebb servers.</span>
        <span class="gd">-</span>
        <span class="gd">-== Apache .htaccess example for FCGI/CGI</span>
        <span class="gd">-</span>
        <span class="gd">-# General Apache options</span>
        <span class="gd">-AddHandler fastcgi-script .fcgi</span>
        <span class="gd">-AddHandler cgi-script .cgi</span>
        <span class="gd">-Options +FollowSymLinks +ExecCGI</span>
        <span class="gd">-</span>
        <span class="gd">-# If you don&#39;t want Rails to look in certain directories,</span>
        <span class="gd">-# use the following rewrite rules so that Apache won&#39;t rewrite certain requests</span>
        <span class="gd">-# </span>
        <span class="gd">-# Example:</span>
        <span class="gd">-#   RewriteCond %{REQUEST_URI} ^/notrails.*</span>
        <span class="gd">-#   RewriteRule .* - [L]</span>
        <span class="gd">-</span>
        <span class="gd">-# Redirect all requests not available on the filesystem to Rails</span>
        <span class="gd">-# By default the cgi dispatcher is used which is very slow</span>
        <span class="gd">-# </span>
        <span class="gd">-# For better performance replace the dispatcher with the fastcgi one</span>
        <span class="gd">-#</span>
        <span class="gd">-# Example:</span>
        <span class="gd">-#   RewriteRule ^(.*)$ dispatch.fcgi [QSA,L]</span>
        <span class="gd">-RewriteEngine On</span>
        <span class="gd">-</span>
        <span class="gd">-# If your Rails application is accessed via an Alias directive,</span>
        <span class="gd">-# then you MUST also set the RewriteBase in this htaccess file.</span>
        <span class="gd">-#</span>
        <span class="gd">-# Example:</span>
        <span class="gd">-#   Alias /myrailsapp /path/to/myrailsapp/public</span>
        <span class="gd">-#   RewriteBase /myrailsapp</span>
        <span class="gd">-</span>
        <span class="gd">-RewriteRule ^$ index.html [QSA]</span>
        <span class="gd">-RewriteRule ^([^.]+)$ $1.html [QSA]</span>
        <span class="gd">-RewriteCond %{REQUEST_FILENAME} !-f</span>
        <span class="gd">-RewriteRule ^(.*)$ dispatch.cgi [QSA,L]</span>
        <span class="gd">-</span>
        <span class="gd">-# In case Rails experiences terminal errors</span>
        <span class="gd">-# Instead of displaying this message you can supply a file here which will be rendered instead</span>
        <span class="gd">-# </span>
        <span class="gd">-# Example:</span>
        <span class="gd">-#   ErrorDocument 500 /500.html</span>
        <span class="gi">+1. At the command prompt, create a new Rails application:</span>
        <span class="gi">+       &lt;tt&gt;rails new myapp&lt;/tt&gt; (where &lt;tt&gt;myapp&lt;/tt&gt; is the application name)</span>
         
        <span class="gd">-ErrorDocument 500 &quot;&lt;h2&gt;Application error&lt;/h2&gt;Rails application failed to start properly&quot;</span>
        <span class="gi">+2. Change directory to &lt;tt&gt;myapp&lt;/tt&gt; and start the web server:</span>
        <span class="gi">+       &lt;tt&gt;cd myapp; rails server&lt;/tt&gt; (run with --help for options)</span>
        <span class="gi">+</span>
        <span class="gi">+3. Go to http://localhost:3000/ and you&#39;ll see:</span>
        <span class="gi">+       &quot;Welcome aboard: You&#39;re riding Ruby on Rails!&quot;</span>
        <span class="gi">+</span>
        <span class="gi">+4. Follow the guidelines to start developing your application. You can find</span>
        <span class="gi">+the following resources handy:</span>
        <span class="gi">+</span>
        <span class="gi">+* The Getting Started Guide: http://guides.rubyonrails.org/getting_started.html</span>
        <span class="gi">+* Ruby on Rails Tutorial Book: http://www.railstutorial.org/</span>
         
         
         == Debugging Rails
         
        <span class="gd">-Sometimes your application goes wrong.  Fortunately there are a lot of tools that</span>
        <span class="gi">+Sometimes your application goes wrong. Fortunately there are a lot of tools that</span>
         will help you debug it and get it back on the rails.
         
        <span class="gd">-First area to check is the application log files.  Have &quot;tail -f&quot; commands running</span>
        <span class="gd">-on the server.log and development.log. Rails will automatically display debugging</span>
        <span class="gd">-and runtime information to these files. Debugging info will also be shown in the</span>
        <span class="gd">-browser on requests from 127.0.0.1.</span>
        <span class="gi">+First area to check is the application log files. Have &quot;tail -f&quot; commands</span>
        <span class="gi">+running on the server.log and development.log. Rails will automatically display</span>
        <span class="gi">+debugging and runtime information to these files. Debugging info will also be</span>
        <span class="gi">+shown in the browser on requests from 127.0.0.1.</span>
         
        <span class="gd">-You can also log your own messages directly into the log file from your code using</span>
        <span class="gd">-the Ruby logger class from inside your controllers. Example:</span>
        <span class="gi">+You can also log your own messages directly into the log file from your code</span>
        <span class="gi">+using the Ruby logger class from inside your controllers. Example:</span>
         
           class WeblogController &lt; ActionController::Base
             def destroy
               @weblog = Weblog.find(params[:id])
               @weblog.destroy
               logger.info(&quot;#{Time.now} Destroyed Weblog ID ##{@weblog.id}!&quot;)
             end
           end
         
         The result will be a message in your log file along the lines of:
         
        <span class="gd">-  Mon Oct 08 14:22:29 +1000 2007 Destroyed Weblog ID #1</span>
        <span class="gi">+  Mon Oct 08 14:22:29 +1000 2007 Destroyed Weblog ID #1!</span>
         
         More information on how to use the logger is at http://www.ruby-doc.org/core/
         
        <span class="gd">-Also, Ruby documentation can be found at http://www.ruby-lang.org/ including:</span>
        <span class="gi">+Also, Ruby documentation can be found at http://www.ruby-lang.org/. There are</span>
        <span class="gi">+several books available online as well:</span>
         
        <span class="gd">-* The Learning Ruby (Pickaxe) Book: http://www.ruby-doc.org/docs/ProgrammingRuby/</span>
        <span class="gd">-* Learn to Program: http://pine.fm/LearnToProgram/  (a beginners guide)</span>
        <span class="gi">+* Programming Ruby: http://www.ruby-doc.org/docs/ProgrammingRuby/ (Pickaxe)</span>
        <span class="gi">+* Learn to Program: http://pine.fm/LearnToProgram/ (a beginners guide)</span>
         
        <span class="gd">-These two online (and free) books will bring you up to speed on the Ruby language</span>
        <span class="gd">-and also on programming in general.</span>
        <span class="gi">+These two books will bring you up to speed on the Ruby language and also on</span>
        <span class="gi">+programming in general.</span>
         
         
         == Debugger
         
        <span class="gd">-Debugger support is available through the debugger command when you start your Mongrel or</span>
        <span class="gd">-Webrick server with --debugger. This means that you can break out of execution at any point</span>
        <span class="gd">-in the code, investigate and change the model, AND then resume execution! </span>
        <span class="gd">-You need to install ruby-debug to run the server in debugging mode. With gems, use &#39;gem install ruby-debug&#39;</span>
        <span class="gd">-Example:</span>
        <span class="gi">+Debugger support is available through the debugger command when you start your</span>
        <span class="gi">+Mongrel or WEBrick server with --debugger. This means that you can break out of</span>
        <span class="gi">+execution at any point in the code, investigate and change the model, and then,</span>
        <span class="gi">+resume execution! You need to install ruby-debug to run the server in debugging</span>
        <span class="gi">+mode. With gems, use &lt;tt&gt;sudo gem install ruby-debug&lt;/tt&gt;. Example:</span>
         
           class WeblogController &lt; ActionController::Base
             def index
               @posts = Post.find(:all)
               debugger
             end
           end
         
         So the controller will accept the action, run the first line, then present you
         with a IRB prompt in the server window. Here you can do things like:
         
           &gt;&gt; @posts.inspect
        <span class="gd">-  =&gt; &quot;[#&lt;Post:0x14a6be8 @attributes={\&quot;title\&quot;=&gt;nil, \&quot;body\&quot;=&gt;nil, \&quot;id\&quot;=&gt;\&quot;1\&quot;}&gt;,</span>
        <span class="gd">-       #&lt;Post:0x14a6620 @attributes={\&quot;title\&quot;=&gt;\&quot;Rails you know!\&quot;, \&quot;body\&quot;=&gt;\&quot;Only ten..\&quot;, \&quot;id\&quot;=&gt;\&quot;2\&quot;}&gt;]&quot;</span>
        <span class="gi">+  =&gt; &quot;[#&lt;Post:0x14a6be8</span>
        <span class="gi">+          @attributes={&quot;title&quot;=&gt;nil, &quot;body&quot;=&gt;nil, &quot;id&quot;=&gt;&quot;1&quot;}&gt;,</span>
        <span class="gi">+       #&lt;Post:0x14a6620</span>
        <span class="gi">+          @attributes={&quot;title&quot;=&gt;&quot;Rails&quot;, &quot;body&quot;=&gt;&quot;Only ten..&quot;, &quot;id&quot;=&gt;&quot;2&quot;}&gt;]&quot;</span>
           &gt;&gt; @posts.first.title = &quot;hello from a debugger&quot;
           =&gt; &quot;hello from a debugger&quot;
         
        <span class="gd">-...and even better is that you can examine how your runtime objects actually work:</span>
        <span class="gi">+...and even better, you can examine how your runtime objects actually work:</span>
         
           &gt;&gt; f = @posts.first
           =&gt; #&lt;Post:0x13630c4 @attributes={&quot;title&quot;=&gt;nil, &quot;body&quot;=&gt;nil, &quot;id&quot;=&gt;&quot;1&quot;}&gt;
           &gt;&gt; f.
           Display all 152 possibilities? (y or n)
         
        <span class="gd">-Finally, when you&#39;re ready to resume execution, you enter &quot;cont&quot;</span>
        <span class="gi">+Finally, when you&#39;re ready to resume execution, you can enter &quot;cont&quot;.</span>
         
         
         == Console
         
        <span class="gd">-You can interact with the domain model by starting the console through &lt;tt&gt;script/console&lt;/tt&gt;.</span>
        <span class="gd">-Here you&#39;ll have all parts of the application configured, just like it is when the</span>
        <span class="gd">-application is running. You can inspect domain models, change values, and save to the</span>
        <span class="gd">-database. Starting the script without arguments will launch it in the development environment.</span>
        <span class="gd">-Passing an argument will specify a different environment, like &lt;tt&gt;script/console production&lt;/tt&gt;.</span>
        <span class="gi">+The console is a Ruby shell, which allows you to interact with your</span>
        <span class="gi">+application&#39;s domain model. Here you&#39;ll have all parts of the application</span>
        <span class="gi">+configured, just like it is when the application is running. You can inspect</span>
        <span class="gi">+domain models, change values, and save to the database. Starting the script</span>
        <span class="gi">+without arguments will launch it in the development environment.</span>
        <span class="gi">+</span>
        <span class="gi">+To start the console, run &lt;tt&gt;rails console&lt;/tt&gt; from the application</span>
        <span class="gi">+directory.</span>
        <span class="gi">+</span>
        <span class="gi">+Options:</span>
        <span class="gi">+</span>
        <span class="gi">+* Passing the &lt;tt&gt;-s, --sandbox&lt;/tt&gt; argument will rollback any modifications</span>
        <span class="gi">+  made to the database.</span>
        <span class="gi">+* Passing an environment name as an argument will load the corresponding</span>
        <span class="gi">+  environment. Example: &lt;tt&gt;rails console production&lt;/tt&gt;.</span>
        <span class="gi">+</span>
        <span class="gi">+To reload your controllers and models after launching the console run</span>
        <span class="gi">+&lt;tt&gt;reload!&lt;/tt&gt;</span>
        <span class="gi">+</span>
        <span class="gi">+More information about irb can be found at:</span>
        <span class="gi">+link:http://www.rubycentral.com/pickaxe/irb.html</span>
         
        <span class="gd">-To reload your controllers and models after launching the console run &lt;tt&gt;reload!&lt;/tt&gt;</span>
         
         == dbconsole
         
        <span class="gd">-You can go to the command line of your database directly through &lt;tt&gt;script/dbconsole&lt;/tt&gt;.</span>
        <span class="gd">-You would be connected to the database with the credentials defined in database.yml.</span>
        <span class="gd">-Starting the script without arguments will connect you to the development database. Passing an</span>
        <span class="gd">-argument will connect you to a different database, like &lt;tt&gt;script/dbconsole production&lt;/tt&gt;.</span>
        <span class="gd">-Currently works for mysql, postgresql and sqlite.</span>
        <span class="gi">+You can go to the command line of your database directly through &lt;tt&gt;rails</span>
        <span class="gi">+dbconsole&lt;/tt&gt;. You would be connected to the database with the credentials</span>
        <span class="gi">+defined in database.yml. Starting the script without arguments will connect you</span>
        <span class="gi">+to the development database. Passing an argument will connect you to a different</span>
        <span class="gi">+database, like &lt;tt&gt;rails dbconsole production&lt;/tt&gt;. Currently works for MySQL,</span>
        <span class="gi">+PostgreSQL and SQLite 3.</span>
         
         == Description of Contents
         
        <span class="gi">+The default directory structure of a generated Ruby on Rails application:</span>
        <span class="gi">+</span>
        <span class="gi">+  |-- app</span>
        <span class="gi">+  |   |-- controllers</span>
        <span class="gi">+  |   |-- helpers</span>
        <span class="gi">+  |   |-- models</span>
        <span class="gi">+  |   `-- views</span>
        <span class="gi">+  |       `-- layouts</span>
        <span class="gi">+  |-- config</span>
        <span class="gi">+  |   |-- environments</span>
        <span class="gi">+  |   |-- initializers</span>
        <span class="gi">+  |   `-- locales</span>
        <span class="gi">+  |-- db</span>
        <span class="gi">+  |-- doc</span>
        <span class="gi">+  |-- lib</span>
        <span class="gi">+  |   `-- tasks</span>
        <span class="gi">+  |-- log</span>
        <span class="gi">+  |-- public</span>
        <span class="gi">+  |   |-- images</span>
        <span class="gi">+  |   |-- javascripts</span>
        <span class="gi">+  |   `-- stylesheets</span>
        <span class="gi">+  |-- script</span>
        <span class="gi">+  |   `-- performance</span>
        <span class="gi">+  |-- test</span>
        <span class="gi">+  |   |-- fixtures</span>
        <span class="gi">+  |   |-- functional</span>
        <span class="gi">+  |   |-- integration</span>
        <span class="gi">+  |   |-- performance</span>
        <span class="gi">+  |   `-- unit</span>
        <span class="gi">+  |-- tmp</span>
        <span class="gi">+  |   |-- cache</span>
        <span class="gi">+  |   |-- pids</span>
        <span class="gi">+  |   |-- sessions</span>
        <span class="gi">+  |   `-- sockets</span>
        <span class="gi">+  `-- vendor</span>
        <span class="gi">+      `-- plugins</span>
        <span class="gi">+</span>
         app
           Holds all the code that&#39;s specific to this particular application.
         
         app/controllers
           Holds controllers that should be named like weblogs_controller.rb for
        <span class="gd">-  automated URL mapping. All controllers should descend from ApplicationController</span>
        <span class="gd">-  which itself descends from ActionController::Base.</span>
        <span class="gi">+  automated URL mapping. All controllers should descend from</span>
        <span class="gi">+  ApplicationController which itself descends from ActionController::Base.</span>
         
         app/models
        <span class="gd">-  Holds models that should be named like post.rb.</span>
        <span class="gd">-  Most models will descend from ActiveRecord::Base.</span>
        <span class="gi">+  Holds models that should be named like post.rb. Models descend from</span>
        <span class="gi">+  ActiveRecord::Base by default.</span>
         
         app/views
           Holds the template files for the view that should be named like
        <span class="gd">-  weblogs/index.html.erb for the WeblogsController#index action. All views use eRuby</span>
        <span class="gd">-  syntax.</span>
        <span class="gi">+  weblogs/index.html.erb for the WeblogsController#index action. All views use</span>
        <span class="gi">+  eRuby syntax by default.</span>
         
         app/views/layouts
        <span class="gd">-  Holds the template files for layouts to be used with views. This models the common</span>
        <span class="gd">-  header/footer method of wrapping views. In your views, define a layout using the</span>
        <span class="gd">-  &lt;tt&gt;layout :default&lt;/tt&gt; and create a file named default.html.erb. Inside default.html.erb,</span>
        <span class="gd">-  call &lt;% yield %&gt; to render the view using this layout.</span>
        <span class="gi">+  Holds the template files for layouts to be used with views. This models the</span>
        <span class="gi">+  common header/footer method of wrapping views. In your views, define a layout</span>
        <span class="gi">+  using the &lt;tt&gt;layout :default&lt;/tt&gt; and create a file named default.html.erb.</span>
        <span class="gi">+  Inside default.html.erb, call &lt;% yield %&gt; to render the view using this</span>
        <span class="gi">+  layout.</span>
         
         app/helpers
        <span class="gd">-  Holds view helpers that should be named like weblogs_helper.rb. These are generated</span>
        <span class="gd">-  for you automatically when using script/generate for controllers. Helpers can be used to</span>
        <span class="gd">-  wrap functionality for your views into methods.</span>
        <span class="gi">+  Holds view helpers that should be named like weblogs_helper.rb. These are</span>
        <span class="gi">+  generated for you automatically when using generators for controllers.</span>
        <span class="gi">+  Helpers can be used to wrap functionality for your views into methods.</span>
         
         config
        <span class="gd">-  Configuration files for the Rails environment, the routing map, the database, and other dependencies.</span>
        <span class="gi">+  Configuration files for the Rails environment, the routing map, the database,</span>
        <span class="gi">+  and other dependencies.</span>
         
         db
        <span class="gd">-  Contains the database schema in schema.rb.  db/migrate contains all</span>
        <span class="gd">-  the sequence of Migrations for your schema.</span>
        <span class="gi">+  Contains the database schema in schema.rb. db/migrate contains all the</span>
        <span class="gi">+  sequence of Migrations for your schema.</span>
         
         doc
        <span class="gd">-  This directory is where your application documentation will be stored when generated</span>
        <span class="gd">-  using &lt;tt&gt;rake doc:app&lt;/tt&gt;</span>
        <span class="gi">+  This directory is where your application documentation will be stored when</span>
        <span class="gi">+  generated using &lt;tt&gt;rake doc:app&lt;/tt&gt;</span>
         
         lib
        <span class="gd">-  Application specific libraries. Basically, any kind of custom code that doesn&#39;t</span>
        <span class="gd">-  belong under controllers, models, or helpers. This directory is in the load path.</span>
        <span class="gi">+  Application specific libraries. Basically, any kind of custom code that</span>
        <span class="gi">+  doesn&#39;t belong under controllers, models, or helpers. This directory is in</span>
        <span class="gi">+  the load path.</span>
         
         public
        <span class="gd">-  The directory available for the web server. Contains subdirectories for images, stylesheets,</span>
        <span class="gd">-  and javascripts. Also contains the dispatchers and the default HTML files. This should be</span>
        <span class="gd">-  set as the DOCUMENT_ROOT of your web server.</span>
        <span class="gi">+  The directory available for the web server. Contains subdirectories for</span>
        <span class="gi">+  images, stylesheets, and javascripts. Also contains the dispatchers and the</span>
        <span class="gi">+  default HTML files. This should be set as the DOCUMENT_ROOT of your web</span>
        <span class="gi">+  server.</span>
         
         script
           Helper scripts for automation and generation.
         
         test
        <span class="gd">-  Unit and functional tests along with fixtures. When using the script/generate scripts, template</span>
        <span class="gd">-  test files will be generated for you and placed in this directory.</span>
        <span class="gi">+  Unit and functional tests along with fixtures. When using the rails generate</span>
        <span class="gi">+  command, template test files will be generated for you and placed in this</span>
        <span class="gi">+  directory.</span>
         
         vendor
        <span class="gd">-  External libraries that the application depends on. Also includes the plugins subdirectory.</span>
        <span class="gd">-  If the app has frozen rails, those gems also go here, under vendor/rails/.</span>
        <span class="gd">-  This directory is in the load path.</span>
        <span class="gi">+  External libraries that the application depends on. Also includes the plugins</span>
        <span class="gi">+  subdirectory. If the app has frozen rails, those gems also go here, under</span>
        <span class="gi">+  vendor/rails/. This directory is in the load path.</span>
        </pre></div>
        <h2 id='Rakefile'>Rakefile</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,10 +1,7 @@</span>
         # Add your own tasks in files placed in lib/tasks ending in .rake,
         # for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.
         
        <span class="gd">-require(File.join(File.dirname(__FILE__), &#39;config&#39;, &#39;boot&#39;))</span>
        <span class="gd">-</span>
        <span class="gi">+require File.expand_path(&#39;../config/application&#39;, __FILE__)</span>
         require &#39;rake&#39;
        <span class="gd">-require &#39;rake/testtask&#39;</span>
        <span class="gd">-require &#39;rake/rdoctask&#39;</span>
         
        <span class="gd">-require &#39;tasks/rails&#39;</span>
        <span class="gi">+Railsdiff::Application.load_tasks</span>
        </pre></div>
        <h2 id='app-controllers-application_controller-rb'>app/controllers/application_controller.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,10 +1,3 @@</span>
        <span class="gd">-# Filters added to this controller apply to all controllers in the application.</span>
        <span class="gd">-# Likewise, all the methods added will be available for all controllers.</span>
        <span class="gd">-</span>
         class ApplicationController &lt; ActionController::Base
        <span class="gd">-  helper :all # include all helpers, all the time</span>
        <span class="gd">-  protect_from_forgery # See ActionController::RequestForgeryProtection for details</span>
        <span class="gd">-</span>
        <span class="gd">-  # Scrub sensitive parameters from your log</span>
        <span class="gd">-  # filter_parameter_logging :password</span>
        <span class="gi">+  protect_from_forgery</span>
         end
        </pre></div>
        <h2 id='app-helpers-application_helper-rb'>app/helpers/application_helper.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +1,2 @@</span>
        <span class="gd">-# Methods added to this helper will be available to all templates in the application.</span>
         module ApplicationHelper
         end
        </pre></div>
        <h2 id='app-views-layouts-application-html-erb'>app/views/layouts/application.html.erb</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,14 @@</span>
        <span class="gi">+&lt;!DOCTYPE html&gt;</span>
        <span class="gi">+&lt;html&gt;</span>
        <span class="gi">+&lt;head&gt;</span>
        <span class="gi">+  &lt;title&gt;Railsdiff&lt;/title&gt;</span>
        <span class="gi">+  &lt;%= stylesheet_link_tag :all %&gt;</span>
        <span class="gi">+  &lt;%= javascript_include_tag :defaults %&gt;</span>
        <span class="gi">+  &lt;%= csrf_meta_tag %&gt;</span>
        <span class="gi">+&lt;/head&gt;</span>
        <span class="gi">+&lt;body&gt;</span>
        <span class="gi">+</span>
        <span class="gi">+&lt;%= yield %&gt;</span>
        <span class="gi">+</span>
        <span class="gi">+&lt;/body&gt;</span>
        <span class="gi">+&lt;/html&gt;</span>
        </pre></div>
        <h2 id='config-application-rb'>config/application.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,42 @@</span>
        <span class="gi">+require File.expand_path(&#39;../boot&#39;, __FILE__)</span>
        <span class="gi">+</span>
        <span class="gi">+require &#39;rails/all&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+# If you have a Gemfile, require the gems listed there, including any gems</span>
        <span class="gi">+# you&#39;ve limited to :test, :development, or :production.</span>
        <span class="gi">+Bundler.require(:default, Rails.env) if defined?(Bundler)</span>
        <span class="gi">+</span>
        <span class="gi">+module Railsdiff</span>
        <span class="gi">+  class Application &lt; Rails::Application</span>
        <span class="gi">+    # Settings in config/environments/* take precedence over those specified here.</span>
        <span class="gi">+    # Application configuration should go into files in config/initializers</span>
        <span class="gi">+    # -- all .rb files in that directory are automatically loaded.</span>
        <span class="gi">+</span>
        <span class="gi">+    # Custom directories with classes and modules you want to be autoloadable.</span>
        <span class="gi">+    # config.autoload_paths += %W(#{config.root}/extras)</span>
        <span class="gi">+</span>
        <span class="gi">+    # Only load the plugins named here, in the order given (default is alphabetical).</span>
        <span class="gi">+    # :all can be used as a placeholder for all plugins not explicitly named.</span>
        <span class="gi">+    # config.plugins = [ :exception_notification, :ssl_requirement, :all ]</span>
        <span class="gi">+</span>
        <span class="gi">+    # Activate observers that should always be running.</span>
        <span class="gi">+    # config.active_record.observers = :cacher, :garbage_collector, :forum_observer</span>
        <span class="gi">+</span>
        <span class="gi">+    # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.</span>
        <span class="gi">+    # Run &quot;rake -D time&quot; for a list of tasks for finding time zone names. Default is UTC.</span>
        <span class="gi">+    # config.time_zone = &#39;Central Time (US &amp; Canada)&#39;</span>
        <span class="gi">+</span>
        <span class="gi">+    # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.</span>
        <span class="gi">+    # config.i18n.load_path += Dir[Rails.root.join(&#39;my&#39;, &#39;locales&#39;, &#39;*.{rb,yml}&#39;).to_s]</span>
        <span class="gi">+    # config.i18n.default_locale = :de</span>
        <span class="gi">+</span>
        <span class="gi">+    # JavaScript files you want as :defaults (application.js is always included).</span>
        <span class="gi">+    # config.action_view.javascript_expansions[:defaults] = %w(jquery rails)</span>
        <span class="gi">+</span>
        <span class="gi">+    # Configure the default encoding used in templates for Ruby 1.9.</span>
        <span class="gi">+    config.encoding = &quot;utf-8&quot;</span>
        <span class="gi">+</span>
        <span class="gi">+    # Configure sensitive parameters which will be filtered from the log file.</span>
        <span class="gi">+    config.filter_parameters += [:password]</span>
        <span class="gi">+  end</span>
        <span class="gi">+end</span>
        </pre></div>
        <h2 id='config-boot-rb'>config/boot.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,114 +1,13 @@</span>
        <span class="gd">-# Don&#39;t change this file!</span>
        <span class="gd">-# Configure your app in config/environment.rb and config/environments/*.rb</span>
        <span class="gi">+require &#39;rubygems&#39;</span>
         
        <span class="gd">-RAILS_ROOT = &quot;#{File.dirname(__FILE__)}/..&quot; unless defined?(RAILS_ROOT)</span>
        <span class="gd">-</span>
        <span class="gd">-module Rails</span>
        <span class="gd">-  class &lt;&lt; self</span>
        <span class="gd">-    def boot!</span>
        <span class="gd">-      unless booted?</span>
        <span class="gd">-        preinitialize</span>
        <span class="gd">-        pick_boot.run</span>
        <span class="gd">-      end</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    def booted?</span>
        <span class="gd">-      defined? Rails::Initializer</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    def pick_boot</span>
        <span class="gd">-      (vendor_rails? ? VendorBoot : GemBoot).new</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    def vendor_rails?</span>
        <span class="gd">-      File.exist?(&quot;#{RAILS_ROOT}/vendor/rails&quot;)</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    def preinitialize</span>
        <span class="gd">-      load(preinitializer_path) if File.exist?(preinitializer_path)</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    def preinitializer_path</span>
        <span class="gd">-      &quot;#{RAILS_ROOT}/config/preinitializer.rb&quot;</span>
        <span class="gd">-    end</span>
        <span class="gd">-  end</span>
        <span class="gd">-</span>
        <span class="gd">-  class Boot</span>
        <span class="gd">-    def run</span>
        <span class="gd">-      load_initializer</span>
        <span class="gd">-      Rails::Initializer.run(:set_load_path)</span>
        <span class="gd">-    end</span>
        <span class="gd">-  end</span>
        <span class="gd">-</span>
        <span class="gd">-  class VendorBoot &lt; Boot</span>
        <span class="gd">-    def load_initializer</span>
        <span class="gd">-      require &quot;#{RAILS_ROOT}/vendor/rails/railties/lib/initializer&quot;</span>
        <span class="gd">-      Rails::Initializer.run(:install_gem_spec_stubs)</span>
        <span class="gd">-      Rails::GemDependency.add_frozen_gem_path</span>
        <span class="gd">-    end</span>
        <span class="gd">-  end</span>
        <span class="gd">-</span>
        <span class="gd">-  class GemBoot &lt; Boot</span>
        <span class="gd">-    def load_initializer</span>
        <span class="gd">-      self.class.load_rubygems</span>
        <span class="gd">-      load_rails_gem</span>
        <span class="gd">-      require &#39;initializer&#39;</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    def load_rails_gem</span>
        <span class="gd">-      if version = self.class.gem_version</span>
        <span class="gd">-        gem &#39;rails&#39;, version</span>
        <span class="gd">-      else</span>
        <span class="gd">-        gem &#39;rails&#39;</span>
        <span class="gd">-      end</span>
        <span class="gd">-    rescue Gem::LoadError =&gt; load_error</span>
        <span class="gd">-      if load_error.message =~ /Could not find RubyGem rails/</span>
        <span class="gd">-        STDERR.puts %(Missing the Rails #{version} gem. Please `gem install -v=#{version} rails`, update your RAILS_GEM_VERSION setting in config/environment.rb for the Rails version you do have installed, or comment out RAILS_GEM_VERSION to use the latest version installed.)</span>
        <span class="gd">-        exit 1</span>
        <span class="gd">-      else</span>
        <span class="gd">-        raise</span>
        <span class="gd">-      end</span>
        <span class="gd">-    end</span>
        <span class="gd">-</span>
        <span class="gd">-    class &lt;&lt; self</span>
        <span class="gd">-      def rubygems_version</span>
        <span class="gd">-        Gem::RubyGemsVersion rescue nil</span>
        <span class="gd">-      end</span>
        <span class="gd">-</span>
        <span class="gd">-      def gem_version</span>
        <span class="gd">-        if defined? RAILS_GEM_VERSION</span>
        <span class="gd">-          RAILS_GEM_VERSION</span>
        <span class="gd">-        elsif ENV.include?(&#39;RAILS_GEM_VERSION&#39;)</span>
        <span class="gd">-          ENV[&#39;RAILS_GEM_VERSION&#39;]</span>
        <span class="gd">-        else</span>
        <span class="gd">-          parse_gem_version(read_environment_rb)</span>
        <span class="gd">-        end</span>
        <span class="gd">-      end</span>
        <span class="gd">-</span>
        <span class="gd">-      def load_rubygems</span>
        <span class="gd">-        min_version = &#39;1.3.2&#39;</span>
        <span class="gd">-        require &#39;rubygems&#39;</span>
        <span class="gd">-        unless rubygems_version &gt;= min_version</span>
        <span class="gd">-          $stderr.puts %Q(Rails requires RubyGems &gt;= #{min_version} (you have #{rubygems_version}). Please `gem update --system` and try again.)</span>
        <span class="gd">-          exit 1</span>
        <span class="gd">-        end</span>
        <span class="gd">-</span>
        <span class="gd">-      rescue LoadError</span>
        <span class="gd">-        $stderr.puts %Q(Rails requires RubyGems &gt;= #{min_version}. Please install RubyGems and try again: http://rubygems.rubyforge.org)</span>
        <span class="gd">-        exit 1</span>
        <span class="gd">-      end</span>
        <span class="gd">-</span>
        <span class="gd">-      def parse_gem_version(text)</span>
        <span class="gd">-        $1 if text =~ /^[^#]*RAILS_GEM_VERSION\s*=\s*[&quot;&#39;]([!~&lt;&gt;=]*\s*[\d.]+)[&quot;&#39;]/</span>
        <span class="gd">-      end</span>
        <span class="gd">-</span>
        <span class="gd">-      private</span>
        <span class="gd">-        def read_environment_rb</span>
        <span class="gd">-          File.read(&quot;#{RAILS_ROOT}/config/environment.rb&quot;)</span>
        <span class="gd">-        end</span>
        <span class="gd">-    end</span>
        <span class="gd">-  end</span>
        <span class="gd">-end</span>
        <span class="gd">-</span>
        <span class="gd">-# All that for this:</span>
        <span class="gd">-Rails.boot!</span>
        <span class="gi">+# Set up gems listed in the Gemfile.</span>
        <span class="gi">+gemfile = File.expand_path(&#39;../../Gemfile&#39;, __FILE__)</span>
        <span class="gi">+begin</span>
        <span class="gi">+  ENV[&#39;BUNDLE_GEMFILE&#39;] = gemfile</span>
        <span class="gi">+  require &#39;bundler&#39;</span>
        <span class="gi">+  Bundler.setup</span>
        <span class="gi">+rescue Bundler::GemNotFound =&gt; e</span>
        <span class="gi">+  STDERR.puts e.message</span>
        <span class="gi">+  STDERR.puts &quot;Try running `bundle install`.&quot;</span>
        <span class="gi">+  exit!</span>
        <span class="gi">+end if File.exist?(gemfile)</span>
        </pre></div>
        <h2 id='config-environment-rb'>config/environment.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,41 +1,5 @@</span>
        <span class="gd">-# Be sure to restart your server when you modify this file</span>
        <span class="gi">+# Load the rails application</span>
        <span class="gi">+require File.expand_path(&#39;../application&#39;, __FILE__)</span>
         
        <span class="gd">-# Specifies gem version of Rails to use when vendor/rails is not present</span>
        <span class="gd">-RAILS_GEM_VERSION = &#39;2.3.15&#39; unless defined? RAILS_GEM_VERSION</span>
        <span class="gd">-</span>
        <span class="gd">-# Bootstrap the Rails environment, frameworks, and default configuration</span>
        <span class="gd">-require File.join(File.dirname(__FILE__), &#39;boot&#39;)</span>
        <span class="gd">-</span>
        <span class="gd">-Rails::Initializer.run do |config|</span>
        <span class="gd">-  # Settings in config/environments/* take precedence over those specified here.</span>
        <span class="gd">-  # Application configuration should go into files in config/initializers</span>
        <span class="gd">-  # -- all .rb files in that directory are automatically loaded.</span>
        <span class="gd">-</span>
        <span class="gd">-  # Add additional load paths for your own custom dirs</span>
        <span class="gd">-  # config.autoload_paths += %W( #{RAILS_ROOT}/extras )</span>
        <span class="gd">-</span>
        <span class="gd">-  # Specify gems that this application depends on and have them installed with rake gems:install</span>
        <span class="gd">-  # config.gem &quot;bj&quot;</span>
        <span class="gd">-  # config.gem &quot;hpricot&quot;, :version =&gt; &#39;0.6&#39;, :source =&gt; &quot;http://code.whytheluckystiff.net&quot;</span>
        <span class="gd">-  # config.gem &quot;sqlite3-ruby&quot;, :lib =&gt; &quot;sqlite3&quot;</span>
        <span class="gd">-  # config.gem &quot;aws-s3&quot;, :lib =&gt; &quot;aws/s3&quot;</span>
        <span class="gd">-</span>
        <span class="gd">-  # Only load the plugins named here, in the order given (default is alphabetical).</span>
        <span class="gd">-  # :all can be used as a placeholder for all plugins not explicitly named</span>
        <span class="gd">-  # config.plugins = [ :exception_notification, :ssl_requirement, :all ]</span>
        <span class="gd">-</span>
        <span class="gd">-  # Skip frameworks you&#39;re not going to use. To use Rails without a database,</span>
        <span class="gd">-  # you must remove the Active Record framework.</span>
        <span class="gd">-  # config.frameworks -= [ :active_record, :active_resource, :action_mailer ]</span>
        <span class="gd">-</span>
        <span class="gd">-  # Activate observers that should always be running</span>
        <span class="gd">-  # config.active_record.observers = :cacher, :garbage_collector, :forum_observer</span>
        <span class="gd">-</span>
        <span class="gd">-  # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.</span>
        <span class="gd">-  # Run &quot;rake -D time&quot; for a list of tasks for finding time zone names.</span>
        <span class="gd">-  config.time_zone = &#39;UTC&#39;</span>
        <span class="gd">-</span>
        <span class="gd">-  # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.</span>
        <span class="gd">-  # config.i18n.load_path += Dir[Rails.root.join(&#39;my&#39;, &#39;locales&#39;, &#39;*.{rb,yml}&#39;)]</span>
        <span class="gd">-  # config.i18n.default_locale = :de</span>
        <span class="gd">-end</span>
        \ No newline at end of file
        <span class="gi">+# Initialize the rails application</span>
        <span class="gi">+Railsdiff::Application.initialize!</span>
        </pre></div>
        <h2 id='config-environments-development-rb'>config/environments/development.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,17 +1,26 @@</span>
        <span class="gd">-# Settings specified here will take precedence over those in config/environment.rb</span>
        <span class="gi">+Railsdiff::Application.configure do</span>
        <span class="gi">+  # Settings specified here will take precedence over those in config/environment.rb</span>
         
        <span class="gd">-# In the development environment your application&#39;s code is reloaded on</span>
        <span class="gd">-# every request.  This slows down response time but is perfect for development</span>
        <span class="gd">-# since you don&#39;t have to restart the webserver when you make code changes.</span>
        <span class="gd">-config.cache_classes = false</span>
        <span class="gd">-</span>
        <span class="gd">-# Log error messages when you accidentally call methods on nil.</span>
        <span class="gd">-config.whiny_nils = true</span>
        <span class="gd">-</span>
        <span class="gd">-# Show full error reports and disable caching</span>
        <span class="gd">-config.action_controller.consider_all_requests_local = true</span>
        <span class="gd">-config.action_view.debug_rjs                         = true</span>
        <span class="gd">-config.action_controller.perform_caching             = false</span>
        <span class="gi">+  # In the development environment your application&#39;s code is reloaded on</span>
        <span class="gi">+  # every request.  This slows down response time but is perfect for development</span>
        <span class="gi">+  # since you don&#39;t have to restart the webserver when you make code changes.</span>
        <span class="gi">+  config.cache_classes = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Log error messages when you accidentally call methods on nil.</span>
        <span class="gi">+  config.whiny_nils = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Show full error reports and disable caching</span>
        <span class="gi">+  config.consider_all_requests_local       = true</span>
        <span class="gi">+  config.action_view.debug_rjs             = true</span>
        <span class="gi">+  config.action_controller.perform_caching = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Don&#39;t care if the mailer can&#39;t send</span>
        <span class="gi">+  config.action_mailer.raise_delivery_errors = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Print deprecation notices to the Rails logger</span>
        <span class="gi">+  config.active_support.deprecation = :log</span>
        <span class="gi">+</span>
        <span class="gi">+  # Only use best-standards-support built into browsers</span>
        <span class="gi">+  config.action_dispatch.best_standards_support = :builtin</span>
        <span class="gi">+end</span>
         
        <span class="gd">-# Don&#39;t care if the mailer can&#39;t send</span>
        <span class="gd">-config.action_mailer.raise_delivery_errors = false</span>
        \ No newline at end of file
        </pre></div>
        <h2 id='config-environments-production-rb'>config/environments/production.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,28 +1,49 @@</span>
        <span class="gd">-# Settings specified here will take precedence over those in config/environment.rb</span>
        <span class="gi">+Railsdiff::Application.configure do</span>
        <span class="gi">+  # Settings specified here will take precedence over those in config/environment.rb</span>
         
        <span class="gd">-# The production environment is meant for finished, &quot;live&quot; apps.</span>
        <span class="gd">-# Code is not reloaded between requests</span>
        <span class="gd">-config.cache_classes = true</span>
        <span class="gi">+  # The production environment is meant for finished, &quot;live&quot; apps.</span>
        <span class="gi">+  # Code is not reloaded between requests</span>
        <span class="gi">+  config.cache_classes = true</span>
         
        <span class="gd">-# Full error reports are disabled and caching is turned on</span>
        <span class="gd">-config.action_controller.consider_all_requests_local = false</span>
        <span class="gd">-config.action_controller.perform_caching             = true</span>
        <span class="gd">-config.action_view.cache_template_loading            = true</span>
        <span class="gi">+  # Full error reports are disabled and caching is turned on</span>
        <span class="gi">+  config.consider_all_requests_local       = false</span>
        <span class="gi">+  config.action_controller.perform_caching = true</span>
         
        <span class="gd">-# See everything in the log (default is :info)</span>
        <span class="gd">-# config.log_level = :debug</span>
        <span class="gi">+  # Specifies the header that your server uses for sending files</span>
        <span class="gi">+  config.action_dispatch.x_sendfile_header = &quot;X-Sendfile&quot;</span>
         
        <span class="gd">-# Use a different logger for distributed setups</span>
        <span class="gd">-# config.logger = SyslogLogger.new</span>
        <span class="gi">+  # For nginx:</span>
        <span class="gi">+  # config.action_dispatch.x_sendfile_header = &#39;X-Accel-Redirect&#39;</span>
         
        <span class="gd">-# Use a different cache store in production</span>
        <span class="gd">-# config.cache_store = :mem_cache_store</span>
        <span class="gi">+  # If you have no front-end server that supports something like X-Sendfile,</span>
        <span class="gi">+  # just comment this out and Rails will serve the files</span>
         
        <span class="gd">-# Enable serving of images, stylesheets, and javascripts from an asset server</span>
        <span class="gd">-# config.action_controller.asset_host = &quot;http://assets.example.com&quot;</span>
        <span class="gi">+  # See everything in the log (default is :info)</span>
        <span class="gi">+  # config.log_level = :debug</span>
         
        <span class="gd">-# Disable delivery errors, bad email addresses will be ignored</span>
        <span class="gd">-# config.action_mailer.raise_delivery_errors = false</span>
        <span class="gi">+  # Use a different logger for distributed setups</span>
        <span class="gi">+  # config.logger = SyslogLogger.new</span>
         
        <span class="gd">-# Enable threaded mode</span>
        <span class="gd">-# config.threadsafe!</span>
        \ No newline at end of file
        <span class="gi">+  # Use a different cache store in production</span>
        <span class="gi">+  # config.cache_store = :mem_cache_store</span>
        <span class="gi">+</span>
        <span class="gi">+  # Disable Rails&#39;s static asset server</span>
        <span class="gi">+  # In production, Apache or nginx will already do this</span>
        <span class="gi">+  config.serve_static_assets = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Enable serving of images, stylesheets, and javascripts from an asset server</span>
        <span class="gi">+  # config.action_controller.asset_host = &quot;http://assets.example.com&quot;</span>
        <span class="gi">+</span>
        <span class="gi">+  # Disable delivery errors, bad email addresses will be ignored</span>
        <span class="gi">+  # config.action_mailer.raise_delivery_errors = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Enable threaded mode</span>
        <span class="gi">+  # config.threadsafe!</span>
        <span class="gi">+</span>
        <span class="gi">+  # Enable locale fallbacks for I18n (makes lookups for any locale fall back to</span>
        <span class="gi">+  # the I18n.default_locale when a translation can not be found)</span>
        <span class="gi">+  config.i18n.fallbacks = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Send deprecation notices to registered listeners</span>
        <span class="gi">+  config.active_support.deprecation = :notify</span>
        <span class="gi">+end</span>
        </pre></div>
        <h2 id='config-environments-test-rb'>config/environments/test.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,28 +1,35 @@</span>
        <span class="gd">-# Settings specified here will take precedence over those in config/environment.rb</span>
        <span class="gi">+Railsdiff::Application.configure do</span>
        <span class="gi">+  # Settings specified here will take precedence over those in config/environment.rb</span>
         
        <span class="gd">-# The test environment is used exclusively to run your application&#39;s</span>
        <span class="gd">-# test suite.  You never need to work with it otherwise.  Remember that</span>
        <span class="gd">-# your test database is &quot;scratch space&quot; for the test suite and is wiped</span>
        <span class="gd">-# and recreated between test runs.  Don&#39;t rely on the data there!</span>
        <span class="gd">-config.cache_classes = true</span>
        <span class="gd">-</span>
        <span class="gd">-# Log error messages when you accidentally call methods on nil.</span>
        <span class="gd">-config.whiny_nils = true</span>
        <span class="gd">-</span>
        <span class="gd">-# Show full error reports and disable caching</span>
        <span class="gd">-config.action_controller.consider_all_requests_local = true</span>
        <span class="gd">-config.action_controller.perform_caching             = false</span>
        <span class="gd">-config.action_view.cache_template_loading            = true</span>
        <span class="gd">-</span>
        <span class="gd">-# Disable request forgery protection in test environment</span>
        <span class="gd">-config.action_controller.allow_forgery_protection    = false</span>
        <span class="gd">-</span>
        <span class="gd">-# Tell Action Mailer not to deliver emails to the real world.</span>
        <span class="gd">-# The :test delivery method accumulates sent emails in the</span>
        <span class="gd">-# ActionMailer::Base.deliveries array.</span>
        <span class="gd">-config.action_mailer.delivery_method = :test</span>
        <span class="gd">-</span>
        <span class="gd">-# Use SQL instead of Active Record&#39;s schema dumper when creating the test database.</span>
        <span class="gd">-# This is necessary if your schema can&#39;t be completely dumped by the schema dumper,</span>
        <span class="gd">-# like if you have constraints or database-specific column types</span>
        <span class="gd">-# config.active_record.schema_format = :sql</span>
        \ No newline at end of file
        <span class="gi">+  # The test environment is used exclusively to run your application&#39;s</span>
        <span class="gi">+  # test suite.  You never need to work with it otherwise.  Remember that</span>
        <span class="gi">+  # your test database is &quot;scratch space&quot; for the test suite and is wiped</span>
        <span class="gi">+  # and recreated between test runs.  Don&#39;t rely on the data there!</span>
        <span class="gi">+  config.cache_classes = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Log error messages when you accidentally call methods on nil.</span>
        <span class="gi">+  config.whiny_nils = true</span>
        <span class="gi">+</span>
        <span class="gi">+  # Show full error reports and disable caching</span>
        <span class="gi">+  config.consider_all_requests_local       = true</span>
        <span class="gi">+  config.action_controller.perform_caching = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Raise exceptions instead of rendering exception templates</span>
        <span class="gi">+  config.action_dispatch.show_exceptions = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Disable request forgery protection in test environment</span>
        <span class="gi">+  config.action_controller.allow_forgery_protection    = false</span>
        <span class="gi">+</span>
        <span class="gi">+  # Tell Action Mailer not to deliver emails to the real world.</span>
        <span class="gi">+  # The :test delivery method accumulates sent emails in the</span>
        <span class="gi">+  # ActionMailer::Base.deliveries array.</span>
        <span class="gi">+  config.action_mailer.delivery_method = :test</span>
        <span class="gi">+</span>
        <span class="gi">+  # Use SQL instead of Active Record&#39;s schema dumper when creating the test database.</span>
        <span class="gi">+  # This is necessary if your schema can&#39;t be completely dumped by the schema dumper,</span>
        <span class="gi">+  # like if you have constraints or database-specific column types</span>
        <span class="gi">+  # config.active_record.schema_format = :sql</span>
        <span class="gi">+</span>
        <span class="gi">+  # Print deprecation notices to the stderr</span>
        <span class="gi">+  config.active_support.deprecation = :stderr</span>
        <span class="gi">+end</span>
        </pre></div>
        <h2 id='config-initializers-backtrace_silencers-rb'>config/initializers/backtrace_silencers.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,7 +1,7 @@</span>
         # Be sure to restart your server when you modify this file.
         
         # You can add backtrace silencers for libraries that you&#39;re using but don&#39;t wish to see in your backtraces.
         # Rails.backtrace_cleaner.add_silencer { |line| line =~ /my_noisy_library/ }
         
        <span class="gd">-# You can also remove all the silencers if you&#39;re trying do debug a problem that might steem from framework code.</span>
        <span class="gd">-# Rails.backtrace_cleaner.remove_silencers!</span>
        \ No newline at end of file
        <span class="gi">+# You can also remove all the silencers if you&#39;re trying to debug a problem that might stem from framework code.</span>
        <span class="gi">+# Rails.backtrace_cleaner.remove_silencers!</span>
        </pre></div>
        <h2 id='config-initializers-cookie_verification_secret-rb'>config/initializers/cookie_verification_secret.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,7 +0,0 @@</span>
        <span class="gd">-# Be sure to restart your server when you modify this file.</span>
        <span class="gd">-</span>
        <span class="gd">-# Your secret key for verifying the integrity of signed cookies.</span>
        <span class="gd">-# If you change this key, all old signed cookies will become invalid!</span>
        <span class="gd">-# Make sure the secret is at least 30 characters and all random, </span>
        <span class="gd">-# no regular words or you&#39;ll be exposed to dictionary attacks.</span>
        <span class="gd">-ActionController::Base.cookie_verifier_secret = &#39;your-secret-token&#39;;</span>
        </pre></div>
        <h2 id='config-initializers-inflections-rb'>config/initializers/inflections.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,10 +1,10 @@</span>
         # Be sure to restart your server when you modify this file.
         
        <span class="gd">-# Add new inflection rules using the following format </span>
        <span class="gi">+# Add new inflection rules using the following format</span>
         # (all these examples are active by default):
         # ActiveSupport::Inflector.inflections do |inflect|
         #   inflect.plural /^(ox)$/i, &#39;\1en&#39;
         #   inflect.singular /^(ox)en/i, &#39;\1&#39;
         #   inflect.irregular &#39;person&#39;, &#39;people&#39;
         #   inflect.uncountable %w( fish sheep )
         # end
        </pre></div>
        <h2 id='config-initializers-new_rails_defaults-rb'>config/initializers/new_rails_defaults.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,21 +0,0 @@</span>
        <span class="gd">-# Be sure to restart your server when you modify this file.</span>
        <span class="gd">-</span>
        <span class="gd">-# These settings change the behavior of Rails 2 apps and will be defaults</span>
        <span class="gd">-# for Rails 3. You can remove this initializer when Rails 3 is released.</span>
        <span class="gd">-</span>
        <span class="gd">-if defined?(ActiveRecord)</span>
        <span class="gd">-  # Include Active Record class name as root for JSON serialized output.</span>
        <span class="gd">-  ActiveRecord::Base.include_root_in_json = true</span>
        <span class="gd">-</span>
        <span class="gd">-  # Store the full class name (including module namespace) in STI type column.</span>
        <span class="gd">-  ActiveRecord::Base.store_full_sti_class = true</span>
        <span class="gd">-end</span>
        <span class="gd">-</span>
        <span class="gd">-ActionController::Routing.generate_best_match = false</span>
        <span class="gd">-</span>
        <span class="gd">-# Use ISO 8601 format for JSON serialized times and dates.</span>
        <span class="gd">-ActiveSupport.use_standard_json_time_format = true</span>
        <span class="gd">-</span>
        <span class="gd">-# Don&#39;t escape HTML entities in JSON, leave that for the #json_escape helper.</span>
        <span class="gd">-# if you&#39;re including raw json in an HTML page.</span>
        <span class="gd">-ActiveSupport.escape_html_entities_in_json = false</span>
        \ No newline at end of file
        </pre></div>
        <h2 id='config-initializers-secret_token-rb'>config/initializers/secret_token.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,7 @@</span>
        <span class="gi">+# Be sure to restart your server when you modify this file.</span>
        <span class="gi">+</span>
        <span class="gi">+# Your secret key for verifying the integrity of signed cookies.</span>
        <span class="gi">+# If you change this key, all old signed cookies will become invalid!</span>
        <span class="gi">+# Make sure the secret is at least 30 characters and all random,</span>
        <span class="gi">+# no regular words or you&#39;ll be exposed to dictionary attacks.</span>
        <span class="gi">+Railsdiff::Application.config.secret_token = &#39;your-secret-token&#39;</span>
        </pre></div>
        <h2 id='config-initializers-session_store-rb'>config/initializers/session_store.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,15 +1,8 @@</span>
         # Be sure to restart your server when you modify this file.
         
        <span class="gd">-# Your secret key for verifying cookie session data integrity.</span>
        <span class="gd">-# If you change this key, all old sessions will become invalid!</span>
        <span class="gd">-# Make sure the secret is at least 30 characters and all random, </span>
        <span class="gd">-# no regular words or you&#39;ll be exposed to dictionary attacks.</span>
        <span class="gd">-ActionController::Base.session = {</span>
        <span class="gd">-  :key         =&gt; &#39;_railsdiff_session&#39;,</span>
        <span class="gd">-  :secret      =&gt; &#39;your-secret-token&#39;</span>
        <span class="gd">-}</span>
        <span class="gi">+Railsdiff::Application.config.session_store :cookie_store, :key =&gt; &#39;_railsdiff_session&#39;</span>
         
         # Use the database for sessions instead of the cookie-based default,
         # which shouldn&#39;t be used to store highly confidential information
         # (create the session table with &quot;rake db:sessions:create&quot;)
        <span class="gd">-# ActionController::Base.session_store = :active_record_store</span>
        <span class="gi">+# Railsdiff::Application.config.session_store :active_record_store</span>
        </pre></div>
        <h2 id='config-locales-en-yml'>config/locales/en.yml</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,5 +1,5 @@</span>
         # Sample localization file for English. Add more files in this directory for other locales.
         # See http://github.com/svenfuchs/rails-i18n/tree/master/rails%2Flocale for starting points.
         
         en:
        <span class="gd">-  hello: &quot;Hello world&quot;</span>
        \ No newline at end of file
        <span class="gi">+  hello: &quot;Hello world&quot;</span>
        </pre></div>
        <h2 id='config-routes-rb'>config/routes.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,43 +1,58 @@</span>
        <span class="gd">-ActionController::Routing::Routes.draw do |map|</span>
        <span class="gd">-  # The priority is based upon order of creation: first created -&gt; highest priority.</span>
        <span class="gi">+Railsdiff::Application.routes.draw do</span>
        <span class="gi">+  # The priority is based upon order of creation:</span>
        <span class="gi">+  # first created -&gt; highest priority.</span>
         
           # Sample of regular route:
        <span class="gd">-  #   map.connect &#39;products/:id&#39;, :controller =&gt; &#39;catalog&#39;, :action =&gt; &#39;view&#39;</span>
        <span class="gi">+  #   match &#39;products/:id&#39; =&gt; &#39;catalog#view&#39;</span>
           # Keep in mind you can assign values other than :controller and :action
         
           # Sample of named route:
        <span class="gd">-  #   map.purchase &#39;products/:id/purchase&#39;, :controller =&gt; &#39;catalog&#39;, :action =&gt; &#39;purchase&#39;</span>
        <span class="gi">+  #   match &#39;products/:id/purchase&#39; =&gt; &#39;catalog#purchase&#39;, :as =&gt; :purchase</span>
           # This route can be invoked with purchase_url(:id =&gt; product.id)
         
           # Sample resource route (maps HTTP verbs to controller actions automatically):
        <span class="gd">-  #   map.resources :products</span>
        <span class="gi">+  #   resources :products</span>
         
           # Sample resource route with options:
        <span class="gd">-  #   map.resources :products, :member =&gt; { :short =&gt; :get, :toggle =&gt; :post }, :collection =&gt; { :sold =&gt; :get }</span>
        <span class="gi">+  #   resources :products do</span>
        <span class="gi">+  #     member do</span>
        <span class="gi">+  #       get &#39;short&#39;</span>
        <span class="gi">+  #       post &#39;toggle&#39;</span>
        <span class="gi">+  #     end</span>
        <span class="gi">+  #</span>
        <span class="gi">+  #     collection do</span>
        <span class="gi">+  #       get &#39;sold&#39;</span>
        <span class="gi">+  #     end</span>
        <span class="gi">+  #   end</span>
         
           # Sample resource route with sub-resources:
        <span class="gd">-  #   map.resources :products, :has_many =&gt; [ :comments, :sales ], :has_one =&gt; :seller</span>
        <span class="gd">-  </span>
        <span class="gi">+  #   resources :products do</span>
        <span class="gi">+  #     resources :comments, :sales</span>
        <span class="gi">+  #     resource :seller</span>
        <span class="gi">+  #   end</span>
        <span class="gi">+</span>
           # Sample resource route with more complex sub-resources
        <span class="gd">-  #   map.resources :products do |products|</span>
        <span class="gd">-  #     products.resources :comments</span>
        <span class="gd">-  #     products.resources :sales, :collection =&gt; { :recent =&gt; :get }</span>
        <span class="gi">+  #   resources :products do</span>
        <span class="gi">+  #     resources :comments</span>
        <span class="gi">+  #     resources :sales do</span>
        <span class="gi">+  #       get &#39;recent&#39;, :on =&gt; :collection</span>
        <span class="gi">+  #     end</span>
           #   end
         
           # Sample resource route within a namespace:
        <span class="gd">-  #   map.namespace :admin do |admin|</span>
        <span class="gd">-  #     # Directs /admin/products/* to Admin::ProductsController (app/controllers/admin/products_controller.rb)</span>
        <span class="gd">-  #     admin.resources :products</span>
        <span class="gi">+  #   namespace :admin do</span>
        <span class="gi">+  #     # Directs /admin/products/* to Admin::ProductsController</span>
        <span class="gi">+  #     # (app/controllers/admin/products_controller.rb)</span>
        <span class="gi">+  #     resources :products</span>
           #   end
         
        <span class="gd">-  # You can have the root of your site routed with map.root -- just remember to delete public/index.html.</span>
        <span class="gd">-  # map.root :controller =&gt; &quot;welcome&quot;</span>
        <span class="gi">+  # You can have the root of your site routed with &quot;root&quot;</span>
        <span class="gi">+  # just remember to delete public/index.html.</span>
        <span class="gi">+  # root :to =&gt; &quot;welcome#index&quot;</span>
         
           # See how all your routes lay out with &quot;rake routes&quot;
         
        <span class="gd">-  # Install the default routes as the lowest priority.</span>
        <span class="gd">-  # Note: These default routes make all actions in every controller accessible via GET requests. You should</span>
        <span class="gd">-  # consider removing or commenting them out if you&#39;re using named routes and resources.</span>
        <span class="gd">-  map.connect &#39;:controller/:action/:id&#39;</span>
        <span class="gd">-  map.connect &#39;:controller/:action/:id.:format&#39;</span>
        <span class="gi">+  # This is a legacy wild controller route that&#39;s not recommended for RESTful applications.</span>
        <span class="gi">+  # Note: This route will make all actions in every controller accessible via GET requests.</span>
        <span class="gi">+  # match &#39;:controller(/:action(/:id(.:format)))&#39;</span>
         end
        </pre></div>
        <h2 id='config-ru'>config.ru</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,4 @@</span>
        <span class="gi">+# This file is used by Rack-based servers to start the application.</span>
        <span class="gi">+</span>
        <span class="gi">+require ::File.expand_path(&#39;../config/environment&#39;,  __FILE__)</span>
        <span class="gi">+run Railsdiff::Application</span>
        </pre></div>
        <h2 id='db-seeds-rb'>db/seeds.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,7 +1,7 @@</span>
         # This file should contain all the record creation needed to seed the database with its default values.
         # The data can then be loaded with the rake db:seed (or created alongside the db with db:setup).
         #
         # Examples:
        <span class="gd">-#   </span>
        <span class="gi">+#</span>
         #   cities = City.create([{ :name =&gt; &#39;Chicago&#39; }, { :name =&gt; &#39;Copenhagen&#39; }])
        <span class="gd">-#   Major.create(:name =&gt; &#39;Daley&#39;, :city =&gt; cities.first)</span>
        <span class="gi">+#   Mayor.create(:name =&gt; &#39;Daley&#39;, :city =&gt; cities.first)</span>
        </pre></div>
        <h2 id='public-404-html'>public/404.html</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,30 +1,26 @@</span>
        <span class="gd">-&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
        <span class="gd">-       &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;</span>
        <span class="gd">-</span>
        <span class="gi">+&lt;!DOCTYPE html&gt;</span>
        <span class="gi">+&lt;html&gt;</span>
         &lt;head&gt;
        <span class="gd">-  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span>
           &lt;title&gt;The page you were looking for doesn&#39;t exist (404)&lt;/title&gt;
        <span class="gd">-	&lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gd">-		body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gd">-		div.dialog {</span>
        <span class="gd">-			width: 25em;</span>
        <span class="gd">-			padding: 0 4em;</span>
        <span class="gd">-			margin: 4em auto 0 auto;</span>
        <span class="gd">-			border: 1px solid #ccc;</span>
        <span class="gd">-			border-right-color: #999;</span>
        <span class="gd">-			border-bottom-color: #999;</span>
        <span class="gd">-		}</span>
        <span class="gd">-		h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gd">-	&lt;/style&gt;</span>
        <span class="gi">+  &lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gi">+    body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gi">+    div.dialog {</span>
        <span class="gi">+      width: 25em;</span>
        <span class="gi">+      padding: 0 4em;</span>
        <span class="gi">+      margin: 4em auto 0 auto;</span>
        <span class="gi">+      border: 1px solid #ccc;</span>
        <span class="gi">+      border-right-color: #999;</span>
        <span class="gi">+      border-bottom-color: #999;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gi">+  &lt;/style&gt;</span>
         &lt;/head&gt;
         
         &lt;body&gt;
           &lt;!-- This file lives in public/404.html --&gt;
           &lt;div class=&quot;dialog&quot;&gt;
             &lt;h1&gt;The page you were looking for doesn&#39;t exist.&lt;/h1&gt;
             &lt;p&gt;You may have mistyped the address or the page may have moved.&lt;/p&gt;
           &lt;/div&gt;
         &lt;/body&gt;
        <span class="gd">-&lt;/html&gt;</span>
        \ No newline at end of file
        <span class="gi">+&lt;/html&gt;</span>
        </pre></div>
        <h2 id='public-422-html'>public/422.html</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,30 +1,26 @@</span>
        <span class="gd">-&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
        <span class="gd">-       &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;</span>
        <span class="gd">-</span>
        <span class="gi">+&lt;!DOCTYPE html&gt;</span>
        <span class="gi">+&lt;html&gt;</span>
         &lt;head&gt;
        <span class="gd">-  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span>
           &lt;title&gt;The change you wanted was rejected (422)&lt;/title&gt;
        <span class="gd">-	&lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gd">-		body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gd">-		div.dialog {</span>
        <span class="gd">-			width: 25em;</span>
        <span class="gd">-			padding: 0 4em;</span>
        <span class="gd">-			margin: 4em auto 0 auto;</span>
        <span class="gd">-			border: 1px solid #ccc;</span>
        <span class="gd">-			border-right-color: #999;</span>
        <span class="gd">-			border-bottom-color: #999;</span>
        <span class="gd">-		}</span>
        <span class="gd">-		h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gd">-	&lt;/style&gt;</span>
        <span class="gi">+  &lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gi">+    body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gi">+    div.dialog {</span>
        <span class="gi">+      width: 25em;</span>
        <span class="gi">+      padding: 0 4em;</span>
        <span class="gi">+      margin: 4em auto 0 auto;</span>
        <span class="gi">+      border: 1px solid #ccc;</span>
        <span class="gi">+      border-right-color: #999;</span>
        <span class="gi">+      border-bottom-color: #999;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gi">+  &lt;/style&gt;</span>
         &lt;/head&gt;
         
         &lt;body&gt;
           &lt;!-- This file lives in public/422.html --&gt;
           &lt;div class=&quot;dialog&quot;&gt;
             &lt;h1&gt;The change you wanted was rejected.&lt;/h1&gt;
             &lt;p&gt;Maybe you tried to change something you didn&#39;t have access to.&lt;/p&gt;
           &lt;/div&gt;
         &lt;/body&gt;
        <span class="gd">-&lt;/html&gt;</span>
        \ No newline at end of file
        <span class="gi">+&lt;/html&gt;</span>
        </pre></div>
        <h2 id='public-500-html'>public/500.html</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,30 +1,26 @@</span>
        <span class="gd">-&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
        <span class="gd">-       &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
        <span class="gd">-</span>
        <span class="gd">-&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;</span>
        <span class="gd">-</span>
        <span class="gi">+&lt;!DOCTYPE html&gt;</span>
        <span class="gi">+&lt;html&gt;</span>
         &lt;head&gt;
        <span class="gd">-  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span>
           &lt;title&gt;We&#39;re sorry, but something went wrong (500)&lt;/title&gt;
        <span class="gd">-	&lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gd">-		body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gd">-		div.dialog {</span>
        <span class="gd">-			width: 25em;</span>
        <span class="gd">-			padding: 0 4em;</span>
        <span class="gd">-			margin: 4em auto 0 auto;</span>
        <span class="gd">-			border: 1px solid #ccc;</span>
        <span class="gd">-			border-right-color: #999;</span>
        <span class="gd">-			border-bottom-color: #999;</span>
        <span class="gd">-		}</span>
        <span class="gd">-		h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gd">-	&lt;/style&gt;</span>
        <span class="gi">+  &lt;style type=&quot;text/css&quot;&gt;</span>
        <span class="gi">+    body { background-color: #fff; color: #666; text-align: center; font-family: arial, sans-serif; }</span>
        <span class="gi">+    div.dialog {</span>
        <span class="gi">+      width: 25em;</span>
        <span class="gi">+      padding: 0 4em;</span>
        <span class="gi">+      margin: 4em auto 0 auto;</span>
        <span class="gi">+      border: 1px solid #ccc;</span>
        <span class="gi">+      border-right-color: #999;</span>
        <span class="gi">+      border-bottom-color: #999;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    h1 { font-size: 100%; color: #f00; line-height: 1.5em; }</span>
        <span class="gi">+  &lt;/style&gt;</span>
         &lt;/head&gt;
         
         &lt;body&gt;
           &lt;!-- This file lives in public/500.html --&gt;
           &lt;div class=&quot;dialog&quot;&gt;
             &lt;h1&gt;We&#39;re sorry, but something went wrong.&lt;/h1&gt;
             &lt;p&gt;We&#39;ve been notified about this issue and we&#39;ll take a look at it shortly.&lt;/p&gt;
           &lt;/div&gt;
         &lt;/body&gt;
         &lt;/html&gt;
        </pre></div>
        <h2 id='public-index-html'>public/index.html</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,275 +1,239 @@</span>
        <span class="gd">-&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
        <span class="gd">-        &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
        <span class="gi">+&lt;!DOCTYPE html&gt;</span>
         &lt;html&gt;
           &lt;head&gt;
        <span class="gd">-    &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span>
             &lt;title&gt;Ruby on Rails: Welcome aboard&lt;/title&gt;
             &lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
               body {
                 margin: 0;
                 margin-bottom: 25px;
                 padding: 0;
                 background-color: #f0f0f0;
                 font-family: &quot;Lucida Grande&quot;, &quot;Bitstream Vera Sans&quot;, &quot;Verdana&quot;;
                 font-size: 13px;
                 color: #333;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
               h1 {
                 font-size: 28px;
                 color: #000;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
               a  {color: #03c}
               a:hover {
                 background-color: #03c;
                 color: white;
                 text-decoration: none;
               }
        <span class="gd">-      </span>
        <span class="gd">-      </span>
        <span class="gi">+</span>
        <span class="gi">+</span>
               #page {
                 background-color: #f0f0f0;
                 width: 750px;
                 margin: 0;
                 margin-left: auto;
                 margin-right: auto;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
               #content {
                 float: left;
                 background-color: white;
                 border: 3px solid #aaa;
                 border-top: none;
                 padding: 25px;
                 width: 500px;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
               #sidebar {
                 float: right;
                 width: 175px;
               }
         
               #footer {
                 clear: both;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
         
               #header, #about, #getting-started {
                 padding-left: 75px;
                 padding-right: 30px;
               }
         
         
               #header {
                 background-image: url(&quot;images/rails.png&quot;);
                 background-repeat: no-repeat;
                 background-position: top left;
                 height: 64px;
               }
               #header h1, #header h2 {margin: 0}
               #header h2 {
                 color: #888;
                 font-weight: normal;
                 font-size: 16px;
               }
        <span class="gd">-      </span>
        <span class="gd">-      </span>
        <span class="gi">+</span>
        <span class="gi">+</span>
               #about h3 {
                 margin: 0;
                 margin-bottom: 10px;
                 font-size: 14px;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
               #about-content {
                 background-color: #ffd;
                 border: 1px solid #fc0;
        <span class="gd">-        margin-left: -11px;</span>
        <span class="gi">+        margin-left: -55px;</span>
        <span class="gi">+        margin-right: -10px;</span>
               }
               #about-content table {
                 margin-top: 10px;
                 margin-bottom: 10px;
                 font-size: 11px;
                 border-collapse: collapse;
               }
               #about-content td {
                 padding: 10px;
                 padding-top: 3px;
                 padding-bottom: 3px;
               }
               #about-content td.name  {color: #555}
               #about-content td.value {color: #000}
        <span class="gd">-      </span>
        <span class="gi">+</span>
        <span class="gi">+      #about-content ul {</span>
        <span class="gi">+        padding: 0;</span>
        <span class="gi">+        list-style-type: none;</span>
        <span class="gi">+      }</span>
        <span class="gi">+</span>
               #about-content.failure {
                 background-color: #fcc;
                 border: 1px solid #f00;
               }
               #about-content.failure p {
                 margin: 0;
                 padding: 10px;
               }
        <span class="gd">-      </span>
        <span class="gd">-      </span>
        <span class="gi">+</span>
        <span class="gi">+</span>
               #getting-started {
                 border-top: 1px solid #ccc;
                 margin-top: 25px;
                 padding-top: 15px;
               }
               #getting-started h1 {
                 margin: 0;
                 font-size: 20px;
               }
               #getting-started h2 {
                 margin: 0;
                 font-size: 14px;
                 font-weight: normal;
                 color: #333;
                 margin-bottom: 25px;
               }
               #getting-started ol {
                 margin-left: 0;
                 padding-left: 0;
               }
               #getting-started li {
                 font-size: 18px;
                 color: #888;
                 margin-bottom: 25px;
               }
               #getting-started li h2 {
                 margin: 0;
                 font-weight: normal;
                 font-size: 18px;
                 color: #333;
               }
               #getting-started li p {
                 color: #555;
                 font-size: 13px;
               }
        <span class="gd">-      </span>
        <span class="gd">-      </span>
        <span class="gd">-      #search {</span>
        <span class="gd">-        margin: 0;</span>
        <span class="gd">-        padding-top: 10px;</span>
        <span class="gd">-        padding-bottom: 10px;</span>
        <span class="gd">-        font-size: 11px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #search input {</span>
        <span class="gd">-        font-size: 11px;</span>
        <span class="gd">-        margin: 2px;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      #search-text {width: 170px}</span>
        <span class="gd">-      </span>
        <span class="gd">-      </span>
        <span class="gi">+</span>
        <span class="gi">+</span>
               #sidebar ul {
                 margin-left: 0;
                 padding-left: 0;
               }
               #sidebar ul h3 {
                 margin-top: 25px;
                 font-size: 16px;
                 padding-bottom: 10px;
                 border-bottom: 1px solid #ccc;
               }
               #sidebar li {
                 list-style-type: none;
               }
               #sidebar ul.links li {
                 margin-bottom: 5px;
               }
        <span class="gd">-      </span>
        <span class="gi">+</span>
             &lt;/style&gt;
        <span class="gd">-    &lt;script type=&quot;text/javascript&quot; src=&quot;javascripts/prototype.js&quot;&gt;&lt;/script&gt;</span>
        <span class="gd">-    &lt;script type=&quot;text/javascript&quot; src=&quot;javascripts/effects.js&quot;&gt;&lt;/script&gt;</span>
             &lt;script type=&quot;text/javascript&quot;&gt;
               function about() {
        <span class="gd">-        if (Element.empty(&#39;about-content&#39;)) {</span>
        <span class="gd">-          new Ajax.Updater(&#39;about-content&#39;, &#39;rails/info/properties&#39;, {</span>
        <span class="gd">-            method:     &#39;get&#39;,</span>
        <span class="gd">-            onFailure:  function() {Element.classNames(&#39;about-content&#39;).add(&#39;failure&#39;)},</span>
        <span class="gd">-            onComplete: function() {new Effect.BlindDown(&#39;about-content&#39;, {duration: 0.25})}</span>
        <span class="gd">-          });</span>
        <span class="gd">-        } else {</span>
        <span class="gd">-          new Effect[Element.visible(&#39;about-content&#39;) ? </span>
        <span class="gd">-            &#39;BlindUp&#39; : &#39;BlindDown&#39;](&#39;about-content&#39;, {duration: 0.25});</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-      </span>
        <span class="gd">-      window.onload = function() {</span>
        <span class="gd">-        $(&#39;search-text&#39;).value = &#39;&#39;;</span>
        <span class="gd">-        $(&#39;search&#39;).onsubmit = function() {</span>
        <span class="gd">-          $(&#39;search-text&#39;).value = &#39;site:rubyonrails.org &#39; + $F(&#39;search-text&#39;);</span>
        <span class="gd">-        }</span>
        <span class="gi">+        info = document.getElementById(&#39;about-content&#39;);</span>
        <span class="gi">+        if (window.XMLHttpRequest)</span>
        <span class="gi">+          { xhr = new XMLHttpRequest(); }</span>
        <span class="gi">+        else</span>
        <span class="gi">+          { xhr = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;); }</span>
        <span class="gi">+        xhr.open(&quot;GET&quot;,&quot;rails/info/properties&quot;,false);</span>
        <span class="gi">+        xhr.send(&quot;&quot;);</span>
        <span class="gi">+        info.innerHTML = xhr.responseText;</span>
        <span class="gi">+        info.style.display = &#39;block&#39;</span>
               }
             &lt;/script&gt;
           &lt;/head&gt;
           &lt;body&gt;
             &lt;div id=&quot;page&quot;&gt;
               &lt;div id=&quot;sidebar&quot;&gt;
                 &lt;ul id=&quot;sidebar-items&quot;&gt;
                   &lt;li&gt;
        <span class="gd">-            &lt;form id=&quot;search&quot; action=&quot;http://www.google.com/search&quot; method=&quot;get&quot;&gt;</span>
        <span class="gd">-              &lt;input type=&quot;hidden&quot; name=&quot;hl&quot; value=&quot;en&quot; /&gt;</span>
        <span class="gd">-              &lt;input type=&quot;text&quot; id=&quot;search-text&quot; name=&quot;q&quot; value=&quot;site:rubyonrails.org &quot; /&gt;</span>
        <span class="gd">-              &lt;input type=&quot;submit&quot; value=&quot;Search&quot; /&gt; the Rails site</span>
        <span class="gd">-            &lt;/form&gt;</span>
        <span class="gd">-          &lt;/li&gt;</span>
        <span class="gd">-        </span>
        <span class="gd">-          &lt;li&gt;</span>
        <span class="gd">-            &lt;h3&gt;Join the community&lt;/h3&gt;</span>
        <span class="gd">-            &lt;ul class=&quot;links&quot;&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://www.rubyonrails.org/&quot;&gt;Ruby on Rails&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://weblog.rubyonrails.org/&quot;&gt;Official weblog&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-              &lt;li&gt;&lt;a href=&quot;http://wiki.rubyonrails.org/&quot;&gt;Wiki&lt;/a&gt;&lt;/li&gt;</span>
        <span class="gd">-            &lt;/ul&gt;</span>
        <span class="gd">-          &lt;/li&gt;</span>
        <span class="gd">-          </span>
        <span class="gd">-          &lt;li&gt;</span>
                     &lt;h3&gt;Browse the documentation&lt;/h3&gt;
                     &lt;ul class=&quot;links&quot;&gt;
                       &lt;li&gt;&lt;a href=&quot;http://api.rubyonrails.org/&quot;&gt;Rails API&lt;/a&gt;&lt;/li&gt;
                       &lt;li&gt;&lt;a href=&quot;http://stdlib.rubyonrails.org/&quot;&gt;Ruby standard library&lt;/a&gt;&lt;/li&gt;
                       &lt;li&gt;&lt;a href=&quot;http://corelib.rubyonrails.org/&quot;&gt;Ruby core&lt;/a&gt;&lt;/li&gt;
                       &lt;li&gt;&lt;a href=&quot;http://guides.rubyonrails.org/&quot;&gt;Rails Guides&lt;/a&gt;&lt;/li&gt;
                     &lt;/ul&gt;
                   &lt;/li&gt;
                 &lt;/ul&gt;
               &lt;/div&gt;
         
               &lt;div id=&quot;content&quot;&gt;
                 &lt;div id=&quot;header&quot;&gt;
                   &lt;h1&gt;Welcome aboard&lt;/h1&gt;
                   &lt;h2&gt;You&amp;rsquo;re riding Ruby on Rails!&lt;/h2&gt;
                 &lt;/div&gt;
         
                 &lt;div id=&quot;about&quot;&gt;
                   &lt;h3&gt;&lt;a href=&quot;rails/info/properties&quot; onclick=&quot;about(); return false&quot;&gt;About your application&amp;rsquo;s environment&lt;/a&gt;&lt;/h3&gt;
                   &lt;div id=&quot;about-content&quot; style=&quot;display: none&quot;&gt;&lt;/div&gt;
                 &lt;/div&gt;
        <span class="gd">-        </span>
        <span class="gi">+</span>
                 &lt;div id=&quot;getting-started&quot;&gt;
                   &lt;h1&gt;Getting started&lt;/h1&gt;
                   &lt;h2&gt;Here&amp;rsquo;s how to get rolling:&lt;/h2&gt;
        <span class="gd">-          </span>
        <span class="gd">-          &lt;ol&gt;          </span>
        <span class="gi">+</span>
        <span class="gi">+          &lt;ol&gt;</span>
                     &lt;li&gt;
        <span class="gd">-              &lt;h2&gt;Use &lt;tt&gt;script/generate&lt;/tt&gt; to create your models and controllers&lt;/h2&gt;</span>
        <span class="gi">+              &lt;h2&gt;Use &lt;code&gt;rails generate&lt;/code&gt; to create your models and controllers&lt;/h2&gt;</span>
                       &lt;p&gt;To see all available options, run it without parameters.&lt;/p&gt;
                     &lt;/li&gt;
        <span class="gd">-            </span>
        <span class="gi">+</span>
                     &lt;li&gt;
                       &lt;h2&gt;Set up a default route and remove or rename this file&lt;/h2&gt;
                       &lt;p&gt;Routes are set up in config/routes.rb.&lt;/p&gt;
                     &lt;/li&gt;
         
                     &lt;li&gt;
                       &lt;h2&gt;Create your database&lt;/h2&gt;
        <span class="gd">-              &lt;p&gt;Run &lt;tt&gt;rake db:migrate&lt;/tt&gt; to create your database. If you&#39;re not using SQLite (the default), edit &lt;tt&gt;config/database.yml&lt;/tt&gt; with your username and password.&lt;/p&gt;</span>
        <span class="gi">+              &lt;p&gt;Run &lt;code&gt;rake db:migrate&lt;/code&gt; to create your database. If you&#39;re not using SQLite (the default), edit &lt;code&gt;config/database.yml&lt;/code&gt; with your username and password.&lt;/p&gt;</span>
                     &lt;/li&gt;
                   &lt;/ol&gt;
                 &lt;/div&gt;
               &lt;/div&gt;
        <span class="gd">-      </span>
        <span class="gi">+</span>
               &lt;div id=&quot;footer&quot;&gt;&amp;nbsp;&lt;/div&gt;
             &lt;/div&gt;
           &lt;/body&gt;
        <span class="gd">-&lt;/html&gt;</span>
        \ No newline at end of file
        <span class="gi">+&lt;/html&gt;</span>
        </pre></div>
        <h2 id='public-javascripts-controls-js'>public/javascripts/controls.js</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,963 +1,965 @@</span>
        <span class="gd">-// Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gd">-//           (c) 2005-2008 Ivan Krstic (http://blogs.law.harvard.edu/ivan)</span>
        <span class="gd">-//           (c) 2005-2008 Jon Tirsen (http://www.tirsen.com)</span>
        <span class="gi">+// script.aculo.us controls.js v1.8.3, Thu Oct 08 11:23:33 +0200 2009</span>
        <span class="gi">+</span>
        <span class="gi">+// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gi">+//           (c) 2005-2009 Ivan Krstic (http://blogs.law.harvard.edu/ivan)</span>
        <span class="gi">+//           (c) 2005-2009 Jon Tirsen (http://www.tirsen.com)</span>
         // Contributors:
         //  Richard Livsey
         //  Rahul Bhargava
         //  Rob Wills
         //
         // script.aculo.us is freely distributable under the terms of an MIT-style license.
         // For details, see the script.aculo.us web site: http://script.aculo.us/
         
         // Autocompleter.Base handles all the autocompletion functionality
         // that&#39;s independent of the data source for autocompletion. This
         // includes drawing the autocompletion menu, observing keyboard
         // and mouse events, and similar.
         //
         // Specific autocompleters need to provide, at the very least,
         // a getUpdatedChoices function that will be invoked every time
         // the text inside the monitored textbox changes. This method
         // should get the text for which to provide autocompletion by
         // invoking this.getToken(), NOT by directly accessing
         // this.element.value. This is to allow incremental tokenized
         // autocompletion. Specific auto-completion logic (AJAX, etc)
         // belongs in getUpdatedChoices.
         //
         // Tokenized incremental autocompletion is enabled automatically
         // when an autocompleter is instantiated with the &#39;tokens&#39; option
         // in the options parameter, e.g.:
         // new Ajax.Autocompleter(&#39;id&#39;,&#39;upd&#39;, &#39;/url/&#39;, { tokens: &#39;,&#39; });
         // will incrementally autocomplete with a comma as the token.
         // Additionally, &#39;,&#39; in the above example can be replaced with
         // a token array, e.g. { tokens: [&#39;,&#39;, &#39;\n&#39;] } which
         // enables autocompletion on multiple tokens. This is most
         // useful when one of the tokens is \n (a newline), as it
         // allows smart autocompletion after linebreaks.
         
         if(typeof Effect == &#39;undefined&#39;)
           throw(&quot;controls.js requires including script.aculo.us&#39; effects.js library&quot;);
         
         var Autocompleter = { };
         Autocompleter.Base = Class.create({
           baseInitialize: function(element, update, options) {
             element          = $(element);
             this.element     = element;
             this.update      = $(update);
             this.hasFocus    = false;
             this.changed     = false;
             this.active      = false;
             this.index       = 0;
             this.entryCount  = 0;
             this.oldElementValue = this.element.value;
         
             if(this.setOptions)
               this.setOptions(options);
             else
               this.options = options || { };
         
             this.options.paramName    = this.options.paramName || this.element.name;
             this.options.tokens       = this.options.tokens || [];
             this.options.frequency    = this.options.frequency || 0.4;
             this.options.minChars     = this.options.minChars || 1;
             this.options.onShow       = this.options.onShow ||
               function(element, update){
                 if(!update.style.position || update.style.position==&#39;absolute&#39;) {
                   update.style.position = &#39;absolute&#39;;
                   Position.clone(element, update, {
                     setHeight: false,
                     offsetTop: element.offsetHeight
                   });
                 }
                 Effect.Appear(update,{duration:0.15});
               };
             this.options.onHide = this.options.onHide ||
               function(element, update){ new Effect.Fade(update,{duration:0.15}) };
         
             if(typeof(this.options.tokens) == &#39;string&#39;)
               this.options.tokens = new Array(this.options.tokens);
             // Force carriage returns as token delimiters anyway
             if (!this.options.tokens.include(&#39;\n&#39;))
               this.options.tokens.push(&#39;\n&#39;);
         
             this.observer = null;
         
             this.element.setAttribute(&#39;autocomplete&#39;,&#39;off&#39;);
         
             Element.hide(this.update);
         
             Event.observe(this.element, &#39;blur&#39;, this.onBlur.bindAsEventListener(this));
             Event.observe(this.element, &#39;keydown&#39;, this.onKeyPress.bindAsEventListener(this));
           },
         
           show: function() {
             if(Element.getStyle(this.update, &#39;display&#39;)==&#39;none&#39;) this.options.onShow(this.element, this.update);
             if(!this.iefix &amp;&amp;
               (Prototype.Browser.IE) &amp;&amp;
               (Element.getStyle(this.update, &#39;position&#39;)==&#39;absolute&#39;)) {
               new Insertion.After(this.update,
                &#39;&lt;iframe id=&quot;&#39; + this.update.id + &#39;_iefix&quot; &#39;+
                &#39;style=&quot;display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);&quot; &#39; +
                &#39;src=&quot;javascript:false;&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;&#39;);
               this.iefix = $(this.update.id+&#39;_iefix&#39;);
             }
             if(this.iefix) setTimeout(this.fixIEOverlapping.bind(this), 50);
           },
         
           fixIEOverlapping: function() {
             Position.clone(this.update, this.iefix, {setTop:(!this.update.style.height)});
             this.iefix.style.zIndex = 1;
             this.update.style.zIndex = 2;
             Element.show(this.iefix);
           },
         
           hide: function() {
             this.stopIndicator();
             if(Element.getStyle(this.update, &#39;display&#39;)!=&#39;none&#39;) this.options.onHide(this.element, this.update);
             if(this.iefix) Element.hide(this.iefix);
           },
         
           startIndicator: function() {
             if(this.options.indicator) Element.show(this.options.indicator);
           },
         
           stopIndicator: function() {
             if(this.options.indicator) Element.hide(this.options.indicator);
           },
         
           onKeyPress: function(event) {
             if(this.active)
               switch(event.keyCode) {
                case Event.KEY_TAB:
                case Event.KEY_RETURN:
                  this.selectEntry();
                  Event.stop(event);
                case Event.KEY_ESC:
                  this.hide();
                  this.active = false;
                  Event.stop(event);
                  return;
                case Event.KEY_LEFT:
                case Event.KEY_RIGHT:
                  return;
                case Event.KEY_UP:
                  this.markPrevious();
                  this.render();
                  Event.stop(event);
                  return;
                case Event.KEY_DOWN:
                  this.markNext();
                  this.render();
                  Event.stop(event);
                  return;
               }
              else
                if(event.keyCode==Event.KEY_TAB || event.keyCode==Event.KEY_RETURN ||
                  (Prototype.Browser.WebKit &gt; 0 &amp;&amp; event.keyCode == 0)) return;
         
             this.changed = true;
             this.hasFocus = true;
         
             if(this.observer) clearTimeout(this.observer);
               this.observer =
                 setTimeout(this.onObserverEvent.bind(this), this.options.frequency*1000);
           },
         
           activate: function() {
             this.changed = false;
             this.hasFocus = true;
             this.getUpdatedChoices();
           },
         
           onHover: function(event) {
             var element = Event.findElement(event, &#39;LI&#39;);
             if(this.index != element.autocompleteIndex)
             {
                 this.index = element.autocompleteIndex;
                 this.render();
             }
             Event.stop(event);
           },
         
           onClick: function(event) {
             var element = Event.findElement(event, &#39;LI&#39;);
             this.index = element.autocompleteIndex;
             this.selectEntry();
             this.hide();
           },
         
           onBlur: function(event) {
             // needed to make click events working
             setTimeout(this.hide.bind(this), 250);
             this.hasFocus = false;
             this.active = false;
           },
         
           render: function() {
             if(this.entryCount &gt; 0) {
               for (var i = 0; i &lt; this.entryCount; i++)
                 this.index==i ?
                   Element.addClassName(this.getEntry(i),&quot;selected&quot;) :
                   Element.removeClassName(this.getEntry(i),&quot;selected&quot;);
               if(this.hasFocus) {
                 this.show();
                 this.active = true;
               }
             } else {
               this.active = false;
               this.hide();
             }
           },
         
           markPrevious: function() {
             if(this.index &gt; 0) this.index--;
               else this.index = this.entryCount-1;
             this.getEntry(this.index).scrollIntoView(true);
           },
         
           markNext: function() {
             if(this.index &lt; this.entryCount-1) this.index++;
               else this.index = 0;
             this.getEntry(this.index).scrollIntoView(false);
           },
         
           getEntry: function(index) {
             return this.update.firstChild.childNodes[index];
           },
         
           getCurrentEntry: function() {
             return this.getEntry(this.index);
           },
         
           selectEntry: function() {
             this.active = false;
             this.updateElement(this.getCurrentEntry());
           },
         
           updateElement: function(selectedElement) {
             if (this.options.updateElement) {
               this.options.updateElement(selectedElement);
               return;
             }
             var value = &#39;&#39;;
             if (this.options.select) {
               var nodes = $(selectedElement).select(&#39;.&#39; + this.options.select) || [];
               if(nodes.length&gt;0) value = Element.collectTextNodes(nodes[0], this.options.select);
             } else
               value = Element.collectTextNodesIgnoreClass(selectedElement, &#39;informal&#39;);
         
             var bounds = this.getTokenBounds();
             if (bounds[0] != -1) {
               var newValue = this.element.value.substr(0, bounds[0]);
               var whitespace = this.element.value.substr(bounds[0]).match(/^\s+/);
               if (whitespace)
                 newValue += whitespace[0];
               this.element.value = newValue + value + this.element.value.substr(bounds[1]);
             } else {
               this.element.value = value;
             }
             this.oldElementValue = this.element.value;
             this.element.focus();
         
             if (this.options.afterUpdateElement)
               this.options.afterUpdateElement(this.element, selectedElement);
           },
         
           updateChoices: function(choices) {
             if(!this.changed &amp;&amp; this.hasFocus) {
               this.update.innerHTML = choices;
               Element.cleanWhitespace(this.update);
               Element.cleanWhitespace(this.update.down());
         
               if(this.update.firstChild &amp;&amp; this.update.down().childNodes) {
                 this.entryCount =
                   this.update.down().childNodes.length;
                 for (var i = 0; i &lt; this.entryCount; i++) {
                   var entry = this.getEntry(i);
                   entry.autocompleteIndex = i;
                   this.addObservers(entry);
                 }
               } else {
                 this.entryCount = 0;
               }
         
               this.stopIndicator();
               this.index = 0;
         
               if(this.entryCount==1 &amp;&amp; this.options.autoSelect) {
                 this.selectEntry();
                 this.hide();
               } else {
                 this.render();
               }
             }
           },
         
           addObservers: function(element) {
             Event.observe(element, &quot;mouseover&quot;, this.onHover.bindAsEventListener(this));
             Event.observe(element, &quot;click&quot;, this.onClick.bindAsEventListener(this));
           },
         
           onObserverEvent: function() {
             this.changed = false;
             this.tokenBounds = null;
             if(this.getToken().length&gt;=this.options.minChars) {
               this.getUpdatedChoices();
             } else {
               this.active = false;
               this.hide();
             }
             this.oldElementValue = this.element.value;
           },
         
           getToken: function() {
             var bounds = this.getTokenBounds();
             return this.element.value.substring(bounds[0], bounds[1]).strip();
           },
         
           getTokenBounds: function() {
             if (null != this.tokenBounds) return this.tokenBounds;
             var value = this.element.value;
             if (value.strip().empty()) return [-1, 0];
             var diff = arguments.callee.getFirstDifferencePos(value, this.oldElementValue);
             var offset = (diff == this.oldElementValue.length ? 1 : 0);
             var prevTokenPos = -1, nextTokenPos = value.length;
             var tp;
             for (var index = 0, l = this.options.tokens.length; index &lt; l; ++index) {
               tp = value.lastIndexOf(this.options.tokens[index], diff + offset - 1);
               if (tp &gt; prevTokenPos) prevTokenPos = tp;
               tp = value.indexOf(this.options.tokens[index], diff + offset);
               if (-1 != tp &amp;&amp; tp &lt; nextTokenPos) nextTokenPos = tp;
             }
             return (this.tokenBounds = [prevTokenPos + 1, nextTokenPos]);
           }
         });
         
         Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos = function(newS, oldS) {
           var boundary = Math.min(newS.length, oldS.length);
           for (var index = 0; index &lt; boundary; ++index)
             if (newS[index] != oldS[index])
               return index;
           return boundary;
         };
         
         Ajax.Autocompleter = Class.create(Autocompleter.Base, {
           initialize: function(element, update, url, options) {
             this.baseInitialize(element, update, options);
             this.options.asynchronous  = true;
             this.options.onComplete    = this.onComplete.bind(this);
             this.options.defaultParams = this.options.parameters || null;
             this.url                   = url;
           },
         
           getUpdatedChoices: function() {
             this.startIndicator();
         
             var entry = encodeURIComponent(this.options.paramName) + &#39;=&#39; +
               encodeURIComponent(this.getToken());
         
             this.options.parameters = this.options.callback ?
               this.options.callback(this.element, entry) : entry;
         
             if(this.options.defaultParams)
               this.options.parameters += &#39;&amp;&#39; + this.options.defaultParams;
         
             new Ajax.Request(this.url, this.options);
           },
         
           onComplete: function(request) {
             this.updateChoices(request.responseText);
           }
         });
         
         // The local array autocompleter. Used when you&#39;d prefer to
         // inject an array of autocompletion options into the page, rather
         // than sending out Ajax queries, which can be quite slow sometimes.
         //
         // The constructor takes four parameters. The first two are, as usual,
         // the id of the monitored textbox, and id of the autocompletion menu.
         // The third is the array you want to autocomplete from, and the fourth
         // is the options block.
         //
         // Extra local autocompletion options:
         // - choices - How many autocompletion choices to offer
         //
         // - partialSearch - If false, the autocompleter will match entered
         //                    text only at the beginning of strings in the
         //                    autocomplete array. Defaults to true, which will
         //                    match text at the beginning of any *word* in the
         //                    strings in the autocomplete array. If you want to
         //                    search anywhere in the string, additionally set
         //                    the option fullSearch to true (default: off).
         //
         // - fullSsearch - Search anywhere in autocomplete array strings.
         //
         // - partialChars - How many characters to enter before triggering
         //                   a partial match (unlike minChars, which defines
         //                   how many characters are required to do any match
         //                   at all). Defaults to 2.
         //
         // - ignoreCase - Whether to ignore case when autocompleting.
         //                 Defaults to true.
         //
         // It&#39;s possible to pass in a custom function as the &#39;selector&#39;
         // option, if you prefer to write your own autocompletion logic.
         // In that case, the other options above will not apply unless
         // you support them.
         
         Autocompleter.Local = Class.create(Autocompleter.Base, {
           initialize: function(element, update, array, options) {
             this.baseInitialize(element, update, options);
             this.options.array = array;
           },
         
           getUpdatedChoices: function() {
             this.updateChoices(this.options.selector(this));
           },
         
           setOptions: function(options) {
             this.options = Object.extend({
               choices: 10,
               partialSearch: true,
               partialChars: 2,
               ignoreCase: true,
               fullSearch: false,
               selector: function(instance) {
                 var ret       = []; // Beginning matches
                 var partial   = []; // Inside matches
                 var entry     = instance.getToken();
                 var count     = 0;
         
                 for (var i = 0; i &lt; instance.options.array.length &amp;&amp;
                   ret.length &lt; instance.options.choices ; i++) {
         
                   var elem = instance.options.array[i];
                   var foundPos = instance.options.ignoreCase ?
                     elem.toLowerCase().indexOf(entry.toLowerCase()) :
                     elem.indexOf(entry);
         
                   while (foundPos != -1) {
                     if (foundPos == 0 &amp;&amp; elem.length != entry.length) {
                       ret.push(&quot;&lt;li&gt;&lt;strong&gt;&quot; + elem.substr(0, entry.length) + &quot;&lt;/strong&gt;&quot; +
                         elem.substr(entry.length) + &quot;&lt;/li&gt;&quot;);
                       break;
                     } else if (entry.length &gt;= instance.options.partialChars &amp;&amp;
                       instance.options.partialSearch &amp;&amp; foundPos != -1) {
                       if (instance.options.fullSearch || /\s/.test(elem.substr(foundPos-1,1))) {
                         partial.push(&quot;&lt;li&gt;&quot; + elem.substr(0, foundPos) + &quot;&lt;strong&gt;&quot; +
                           elem.substr(foundPos, entry.length) + &quot;&lt;/strong&gt;&quot; + elem.substr(
                           foundPos + entry.length) + &quot;&lt;/li&gt;&quot;);
                         break;
                       }
                     }
         
                     foundPos = instance.options.ignoreCase ?
                       elem.toLowerCase().indexOf(entry.toLowerCase(), foundPos + 1) :
                       elem.indexOf(entry, foundPos + 1);
         
                   }
                 }
                 if (partial.length)
                   ret = ret.concat(partial.slice(0, instance.options.choices - ret.length));
                 return &quot;&lt;ul&gt;&quot; + ret.join(&#39;&#39;) + &quot;&lt;/ul&gt;&quot;;
               }
             }, options || { });
           }
         });
         
         // AJAX in-place editor and collection editor
         // Full rewrite by Christophe Porteneuve &lt;tdd@tddsworld.com&gt; (April 2007).
         
         // Use this if you notice weird scrolling problems on some browsers,
         // the DOM might be a bit confused when this gets called so do this
         // waits 1 ms (with setTimeout) until it does the activation
         Field.scrollFreeActivate = function(field) {
           setTimeout(function() {
             Field.activate(field);
           }, 1);
         };
         
         Ajax.InPlaceEditor = Class.create({
           initialize: function(element, url, options) {
             this.url = url;
             this.element = element = $(element);
             this.prepareOptions();
             this._controls = { };
             arguments.callee.dealWithDeprecatedOptions(options); // DEPRECATION LAYER!!!
             Object.extend(this.options, options || { });
             if (!this.options.formId &amp;&amp; this.element.id) {
               this.options.formId = this.element.id + &#39;-inplaceeditor&#39;;
               if ($(this.options.formId))
                 this.options.formId = &#39;&#39;;
             }
             if (this.options.externalControl)
               this.options.externalControl = $(this.options.externalControl);
             if (!this.options.externalControl)
               this.options.externalControlOnly = false;
             this._originalBackground = this.element.getStyle(&#39;background-color&#39;) || &#39;transparent&#39;;
             this.element.title = this.options.clickToEditText;
             this._boundCancelHandler = this.handleFormCancellation.bind(this);
             this._boundComplete = (this.options.onComplete || Prototype.emptyFunction).bind(this);
             this._boundFailureHandler = this.handleAJAXFailure.bind(this);
             this._boundSubmitHandler = this.handleFormSubmission.bind(this);
             this._boundWrapperHandler = this.wrapUp.bind(this);
             this.registerListeners();
           },
           checkForEscapeOrReturn: function(e) {
             if (!this._editing || e.ctrlKey || e.altKey || e.shiftKey) return;
             if (Event.KEY_ESC == e.keyCode)
               this.handleFormCancellation(e);
             else if (Event.KEY_RETURN == e.keyCode)
               this.handleFormSubmission(e);
           },
           createControl: function(mode, handler, extraClasses) {
             var control = this.options[mode + &#39;Control&#39;];
             var text = this.options[mode + &#39;Text&#39;];
             if (&#39;button&#39; == control) {
               var btn = document.createElement(&#39;input&#39;);
               btn.type = &#39;submit&#39;;
               btn.value = text;
               btn.className = &#39;editor_&#39; + mode + &#39;_button&#39;;
               if (&#39;cancel&#39; == mode)
                 btn.onclick = this._boundCancelHandler;
               this._form.appendChild(btn);
               this._controls[mode] = btn;
             } else if (&#39;link&#39; == control) {
               var link = document.createElement(&#39;a&#39;);
               link.href = &#39;#&#39;;
               link.appendChild(document.createTextNode(text));
               link.onclick = &#39;cancel&#39; == mode ? this._boundCancelHandler : this._boundSubmitHandler;
               link.className = &#39;editor_&#39; + mode + &#39;_link&#39;;
               if (extraClasses)
                 link.className += &#39; &#39; + extraClasses;
               this._form.appendChild(link);
               this._controls[mode] = link;
             }
           },
           createEditField: function() {
             var text = (this.options.loadTextURL ? this.options.loadingText : this.getText());
             var fld;
             if (1 &gt;= this.options.rows &amp;&amp; !/\r|\n/.test(this.getText())) {
               fld = document.createElement(&#39;input&#39;);
               fld.type = &#39;text&#39;;
               var size = this.options.size || this.options.cols || 0;
               if (0 &lt; size) fld.size = size;
             } else {
               fld = document.createElement(&#39;textarea&#39;);
               fld.rows = (1 &gt;= this.options.rows ? this.options.autoRows : this.options.rows);
               fld.cols = this.options.cols || 40;
             }
             fld.name = this.options.paramName;
             fld.value = text; // No HTML breaks conversion anymore
             fld.className = &#39;editor_field&#39;;
             if (this.options.submitOnBlur)
               fld.onblur = this._boundSubmitHandler;
             this._controls.editor = fld;
             if (this.options.loadTextURL)
               this.loadExternalText();
             this._form.appendChild(this._controls.editor);
           },
           createForm: function() {
             var ipe = this;
             function addText(mode, condition) {
               var text = ipe.options[&#39;text&#39; + mode + &#39;Controls&#39;];
               if (!text || condition === false) return;
               ipe._form.appendChild(document.createTextNode(text));
             };
             this._form = $(document.createElement(&#39;form&#39;));
             this._form.id = this.options.formId;
             this._form.addClassName(this.options.formClassName);
             this._form.onsubmit = this._boundSubmitHandler;
             this.createEditField();
             if (&#39;textarea&#39; == this._controls.editor.tagName.toLowerCase())
               this._form.appendChild(document.createElement(&#39;br&#39;));
             if (this.options.onFormCustomization)
               this.options.onFormCustomization(this, this._form);
             addText(&#39;Before&#39;, this.options.okControl || this.options.cancelControl);
             this.createControl(&#39;ok&#39;, this._boundSubmitHandler);
             addText(&#39;Between&#39;, this.options.okControl &amp;&amp; this.options.cancelControl);
             this.createControl(&#39;cancel&#39;, this._boundCancelHandler, &#39;editor_cancel&#39;);
             addText(&#39;After&#39;, this.options.okControl || this.options.cancelControl);
           },
           destroy: function() {
             if (this._oldInnerHTML)
               this.element.innerHTML = this._oldInnerHTML;
             this.leaveEditMode();
             this.unregisterListeners();
           },
           enterEditMode: function(e) {
             if (this._saving || this._editing) return;
             this._editing = true;
             this.triggerCallback(&#39;onEnterEditMode&#39;);
             if (this.options.externalControl)
               this.options.externalControl.hide();
             this.element.hide();
             this.createForm();
             this.element.parentNode.insertBefore(this._form, this.element);
             if (!this.options.loadTextURL)
               this.postProcessEditField();
             if (e) Event.stop(e);
           },
           enterHover: function(e) {
             if (this.options.hoverClassName)
               this.element.addClassName(this.options.hoverClassName);
             if (this._saving) return;
             this.triggerCallback(&#39;onEnterHover&#39;);
           },
           getText: function() {
             return this.element.innerHTML.unescapeHTML();
           },
           handleAJAXFailure: function(transport) {
             this.triggerCallback(&#39;onFailure&#39;, transport);
             if (this._oldInnerHTML) {
               this.element.innerHTML = this._oldInnerHTML;
               this._oldInnerHTML = null;
             }
           },
           handleFormCancellation: function(e) {
             this.wrapUp();
             if (e) Event.stop(e);
           },
           handleFormSubmission: function(e) {
             var form = this._form;
             var value = $F(this._controls.editor);
             this.prepareSubmission();
             var params = this.options.callback(form, value) || &#39;&#39;;
             if (Object.isString(params))
               params = params.toQueryParams();
             params.editorId = this.element.id;
             if (this.options.htmlResponse) {
               var options = Object.extend({ evalScripts: true }, this.options.ajaxOptions);
               Object.extend(options, {
                 parameters: params,
                 onComplete: this._boundWrapperHandler,
                 onFailure: this._boundFailureHandler
               });
               new Ajax.Updater({ success: this.element }, this.url, options);
             } else {
               var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);
               Object.extend(options, {
                 parameters: params,
                 onComplete: this._boundWrapperHandler,
                 onFailure: this._boundFailureHandler
               });
               new Ajax.Request(this.url, options);
             }
             if (e) Event.stop(e);
           },
           leaveEditMode: function() {
             this.element.removeClassName(this.options.savingClassName);
             this.removeForm();
             this.leaveHover();
             this.element.style.backgroundColor = this._originalBackground;
             this.element.show();
             if (this.options.externalControl)
               this.options.externalControl.show();
             this._saving = false;
             this._editing = false;
             this._oldInnerHTML = null;
             this.triggerCallback(&#39;onLeaveEditMode&#39;);
           },
           leaveHover: function(e) {
             if (this.options.hoverClassName)
               this.element.removeClassName(this.options.hoverClassName);
             if (this._saving) return;
             this.triggerCallback(&#39;onLeaveHover&#39;);
           },
           loadExternalText: function() {
             this._form.addClassName(this.options.loadingClassName);
             this._controls.editor.disabled = true;
             var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);
             Object.extend(options, {
               parameters: &#39;editorId=&#39; + encodeURIComponent(this.element.id),
               onComplete: Prototype.emptyFunction,
               onSuccess: function(transport) {
                 this._form.removeClassName(this.options.loadingClassName);
                 var text = transport.responseText;
                 if (this.options.stripLoadedTextTags)
                   text = text.stripTags();
                 this._controls.editor.value = text;
                 this._controls.editor.disabled = false;
                 this.postProcessEditField();
               }.bind(this),
               onFailure: this._boundFailureHandler
             });
             new Ajax.Request(this.options.loadTextURL, options);
           },
           postProcessEditField: function() {
             var fpc = this.options.fieldPostCreation;
             if (fpc)
               $(this._controls.editor)[&#39;focus&#39; == fpc ? &#39;focus&#39; : &#39;activate&#39;]();
           },
           prepareOptions: function() {
             this.options = Object.clone(Ajax.InPlaceEditor.DefaultOptions);
             Object.extend(this.options, Ajax.InPlaceEditor.DefaultCallbacks);
             [this._extraDefaultOptions].flatten().compact().each(function(defs) {
               Object.extend(this.options, defs);
             }.bind(this));
           },
           prepareSubmission: function() {
             this._saving = true;
             this.removeForm();
             this.leaveHover();
             this.showSaving();
           },
           registerListeners: function() {
             this._listeners = { };
             var listener;
             $H(Ajax.InPlaceEditor.Listeners).each(function(pair) {
               listener = this[pair.value].bind(this);
               this._listeners[pair.key] = listener;
               if (!this.options.externalControlOnly)
                 this.element.observe(pair.key, listener);
               if (this.options.externalControl)
                 this.options.externalControl.observe(pair.key, listener);
             }.bind(this));
           },
           removeForm: function() {
             if (!this._form) return;
             this._form.remove();
             this._form = null;
             this._controls = { };
           },
           showSaving: function() {
             this._oldInnerHTML = this.element.innerHTML;
             this.element.innerHTML = this.options.savingText;
             this.element.addClassName(this.options.savingClassName);
             this.element.style.backgroundColor = this._originalBackground;
             this.element.show();
           },
           triggerCallback: function(cbName, arg) {
             if (&#39;function&#39; == typeof this.options[cbName]) {
               this.options[cbName](this, arg);
             }
           },
           unregisterListeners: function() {
             $H(this._listeners).each(function(pair) {
               if (!this.options.externalControlOnly)
                 this.element.stopObserving(pair.key, pair.value);
               if (this.options.externalControl)
                 this.options.externalControl.stopObserving(pair.key, pair.value);
             }.bind(this));
           },
           wrapUp: function(transport) {
             this.leaveEditMode();
             // Can&#39;t use triggerCallback due to backward compatibility: requires
             // binding + direct element
             this._boundComplete(transport, this.element);
           }
         });
         
         Object.extend(Ajax.InPlaceEditor.prototype, {
           dispose: Ajax.InPlaceEditor.prototype.destroy
         });
         
         Ajax.InPlaceCollectionEditor = Class.create(Ajax.InPlaceEditor, {
           initialize: function($super, element, url, options) {
             this._extraDefaultOptions = Ajax.InPlaceCollectionEditor.DefaultOptions;
             $super(element, url, options);
           },
         
           createEditField: function() {
             var list = document.createElement(&#39;select&#39;);
             list.name = this.options.paramName;
             list.size = 1;
             this._controls.editor = list;
             this._collection = this.options.collection || [];
             if (this.options.loadCollectionURL)
               this.loadCollection();
             else
               this.checkForExternalText();
             this._form.appendChild(this._controls.editor);
           },
         
           loadCollection: function() {
             this._form.addClassName(this.options.loadingClassName);
             this.showLoadingText(this.options.loadingCollectionText);
             var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);
             Object.extend(options, {
               parameters: &#39;editorId=&#39; + encodeURIComponent(this.element.id),
               onComplete: Prototype.emptyFunction,
               onSuccess: function(transport) {
                 var js = transport.responseText.strip();
                 if (!/^\[.*\]$/.test(js)) // TODO: improve sanity check
                   throw(&#39;Server returned an invalid collection representation.&#39;);
                 this._collection = eval(js);
                 this.checkForExternalText();
               }.bind(this),
               onFailure: this.onFailure
             });
             new Ajax.Request(this.options.loadCollectionURL, options);
           },
         
           showLoadingText: function(text) {
             this._controls.editor.disabled = true;
             var tempOption = this._controls.editor.firstChild;
             if (!tempOption) {
               tempOption = document.createElement(&#39;option&#39;);
               tempOption.value = &#39;&#39;;
               this._controls.editor.appendChild(tempOption);
               tempOption.selected = true;
             }
             tempOption.update((text || &#39;&#39;).stripScripts().stripTags());
           },
         
           checkForExternalText: function() {
             this._text = this.getText();
             if (this.options.loadTextURL)
               this.loadExternalText();
             else
               this.buildOptionList();
           },
         
           loadExternalText: function() {
             this.showLoadingText(this.options.loadingText);
             var options = Object.extend({ method: &#39;get&#39; }, this.options.ajaxOptions);
             Object.extend(options, {
               parameters: &#39;editorId=&#39; + encodeURIComponent(this.element.id),
               onComplete: Prototype.emptyFunction,
               onSuccess: function(transport) {
                 this._text = transport.responseText.strip();
                 this.buildOptionList();
               }.bind(this),
               onFailure: this.onFailure
             });
             new Ajax.Request(this.options.loadTextURL, options);
           },
         
           buildOptionList: function() {
             this._form.removeClassName(this.options.loadingClassName);
             this._collection = this._collection.map(function(entry) {
               return 2 === entry.length ? entry : [entry, entry].flatten();
             });
             var marker = (&#39;value&#39; in this.options) ? this.options.value : this._text;
             var textFound = this._collection.any(function(entry) {
               return entry[0] == marker;
             }.bind(this));
             this._controls.editor.update(&#39;&#39;);
             var option;
             this._collection.each(function(entry, index) {
               option = document.createElement(&#39;option&#39;);
               option.value = entry[0];
               option.selected = textFound ? entry[0] == marker : 0 == index;
               option.appendChild(document.createTextNode(entry[1]));
               this._controls.editor.appendChild(option);
             }.bind(this));
             this._controls.editor.disabled = false;
             Field.scrollFreeActivate(this._controls.editor);
           }
         });
         
         //**** DEPRECATION LAYER FOR InPlace[Collection]Editor! ****
         //**** This only  exists for a while,  in order to  let ****
         //**** users adapt to  the new API.  Read up on the new ****
         //**** API and convert your code to it ASAP!            ****
         
         Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions = function(options) {
           if (!options) return;
           function fallback(name, expr) {
             if (name in options || expr === undefined) return;
             options[name] = expr;
           };
           fallback(&#39;cancelControl&#39;, (options.cancelLink ? &#39;link&#39; : (options.cancelButton ? &#39;button&#39; :
             options.cancelLink == options.cancelButton == false ? false : undefined)));
           fallback(&#39;okControl&#39;, (options.okLink ? &#39;link&#39; : (options.okButton ? &#39;button&#39; :
             options.okLink == options.okButton == false ? false : undefined)));
           fallback(&#39;highlightColor&#39;, options.highlightcolor);
           fallback(&#39;highlightEndColor&#39;, options.highlightendcolor);
         };
         
         Object.extend(Ajax.InPlaceEditor, {
           DefaultOptions: {
             ajaxOptions: { },
             autoRows: 3,                                // Use when multi-line w/ rows == 1
             cancelControl: &#39;link&#39;,                      // &#39;link&#39;|&#39;button&#39;|false
             cancelText: &#39;cancel&#39;,
             clickToEditText: &#39;Click to edit&#39;,
             externalControl: null,                      // id|elt
             externalControlOnly: false,
             fieldPostCreation: &#39;activate&#39;,              // &#39;activate&#39;|&#39;focus&#39;|false
             formClassName: &#39;inplaceeditor-form&#39;,
             formId: null,                               // id|elt
             highlightColor: &#39;#ffff99&#39;,
             highlightEndColor: &#39;#ffffff&#39;,
             hoverClassName: &#39;&#39;,
             htmlResponse: true,
             loadingClassName: &#39;inplaceeditor-loading&#39;,
             loadingText: &#39;Loading...&#39;,
             okControl: &#39;button&#39;,                        // &#39;link&#39;|&#39;button&#39;|false
             okText: &#39;ok&#39;,
             paramName: &#39;value&#39;,
             rows: 1,                                    // If 1 and multi-line, uses autoRows
             savingClassName: &#39;inplaceeditor-saving&#39;,
             savingText: &#39;Saving...&#39;,
             size: 0,
             stripLoadedTextTags: false,
             submitOnBlur: false,
             textAfterControls: &#39;&#39;,
             textBeforeControls: &#39;&#39;,
             textBetweenControls: &#39;&#39;
           },
           DefaultCallbacks: {
             callback: function(form) {
               return Form.serialize(form);
             },
             onComplete: function(transport, element) {
               // For backward compatibility, this one is bound to the IPE, and passes
               // the element directly.  It was too often customized, so we don&#39;t break it.
               new Effect.Highlight(element, {
                 startcolor: this.options.highlightColor, keepBackgroundImage: true });
             },
             onEnterEditMode: null,
             onEnterHover: function(ipe) {
               ipe.element.style.backgroundColor = ipe.options.highlightColor;
               if (ipe._effect)
                 ipe._effect.cancel();
             },
             onFailure: function(transport, ipe) {
               alert(&#39;Error communication with the server: &#39; + transport.responseText.stripTags());
             },
             onFormCustomization: null, // Takes the IPE and its generated form, after editor, before controls.
             onLeaveEditMode: null,
             onLeaveHover: function(ipe) {
               ipe._effect = new Effect.Highlight(ipe.element, {
                 startcolor: ipe.options.highlightColor, endcolor: ipe.options.highlightEndColor,
                 restorecolor: ipe._originalBackground, keepBackgroundImage: true
               });
             }
           },
           Listeners: {
             click: &#39;enterEditMode&#39;,
             keydown: &#39;checkForEscapeOrReturn&#39;,
             mouseover: &#39;enterHover&#39;,
             mouseout: &#39;leaveHover&#39;
           }
         });
         
         Ajax.InPlaceCollectionEditor.DefaultOptions = {
           loadingCollectionText: &#39;Loading options...&#39;
         };
         
         // Delayed observer, like Form.Element.Observer,
         // but waits for delay after last key input
         // Ideal for live-search fields
         
         Form.Element.DelayedObserver = Class.create({
           initialize: function(element, delay, callback) {
             this.delay     = delay || 0.5;
             this.element   = $(element);
             this.callback  = callback;
             this.timer     = null;
             this.lastValue = $F(this.element);
             Event.observe(this.element,&#39;keyup&#39;,this.delayedListener.bindAsEventListener(this));
           },
           delayedListener: function(event) {
             if(this.lastValue == $F(this.element)) return;
             if(this.timer) clearTimeout(this.timer);
             this.timer = setTimeout(this.onTimerEvent.bind(this), this.delay * 1000);
             this.lastValue = $F(this.element);
           },
           onTimerEvent: function() {
             this.timer = null;
             this.callback(this.element, $F(this.element));
           }
         });
        \ No newline at end of file
        </pre></div>
        <h2 id='public-javascripts-dragdrop-js'>public/javascripts/dragdrop.js</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,973 +1,974 @@</span>
        <span class="gd">-// Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gd">-//           (c) 2005-2008 Sammi Williams (http://www.oriontransfer.co.nz, sammi@oriontransfer.co.nz)</span>
        <span class="gi">+// script.aculo.us dragdrop.js v1.8.3, Thu Oct 08 11:23:33 +0200 2009</span>
        <span class="gi">+</span>
        <span class="gi">+// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
         //
         // script.aculo.us is freely distributable under the terms of an MIT-style license.
         // For details, see the script.aculo.us web site: http://script.aculo.us/
         
         if(Object.isUndefined(Effect))
           throw(&quot;dragdrop.js requires including script.aculo.us&#39; effects.js library&quot;);
         
         var Droppables = {
           drops: [],
         
           remove: function(element) {
             this.drops = this.drops.reject(function(d) { return d.element==$(element) });
           },
         
           add: function(element) {
             element = $(element);
             var options = Object.extend({
               greedy:     true,
               hoverclass: null,
               tree:       false
             }, arguments[1] || { });
         
             // cache containers
             if(options.containment) {
               options._containers = [];
               var containment = options.containment;
               if(Object.isArray(containment)) {
                 containment.each( function(c) { options._containers.push($(c)) });
               } else {
                 options._containers.push($(containment));
               }
             }
         
             if(options.accept) options.accept = [options.accept].flatten();
         
             Element.makePositioned(element); // fix IE
             options.element = element;
         
             this.drops.push(options);
           },
         
           findDeepestChild: function(drops) {
             deepest = drops[0];
         
             for (i = 1; i &lt; drops.length; ++i)
               if (Element.isParent(drops[i].element, deepest.element))
                 deepest = drops[i];
         
             return deepest;
           },
         
           isContained: function(element, drop) {
             var containmentNode;
             if(drop.tree) {
               containmentNode = element.treeNode;
             } else {
               containmentNode = element.parentNode;
             }
             return drop._containers.detect(function(c) { return containmentNode == c });
           },
         
           isAffected: function(point, element, drop) {
             return (
               (drop.element!=element) &amp;&amp;
               ((!drop._containers) ||
                 this.isContained(element, drop)) &amp;&amp;
               ((!drop.accept) ||
                 (Element.classNames(element).detect(
                   function(v) { return drop.accept.include(v) } ) )) &amp;&amp;
               Position.within(drop.element, point[0], point[1]) );
           },
         
           deactivate: function(drop) {
             if(drop.hoverclass)
               Element.removeClassName(drop.element, drop.hoverclass);
             this.last_active = null;
           },
         
           activate: function(drop) {
             if(drop.hoverclass)
               Element.addClassName(drop.element, drop.hoverclass);
             this.last_active = drop;
           },
         
           show: function(point, element) {
             if(!this.drops.length) return;
             var drop, affected = [];
         
             this.drops.each( function(drop) {
               if(Droppables.isAffected(point, element, drop))
                 affected.push(drop);
             });
         
             if(affected.length&gt;0)
               drop = Droppables.findDeepestChild(affected);
         
             if(this.last_active &amp;&amp; this.last_active != drop) this.deactivate(this.last_active);
             if (drop) {
               Position.within(drop.element, point[0], point[1]);
               if(drop.onHover)
                 drop.onHover(element, drop.element, Position.overlap(drop.overlap, drop.element));
         
               if (drop != this.last_active) Droppables.activate(drop);
             }
           },
         
           fire: function(event, element) {
             if(!this.last_active) return;
             Position.prepare();
         
             if (this.isAffected([Event.pointerX(event), Event.pointerY(event)], element, this.last_active))
               if (this.last_active.onDrop) {
                 this.last_active.onDrop(element, this.last_active.element, event);
                 return true;
               }
           },
         
           reset: function() {
             if(this.last_active)
               this.deactivate(this.last_active);
           }
         };
         
         var Draggables = {
           drags: [],
           observers: [],
         
           register: function(draggable) {
             if(this.drags.length == 0) {
               this.eventMouseUp   = this.endDrag.bindAsEventListener(this);
               this.eventMouseMove = this.updateDrag.bindAsEventListener(this);
               this.eventKeypress  = this.keyPress.bindAsEventListener(this);
         
               Event.observe(document, &quot;mouseup&quot;, this.eventMouseUp);
               Event.observe(document, &quot;mousemove&quot;, this.eventMouseMove);
               Event.observe(document, &quot;keypress&quot;, this.eventKeypress);
             }
             this.drags.push(draggable);
           },
         
           unregister: function(draggable) {
             this.drags = this.drags.reject(function(d) { return d==draggable });
             if(this.drags.length == 0) {
               Event.stopObserving(document, &quot;mouseup&quot;, this.eventMouseUp);
               Event.stopObserving(document, &quot;mousemove&quot;, this.eventMouseMove);
               Event.stopObserving(document, &quot;keypress&quot;, this.eventKeypress);
             }
           },
         
           activate: function(draggable) {
             if(draggable.options.delay) {
               this._timeout = setTimeout(function() {
                 Draggables._timeout = null;
                 window.focus();
                 Draggables.activeDraggable = draggable;
               }.bind(this), draggable.options.delay);
             } else {
               window.focus(); // allows keypress events if window isn&#39;t currently focused, fails for Safari
               this.activeDraggable = draggable;
             }
           },
         
           deactivate: function() {
             this.activeDraggable = null;
           },
         
           updateDrag: function(event) {
             if(!this.activeDraggable) return;
             var pointer = [Event.pointerX(event), Event.pointerY(event)];
             // Mozilla-based browsers fire successive mousemove events with
             // the same coordinates, prevent needless redrawing (moz bug?)
             if(this._lastPointer &amp;&amp; (this._lastPointer.inspect() == pointer.inspect())) return;
             this._lastPointer = pointer;
         
             this.activeDraggable.updateDrag(event, pointer);
           },
         
           endDrag: function(event) {
             if(this._timeout) {
               clearTimeout(this._timeout);
               this._timeout = null;
             }
             if(!this.activeDraggable) return;
             this._lastPointer = null;
             this.activeDraggable.endDrag(event);
             this.activeDraggable = null;
           },
         
           keyPress: function(event) {
             if(this.activeDraggable)
               this.activeDraggable.keyPress(event);
           },
         
           addObserver: function(observer) {
             this.observers.push(observer);
             this._cacheObserverCallbacks();
           },
         
           removeObserver: function(element) {  // element instead of observer fixes mem leaks
             this.observers = this.observers.reject( function(o) { return o.element==element });
             this._cacheObserverCallbacks();
           },
         
           notify: function(eventName, draggable, event) {  // &#39;onStart&#39;, &#39;onEnd&#39;, &#39;onDrag&#39;
             if(this[eventName+&#39;Count&#39;] &gt; 0)
               this.observers.each( function(o) {
                 if(o[eventName]) o[eventName](eventName, draggable, event);
               });
             if(draggable.options[eventName]) draggable.options[eventName](draggable, event);
           },
         
           _cacheObserverCallbacks: function() {
             [&#39;onStart&#39;,&#39;onEnd&#39;,&#39;onDrag&#39;].each( function(eventName) {
               Draggables[eventName+&#39;Count&#39;] = Draggables.observers.select(
                 function(o) { return o[eventName]; }
               ).length;
             });
           }
         };
         
         /*--------------------------------------------------------------------------*/
         
         var Draggable = Class.create({
           initialize: function(element) {
             var defaults = {
               handle: false,
               reverteffect: function(element, top_offset, left_offset) {
                 var dur = Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;
                 new Effect.Move(element, { x: -left_offset, y: -top_offset, duration: dur,
                   queue: {scope:&#39;_draggable&#39;, position:&#39;end&#39;}
                 });
               },
               endeffect: function(element) {
                 var toOpacity = Object.isNumber(element._opacity) ? element._opacity : 1.0;
                 new Effect.Opacity(element, {duration:0.2, from:0.7, to:toOpacity,
                   queue: {scope:&#39;_draggable&#39;, position:&#39;end&#39;},
                   afterFinish: function(){
                     Draggable._dragging[element] = false
                   }
                 });
               },
               zindex: 1000,
               revert: false,
               quiet: false,
               scroll: false,
               scrollSensitivity: 20,
               scrollSpeed: 15,
               snap: false,  // false, or xy or [x,y] or function(x,y){ return [x,y] }
               delay: 0
             };
         
             if(!arguments[1] || Object.isUndefined(arguments[1].endeffect))
               Object.extend(defaults, {
                 starteffect: function(element) {
                   element._opacity = Element.getOpacity(element);
                   Draggable._dragging[element] = true;
                   new Effect.Opacity(element, {duration:0.2, from:element._opacity, to:0.7});
                 }
               });
         
             var options = Object.extend(defaults, arguments[1] || { });
         
             this.element = $(element);
         
             if(options.handle &amp;&amp; Object.isString(options.handle))
               this.handle = this.element.down(&#39;.&#39;+options.handle, 0);
         
             if(!this.handle) this.handle = $(options.handle);
             if(!this.handle) this.handle = this.element;
         
             if(options.scroll &amp;&amp; !options.scroll.scrollTo &amp;&amp; !options.scroll.outerHTML) {
               options.scroll = $(options.scroll);
               this._isScrollChild = Element.childOf(this.element, options.scroll);
             }
         
             Element.makePositioned(this.element); // fix IE
         
             this.options  = options;
             this.dragging = false;
         
             this.eventMouseDown = this.initDrag.bindAsEventListener(this);
             Event.observe(this.handle, &quot;mousedown&quot;, this.eventMouseDown);
         
             Draggables.register(this);
           },
         
           destroy: function() {
             Event.stopObserving(this.handle, &quot;mousedown&quot;, this.eventMouseDown);
             Draggables.unregister(this);
           },
         
           currentDelta: function() {
             return([
               parseInt(Element.getStyle(this.element,&#39;left&#39;) || &#39;0&#39;),
               parseInt(Element.getStyle(this.element,&#39;top&#39;) || &#39;0&#39;)]);
           },
         
           initDrag: function(event) {
             if(!Object.isUndefined(Draggable._dragging[this.element]) &amp;&amp;
               Draggable._dragging[this.element]) return;
             if(Event.isLeftClick(event)) {
               // abort on form elements, fixes a Firefox issue
               var src = Event.element(event);
               if((tag_name = src.tagName.toUpperCase()) &amp;&amp; (
                 tag_name==&#39;INPUT&#39; ||
                 tag_name==&#39;SELECT&#39; ||
                 tag_name==&#39;OPTION&#39; ||
                 tag_name==&#39;BUTTON&#39; ||
                 tag_name==&#39;TEXTAREA&#39;)) return;
         
               var pointer = [Event.pointerX(event), Event.pointerY(event)];
        <span class="gd">-      var pos     = Position.cumulativeOffset(this.element);</span>
        <span class="gi">+      var pos     = this.element.cumulativeOffset();</span>
               this.offset = [0,1].map( function(i) { return (pointer[i] - pos[i]) });
         
               Draggables.activate(this);
               Event.stop(event);
             }
           },
         
           startDrag: function(event) {
             this.dragging = true;
             if(!this.delta)
               this.delta = this.currentDelta();
         
             if(this.options.zindex) {
               this.originalZ = parseInt(Element.getStyle(this.element,&#39;z-index&#39;) || 0);
               this.element.style.zIndex = this.options.zindex;
             }
         
             if(this.options.ghosting) {
               this._clone = this.element.cloneNode(true);
               this._originallyAbsolute = (this.element.getStyle(&#39;position&#39;) == &#39;absolute&#39;);
               if (!this._originallyAbsolute)
                 Position.absolutize(this.element);
               this.element.parentNode.insertBefore(this._clone, this.element);
             }
         
             if(this.options.scroll) {
               if (this.options.scroll == window) {
                 var where = this._getWindowScroll(this.options.scroll);
                 this.originalScrollLeft = where.left;
                 this.originalScrollTop = where.top;
               } else {
                 this.originalScrollLeft = this.options.scroll.scrollLeft;
                 this.originalScrollTop = this.options.scroll.scrollTop;
               }
             }
         
             Draggables.notify(&#39;onStart&#39;, this, event);
         
             if(this.options.starteffect) this.options.starteffect(this.element);
           },
         
           updateDrag: function(event, pointer) {
             if(!this.dragging) this.startDrag(event);
         
             if(!this.options.quiet){
               Position.prepare();
               Droppables.show(pointer, this.element);
             }
         
             Draggables.notify(&#39;onDrag&#39;, this, event);
         
             this.draw(pointer);
             if(this.options.change) this.options.change(this);
         
             if(this.options.scroll) {
               this.stopScrolling();
         
               var p;
               if (this.options.scroll == window) {
                 with(this._getWindowScroll(this.options.scroll)) { p = [ left, top, left+width, top+height ]; }
               } else {
                 p = Position.page(this.options.scroll);
                 p[0] += this.options.scroll.scrollLeft + Position.deltaX;
                 p[1] += this.options.scroll.scrollTop + Position.deltaY;
                 p.push(p[0]+this.options.scroll.offsetWidth);
                 p.push(p[1]+this.options.scroll.offsetHeight);
               }
               var speed = [0,0];
               if(pointer[0] &lt; (p[0]+this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[0]+this.options.scrollSensitivity);
               if(pointer[1] &lt; (p[1]+this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[1]+this.options.scrollSensitivity);
               if(pointer[0] &gt; (p[2]-this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[2]-this.options.scrollSensitivity);
               if(pointer[1] &gt; (p[3]-this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[3]-this.options.scrollSensitivity);
               this.startScrolling(speed);
             }
         
             // fix AppleWebKit rendering
             if(Prototype.Browser.WebKit) window.scrollBy(0,0);
         
             Event.stop(event);
           },
         
           finishDrag: function(event, success) {
             this.dragging = false;
         
             if(this.options.quiet){
               Position.prepare();
               var pointer = [Event.pointerX(event), Event.pointerY(event)];
               Droppables.show(pointer, this.element);
             }
         
             if(this.options.ghosting) {
               if (!this._originallyAbsolute)
                 Position.relativize(this.element);
               delete this._originallyAbsolute;
               Element.remove(this._clone);
               this._clone = null;
             }
         
             var dropped = false;
             if(success) {
               dropped = Droppables.fire(event, this.element);
               if (!dropped) dropped = false;
             }
             if(dropped &amp;&amp; this.options.onDropped) this.options.onDropped(this.element);
             Draggables.notify(&#39;onEnd&#39;, this, event);
         
             var revert = this.options.revert;
             if(revert &amp;&amp; Object.isFunction(revert)) revert = revert(this.element);
         
             var d = this.currentDelta();
             if(revert &amp;&amp; this.options.reverteffect) {
               if (dropped == 0 || revert != &#39;failure&#39;)
                 this.options.reverteffect(this.element,
                   d[1]-this.delta[1], d[0]-this.delta[0]);
             } else {
               this.delta = d;
             }
         
             if(this.options.zindex)
               this.element.style.zIndex = this.originalZ;
         
             if(this.options.endeffect)
               this.options.endeffect(this.element);
         
             Draggables.deactivate(this);
             Droppables.reset();
           },
         
           keyPress: function(event) {
             if(event.keyCode!=Event.KEY_ESC) return;
             this.finishDrag(event, false);
             Event.stop(event);
           },
         
           endDrag: function(event) {
             if(!this.dragging) return;
             this.stopScrolling();
             this.finishDrag(event, true);
             Event.stop(event);
           },
         
           draw: function(point) {
        <span class="gd">-    var pos = Position.cumulativeOffset(this.element);</span>
        <span class="gi">+    var pos = this.element.cumulativeOffset();</span>
             if(this.options.ghosting) {
               var r   = Position.realOffset(this.element);
               pos[0] += r[0] - Position.deltaX; pos[1] += r[1] - Position.deltaY;
             }
         
             var d = this.currentDelta();
             pos[0] -= d[0]; pos[1] -= d[1];
         
             if(this.options.scroll &amp;&amp; (this.options.scroll != window &amp;&amp; this._isScrollChild)) {
               pos[0] -= this.options.scroll.scrollLeft-this.originalScrollLeft;
               pos[1] -= this.options.scroll.scrollTop-this.originalScrollTop;
             }
         
             var p = [0,1].map(function(i){
               return (point[i]-pos[i]-this.offset[i])
             }.bind(this));
         
             if(this.options.snap) {
               if(Object.isFunction(this.options.snap)) {
                 p = this.options.snap(p[0],p[1],this);
               } else {
               if(Object.isArray(this.options.snap)) {
                 p = p.map( function(v, i) {
                   return (v/this.options.snap[i]).round()*this.options.snap[i] }.bind(this));
               } else {
                 p = p.map( function(v) {
                   return (v/this.options.snap).round()*this.options.snap }.bind(this));
               }
             }}
         
             var style = this.element.style;
             if((!this.options.constraint) || (this.options.constraint==&#39;horizontal&#39;))
               style.left = p[0] + &quot;px&quot;;
             if((!this.options.constraint) || (this.options.constraint==&#39;vertical&#39;))
               style.top  = p[1] + &quot;px&quot;;
         
             if(style.visibility==&quot;hidden&quot;) style.visibility = &quot;&quot;; // fix gecko rendering
           },
         
           stopScrolling: function() {
             if(this.scrollInterval) {
               clearInterval(this.scrollInterval);
               this.scrollInterval = null;
               Draggables._lastScrollPointer = null;
             }
           },
         
           startScrolling: function(speed) {
             if(!(speed[0] || speed[1])) return;
             this.scrollSpeed = [speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];
             this.lastScrolled = new Date();
             this.scrollInterval = setInterval(this.scroll.bind(this), 10);
           },
         
           scroll: function() {
             var current = new Date();
             var delta = current - this.lastScrolled;
             this.lastScrolled = current;
             if(this.options.scroll == window) {
               with (this._getWindowScroll(this.options.scroll)) {
                 if (this.scrollSpeed[0] || this.scrollSpeed[1]) {
                   var d = delta / 1000;
                   this.options.scroll.scrollTo( left + d*this.scrollSpeed[0], top + d*this.scrollSpeed[1] );
                 }
               }
             } else {
               this.options.scroll.scrollLeft += this.scrollSpeed[0] * delta / 1000;
               this.options.scroll.scrollTop  += this.scrollSpeed[1] * delta / 1000;
             }
         
             Position.prepare();
             Droppables.show(Draggables._lastPointer, this.element);
             Draggables.notify(&#39;onDrag&#39;, this);
             if (this._isScrollChild) {
               Draggables._lastScrollPointer = Draggables._lastScrollPointer || $A(Draggables._lastPointer);
               Draggables._lastScrollPointer[0] += this.scrollSpeed[0] * delta / 1000;
               Draggables._lastScrollPointer[1] += this.scrollSpeed[1] * delta / 1000;
               if (Draggables._lastScrollPointer[0] &lt; 0)
                 Draggables._lastScrollPointer[0] = 0;
               if (Draggables._lastScrollPointer[1] &lt; 0)
                 Draggables._lastScrollPointer[1] = 0;
               this.draw(Draggables._lastScrollPointer);
             }
         
             if(this.options.change) this.options.change(this);
           },
         
           _getWindowScroll: function(w) {
             var T, L, W, H;
             with (w.document) {
               if (w.document.documentElement &amp;&amp; documentElement.scrollTop) {
                 T = documentElement.scrollTop;
                 L = documentElement.scrollLeft;
               } else if (w.document.body) {
                 T = body.scrollTop;
                 L = body.scrollLeft;
               }
               if (w.innerWidth) {
                 W = w.innerWidth;
                 H = w.innerHeight;
               } else if (w.document.documentElement &amp;&amp; documentElement.clientWidth) {
                 W = documentElement.clientWidth;
                 H = documentElement.clientHeight;
               } else {
                 W = body.offsetWidth;
                 H = body.offsetHeight;
               }
             }
             return { top: T, left: L, width: W, height: H };
           }
         });
         
         Draggable._dragging = { };
         
         /*--------------------------------------------------------------------------*/
         
         var SortableObserver = Class.create({
           initialize: function(element, observer) {
             this.element   = $(element);
             this.observer  = observer;
             this.lastValue = Sortable.serialize(this.element);
           },
         
           onStart: function() {
             this.lastValue = Sortable.serialize(this.element);
           },
         
           onEnd: function() {
             Sortable.unmark();
             if(this.lastValue != Sortable.serialize(this.element))
               this.observer(this.element)
           }
         });
         
         var Sortable = {
           SERIALIZE_RULE: /^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,
         
           sortables: { },
         
           _findRootElement: function(element) {
             while (element.tagName.toUpperCase() != &quot;BODY&quot;) {
               if(element.id &amp;&amp; Sortable.sortables[element.id]) return element;
               element = element.parentNode;
             }
           },
         
           options: function(element) {
             element = Sortable._findRootElement($(element));
             if(!element) return;
             return Sortable.sortables[element.id];
           },
         
           destroy: function(element){
             element = $(element);
             var s = Sortable.sortables[element.id];
         
             if(s) {
               Draggables.removeObserver(s.element);
               s.droppables.each(function(d){ Droppables.remove(d) });
               s.draggables.invoke(&#39;destroy&#39;);
         
               delete Sortable.sortables[s.element.id];
             }
           },
         
           create: function(element) {
             element = $(element);
             var options = Object.extend({
               element:     element,
               tag:         &#39;li&#39;,       // assumes li children, override with tag: &#39;tagname&#39;
               dropOnEmpty: false,
               tree:        false,
               treeTag:     &#39;ul&#39;,
               overlap:     &#39;vertical&#39;, // one of &#39;vertical&#39;, &#39;horizontal&#39;
               constraint:  &#39;vertical&#39;, // one of &#39;vertical&#39;, &#39;horizontal&#39;, false
               containment: element,    // also takes array of elements (or id&#39;s); or false
               handle:      false,      // or a CSS class
               only:        false,
               delay:       0,
               hoverclass:  null,
               ghosting:    false,
               quiet:       false,
               scroll:      false,
               scrollSensitivity: 20,
               scrollSpeed: 15,
               format:      this.SERIALIZE_RULE,
         
               // these take arrays of elements or ids and can be
               // used for better initialization performance
               elements:    false,
               handles:     false,
         
               onChange:    Prototype.emptyFunction,
               onUpdate:    Prototype.emptyFunction
             }, arguments[1] || { });
         
             // clear any old sortable with same element
             this.destroy(element);
         
             // build options for the draggables
             var options_for_draggable = {
               revert:      true,
               quiet:       options.quiet,
               scroll:      options.scroll,
               scrollSpeed: options.scrollSpeed,
               scrollSensitivity: options.scrollSensitivity,
               delay:       options.delay,
               ghosting:    options.ghosting,
               constraint:  options.constraint,
               handle:      options.handle };
         
             if(options.starteffect)
               options_for_draggable.starteffect = options.starteffect;
         
             if(options.reverteffect)
               options_for_draggable.reverteffect = options.reverteffect;
             else
               if(options.ghosting) options_for_draggable.reverteffect = function(element) {
                 element.style.top  = 0;
                 element.style.left = 0;
               };
         
             if(options.endeffect)
               options_for_draggable.endeffect = options.endeffect;
         
             if(options.zindex)
               options_for_draggable.zindex = options.zindex;
         
             // build options for the droppables
             var options_for_droppable = {
               overlap:     options.overlap,
               containment: options.containment,
               tree:        options.tree,
               hoverclass:  options.hoverclass,
               onHover:     Sortable.onHover
             };
         
             var options_for_tree = {
               onHover:      Sortable.onEmptyHover,
               overlap:      options.overlap,
               containment:  options.containment,
               hoverclass:   options.hoverclass
             };
         
             // fix for gecko engine
             Element.cleanWhitespace(element);
         
             options.draggables = [];
             options.droppables = [];
         
             // drop on empty handling
             if(options.dropOnEmpty || options.tree) {
               Droppables.add(element, options_for_tree);
               options.droppables.push(element);
             }
         
             (options.elements || this.findElements(element, options) || []).each( function(e,i) {
               var handle = options.handles ? $(options.handles[i]) :
                 (options.handle ? $(e).select(&#39;.&#39; + options.handle)[0] : e);
               options.draggables.push(
                 new Draggable(e, Object.extend(options_for_draggable, { handle: handle })));
               Droppables.add(e, options_for_droppable);
               if(options.tree) e.treeNode = element;
               options.droppables.push(e);
             });
         
             if(options.tree) {
               (Sortable.findTreeElements(element, options) || []).each( function(e) {
                 Droppables.add(e, options_for_tree);
                 e.treeNode = element;
                 options.droppables.push(e);
               });
             }
         
             // keep reference
        <span class="gd">-    this.sortables[element.id] = options;</span>
        <span class="gi">+    this.sortables[element.identify()] = options;</span>
         
             // for onupdate
             Draggables.addObserver(new SortableObserver(element, options.onUpdate));
         
           },
         
           // return all suitable-for-sortable elements in a guaranteed order
           findElements: function(element, options) {
             return Element.findChildren(
               element, options.only, options.tree ? true : false, options.tag);
           },
         
           findTreeElements: function(element, options) {
             return Element.findChildren(
               element, options.only, options.tree ? true : false, options.treeTag);
           },
         
           onHover: function(element, dropon, overlap) {
             if(Element.isParent(dropon, element)) return;
         
             if(overlap &gt; .33 &amp;&amp; overlap &lt; .66 &amp;&amp; Sortable.options(dropon).tree) {
               return;
             } else if(overlap&gt;0.5) {
               Sortable.mark(dropon, &#39;before&#39;);
               if(dropon.previousSibling != element) {
                 var oldParentNode = element.parentNode;
                 element.style.visibility = &quot;hidden&quot;; // fix gecko rendering
                 dropon.parentNode.insertBefore(element, dropon);
                 if(dropon.parentNode!=oldParentNode)
                   Sortable.options(oldParentNode).onChange(element);
                 Sortable.options(dropon.parentNode).onChange(element);
               }
             } else {
               Sortable.mark(dropon, &#39;after&#39;);
               var nextElement = dropon.nextSibling || null;
               if(nextElement != element) {
                 var oldParentNode = element.parentNode;
                 element.style.visibility = &quot;hidden&quot;; // fix gecko rendering
                 dropon.parentNode.insertBefore(element, nextElement);
                 if(dropon.parentNode!=oldParentNode)
                   Sortable.options(oldParentNode).onChange(element);
                 Sortable.options(dropon.parentNode).onChange(element);
               }
             }
           },
         
           onEmptyHover: function(element, dropon, overlap) {
             var oldParentNode = element.parentNode;
             var droponOptions = Sortable.options(dropon);
         
             if(!Element.isParent(dropon, element)) {
               var index;
         
               var children = Sortable.findElements(dropon, {tag: droponOptions.tag, only: droponOptions.only});
               var child = null;
         
               if(children) {
                 var offset = Element.offsetSize(dropon, droponOptions.overlap) * (1.0 - overlap);
         
                 for (index = 0; index &lt; children.length; index += 1) {
                   if (offset - Element.offsetSize (children[index], droponOptions.overlap) &gt;= 0) {
                     offset -= Element.offsetSize (children[index], droponOptions.overlap);
                   } else if (offset - (Element.offsetSize (children[index], droponOptions.overlap) / 2) &gt;= 0) {
                     child = index + 1 &lt; children.length ? children[index + 1] : null;
                     break;
                   } else {
                     child = children[index];
                     break;
                   }
                 }
               }
         
               dropon.insertBefore(element, child);
         
               Sortable.options(oldParentNode).onChange(element);
               droponOptions.onChange(element);
             }
           },
         
           unmark: function() {
             if(Sortable._marker) Sortable._marker.hide();
           },
         
           mark: function(dropon, position) {
             // mark on ghosting only
             var sortable = Sortable.options(dropon.parentNode);
             if(sortable &amp;&amp; !sortable.ghosting) return;
         
             if(!Sortable._marker) {
               Sortable._marker =
                 ($(&#39;dropmarker&#39;) || Element.extend(document.createElement(&#39;DIV&#39;))).
                   hide().addClassName(&#39;dropmarker&#39;).setStyle({position:&#39;absolute&#39;});
               document.getElementsByTagName(&quot;body&quot;).item(0).appendChild(Sortable._marker);
             }
        <span class="gd">-    var offsets = Position.cumulativeOffset(dropon);</span>
        <span class="gi">+    var offsets = dropon.cumulativeOffset();</span>
             Sortable._marker.setStyle({left: offsets[0]+&#39;px&#39;, top: offsets[1] + &#39;px&#39;});
         
             if(position==&#39;after&#39;)
               if(sortable.overlap == &#39;horizontal&#39;)
                 Sortable._marker.setStyle({left: (offsets[0]+dropon.clientWidth) + &#39;px&#39;});
               else
                 Sortable._marker.setStyle({top: (offsets[1]+dropon.clientHeight) + &#39;px&#39;});
         
             Sortable._marker.show();
           },
         
           _tree: function(element, options, parent) {
             var children = Sortable.findElements(element, options) || [];
         
             for (var i = 0; i &lt; children.length; ++i) {
               var match = children[i].id.match(options.format);
         
               if (!match) continue;
         
               var child = {
                 id: encodeURIComponent(match ? match[1] : null),
                 element: element,
                 parent: parent,
                 children: [],
                 position: parent.children.length,
                 container: $(children[i]).down(options.treeTag)
               };
         
               /* Get the element containing the children and recurse over it */
               if (child.container)
                 this._tree(child.container, options, child);
         
               parent.children.push (child);
             }
         
             return parent;
           },
         
           tree: function(element) {
             element = $(element);
             var sortableOptions = this.options(element);
             var options = Object.extend({
               tag: sortableOptions.tag,
               treeTag: sortableOptions.treeTag,
               only: sortableOptions.only,
               name: element.id,
               format: sortableOptions.format
             }, arguments[1] || { });
         
             var root = {
               id: null,
               parent: null,
               children: [],
               container: element,
               position: 0
             };
         
             return Sortable._tree(element, options, root);
           },
         
           /* Construct a [i] index for a particular node */
           _constructIndex: function(node) {
             var index = &#39;&#39;;
             do {
               if (node.id) index = &#39;[&#39; + node.position + &#39;]&#39; + index;
             } while ((node = node.parent) != null);
             return index;
           },
         
           sequence: function(element) {
             element = $(element);
             var options = Object.extend(this.options(element), arguments[1] || { });
         
             return $(this.findElements(element, options) || []).map( function(item) {
               return item.id.match(options.format) ? item.id.match(options.format)[1] : &#39;&#39;;
             });
           },
         
           setSequence: function(element, new_sequence) {
             element = $(element);
             var options = Object.extend(this.options(element), arguments[2] || { });
         
             var nodeMap = { };
             this.findElements(element, options).each( function(n) {
                 if (n.id.match(options.format))
                     nodeMap[n.id.match(options.format)[1]] = [n, n.parentNode];
                 n.parentNode.removeChild(n);
             });
         
             new_sequence.each(function(ident) {
               var n = nodeMap[ident];
               if (n) {
                 n[1].appendChild(n[0]);
                 delete nodeMap[ident];
               }
             });
           },
         
           serialize: function(element) {
             element = $(element);
             var options = Object.extend(Sortable.options(element), arguments[1] || { });
             var name = encodeURIComponent(
               (arguments[1] &amp;&amp; arguments[1].name) ? arguments[1].name : element.id);
         
             if (options.tree) {
               return Sortable.tree(element, arguments[1]).children.map( function (item) {
                 return [name + Sortable._constructIndex(item) + &quot;[id]=&quot; +
                         encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));
               }).flatten().join(&#39;&amp;&#39;);
             } else {
               return Sortable.sequence(element, arguments[1]).map( function(item) {
                 return name + &quot;[]=&quot; + encodeURIComponent(item);
               }).join(&#39;&amp;&#39;);
             }
           }
         };
         
         // Returns true if child is contained within element
         Element.isParent = function(child, element) {
           if (!child.parentNode || child == element) return false;
           if (child.parentNode == element) return true;
           return Element.isParent(child.parentNode, element);
         };
         
         Element.findChildren = function(element, only, recursive, tagName) {
           if(!element.hasChildNodes()) return null;
           tagName = tagName.toUpperCase();
           if(only) only = [only].flatten();
           var elements = [];
           $A(element.childNodes).each( function(e) {
             if(e.tagName &amp;&amp; e.tagName.toUpperCase()==tagName &amp;&amp;
               (!only || (Element.classNames(e).detect(function(v) { return only.include(v) }))))
                 elements.push(e);
             if(recursive) {
               var grandchildren = Element.findChildren(e, only, recursive, tagName);
               if(grandchildren) elements.push(grandchildren);
             }
           });
         
           return (elements.length&gt;0 ? elements.flatten() : []);
         };
         
         Element.offsetSize = function (element, type) {
           return element[&#39;offset&#39; + ((type==&#39;vertical&#39; || type==&#39;height&#39;) ? &#39;Height&#39; : &#39;Width&#39;)];
         };
        \ No newline at end of file
        </pre></div>
        <h2 id='public-javascripts-effects-js'>public/javascripts/effects.js</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,1128 +1,1123 @@</span>
        <span class="gd">-// Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
        <span class="gi">+// script.aculo.us effects.js v1.8.3, Thu Oct 08 11:23:33 +0200 2009</span>
        <span class="gi">+</span>
        <span class="gi">+// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)</span>
         // Contributors:
         //  Justin Palmer (http://encytemedia.com/)
         //  Mark Pilgrim (http://diveintomark.org/)
         //  Martin Bialasinki
         //
         // script.aculo.us is freely distributable under the terms of an MIT-style license.
         // For details, see the script.aculo.us web site: http://script.aculo.us/
         
         // converts rgb() and #xxx to #xxxxxx format,
         // returns self (or first argument) if not convertable
         String.prototype.parseColor = function() {
           var color = &#39;#&#39;;
           if (this.slice(0,4) == &#39;rgb(&#39;) {
             var cols = this.slice(4,this.length-1).split(&#39;,&#39;);
             var i=0; do { color += parseInt(cols[i]).toColorPart() } while (++i&lt;3);
           } else {
             if (this.slice(0,1) == &#39;#&#39;) {
               if (this.length==4) for(var i=1;i&lt;4;i++) color += (this.charAt(i) + this.charAt(i)).toLowerCase();
               if (this.length==7) color = this.toLowerCase();
             }
           }
           return (color.length==7 ? color : (arguments[0] || this));
         };
         
         /*--------------------------------------------------------------------------*/
         
         Element.collectTextNodes = function(element) {
           return $A($(element).childNodes).collect( function(node) {
             return (node.nodeType==3 ? node.nodeValue :
               (node.hasChildNodes() ? Element.collectTextNodes(node) : &#39;&#39;));
           }).flatten().join(&#39;&#39;);
         };
         
         Element.collectTextNodesIgnoreClass = function(element, className) {
           return $A($(element).childNodes).collect( function(node) {
             return (node.nodeType==3 ? node.nodeValue :
               ((node.hasChildNodes() &amp;&amp; !Element.hasClassName(node,className)) ?
                 Element.collectTextNodesIgnoreClass(node, className) : &#39;&#39;));
           }).flatten().join(&#39;&#39;);
         };
         
         Element.setContentZoom = function(element, percent) {
           element = $(element);
           element.setStyle({fontSize: (percent/100) + &#39;em&#39;});
           if (Prototype.Browser.WebKit) window.scrollBy(0,0);
           return element;
         };
         
         Element.getInlineOpacity = function(element){
           return $(element).style.opacity || &#39;&#39;;
         };
         
         Element.forceRerendering = function(element) {
           try {
             element = $(element);
             var n = document.createTextNode(&#39; &#39;);
             element.appendChild(n);
             element.removeChild(n);
           } catch(e) { }
         };
         
         /*--------------------------------------------------------------------------*/
         
         var Effect = {
           _elementDoesNotExistError: {
             name: &#39;ElementDoesNotExistError&#39;,
             message: &#39;The specified DOM element does not exist, but is required for this effect to operate&#39;
           },
           Transitions: {
             linear: Prototype.K,
             sinoidal: function(pos) {
               return (-Math.cos(pos*Math.PI)/2) + .5;
             },
             reverse: function(pos) {
               return 1-pos;
             },
             flicker: function(pos) {
               var pos = ((-Math.cos(pos*Math.PI)/4) + .75) + Math.random()/4;
               return pos &gt; 1 ? 1 : pos;
             },
             wobble: function(pos) {
               return (-Math.cos(pos*Math.PI*(9*pos))/2) + .5;
             },
             pulse: function(pos, pulses) {
               return (-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2) + .5;
             },
             spring: function(pos) {
               return 1 - (Math.cos(pos * 4.5 * Math.PI) * Math.exp(-pos * 6));
             },
             none: function(pos) {
               return 0;
             },
             full: function(pos) {
               return 1;
             }
           },
           DefaultOptions: {
             duration:   1.0,   // seconds
             fps:        100,   // 100= assume 66fps max.
             sync:       false, // true for combining
             from:       0.0,
             to:         1.0,
             delay:      0.0,
             queue:      &#39;parallel&#39;
           },
           tagifyText: function(element) {
             var tagifyStyle = &#39;position:relative&#39;;
             if (Prototype.Browser.IE) tagifyStyle += &#39;;zoom:1&#39;;
         
             element = $(element);
             $A(element.childNodes).each( function(child) {
               if (child.nodeType==3) {
                 child.nodeValue.toArray().each( function(character) {
                   element.insertBefore(
                     new Element(&#39;span&#39;, {style: tagifyStyle}).update(
                       character == &#39; &#39; ? String.fromCharCode(160) : character),
                       child);
                 });
                 Element.remove(child);
               }
             });
           },
           multiple: function(element, effect) {
             var elements;
             if (((typeof element == &#39;object&#39;) ||
                 Object.isFunction(element)) &amp;&amp;
                (element.length))
               elements = element;
             else
               elements = $(element).childNodes;
         
             var options = Object.extend({
               speed: 0.1,
               delay: 0.0
             }, arguments[2] || { });
             var masterDelay = options.delay;
         
             $A(elements).each( function(element, index) {
               new effect(element, Object.extend(options, { delay: index * options.speed + masterDelay }));
             });
           },
           PAIRS: {
             &#39;slide&#39;:  [&#39;SlideDown&#39;,&#39;SlideUp&#39;],
             &#39;blind&#39;:  [&#39;BlindDown&#39;,&#39;BlindUp&#39;],
             &#39;appear&#39;: [&#39;Appear&#39;,&#39;Fade&#39;]
           },
        <span class="gd">-  toggle: function(element, effect) {</span>
        <span class="gi">+  toggle: function(element, effect, options) {</span>
             element = $(element);
        <span class="gd">-    effect = (effect || &#39;appear&#39;).toLowerCase();</span>
        <span class="gd">-    var options = Object.extend({</span>
        <span class="gi">+    effect  = (effect || &#39;appear&#39;).toLowerCase();</span>
        <span class="gi">+</span>
        <span class="gi">+    return Effect[ Effect.PAIRS[ effect ][ element.visible() ? 1 : 0 ] ](element, Object.extend({</span>
               queue: { position:&#39;end&#39;, scope:(element.id || &#39;global&#39;), limit: 1 }
        <span class="gd">-    }, arguments[2] || { });</span>
        <span class="gd">-    Effect[element.visible() ?</span>
        <span class="gd">-      Effect.PAIRS[effect][1] : Effect.PAIRS[effect][0]](element, options);</span>
        <span class="gi">+    }, options || {}));</span>
           }
         };
         
         Effect.DefaultOptions.transition = Effect.Transitions.sinoidal;
         
         /* ------------- core effects ------------- */
         
         Effect.ScopedQueue = Class.create(Enumerable, {
           initialize: function() {
             this.effects  = [];
             this.interval = null;
           },
           _each: function(iterator) {
             this.effects._each(iterator);
           },
           add: function(effect) {
             var timestamp = new Date().getTime();
         
             var position = Object.isString(effect.options.queue) ?
               effect.options.queue : effect.options.queue.position;
         
             switch(position) {
               case &#39;front&#39;:
                 // move unstarted effects after this effect
                 this.effects.findAll(function(e){ return e.state==&#39;idle&#39; }).each( function(e) {
                     e.startOn  += effect.finishOn;
                     e.finishOn += effect.finishOn;
                   });
                 break;
               case &#39;with-last&#39;:
                 timestamp = this.effects.pluck(&#39;startOn&#39;).max() || timestamp;
                 break;
               case &#39;end&#39;:
                 // start effect after last queued effect has finished
                 timestamp = this.effects.pluck(&#39;finishOn&#39;).max() || timestamp;
                 break;
             }
         
             effect.startOn  += timestamp;
             effect.finishOn += timestamp;
         
             if (!effect.options.queue.limit || (this.effects.length &lt; effect.options.queue.limit))
               this.effects.push(effect);
         
             if (!this.interval)
               this.interval = setInterval(this.loop.bind(this), 15);
           },
           remove: function(effect) {
             this.effects = this.effects.reject(function(e) { return e==effect });
             if (this.effects.length == 0) {
               clearInterval(this.interval);
               this.interval = null;
             }
           },
           loop: function() {
             var timePos = new Date().getTime();
             for(var i=0, len=this.effects.length;i&lt;len;i++)
               this.effects[i] &amp;&amp; this.effects[i].loop(timePos);
           }
         });
         
         Effect.Queues = {
           instances: $H(),
           get: function(queueName) {
             if (!Object.isString(queueName)) return queueName;
         
             return this.instances.get(queueName) ||
               this.instances.set(queueName, new Effect.ScopedQueue());
           }
         };
         Effect.Queue = Effect.Queues.get(&#39;global&#39;);
         
         Effect.Base = Class.create({
           position: null,
           start: function(options) {
        <span class="gd">-    function codeForEvent(options,eventName){</span>
        <span class="gd">-      return (</span>
        <span class="gd">-        (options[eventName+&#39;Internal&#39;] ? &#39;this.options.&#39;+eventName+&#39;Internal(this);&#39; : &#39;&#39;) +</span>
        <span class="gd">-        (options[eventName] ? &#39;this.options.&#39;+eventName+&#39;(this);&#39; : &#39;&#39;)</span>
        <span class="gd">-      );</span>
        <span class="gd">-    }</span>
             if (options &amp;&amp; options.transition === false) options.transition = Effect.Transitions.linear;
             this.options      = Object.extend(Object.extend({ },Effect.DefaultOptions), options || { });
             this.currentFrame = 0;
             this.state        = &#39;idle&#39;;
             this.startOn      = this.options.delay*1000;
             this.finishOn     = this.startOn+(this.options.duration*1000);
             this.fromToDelta  = this.options.to-this.options.from;
             this.totalTime    = this.finishOn-this.startOn;
             this.totalFrames  = this.options.fps*this.options.duration;
         
             this.render = (function() {
               function dispatch(effect, eventName) {
                 if (effect.options[eventName + &#39;Internal&#39;])
                   effect.options[eventName + &#39;Internal&#39;](effect);
                 if (effect.options[eventName])
                   effect.options[eventName](effect);
               }
         
               return function(pos) {
                 if (this.state === &quot;idle&quot;) {
                   this.state = &quot;running&quot;;
                   dispatch(this, &#39;beforeSetup&#39;);
                   if (this.setup) this.setup();
                   dispatch(this, &#39;afterSetup&#39;);
                 }
                 if (this.state === &quot;running&quot;) {
                   pos = (this.options.transition(pos) * this.fromToDelta) + this.options.from;
                   this.position = pos;
                   dispatch(this, &#39;beforeUpdate&#39;);
                   if (this.update) this.update(pos);
                   dispatch(this, &#39;afterUpdate&#39;);
                 }
               };
             })();
         
             this.event(&#39;beforeStart&#39;);
             if (!this.options.sync)
               Effect.Queues.get(Object.isString(this.options.queue) ?
                 &#39;global&#39; : this.options.queue.scope).add(this);
           },
           loop: function(timePos) {
             if (timePos &gt;= this.startOn) {
               if (timePos &gt;= this.finishOn) {
                 this.render(1.0);
                 this.cancel();
                 this.event(&#39;beforeFinish&#39;);
                 if (this.finish) this.finish();
                 this.event(&#39;afterFinish&#39;);
                 return;
               }
               var pos   = (timePos - this.startOn) / this.totalTime,
                   frame = (pos * this.totalFrames).round();
               if (frame &gt; this.currentFrame) {
                 this.render(pos);
                 this.currentFrame = frame;
               }
             }
           },
           cancel: function() {
             if (!this.options.sync)
               Effect.Queues.get(Object.isString(this.options.queue) ?
                 &#39;global&#39; : this.options.queue.scope).remove(this);
             this.state = &#39;finished&#39;;
           },
           event: function(eventName) {
             if (this.options[eventName + &#39;Internal&#39;]) this.options[eventName + &#39;Internal&#39;](this);
             if (this.options[eventName]) this.options[eventName](this);
           },
           inspect: function() {
             var data = $H();
             for(property in this)
               if (!Object.isFunction(this[property])) data.set(property, this[property]);
             return &#39;#&lt;Effect:&#39; + data.inspect() + &#39;,options:&#39; + $H(this.options).inspect() + &#39;&gt;&#39;;
           }
         });
         
         Effect.Parallel = Class.create(Effect.Base, {
           initialize: function(effects) {
             this.effects = effects || [];
             this.start(arguments[1]);
           },
           update: function(position) {
             this.effects.invoke(&#39;render&#39;, position);
           },
           finish: function(position) {
             this.effects.each( function(effect) {
               effect.render(1.0);
               effect.cancel();
               effect.event(&#39;beforeFinish&#39;);
               if (effect.finish) effect.finish(position);
               effect.event(&#39;afterFinish&#39;);
             });
           }
         });
         
         Effect.Tween = Class.create(Effect.Base, {
           initialize: function(object, from, to) {
             object = Object.isString(object) ? $(object) : object;
             var args = $A(arguments), method = args.last(),
               options = args.length == 5 ? args[3] : null;
             this.method = Object.isFunction(method) ? method.bind(object) :
               Object.isFunction(object[method]) ? object[method].bind(object) :
               function(value) { object[method] = value };
             this.start(Object.extend({ from: from, to: to }, options || { }));
           },
           update: function(position) {
             this.method(position);
           }
         });
         
         Effect.Event = Class.create(Effect.Base, {
           initialize: function() {
             this.start(Object.extend({ duration: 0 }, arguments[0] || { }));
           },
           update: Prototype.emptyFunction
         });
         
         Effect.Opacity = Class.create(Effect.Base, {
           initialize: function(element) {
             this.element = $(element);
             if (!this.element) throw(Effect._elementDoesNotExistError);
             // make this work on IE on elements without &#39;layout&#39;
             if (Prototype.Browser.IE &amp;&amp; (!this.element.currentStyle.hasLayout))
               this.element.setStyle({zoom: 1});
             var options = Object.extend({
               from: this.element.getOpacity() || 0.0,
               to:   1.0
             }, arguments[1] || { });
             this.start(options);
           },
           update: function(position) {
             this.element.setOpacity(position);
           }
         });
         
         Effect.Move = Class.create(Effect.Base, {
           initialize: function(element) {
             this.element = $(element);
             if (!this.element) throw(Effect._elementDoesNotExistError);
             var options = Object.extend({
               x:    0,
               y:    0,
               mode: &#39;relative&#39;
             }, arguments[1] || { });
             this.start(options);
           },
           setup: function() {
             this.element.makePositioned();
             this.originalLeft = parseFloat(this.element.getStyle(&#39;left&#39;) || &#39;0&#39;);
             this.originalTop  = parseFloat(this.element.getStyle(&#39;top&#39;)  || &#39;0&#39;);
             if (this.options.mode == &#39;absolute&#39;) {
               this.options.x = this.options.x - this.originalLeft;
               this.options.y = this.options.y - this.originalTop;
             }
           },
           update: function(position) {
             this.element.setStyle({
               left: (this.options.x  * position + this.originalLeft).round() + &#39;px&#39;,
               top:  (this.options.y  * position + this.originalTop).round()  + &#39;px&#39;
             });
           }
         });
         
         // for backwards compatibility
         Effect.MoveBy = function(element, toTop, toLeft) {
           return new Effect.Move(element,
             Object.extend({ x: toLeft, y: toTop }, arguments[3] || { }));
         };
         
         Effect.Scale = Class.create(Effect.Base, {
           initialize: function(element, percent) {
             this.element = $(element);
             if (!this.element) throw(Effect._elementDoesNotExistError);
             var options = Object.extend({
               scaleX: true,
               scaleY: true,
               scaleContent: true,
               scaleFromCenter: false,
               scaleMode: &#39;box&#39;,        // &#39;box&#39; or &#39;contents&#39; or { } with provided values
               scaleFrom: 100.0,
               scaleTo:   percent
             }, arguments[2] || { });
             this.start(options);
           },
           setup: function() {
             this.restoreAfterFinish = this.options.restoreAfterFinish || false;
             this.elementPositioning = this.element.getStyle(&#39;position&#39;);
         
             this.originalStyle = { };
             [&#39;top&#39;,&#39;left&#39;,&#39;width&#39;,&#39;height&#39;,&#39;fontSize&#39;].each( function(k) {
               this.originalStyle[k] = this.element.style[k];
             }.bind(this));
         
             this.originalTop  = this.element.offsetTop;
             this.originalLeft = this.element.offsetLeft;
         
             var fontSize = this.element.getStyle(&#39;font-size&#39;) || &#39;100%&#39;;
             [&#39;em&#39;,&#39;px&#39;,&#39;%&#39;,&#39;pt&#39;].each( function(fontSizeType) {
               if (fontSize.indexOf(fontSizeType)&gt;0) {
                 this.fontSize     = parseFloat(fontSize);
                 this.fontSizeType = fontSizeType;
               }
             }.bind(this));
         
             this.factor = (this.options.scaleTo - this.options.scaleFrom)/100;
         
             this.dims = null;
             if (this.options.scaleMode==&#39;box&#39;)
               this.dims = [this.element.offsetHeight, this.element.offsetWidth];
             if (/^content/.test(this.options.scaleMode))
               this.dims = [this.element.scrollHeight, this.element.scrollWidth];
             if (!this.dims)
               this.dims = [this.options.scaleMode.originalHeight,
                            this.options.scaleMode.originalWidth];
           },
           update: function(position) {
             var currentScale = (this.options.scaleFrom/100.0) + (this.factor * position);
             if (this.options.scaleContent &amp;&amp; this.fontSize)
               this.element.setStyle({fontSize: this.fontSize * currentScale + this.fontSizeType });
             this.setDimensions(this.dims[0] * currentScale, this.dims[1] * currentScale);
           },
           finish: function(position) {
             if (this.restoreAfterFinish) this.element.setStyle(this.originalStyle);
           },
           setDimensions: function(height, width) {
             var d = { };
             if (this.options.scaleX) d.width = width.round() + &#39;px&#39;;
             if (this.options.scaleY) d.height = height.round() + &#39;px&#39;;
             if (this.options.scaleFromCenter) {
               var topd  = (height - this.dims[0])/2;
               var leftd = (width  - this.dims[1])/2;
               if (this.elementPositioning == &#39;absolute&#39;) {
                 if (this.options.scaleY) d.top = this.originalTop-topd + &#39;px&#39;;
                 if (this.options.scaleX) d.left = this.originalLeft-leftd + &#39;px&#39;;
               } else {
                 if (this.options.scaleY) d.top = -topd + &#39;px&#39;;
                 if (this.options.scaleX) d.left = -leftd + &#39;px&#39;;
               }
             }
             this.element.setStyle(d);
           }
         });
         
         Effect.Highlight = Class.create(Effect.Base, {
           initialize: function(element) {
             this.element = $(element);
             if (!this.element) throw(Effect._elementDoesNotExistError);
             var options = Object.extend({ startcolor: &#39;#ffff99&#39; }, arguments[1] || { });
             this.start(options);
           },
           setup: function() {
             // Prevent executing on elements not in the layout flow
             if (this.element.getStyle(&#39;display&#39;)==&#39;none&#39;) { this.cancel(); return; }
             // Disable background image during the effect
             this.oldStyle = { };
             if (!this.options.keepBackgroundImage) {
               this.oldStyle.backgroundImage = this.element.getStyle(&#39;background-image&#39;);
               this.element.setStyle({backgroundImage: &#39;none&#39;});
             }
             if (!this.options.endcolor)
               this.options.endcolor = this.element.getStyle(&#39;background-color&#39;).parseColor(&#39;#ffffff&#39;);
             if (!this.options.restorecolor)
               this.options.restorecolor = this.element.getStyle(&#39;background-color&#39;);
             // init color calculations
             this._base  = $R(0,2).map(function(i){ return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16) }.bind(this));
             this._delta = $R(0,2).map(function(i){ return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i] }.bind(this));
           },
           update: function(position) {
             this.element.setStyle({backgroundColor: $R(0,2).inject(&#39;#&#39;,function(m,v,i){
               return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart()); }.bind(this)) });
           },
           finish: function() {
             this.element.setStyle(Object.extend(this.oldStyle, {
               backgroundColor: this.options.restorecolor
             }));
           }
         });
         
         Effect.ScrollTo = function(element) {
           var options = arguments[1] || { },
           scrollOffsets = document.viewport.getScrollOffsets(),
           elementOffsets = $(element).cumulativeOffset();
         
           if (options.offset) elementOffsets[1] += options.offset;
         
           return new Effect.Tween(null,
             scrollOffsets.top,
             elementOffsets[1],
             options,
             function(p){ scrollTo(scrollOffsets.left, p.round()); }
           );
         };
         
         /* ------------- combination effects ------------- */
         
         Effect.Fade = function(element) {
           element = $(element);
           var oldOpacity = element.getInlineOpacity();
           var options = Object.extend({
             from: element.getOpacity() || 1.0,
             to:   0.0,
             afterFinishInternal: function(effect) {
               if (effect.options.to!=0) return;
               effect.element.hide().setStyle({opacity: oldOpacity});
             }
           }, arguments[1] || { });
           return new Effect.Opacity(element,options);
         };
         
         Effect.Appear = function(element) {
           element = $(element);
           var options = Object.extend({
           from: (element.getStyle(&#39;display&#39;) == &#39;none&#39; ? 0.0 : element.getOpacity() || 0.0),
           to:   1.0,
           // force Safari to render floated elements properly
           afterFinishInternal: function(effect) {
             effect.element.forceRerendering();
           },
           beforeSetup: function(effect) {
             effect.element.setOpacity(effect.options.from).show();
           }}, arguments[1] || { });
           return new Effect.Opacity(element,options);
         };
         
         Effect.Puff = function(element) {
           element = $(element);
           var oldStyle = {
             opacity: element.getInlineOpacity(),
             position: element.getStyle(&#39;position&#39;),
             top:  element.style.top,
             left: element.style.left,
             width: element.style.width,
             height: element.style.height
           };
           return new Effect.Parallel(
            [ new Effect.Scale(element, 200,
               { sync: true, scaleFromCenter: true, scaleContent: true, restoreAfterFinish: true }),
              new Effect.Opacity(element, { sync: true, to: 0.0 } ) ],
              Object.extend({ duration: 1.0,
               beforeSetupInternal: function(effect) {
                 Position.absolutize(effect.effects[0].element);
               },
               afterFinishInternal: function(effect) {
                  effect.effects[0].element.hide().setStyle(oldStyle); }
              }, arguments[1] || { })
            );
         };
         
         Effect.BlindUp = function(element) {
           element = $(element);
           element.makeClipping();
           return new Effect.Scale(element, 0,
             Object.extend({ scaleContent: false,
               scaleX: false,
               restoreAfterFinish: true,
               afterFinishInternal: function(effect) {
                 effect.element.hide().undoClipping();
               }
             }, arguments[1] || { })
           );
         };
         
         Effect.BlindDown = function(element) {
           element = $(element);
           var elementDimensions = element.getDimensions();
           return new Effect.Scale(element, 100, Object.extend({
             scaleContent: false,
             scaleX: false,
             scaleFrom: 0,
             scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
             restoreAfterFinish: true,
             afterSetup: function(effect) {
               effect.element.makeClipping().setStyle({height: &#39;0px&#39;}).show();
             },
             afterFinishInternal: function(effect) {
               effect.element.undoClipping();
             }
           }, arguments[1] || { }));
         };
         
         Effect.SwitchOff = function(element) {
           element = $(element);
           var oldOpacity = element.getInlineOpacity();
           return new Effect.Appear(element, Object.extend({
             duration: 0.4,
             from: 0,
             transition: Effect.Transitions.flicker,
             afterFinishInternal: function(effect) {
               new Effect.Scale(effect.element, 1, {
                 duration: 0.3, scaleFromCenter: true,
                 scaleX: false, scaleContent: false, restoreAfterFinish: true,
                 beforeSetup: function(effect) {
                   effect.element.makePositioned().makeClipping();
                 },
                 afterFinishInternal: function(effect) {
                   effect.element.hide().undoClipping().undoPositioned().setStyle({opacity: oldOpacity});
                 }
               });
             }
           }, arguments[1] || { }));
         };
         
         Effect.DropOut = function(element) {
           element = $(element);
           var oldStyle = {
             top: element.getStyle(&#39;top&#39;),
             left: element.getStyle(&#39;left&#39;),
             opacity: element.getInlineOpacity() };
           return new Effect.Parallel(
             [ new Effect.Move(element, {x: 0, y: 100, sync: true }),
               new Effect.Opacity(element, { sync: true, to: 0.0 }) ],
             Object.extend(
               { duration: 0.5,
                 beforeSetup: function(effect) {
                   effect.effects[0].element.makePositioned();
                 },
                 afterFinishInternal: function(effect) {
                   effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);
                 }
               }, arguments[1] || { }));
         };
         
         Effect.Shake = function(element) {
           element = $(element);
           var options = Object.extend({
             distance: 20,
             duration: 0.5
           }, arguments[1] || {});
           var distance = parseFloat(options.distance);
           var split = parseFloat(options.duration) / 10.0;
           var oldStyle = {
             top: element.getStyle(&#39;top&#39;),
             left: element.getStyle(&#39;left&#39;) };
             return new Effect.Move(element,
               { x:  distance, y: 0, duration: split, afterFinishInternal: function(effect) {
             new Effect.Move(effect.element,
               { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
             new Effect.Move(effect.element,
               { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
             new Effect.Move(effect.element,
               { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
             new Effect.Move(effect.element,
               { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
             new Effect.Move(effect.element,
               { x: -distance, y: 0, duration: split, afterFinishInternal: function(effect) {
                 effect.element.undoPositioned().setStyle(oldStyle);
           }}); }}); }}); }}); }}); }});
         };
         
         Effect.SlideDown = function(element) {
           element = $(element).cleanWhitespace();
           // SlideDown need to have the content of the element wrapped in a container element with fixed height!
           var oldInnerBottom = element.down().getStyle(&#39;bottom&#39;);
           var elementDimensions = element.getDimensions();
           return new Effect.Scale(element, 100, Object.extend({
             scaleContent: false,
             scaleX: false,
             scaleFrom: window.opera ? 0 : 1,
             scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
             restoreAfterFinish: true,
             afterSetup: function(effect) {
               effect.element.makePositioned();
               effect.element.down().makePositioned();
               if (window.opera) effect.element.setStyle({top: &#39;&#39;});
               effect.element.makeClipping().setStyle({height: &#39;0px&#39;}).show();
             },
             afterUpdateInternal: function(effect) {
               effect.element.down().setStyle({bottom:
                 (effect.dims[0] - effect.element.clientHeight) + &#39;px&#39; });
             },
             afterFinishInternal: function(effect) {
               effect.element.undoClipping().undoPositioned();
               effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom}); }
             }, arguments[1] || { })
           );
         };
         
         Effect.SlideUp = function(element) {
           element = $(element).cleanWhitespace();
           var oldInnerBottom = element.down().getStyle(&#39;bottom&#39;);
           var elementDimensions = element.getDimensions();
           return new Effect.Scale(element, window.opera ? 0 : 1,
            Object.extend({ scaleContent: false,
             scaleX: false,
             scaleMode: &#39;box&#39;,
             scaleFrom: 100,
             scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
             restoreAfterFinish: true,
             afterSetup: function(effect) {
               effect.element.makePositioned();
               effect.element.down().makePositioned();
               if (window.opera) effect.element.setStyle({top: &#39;&#39;});
               effect.element.makeClipping().show();
             },
             afterUpdateInternal: function(effect) {
               effect.element.down().setStyle({bottom:
                 (effect.dims[0] - effect.element.clientHeight) + &#39;px&#39; });
             },
             afterFinishInternal: function(effect) {
               effect.element.hide().undoClipping().undoPositioned();
               effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom});
             }
            }, arguments[1] || { })
           );
         };
         
         // Bug in opera makes the TD containing this element expand for a instance after finish
         Effect.Squish = function(element) {
           return new Effect.Scale(element, window.opera ? 1 : 0, {
             restoreAfterFinish: true,
             beforeSetup: function(effect) {
               effect.element.makeClipping();
             },
             afterFinishInternal: function(effect) {
               effect.element.hide().undoClipping();
             }
           });
         };
         
         Effect.Grow = function(element) {
           element = $(element);
           var options = Object.extend({
             direction: &#39;center&#39;,
             moveTransition: Effect.Transitions.sinoidal,
             scaleTransition: Effect.Transitions.sinoidal,
             opacityTransition: Effect.Transitions.full
           }, arguments[1] || { });
           var oldStyle = {
             top: element.style.top,
             left: element.style.left,
             height: element.style.height,
             width: element.style.width,
             opacity: element.getInlineOpacity() };
         
           var dims = element.getDimensions();
           var initialMoveX, initialMoveY;
           var moveX, moveY;
         
           switch (options.direction) {
             case &#39;top-left&#39;:
               initialMoveX = initialMoveY = moveX = moveY = 0;
               break;
             case &#39;top-right&#39;:
               initialMoveX = dims.width;
               initialMoveY = moveY = 0;
               moveX = -dims.width;
               break;
             case &#39;bottom-left&#39;:
               initialMoveX = moveX = 0;
               initialMoveY = dims.height;
               moveY = -dims.height;
               break;
             case &#39;bottom-right&#39;:
               initialMoveX = dims.width;
               initialMoveY = dims.height;
               moveX = -dims.width;
               moveY = -dims.height;
               break;
             case &#39;center&#39;:
               initialMoveX = dims.width / 2;
               initialMoveY = dims.height / 2;
               moveX = -dims.width / 2;
               moveY = -dims.height / 2;
               break;
           }
         
           return new Effect.Move(element, {
             x: initialMoveX,
             y: initialMoveY,
             duration: 0.01,
             beforeSetup: function(effect) {
               effect.element.hide().makeClipping().makePositioned();
             },
             afterFinishInternal: function(effect) {
               new Effect.Parallel(
                 [ new Effect.Opacity(effect.element, { sync: true, to: 1.0, from: 0.0, transition: options.opacityTransition }),
                   new Effect.Move(effect.element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition }),
                   new Effect.Scale(effect.element, 100, {
                     scaleMode: { originalHeight: dims.height, originalWidth: dims.width },
                     sync: true, scaleFrom: window.opera ? 1 : 0, transition: options.scaleTransition, restoreAfterFinish: true})
                 ], Object.extend({
                      beforeSetup: function(effect) {
                        effect.effects[0].element.setStyle({height: &#39;0px&#39;}).show();
                      },
                      afterFinishInternal: function(effect) {
                        effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);
                      }
                    }, options)
               );
             }
           });
         };
         
         Effect.Shrink = function(element) {
           element = $(element);
           var options = Object.extend({
             direction: &#39;center&#39;,
             moveTransition: Effect.Transitions.sinoidal,
             scaleTransition: Effect.Transitions.sinoidal,
             opacityTransition: Effect.Transitions.none
           }, arguments[1] || { });
           var oldStyle = {
             top: element.style.top,
             left: element.style.left,
             height: element.style.height,
             width: element.style.width,
             opacity: element.getInlineOpacity() };
         
           var dims = element.getDimensions();
           var moveX, moveY;
         
           switch (options.direction) {
             case &#39;top-left&#39;:
               moveX = moveY = 0;
               break;
             case &#39;top-right&#39;:
               moveX = dims.width;
               moveY = 0;
               break;
             case &#39;bottom-left&#39;:
               moveX = 0;
               moveY = dims.height;
               break;
             case &#39;bottom-right&#39;:
               moveX = dims.width;
               moveY = dims.height;
               break;
             case &#39;center&#39;:
               moveX = dims.width / 2;
               moveY = dims.height / 2;
               break;
           }
         
           return new Effect.Parallel(
             [ new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0, transition: options.opacityTransition }),
               new Effect.Scale(element, window.opera ? 1 : 0, { sync: true, transition: options.scaleTransition, restoreAfterFinish: true}),
               new Effect.Move(element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition })
             ], Object.extend({
                  beforeStartInternal: function(effect) {
                    effect.effects[0].element.makePositioned().makeClipping();
                  },
                  afterFinishInternal: function(effect) {
                    effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle); }
                }, options)
           );
         };
         
         Effect.Pulsate = function(element) {
           element = $(element);
           var options    = arguments[1] || { },
             oldOpacity = element.getInlineOpacity(),
             transition = options.transition || Effect.Transitions.linear,
             reverser   = function(pos){
               return 1 - transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2) + .5);
             };
         
           return new Effect.Opacity(element,
             Object.extend(Object.extend({  duration: 2.0, from: 0,
               afterFinishInternal: function(effect) { effect.element.setStyle({opacity: oldOpacity}); }
             }, options), {transition: reverser}));
         };
         
         Effect.Fold = function(element) {
           element = $(element);
           var oldStyle = {
             top: element.style.top,
             left: element.style.left,
             width: element.style.width,
             height: element.style.height };
           element.makeClipping();
           return new Effect.Scale(element, 5, Object.extend({
             scaleContent: false,
             scaleX: false,
             afterFinishInternal: function(effect) {
             new Effect.Scale(element, 1, {
               scaleContent: false,
               scaleY: false,
               afterFinishInternal: function(effect) {
                 effect.element.hide().undoClipping().setStyle(oldStyle);
               } });
           }}, arguments[1] || { }));
         };
         
         Effect.Morph = Class.create(Effect.Base, {
           initialize: function(element) {
             this.element = $(element);
             if (!this.element) throw(Effect._elementDoesNotExistError);
             var options = Object.extend({
               style: { }
             }, arguments[1] || { });
         
             if (!Object.isString(options.style)) this.style = $H(options.style);
             else {
               if (options.style.include(&#39;:&#39;))
                 this.style = options.style.parseStyle();
               else {
                 this.element.addClassName(options.style);
                 this.style = $H(this.element.getStyles());
                 this.element.removeClassName(options.style);
                 var css = this.element.getStyles();
                 this.style = this.style.reject(function(style) {
                   return style.value == css[style.key];
                 });
                 options.afterFinishInternal = function(effect) {
                   effect.element.addClassName(effect.options.style);
                   effect.transforms.each(function(transform) {
                     effect.element.style[transform.style] = &#39;&#39;;
                   });
                 };
               }
             }
             this.start(options);
           },
         
           setup: function(){
             function parseColor(color){
               if (!color || [&#39;rgba(0, 0, 0, 0)&#39;,&#39;transparent&#39;].include(color)) color = &#39;#ffffff&#39;;
               color = color.parseColor();
               return $R(0,2).map(function(i){
                 return parseInt( color.slice(i*2+1,i*2+3), 16 );
               });
             }
             this.transforms = this.style.map(function(pair){
               var property = pair[0], value = pair[1], unit = null;
         
               if (value.parseColor(&#39;#zzzzzz&#39;) != &#39;#zzzzzz&#39;) {
                 value = value.parseColor();
                 unit  = &#39;color&#39;;
               } else if (property == &#39;opacity&#39;) {
                 value = parseFloat(value);
                 if (Prototype.Browser.IE &amp;&amp; (!this.element.currentStyle.hasLayout))
                   this.element.setStyle({zoom: 1});
               } else if (Element.CSS_LENGTH.test(value)) {
                   var components = value.match(/^([\+\-]?[0-9\.]+)(.*)$/);
                   value = parseFloat(components[1]);
                   unit = (components.length == 3) ? components[2] : null;
               }
         
               var originalValue = this.element.getStyle(property);
               return {
                 style: property.camelize(),
                 originalValue: unit==&#39;color&#39; ? parseColor(originalValue) : parseFloat(originalValue || 0),
                 targetValue: unit==&#39;color&#39; ? parseColor(value) : value,
                 unit: unit
               };
             }.bind(this)).reject(function(transform){
               return (
                 (transform.originalValue == transform.targetValue) ||
                 (
                   transform.unit != &#39;color&#39; &amp;&amp;
                   (isNaN(transform.originalValue) || isNaN(transform.targetValue))
                 )
               );
             });
           },
           update: function(position) {
             var style = { }, transform, i = this.transforms.length;
             while(i--)
               style[(transform = this.transforms[i]).style] =
                 transform.unit==&#39;color&#39; ? &#39;#&#39;+
                   (Math.round(transform.originalValue[0]+
                     (transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart() +
                   (Math.round(transform.originalValue[1]+
                     (transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart() +
                   (Math.round(transform.originalValue[2]+
                     (transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart() :
                 (transform.originalValue +
                   (transform.targetValue - transform.originalValue) * position).toFixed(3) +
                     (transform.unit === null ? &#39;&#39; : transform.unit);
             this.element.setStyle(style, true);
           }
         });
         
         Effect.Transform = Class.create({
           initialize: function(tracks){
             this.tracks  = [];
             this.options = arguments[1] || { };
             this.addTracks(tracks);
           },
           addTracks: function(tracks){
             tracks.each(function(track){
               track = $H(track);
               var data = track.values().first();
               this.tracks.push($H({
                 ids:     track.keys().first(),
                 effect:  Effect.Morph,
                 options: { style: data }
               }));
             }.bind(this));
             return this;
           },
           play: function(){
             return new Effect.Parallel(
               this.tracks.map(function(track){
                 var ids = track.get(&#39;ids&#39;), effect = track.get(&#39;effect&#39;), options = track.get(&#39;options&#39;);
                 var elements = [$(ids) || $$(ids)].flatten();
                 return elements.map(function(e){ return new effect(e, Object.extend({ sync:true }, options)) });
               }).flatten(),
               this.options
             );
           }
         });
         
         Element.CSS_PROPERTIES = $w(
           &#39;backgroundColor backgroundPosition borderBottomColor borderBottomStyle &#39; +
           &#39;borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth &#39; +
           &#39;borderRightColor borderRightStyle borderRightWidth borderSpacing &#39; +
           &#39;borderTopColor borderTopStyle borderTopWidth bottom clip color &#39; +
           &#39;fontSize fontWeight height left letterSpacing lineHeight &#39; +
           &#39;marginBottom marginLeft marginRight marginTop markerOffset maxHeight &#39;+
           &#39;maxWidth minHeight minWidth opacity outlineColor outlineOffset &#39; +
           &#39;outlineWidth paddingBottom paddingLeft paddingRight paddingTop &#39; +
           &#39;right textIndent top width wordSpacing zIndex&#39;);
         
         Element.CSS_LENGTH = /^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;
         
         String.__parseStyleElement = document.createElement(&#39;div&#39;);
         String.prototype.parseStyle = function(){
           var style, styleRules = $H();
           if (Prototype.Browser.WebKit)
             style = new Element(&#39;div&#39;,{style:this}).style;
           else {
             String.__parseStyleElement.innerHTML = &#39;&lt;div style=&quot;&#39; + this + &#39;&quot;&gt;&lt;/div&gt;&#39;;
             style = String.__parseStyleElement.childNodes[0].style;
           }
         
           Element.CSS_PROPERTIES.each(function(property){
             if (style[property]) styleRules.set(property, style[property]);
           });
         
           if (Prototype.Browser.IE &amp;&amp; this.include(&#39;opacity&#39;))
             styleRules.set(&#39;opacity&#39;, this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);
         
           return styleRules;
         };
         
         if (document.defaultView &amp;&amp; document.defaultView.getComputedStyle) {
           Element.getStyles = function(element) {
             var css = document.defaultView.getComputedStyle($(element), null);
             return Element.CSS_PROPERTIES.inject({ }, function(styles, property) {
               styles[property] = css[property];
               return styles;
             });
           };
         } else {
           Element.getStyles = function(element) {
             element = $(element);
             var css = element.currentStyle, styles;
             styles = Element.CSS_PROPERTIES.inject({ }, function(results, property) {
               results[property] = css[property];
               return results;
             });
             if (!styles.opacity) styles.opacity = element.getOpacity();
             return styles;
           };
         }
         
         Effect.Methods = {
           morph: function(element, style) {
             element = $(element);
             new Effect.Morph(element, Object.extend({ style: style }, arguments[2] || { }));
             return element;
           },
           visualEffect: function(element, effect, options) {
             element = $(element);
             var s = effect.dasherize().camelize(), klass = s.charAt(0).toUpperCase() + s.substring(1);
             new Effect[klass](element, options);
             return element;
           },
           highlight: function(element, options) {
             element = $(element);
             new Effect.Highlight(element, options);
             return element;
           }
         };
         
         $w(&#39;fade appear grow shrink fold blindUp blindDown slideUp slideDown &#39;+
           &#39;pulsate shake puff squish switchOff dropOut&#39;).each(
           function(effect) {
             Effect.Methods[effect] = function(element, options){
               element = $(element);
               Effect[effect.charAt(0).toUpperCase() + effect.substring(1)](element, options);
               return element;
             };
           }
         );
         
         $w(&#39;getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles&#39;).each(
           function(f) { Effect.Methods[f] = Element[f]; }
         );
         
         Element.addMethods(Effect.Methods);
        \ No newline at end of file
        </pre></div>
        <h2 id='public-javascripts-prototype-js'>public/javascripts/prototype.js</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,4320 +1,6001 @@</span>
        <span class="gd">-/*  Prototype JavaScript framework, version 1.6.0.3</span>
        <span class="gd">- *  (c) 2005-2008 Sam Stephenson</span>
        <span class="gi">+/*  Prototype JavaScript framework, version 1.7_rc2</span>
        <span class="gi">+ *  (c) 2005-2010 Sam Stephenson</span>
          *
          *  Prototype is freely distributable under the terms of an MIT-style license.
          *  For details, see the Prototype web site: http://www.prototypejs.org/
          *
          *--------------------------------------------------------------------------*/
         
         var Prototype = {
        <span class="gd">-  Version: &#39;1.6.0.3&#39;,</span>
         
        <span class="gd">-  Browser: {</span>
        <span class="gd">-    IE:     !!(window.attachEvent &amp;&amp;</span>
        <span class="gd">-      navigator.userAgent.indexOf(&#39;Opera&#39;) === -1),</span>
        <span class="gd">-    Opera:  navigator.userAgent.indexOf(&#39;Opera&#39;) &gt; -1,</span>
        <span class="gd">-    WebKit: navigator.userAgent.indexOf(&#39;AppleWebKit/&#39;) &gt; -1,</span>
        <span class="gd">-    Gecko:  navigator.userAgent.indexOf(&#39;Gecko&#39;) &gt; -1 &amp;&amp;</span>
        <span class="gd">-      navigator.userAgent.indexOf(&#39;KHTML&#39;) === -1,</span>
        <span class="gd">-    MobileSafari: !!navigator.userAgent.match(/Apple.*Mobile.*Safari/)</span>
        <span class="gd">-  },</span>
        <span class="gi">+  Version: &#39;1.7_rc2&#39;,</span>
        <span class="gi">+</span>
        <span class="gi">+  Browser: (function(){</span>
        <span class="gi">+    var ua = navigator.userAgent;</span>
        <span class="gi">+    var isOpera = Object.prototype.toString.call(window.opera) == &#39;[object Opera]&#39;;</span>
        <span class="gi">+    return {</span>
        <span class="gi">+      IE:             !!window.attachEvent &amp;&amp; !isOpera,</span>
        <span class="gi">+      Opera:          isOpera,</span>
        <span class="gi">+      WebKit:         ua.indexOf(&#39;AppleWebKit/&#39;) &gt; -1,</span>
        <span class="gi">+      Gecko:          ua.indexOf(&#39;Gecko&#39;) &gt; -1 &amp;&amp; ua.indexOf(&#39;KHTML&#39;) === -1,</span>
        <span class="gi">+      MobileSafari:   /Apple.*Mobile/.test(ua)</span>
        <span class="gi">+    }</span>
        <span class="gi">+  })(),</span>
         
           BrowserFeatures: {
             XPath: !!document.evaluate,
        <span class="gi">+</span>
             SelectorsAPI: !!document.querySelector,
        <span class="gd">-    ElementExtensions: !!window.HTMLElement,</span>
        <span class="gd">-    SpecificElementExtensions:</span>
        <span class="gd">-      document.createElement(&#39;div&#39;)[&#39;__proto__&#39;] &amp;&amp;</span>
        <span class="gd">-      document.createElement(&#39;div&#39;)[&#39;__proto__&#39;] !==</span>
        <span class="gd">-        document.createElement(&#39;form&#39;)[&#39;__proto__&#39;]</span>
        <span class="gi">+</span>
        <span class="gi">+    ElementExtensions: (function() {</span>
        <span class="gi">+      var constructor = window.Element || window.HTMLElement;</span>
        <span class="gi">+      return !!(constructor &amp;&amp; constructor.prototype);</span>
        <span class="gi">+    })(),</span>
        <span class="gi">+    SpecificElementExtensions: (function() {</span>
        <span class="gi">+      if (typeof window.HTMLDivElement !== &#39;undefined&#39;)</span>
        <span class="gi">+        return true;</span>
        <span class="gi">+</span>
        <span class="gi">+      var div = document.createElement(&#39;div&#39;),</span>
        <span class="gi">+          form = document.createElement(&#39;form&#39;),</span>
        <span class="gi">+          isSupported = false;</span>
        <span class="gi">+</span>
        <span class="gi">+      if (div[&#39;__proto__&#39;] &amp;&amp; (div[&#39;__proto__&#39;] !== form[&#39;__proto__&#39;])) {</span>
        <span class="gi">+        isSupported = true;</span>
        <span class="gi">+      }</span>
        <span class="gi">+</span>
        <span class="gi">+      div = form = null;</span>
        <span class="gi">+</span>
        <span class="gi">+      return isSupported;</span>
        <span class="gi">+    })()</span>
           },
         
           ScriptFragment: &#39;&lt;script[^&gt;]*&gt;([\\S\\s]*?)&lt;\/script&gt;&#39;,
           JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,
         
           emptyFunction: function() { },
        <span class="gi">+</span>
           K: function(x) { return x }
         };
         
         if (Prototype.Browser.MobileSafari)
           Prototype.BrowserFeatures.SpecificElementExtensions = false;
         
         
        <span class="gi">+var Abstract = { };</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+var Try = {</span>
        <span class="gi">+  these: function() {</span>
        <span class="gi">+    var returnValue;</span>
        <span class="gi">+</span>
        <span class="gi">+    for (var i = 0, length = arguments.length; i &lt; length; i++) {</span>
        <span class="gi">+      var lambda = arguments[i];</span>
        <span class="gi">+      try {</span>
        <span class="gi">+        returnValue = lambda();</span>
        <span class="gi">+        break;</span>
        <span class="gi">+      } catch (e) { }</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    return returnValue;</span>
        <span class="gi">+  }</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
         /* Based on Alex Arnell&#39;s inheritance implementation. */
        <span class="gd">-var Class = {</span>
        <span class="gd">-  create: function() {</span>
        <span class="gi">+</span>
        <span class="gi">+var Class = (function() {</span>
        <span class="gi">+</span>
        <span class="gi">+  var IS_DONTENUM_BUGGY = (function(){</span>
        <span class="gi">+    for (var p in { toString: 1 }) {</span>
        <span class="gi">+      if (p === &#39;toString&#39;) return false;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return true;</span>
        <span class="gi">+  })();</span>
        <span class="gi">+</span>
        <span class="gi">+  function subclass() {};</span>
        <span class="gi">+  function create() {</span>
             var parent = null, properties = $A(arguments);
             if (Object.isFunction(properties[0]))
               parent = properties.shift();
         
             function klass() {
               this.initialize.apply(this, arguments);
             }
         
             Object.extend(klass, Class.Methods);
             klass.superclass = parent;
             klass.subclasses = [];
         
             if (parent) {
        <span class="gd">-      var subclass = function() { };</span>
               subclass.prototype = parent.prototype;
               klass.prototype = new subclass;
               parent.subclasses.push(klass);
             }
         
        <span class="gd">-    for (var i = 0; i &lt; properties.length; i++)</span>
        <span class="gi">+    for (var i = 0, length = properties.length; i &lt; length; i++)</span>
               klass.addMethods(properties[i]);
         
             if (!klass.prototype.initialize)
               klass.prototype.initialize = Prototype.emptyFunction;
         
             klass.prototype.constructor = klass;
        <span class="gd">-</span>
             return klass;
           }
        <span class="gd">-};</span>
         
        <span class="gd">-Class.Methods = {</span>
        <span class="gd">-  addMethods: function(source) {</span>
        <span class="gd">-    var ancestor   = this.superclass &amp;&amp; this.superclass.prototype;</span>
        <span class="gd">-    var properties = Object.keys(source);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (!Object.keys({ toString: true }).length)</span>
        <span class="gd">-      properties.push(&quot;toString&quot;, &quot;valueOf&quot;);</span>
        <span class="gi">+  function addMethods(source) {</span>
        <span class="gi">+    var ancestor   = this.superclass &amp;&amp; this.superclass.prototype,</span>
        <span class="gi">+        properties = Object.keys(source);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (IS_DONTENUM_BUGGY) {</span>
        <span class="gi">+      if (source.toString != Object.prototype.toString)</span>
        <span class="gi">+        properties.push(&quot;toString&quot;);</span>
        <span class="gi">+      if (source.valueOf != Object.prototype.valueOf)</span>
        <span class="gi">+        properties.push(&quot;valueOf&quot;);</span>
        <span class="gi">+    }</span>
         
             for (var i = 0, length = properties.length; i &lt; length; i++) {
               var property = properties[i], value = source[property];
               if (ancestor &amp;&amp; Object.isFunction(value) &amp;&amp;
        <span class="gd">-          value.argumentNames().first() == &quot;$super&quot;) {</span>
        <span class="gi">+          value.argumentNames()[0] == &quot;$super&quot;) {</span>
                 var method = value;
                 value = (function(m) {
        <span class="gd">-          return function() { return ancestor[m].apply(this, arguments) };</span>
        <span class="gi">+          return function() { return ancestor[m].apply(this, arguments); };</span>
                 })(property).wrap(method);
         
                 value.valueOf = method.valueOf.bind(method);
                 value.toString = method.toString.bind(method);
               }
               this.prototype[property] = value;
             }
         
             return this;
           }
        <span class="gd">-};</span>
         
        <span class="gd">-var Abstract = { };</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    create: create,</span>
        <span class="gi">+    Methods: {</span>
        <span class="gi">+      addMethods: addMethods</span>
        <span class="gi">+    }</span>
        <span class="gi">+  };</span>
        <span class="gi">+})();</span>
        <span class="gi">+(function() {</span>
         
        <span class="gd">-Object.extend = function(destination, source) {</span>
        <span class="gd">-  for (var property in source)</span>
        <span class="gd">-    destination[property] = source[property];</span>
        <span class="gd">-  return destination;</span>
        <span class="gd">-};</span>
        <span class="gi">+  var _toString = Object.prototype.toString,</span>
        <span class="gi">+      NULL_TYPE = &#39;Null&#39;,</span>
        <span class="gi">+      UNDEFINED_TYPE = &#39;Undefined&#39;,</span>
        <span class="gi">+      BOOLEAN_TYPE = &#39;Boolean&#39;,</span>
        <span class="gi">+      NUMBER_TYPE = &#39;Number&#39;,</span>
        <span class="gi">+      STRING_TYPE = &#39;String&#39;,</span>
        <span class="gi">+      OBJECT_TYPE = &#39;Object&#39;,</span>
        <span class="gi">+      BOOLEAN_CLASS = &#39;[object Boolean]&#39;,</span>
        <span class="gi">+      NUMBER_CLASS = &#39;[object Number]&#39;,</span>
        <span class="gi">+      STRING_CLASS = &#39;[object String]&#39;,</span>
        <span class="gi">+      ARRAY_CLASS = &#39;[object Array]&#39;,</span>
        <span class="gi">+      NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &amp;&amp;</span>
        <span class="gi">+        typeof JSON.stringify === &#39;function&#39; &amp;&amp;</span>
        <span class="gi">+        JSON.stringify(0) === &#39;0&#39; &amp;&amp;</span>
        <span class="gi">+        typeof JSON.stringify(Prototype.K) === &#39;undefined&#39;;</span>
        <span class="gi">+</span>
        <span class="gi">+  function Type(o) {</span>
        <span class="gi">+    switch(o) {</span>
        <span class="gi">+      case null: return NULL_TYPE;</span>
        <span class="gi">+      case (void 0): return UNDEFINED_TYPE;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    var type = typeof o;</span>
        <span class="gi">+    switch(type) {</span>
        <span class="gi">+      case &#39;boolean&#39;: return BOOLEAN_TYPE;</span>
        <span class="gi">+      case &#39;number&#39;:  return NUMBER_TYPE;</span>
        <span class="gi">+      case &#39;string&#39;:  return STRING_TYPE;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return OBJECT_TYPE;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function extend(destination, source) {</span>
        <span class="gi">+    for (var property in source)</span>
        <span class="gi">+      destination[property] = source[property];</span>
        <span class="gi">+    return destination;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-Object.extend(Object, {</span>
        <span class="gd">-  inspect: function(object) {</span>
        <span class="gi">+  function inspect(object) {</span>
             try {
        <span class="gd">-      if (Object.isUndefined(object)) return &#39;undefined&#39;;</span>
        <span class="gi">+      if (isUndefined(object)) return &#39;undefined&#39;;</span>
               if (object === null) return &#39;null&#39;;
               return object.inspect ? object.inspect() : String(object);
             } catch (e) {
               if (e instanceof RangeError) return &#39;...&#39;;
               throw e;
             }
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  toJSON: function(object) {</span>
        <span class="gd">-    var type = typeof object;</span>
        <span class="gd">-    switch (type) {</span>
        <span class="gd">-      case &#39;undefined&#39;:</span>
        <span class="gd">-      case &#39;function&#39;:</span>
        <span class="gd">-      case &#39;unknown&#39;: return;</span>
        <span class="gd">-      case &#39;boolean&#39;: return object.toString();</span>
        <span class="gi">+  function toJSON(value) {</span>
        <span class="gi">+    return Str(&#39;&#39;, { &#39;&#39;: value }, []);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function Str(key, holder, stack) {</span>
        <span class="gi">+    var value = holder[key],</span>
        <span class="gi">+        type = typeof value;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (Type(value) === OBJECT_TYPE &amp;&amp; typeof value.toJSON === &#39;function&#39;) {</span>
        <span class="gi">+      value = value.toJSON(key);</span>
             }
         
        <span class="gd">-    if (object === null) return &#39;null&#39;;</span>
        <span class="gd">-    if (object.toJSON) return object.toJSON();</span>
        <span class="gd">-    if (Object.isElement(object)) return;</span>
        <span class="gi">+    var _class = _toString.call(value);</span>
         
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    for (var property in object) {</span>
        <span class="gd">-      var value = Object.toJSON(object[property]);</span>
        <span class="gd">-      if (!Object.isUndefined(value))</span>
        <span class="gd">-        results.push(property.toJSON() + &#39;: &#39; + value);</span>
        <span class="gi">+    switch (_class) {</span>
        <span class="gi">+      case NUMBER_CLASS:</span>
        <span class="gi">+      case BOOLEAN_CLASS:</span>
        <span class="gi">+      case STRING_CLASS:</span>
        <span class="gi">+        value = value.valueOf();</span>
             }
         
        <span class="gd">-    return &#39;{&#39; + results.join(&#39;, &#39;) + &#39;}&#39;;</span>
        <span class="gd">-  },</span>
        <span class="gi">+    switch (value) {</span>
        <span class="gi">+      case null: return &#39;null&#39;;</span>
        <span class="gi">+      case true: return &#39;true&#39;;</span>
        <span class="gi">+      case false: return &#39;false&#39;;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    type = typeof value;</span>
        <span class="gi">+    switch (type) {</span>
        <span class="gi">+      case &#39;string&#39;:</span>
        <span class="gi">+        return value.inspect(true);</span>
        <span class="gi">+      case &#39;number&#39;:</span>
        <span class="gi">+        return isFinite(value) ? String(value) : &#39;null&#39;;</span>
        <span class="gi">+      case &#39;object&#39;:</span>
        <span class="gi">+</span>
        <span class="gi">+        for (var i = 0, length = stack.length; i &lt; length; i++) {</span>
        <span class="gi">+          if (stack[i] === value) { throw new TypeError(); }</span>
        <span class="gi">+        }</span>
        <span class="gi">+        stack.push(value);</span>
        <span class="gi">+</span>
        <span class="gi">+        var partial = [];</span>
        <span class="gi">+        if (_class === ARRAY_CLASS) {</span>
        <span class="gi">+          for (var i = 0, length = value.length; i &lt; length; i++) {</span>
        <span class="gi">+            var str = Str(i, value, stack);</span>
        <span class="gi">+            partial.push(typeof str === &#39;undefined&#39; ? &#39;null&#39; : str);</span>
        <span class="gi">+          }</span>
        <span class="gi">+          partial = &#39;[&#39; + partial.join(&#39;,&#39;) + &#39;]&#39;;</span>
        <span class="gi">+        } else {</span>
        <span class="gi">+          var keys = Object.keys(value);</span>
        <span class="gi">+          for (var i = 0, length = keys.length; i &lt; length; i++) {</span>
        <span class="gi">+            var key = keys[i], str = Str(key, value, stack);</span>
        <span class="gi">+            if (typeof str !== &quot;undefined&quot;) {</span>
        <span class="gi">+               partial.push(key.inspect(true)+ &#39;:&#39; + str);</span>
        <span class="gi">+             }</span>
        <span class="gi">+          }</span>
        <span class="gi">+          partial = &#39;{&#39; + partial.join(&#39;,&#39;) + &#39;}&#39;;</span>
        <span class="gi">+        }</span>
        <span class="gi">+        stack.pop();</span>
        <span class="gi">+        return partial;</span>
        <span class="gi">+    }</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function stringify(object) {</span>
        <span class="gi">+    return JSON.stringify(object);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  toQueryString: function(object) {</span>
        <span class="gi">+  function toQueryString(object) {</span>
             return $H(object).toQueryString();
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  toHTML: function(object) {</span>
        <span class="gi">+  function toHTML(object) {</span>
             return object &amp;&amp; object.toHTML ? object.toHTML() : String.interpret(object);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  keys: function(object) {</span>
        <span class="gd">-    var keys = [];</span>
        <span class="gd">-    for (var property in object)</span>
        <span class="gd">-      keys.push(property);</span>
        <span class="gd">-    return keys;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function keys(object) {</span>
        <span class="gi">+    if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }</span>
        <span class="gi">+    var results = [];</span>
        <span class="gi">+    for (var property in object) {</span>
        <span class="gi">+      if (object.hasOwnProperty(property)) {</span>
        <span class="gi">+        results.push(property);</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return results;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  values: function(object) {</span>
        <span class="gd">-    var values = [];</span>
        <span class="gi">+  function values(object) {</span>
        <span class="gi">+    var results = [];</span>
             for (var property in object)
        <span class="gd">-      values.push(object[property]);</span>
        <span class="gd">-    return values;</span>
        <span class="gd">-  },</span>
        <span class="gi">+      results.push(object[property]);</span>
        <span class="gi">+    return results;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  clone: function(object) {</span>
        <span class="gd">-    return Object.extend({ }, object);</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function clone(object) {</span>
        <span class="gi">+    return extend({ }, object);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isElement: function(object) {</span>
        <span class="gi">+  function isElement(object) {</span>
             return !!(object &amp;&amp; object.nodeType == 1);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isArray: function(object) {</span>
        <span class="gd">-    return object != null &amp;&amp; typeof object == &quot;object&quot; &amp;&amp;</span>
        <span class="gd">-      &#39;splice&#39; in object &amp;&amp; &#39;join&#39; in object;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function isArray(object) {</span>
        <span class="gi">+    return _toString.call(object) === ARRAY_CLASS;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isHash: function(object) {</span>
        <span class="gi">+  var hasNativeIsArray = (typeof Array.isArray == &#39;function&#39;)</span>
        <span class="gi">+    &amp;&amp; Array.isArray([]) &amp;&amp; !Array.isArray({});</span>
        <span class="gi">+</span>
        <span class="gi">+  if (hasNativeIsArray) {</span>
        <span class="gi">+    isArray = Array.isArray;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function isHash(object) {</span>
             return object instanceof Hash;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isFunction: function(object) {</span>
        <span class="gd">-    return typeof object == &quot;function&quot;;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function isFunction(object) {</span>
        <span class="gi">+    return typeof object === &quot;function&quot;;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isString: function(object) {</span>
        <span class="gd">-    return typeof object == &quot;string&quot;;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function isString(object) {</span>
        <span class="gi">+    return _toString.call(object) === STRING_CLASS;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isNumber: function(object) {</span>
        <span class="gd">-    return typeof object == &quot;number&quot;;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function isNumber(object) {</span>
        <span class="gi">+    return _toString.call(object) === NUMBER_CLASS;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function isUndefined(object) {</span>
        <span class="gi">+    return typeof object === &quot;undefined&quot;;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  extend(Object, {</span>
        <span class="gi">+    extend:        extend,</span>
        <span class="gi">+    inspect:       inspect,</span>
        <span class="gi">+    toJSON:        NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,</span>
        <span class="gi">+    toQueryString: toQueryString,</span>
        <span class="gi">+    toHTML:        toHTML,</span>
        <span class="gi">+    keys:          Object.keys || keys,</span>
        <span class="gi">+    values:        values,</span>
        <span class="gi">+    clone:         clone,</span>
        <span class="gi">+    isElement:     isElement,</span>
        <span class="gi">+    isArray:       isArray,</span>
        <span class="gi">+    isHash:        isHash,</span>
        <span class="gi">+    isFunction:    isFunction,</span>
        <span class="gi">+    isString:      isString,</span>
        <span class="gi">+    isNumber:      isNumber,</span>
        <span class="gi">+    isUndefined:   isUndefined</span>
        <span class="gi">+  });</span>
        <span class="gi">+})();</span>
        <span class="gi">+Object.extend(Function.prototype, (function() {</span>
        <span class="gi">+  var slice = Array.prototype.slice;</span>
         
        <span class="gd">-  isUndefined: function(object) {</span>
        <span class="gd">-    return typeof object == &quot;undefined&quot;;</span>
        <span class="gi">+  function update(array, args) {</span>
        <span class="gi">+    var arrayLength = array.length, length = args.length;</span>
        <span class="gi">+    while (length--) array[arrayLength + length] = args[length];</span>
        <span class="gi">+    return array;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function merge(array, args) {</span>
        <span class="gi">+    array = slice.call(array, 0);</span>
        <span class="gi">+    return update(array, args);</span>
           }
        <span class="gd">-});</span>
         
        <span class="gd">-Object.extend(Function.prototype, {</span>
        <span class="gd">-  argumentNames: function() {</span>
        <span class="gd">-    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1]</span>
        <span class="gi">+  function argumentNames() {</span>
        <span class="gi">+    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]</span>
        <span class="gi">+      .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, &#39;&#39;)</span>
               .replace(/\s+/g, &#39;&#39;).split(&#39;,&#39;);
             return names.length == 1 &amp;&amp; !names[0] ? [] : names;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  bind: function() {</span>
        <span class="gi">+  function bind(context) {</span>
             if (arguments.length &lt; 2 &amp;&amp; Object.isUndefined(arguments[0])) return this;
        <span class="gd">-    var __method = this, args = $A(arguments), object = args.shift();</span>
        <span class="gi">+    var __method = this, args = slice.call(arguments, 1);</span>
             return function() {
        <span class="gd">-      return __method.apply(object, args.concat($A(arguments)));</span>
        <span class="gi">+      var a = merge(args, arguments);</span>
        <span class="gi">+      return __method.apply(context, a);</span>
             }
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  bindAsEventListener: function() {</span>
        <span class="gd">-    var __method = this, args = $A(arguments), object = args.shift();</span>
        <span class="gi">+  function bindAsEventListener(context) {</span>
        <span class="gi">+    var __method = this, args = slice.call(arguments, 1);</span>
             return function(event) {
        <span class="gd">-      return __method.apply(object, [event || window.event].concat(args));</span>
        <span class="gi">+      var a = update([event || window.event], args);</span>
        <span class="gi">+      return __method.apply(context, a);</span>
             }
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  curry: function() {</span>
        <span class="gi">+  function curry() {</span>
             if (!arguments.length) return this;
        <span class="gd">-    var __method = this, args = $A(arguments);</span>
        <span class="gi">+    var __method = this, args = slice.call(arguments, 0);</span>
             return function() {
        <span class="gd">-      return __method.apply(this, args.concat($A(arguments)));</span>
        <span class="gi">+      var a = merge(args, arguments);</span>
        <span class="gi">+      return __method.apply(this, a);</span>
             }
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  delay: function() {</span>
        <span class="gd">-    var __method = this, args = $A(arguments), timeout = args.shift() * 1000;</span>
        <span class="gi">+  function delay(timeout) {</span>
        <span class="gi">+    var __method = this, args = slice.call(arguments, 1);</span>
        <span class="gi">+    timeout = timeout * 1000;</span>
             return window.setTimeout(function() {
               return __method.apply(__method, args);
             }, timeout);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  defer: function() {</span>
        <span class="gd">-    var args = [0.01].concat($A(arguments));</span>
        <span class="gi">+  function defer() {</span>
        <span class="gi">+    var args = update([0.01], arguments);</span>
             return this.delay.apply(this, args);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  wrap: function(wrapper) {</span>
        <span class="gi">+  function wrap(wrapper) {</span>
             var __method = this;
             return function() {
        <span class="gd">-      return wrapper.apply(this, [__method.bind(this)].concat($A(arguments)));</span>
        <span class="gi">+      var a = update([__method.bind(this)], arguments);</span>
        <span class="gi">+      return wrapper.apply(this, a);</span>
             }
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  methodize: function() {</span>
        <span class="gi">+  function methodize() {</span>
             if (this._methodized) return this._methodized;
             var __method = this;
             return this._methodized = function() {
        <span class="gd">-      return __method.apply(null, [this].concat($A(arguments)));</span>
        <span class="gi">+      var a = update([this], arguments);</span>
        <span class="gi">+      return __method.apply(null, a);</span>
             };
           }
        <span class="gd">-});</span>
         
        <span class="gd">-Date.prototype.toJSON = function() {</span>
        <span class="gd">-  return &#39;&quot;&#39; + this.getUTCFullYear() + &#39;-&#39; +</span>
        <span class="gd">-    (this.getUTCMonth() + 1).toPaddedString(2) + &#39;-&#39; +</span>
        <span class="gd">-    this.getUTCDate().toPaddedString(2) + &#39;T&#39; +</span>
        <span class="gd">-    this.getUTCHours().toPaddedString(2) + &#39;:&#39; +</span>
        <span class="gd">-    this.getUTCMinutes().toPaddedString(2) + &#39;:&#39; +</span>
        <span class="gd">-    this.getUTCSeconds().toPaddedString(2) + &#39;Z&quot;&#39;;</span>
        <span class="gd">-};</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    argumentNames:       argumentNames,</span>
        <span class="gi">+    bind:                bind,</span>
        <span class="gi">+    bindAsEventListener: bindAsEventListener,</span>
        <span class="gi">+    curry:               curry,</span>
        <span class="gi">+    delay:               delay,</span>
        <span class="gi">+    defer:               defer,</span>
        <span class="gi">+    wrap:                wrap,</span>
        <span class="gi">+    methodize:           methodize</span>
        <span class="gi">+  }</span>
        <span class="gi">+})());</span>
         
        <span class="gd">-var Try = {</span>
        <span class="gd">-  these: function() {</span>
        <span class="gd">-    var returnValue;</span>
         
        <span class="gd">-    for (var i = 0, length = arguments.length; i &lt; length; i++) {</span>
        <span class="gd">-      var lambda = arguments[i];</span>
        <span class="gd">-      try {</span>
        <span class="gd">-        returnValue = lambda();</span>
        <span class="gd">-        break;</span>
        <span class="gd">-      } catch (e) { }</span>
        <span class="gd">-    }</span>
         
        <span class="gd">-    return returnValue;</span>
        <span class="gi">+(function(proto) {</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  function toISOString() {</span>
        <span class="gi">+    return this.getUTCFullYear() + &#39;-&#39; +</span>
        <span class="gi">+      (this.getUTCMonth() + 1).toPaddedString(2) + &#39;-&#39; +</span>
        <span class="gi">+      this.getUTCDate().toPaddedString(2) + &#39;T&#39; +</span>
        <span class="gi">+      this.getUTCHours().toPaddedString(2) + &#39;:&#39; +</span>
        <span class="gi">+      this.getUTCMinutes().toPaddedString(2) + &#39;:&#39; +</span>
        <span class="gi">+      this.getUTCSeconds().toPaddedString(2) + &#39;Z&#39;;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  function toJSON() {</span>
        <span class="gi">+    return this.toISOString();</span>
           }
        <span class="gd">-};</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!proto.toISOString) proto.toISOString = toISOString;</span>
        <span class="gi">+  if (!proto.toJSON) proto.toJSON = toJSON;</span>
        <span class="gi">+</span>
        <span class="gi">+})(Date.prototype);</span>
        <span class="gi">+</span>
         
         RegExp.prototype.match = RegExp.prototype.test;
         
         RegExp.escape = function(str) {
           return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, &#39;\\$1&#39;);
         };
        <span class="gd">-</span>
        <span class="gd">-/*--------------------------------------------------------------------------*/</span>
        <span class="gd">-</span>
         var PeriodicalExecuter = Class.create({
           initialize: function(callback, frequency) {
             this.callback = callback;
             this.frequency = frequency;
             this.currentlyExecuting = false;
         
             this.registerCallback();
           },
         
           registerCallback: function() {
             this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
           },
         
           execute: function() {
             this.callback(this);
           },
         
           stop: function() {
             if (!this.timer) return;
             clearInterval(this.timer);
             this.timer = null;
           },
         
           onTimerEvent: function() {
             if (!this.currentlyExecuting) {
               try {
                 this.currentlyExecuting = true;
                 this.execute();
        <span class="gd">-      } finally {</span>
                 this.currentlyExecuting = false;
        <span class="gi">+      } catch(e) {</span>
        <span class="gi">+        this.currentlyExecuting = false;</span>
        <span class="gi">+        throw e;</span>
               }
             }
           }
         });
         Object.extend(String, {
           interpret: function(value) {
             return value == null ? &#39;&#39; : String(value);
           },
           specialChar: {
             &#39;\b&#39;: &#39;\\b&#39;,
             &#39;\t&#39;: &#39;\\t&#39;,
             &#39;\n&#39;: &#39;\\n&#39;,
             &#39;\f&#39;: &#39;\\f&#39;,
             &#39;\r&#39;: &#39;\\r&#39;,
             &#39;\\&#39;: &#39;\\\\&#39;
           }
         });
         
        <span class="gd">-Object.extend(String.prototype, {</span>
        <span class="gd">-  gsub: function(pattern, replacement) {</span>
        <span class="gi">+Object.extend(String.prototype, (function() {</span>
        <span class="gi">+  var NATIVE_JSON_PARSE_SUPPORT = window.JSON &amp;&amp;</span>
        <span class="gi">+    typeof JSON.parse === &#39;function&#39; &amp;&amp;</span>
        <span class="gi">+    JSON.parse(&#39;{&quot;test&quot;: true}&#39;).test;</span>
        <span class="gi">+</span>
        <span class="gi">+  function prepareReplacement(replacement) {</span>
        <span class="gi">+    if (Object.isFunction(replacement)) return replacement;</span>
        <span class="gi">+    var template = new Template(replacement);</span>
        <span class="gi">+    return function(match) { return template.evaluate(match) };</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function gsub(pattern, replacement) {</span>
             var result = &#39;&#39;, source = this, match;
        <span class="gd">-    replacement = arguments.callee.prepareReplacement(replacement);</span>
        <span class="gi">+    replacement = prepareReplacement(replacement);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (Object.isString(pattern))</span>
        <span class="gi">+      pattern = RegExp.escape(pattern);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (!(pattern.length || pattern.source)) {</span>
        <span class="gi">+      replacement = replacement(&#39;&#39;);</span>
        <span class="gi">+      return replacement + source.split(&#39;&#39;).join(replacement) + replacement;</span>
        <span class="gi">+    }</span>
         
             while (source.length &gt; 0) {
               if (match = source.match(pattern)) {
                 result += source.slice(0, match.index);
                 result += String.interpret(replacement(match));
                 source  = source.slice(match.index + match[0].length);
               } else {
                 result += source, source = &#39;&#39;;
               }
             }
             return result;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  sub: function(pattern, replacement, count) {</span>
        <span class="gd">-    replacement = this.gsub.prepareReplacement(replacement);</span>
        <span class="gi">+  function sub(pattern, replacement, count) {</span>
        <span class="gi">+    replacement = prepareReplacement(replacement);</span>
             count = Object.isUndefined(count) ? 1 : count;
         
             return this.gsub(pattern, function(match) {
               if (--count &lt; 0) return match[0];
               return replacement(match);
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  scan: function(pattern, iterator) {</span>
        <span class="gi">+  function scan(pattern, iterator) {</span>
             this.gsub(pattern, iterator);
             return String(this);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  truncate: function(length, truncation) {</span>
        <span class="gi">+  function truncate(length, truncation) {</span>
             length = length || 30;
             truncation = Object.isUndefined(truncation) ? &#39;...&#39; : truncation;
             return this.length &gt; length ?
               this.slice(0, length - truncation.length) + truncation : String(this);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  strip: function() {</span>
        <span class="gi">+  function strip() {</span>
             return this.replace(/^\s+/, &#39;&#39;).replace(/\s+$/, &#39;&#39;);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  stripTags: function() {</span>
        <span class="gd">-    return this.replace(/&lt;\/?[^&gt;]+&gt;/gi, &#39;&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function stripTags() {</span>
        <span class="gi">+    return this.replace(/&lt;\w+(\s+(&quot;[^&quot;]*&quot;|&#39;[^&#39;]*&#39;|[^&gt;])+)?&gt;|&lt;\/\w+&gt;/gi, &#39;&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  stripScripts: function() {</span>
        <span class="gi">+  function stripScripts() {</span>
             return this.replace(new RegExp(Prototype.ScriptFragment, &#39;img&#39;), &#39;&#39;);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  extractScripts: function() {</span>
        <span class="gd">-    var matchAll = new RegExp(Prototype.ScriptFragment, &#39;img&#39;);</span>
        <span class="gd">-    var matchOne = new RegExp(Prototype.ScriptFragment, &#39;im&#39;);</span>
        <span class="gi">+  function extractScripts() {</span>
        <span class="gi">+    var matchAll = new RegExp(Prototype.ScriptFragment, &#39;img&#39;),</span>
        <span class="gi">+        matchOne = new RegExp(Prototype.ScriptFragment, &#39;im&#39;);</span>
             return (this.match(matchAll) || []).map(function(scriptTag) {
               return (scriptTag.match(matchOne) || [&#39;&#39;, &#39;&#39;])[1];
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  evalScripts: function() {</span>
        <span class="gi">+  function evalScripts() {</span>
             return this.extractScripts().map(function(script) { return eval(script) });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  escapeHTML: function() {</span>
        <span class="gd">-    var self = arguments.callee;</span>
        <span class="gd">-    self.text.data = this;</span>
        <span class="gd">-    return self.div.innerHTML;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function escapeHTML() {</span>
        <span class="gi">+    return this.replace(/&amp;/g,&#39;&amp;amp;&#39;).replace(/&lt;/g,&#39;&amp;lt;&#39;).replace(/&gt;/g,&#39;&amp;gt;&#39;);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function unescapeHTML() {</span>
        <span class="gi">+    return this.stripTags().replace(/&amp;lt;/g,&#39;&lt;&#39;).replace(/&amp;gt;/g,&#39;&gt;&#39;).replace(/&amp;amp;/g,&#39;&amp;&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  unescapeHTML: function() {</span>
        <span class="gd">-    var div = new Element(&#39;div&#39;);</span>
        <span class="gd">-    div.innerHTML = this.stripTags();</span>
        <span class="gd">-    return div.childNodes[0] ? (div.childNodes.length &gt; 1 ?</span>
        <span class="gd">-      $A(div.childNodes).inject(&#39;&#39;, function(memo, node) { return memo+node.nodeValue }) :</span>
        <span class="gd">-      div.childNodes[0].nodeValue) : &#39;&#39;;</span>
        <span class="gd">-  },</span>
         
        <span class="gd">-  toQueryParams: function(separator) {</span>
        <span class="gi">+  function toQueryParams(separator) {</span>
             var match = this.strip().match(/([^?#]*)(#.*)?$/);
             if (!match) return { };
         
             return match[1].split(separator || &#39;&amp;&#39;).inject({ }, function(hash, pair) {
               if ((pair = pair.split(&#39;=&#39;))[0]) {
        <span class="gd">-        var key = decodeURIComponent(pair.shift());</span>
        <span class="gd">-        var value = pair.length &gt; 1 ? pair.join(&#39;=&#39;) : pair[0];</span>
        <span class="gi">+        var key = decodeURIComponent(pair.shift()),</span>
        <span class="gi">+            value = pair.length &gt; 1 ? pair.join(&#39;=&#39;) : pair[0];</span>
        <span class="gi">+</span>
                 if (value != undefined) value = decodeURIComponent(value);
         
                 if (key in hash) {
                   if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
                   hash[key].push(value);
                 }
                 else hash[key] = value;
               }
               return hash;
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  toArray: function() {</span>
        <span class="gi">+  function toArray() {</span>
             return this.split(&#39;&#39;);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  succ: function() {</span>
        <span class="gi">+  function succ() {</span>
             return this.slice(0, this.length - 1) +
               String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  times: function(count) {</span>
        <span class="gi">+  function times(count) {</span>
             return count &lt; 1 ? &#39;&#39; : new Array(count + 1).join(this);
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  camelize: function() {</span>
        <span class="gd">-    var parts = this.split(&#39;-&#39;), len = parts.length;</span>
        <span class="gd">-    if (len == 1) return parts[0];</span>
        <span class="gd">-</span>
        <span class="gd">-    var camelized = this.charAt(0) == &#39;-&#39;</span>
        <span class="gd">-      ? parts[0].charAt(0).toUpperCase() + parts[0].substring(1)</span>
        <span class="gd">-      : parts[0];</span>
        <span class="gd">-</span>
        <span class="gd">-    for (var i = 1; i &lt; len; i++)</span>
        <span class="gd">-      camelized += parts[i].charAt(0).toUpperCase() + parts[i].substring(1);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    return camelized;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function camelize() {</span>
        <span class="gi">+    return this.replace(/-+(.)?/g, function(match, chr) {</span>
        <span class="gi">+      return chr ? chr.toUpperCase() : &#39;&#39;;</span>
        <span class="gi">+    });</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  capitalize: function() {</span>
        <span class="gi">+  function capitalize() {</span>
             return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  underscore: function() {</span>
        <span class="gd">-    return this.gsub(/::/, &#39;/&#39;).gsub(/([A-Z]+)([A-Z][a-z])/,&#39;#{1}_#{2}&#39;).gsub(/([a-z\d])([A-Z])/,&#39;#{1}_#{2}&#39;).gsub(/-/,&#39;_&#39;).toLowerCase();</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function underscore() {</span>
        <span class="gi">+    return this.replace(/::/g, &#39;/&#39;)</span>
        <span class="gi">+               .replace(/([A-Z]+)([A-Z][a-z])/g, &#39;$1_$2&#39;)</span>
        <span class="gi">+               .replace(/([a-z\d])([A-Z])/g, &#39;$1_$2&#39;)</span>
        <span class="gi">+               .replace(/-/g, &#39;_&#39;)</span>
        <span class="gi">+               .toLowerCase();</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  dasherize: function() {</span>
        <span class="gd">-    return this.gsub(/_/,&#39;-&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function dasherize() {</span>
        <span class="gi">+    return this.replace(/_/g, &#39;-&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  inspect: function(useDoubleQuotes) {</span>
        <span class="gd">-    var escapedString = this.gsub(/[\x00-\x1f\\]/, function(match) {</span>
        <span class="gd">-      var character = String.specialChar[match[0]];</span>
        <span class="gd">-      return character ? character : &#39;\\u00&#39; + match[0].charCodeAt().toPaddedString(2, 16);</span>
        <span class="gi">+  function inspect(useDoubleQuotes) {</span>
        <span class="gi">+    var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {</span>
        <span class="gi">+      if (character in String.specialChar) {</span>
        <span class="gi">+        return String.specialChar[character];</span>
        <span class="gi">+      }</span>
        <span class="gi">+      return &#39;\\u00&#39; + character.charCodeAt().toPaddedString(2, 16);</span>
             });
             if (useDoubleQuotes) return &#39;&quot;&#39; + escapedString.replace(/&quot;/g, &#39;\\&quot;&#39;) + &#39;&quot;&#39;;
             return &quot;&#39;&quot; + escapedString.replace(/&#39;/g, &#39;\\\&#39;&#39;) + &quot;&#39;&quot;;
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  toJSON: function() {</span>
        <span class="gd">-    return this.inspect(true);</span>
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  unfilterJSON: function(filter) {</span>
        <span class="gd">-    return this.sub(filter || Prototype.JSONFilter, &#39;#{1}&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function unfilterJSON(filter) {</span>
        <span class="gi">+    return this.replace(filter || Prototype.JSONFilter, &#39;$1&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  isJSON: function() {</span>
        <span class="gi">+  function isJSON() {</span>
             var str = this;
             if (str.blank()) return false;
        <span class="gd">-    str = this.replace(/\\./g, &#39;@&#39;).replace(/&quot;[^&quot;\\\n\r]*&quot;/g, &#39;&#39;);</span>
        <span class="gd">-    return (/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);</span>
        <span class="gd">-  },</span>
        <span class="gi">+    str = str.replace(/\\(?:[&quot;\\\/bfnrt]|u[0-9a-fA-F]{4})/g, &#39;@&#39;);</span>
        <span class="gi">+    str = str.replace(/&quot;[^&quot;\\\n\r]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, &#39;]&#39;);</span>
        <span class="gi">+    str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, &#39;&#39;);</span>
        <span class="gi">+    return (/^[\],:{}\s]*$/).test(str);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  evalJSON: function(sanitize) {</span>
        <span class="gd">-    var json = this.unfilterJSON();</span>
        <span class="gi">+  function evalJSON(sanitize) {</span>
        <span class="gi">+    var json = this.unfilterJSON(),</span>
        <span class="gi">+        cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;</span>
        <span class="gi">+    if (cx.test(json)) {</span>
        <span class="gi">+      json = json.replace(cx, function (a) {</span>
        <span class="gi">+        return &#39;\\u&#39; + (&#39;0000&#39; + a.charCodeAt(0).toString(16)).slice(-4);</span>
        <span class="gi">+      });</span>
        <span class="gi">+    }</span>
             try {
               if (!sanitize || json.isJSON()) return eval(&#39;(&#39; + json + &#39;)&#39;);
             } catch (e) { }
             throw new SyntaxError(&#39;Badly formed JSON string: &#39; + this.inspect());
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function parseJSON() {</span>
        <span class="gi">+    var json = this.unfilterJSON();</span>
        <span class="gi">+    return JSON.parse(json);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  include: function(pattern) {</span>
        <span class="gi">+  function include(pattern) {</span>
             return this.indexOf(pattern) &gt; -1;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  startsWith: function(pattern) {</span>
        <span class="gd">-    return this.indexOf(pattern) === 0;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function startsWith(pattern) {</span>
        <span class="gi">+    return this.lastIndexOf(pattern, 0) === 0;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  endsWith: function(pattern) {</span>
        <span class="gi">+  function endsWith(pattern) {</span>
             var d = this.length - pattern.length;
        <span class="gd">-    return d &gt;= 0 &amp;&amp; this.lastIndexOf(pattern) === d;</span>
        <span class="gd">-  },</span>
        <span class="gi">+    return d &gt;= 0 &amp;&amp; this.indexOf(pattern, d) === d;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  empty: function() {</span>
        <span class="gi">+  function empty() {</span>
             return this == &#39;&#39;;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  blank: function() {</span>
        <span class="gi">+  function blank() {</span>
             return /^\s*$/.test(this);
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  interpolate: function(object, pattern) {</span>
        <span class="gd">-    return new Template(this, pattern).evaluate(object);</span>
           }
        <span class="gd">-});</span>
         
        <span class="gd">-if (Prototype.Browser.WebKit || Prototype.Browser.IE) Object.extend(String.prototype, {</span>
        <span class="gd">-  escapeHTML: function() {</span>
        <span class="gd">-    return this.replace(/&amp;/g,&#39;&amp;amp;&#39;).replace(/&lt;/g,&#39;&amp;lt;&#39;).replace(/&gt;/g,&#39;&amp;gt;&#39;);</span>
        <span class="gd">-  },</span>
        <span class="gd">-  unescapeHTML: function() {</span>
        <span class="gd">-    return this.stripTags().replace(/&amp;amp;/g,&#39;&amp;&#39;).replace(/&amp;lt;/g,&#39;&lt;&#39;).replace(/&amp;gt;/g,&#39;&gt;&#39;);</span>
        <span class="gi">+  function interpolate(object, pattern) {</span>
        <span class="gi">+    return new Template(this, pattern).evaluate(object);</span>
           }
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-String.prototype.gsub.prepareReplacement = function(replacement) {</span>
        <span class="gd">-  if (Object.isFunction(replacement)) return replacement;</span>
        <span class="gd">-  var template = new Template(replacement);</span>
        <span class="gd">-  return function(match) { return template.evaluate(match) };</span>
        <span class="gd">-};</span>
         
        <span class="gd">-String.prototype.parseQuery = String.prototype.toQueryParams;</span>
        <span class="gd">-</span>
        <span class="gd">-Object.extend(String.prototype.escapeHTML, {</span>
        <span class="gd">-  div:  document.createElement(&#39;div&#39;),</span>
        <span class="gd">-  text: document.createTextNode(&#39;&#39;)</span>
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    gsub:           gsub,</span>
        <span class="gi">+    sub:            sub,</span>
        <span class="gi">+    scan:           scan,</span>
        <span class="gi">+    truncate:       truncate,</span>
        <span class="gi">+    strip:          String.prototype.trim || strip,</span>
        <span class="gi">+    stripTags:      stripTags,</span>
        <span class="gi">+    stripScripts:   stripScripts,</span>
        <span class="gi">+    extractScripts: extractScripts,</span>
        <span class="gi">+    evalScripts:    evalScripts,</span>
        <span class="gi">+    escapeHTML:     escapeHTML,</span>
        <span class="gi">+    unescapeHTML:   unescapeHTML,</span>
        <span class="gi">+    toQueryParams:  toQueryParams,</span>
        <span class="gi">+    parseQuery:     toQueryParams,</span>
        <span class="gi">+    toArray:        toArray,</span>
        <span class="gi">+    succ:           succ,</span>
        <span class="gi">+    times:          times,</span>
        <span class="gi">+    camelize:       camelize,</span>
        <span class="gi">+    capitalize:     capitalize,</span>
        <span class="gi">+    underscore:     underscore,</span>
        <span class="gi">+    dasherize:      dasherize,</span>
        <span class="gi">+    inspect:        inspect,</span>
        <span class="gi">+    unfilterJSON:   unfilterJSON,</span>
        <span class="gi">+    isJSON:         isJSON,</span>
        <span class="gi">+    evalJSON:       NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,</span>
        <span class="gi">+    include:        include,</span>
        <span class="gi">+    startsWith:     startsWith,</span>
        <span class="gi">+    endsWith:       endsWith,</span>
        <span class="gi">+    empty:          empty,</span>
        <span class="gi">+    blank:          blank,</span>
        <span class="gi">+    interpolate:    interpolate</span>
        <span class="gi">+  };</span>
        <span class="gi">+})());</span>
         
         var Template = Class.create({
           initialize: function(template, pattern) {
             this.template = template.toString();
             this.pattern = pattern || Template.Pattern;
           },
         
           evaluate: function(object) {
        <span class="gd">-    if (Object.isFunction(object.toTemplateReplacements))</span>
        <span class="gi">+    if (object &amp;&amp; Object.isFunction(object.toTemplateReplacements))</span>
               object = object.toTemplateReplacements();
         
             return this.template.gsub(this.pattern, function(match) {
        <span class="gd">-      if (object == null) return &#39;&#39;;</span>
        <span class="gi">+      if (object == null) return (match[1] + &#39;&#39;);</span>
         
               var before = match[1] || &#39;&#39;;
               if (before == &#39;\\&#39;) return match[2];
         
        <span class="gd">-      var ctx = object, expr = match[3];</span>
        <span class="gd">-      var pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;</span>
        <span class="gi">+      var ctx = object, expr = match[3],</span>
        <span class="gi">+          pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;</span>
        <span class="gi">+</span>
               match = pattern.exec(expr);
               if (match == null) return before;
         
               while (match != null) {
        <span class="gd">-        var comp = match[1].startsWith(&#39;[&#39;) ? match[2].gsub(&#39;\\\\]&#39;, &#39;]&#39;) : match[1];</span>
        <span class="gi">+        var comp = match[1].startsWith(&#39;[&#39;) ? match[2].replace(/\\\\]/g, &#39;]&#39;) : match[1];</span>
                 ctx = ctx[comp];
                 if (null == ctx || &#39;&#39; == match[3]) break;
                 expr = expr.substring(&#39;[&#39; == match[3] ? match[1].length : match[0].length);
                 match = pattern.exec(expr);
               }
         
               return before + String.interpret(ctx);
             });
           }
         });
         Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;
         
         var $break = { };
         
        <span class="gd">-var Enumerable = {</span>
        <span class="gd">-  each: function(iterator, context) {</span>
        <span class="gi">+var Enumerable = (function() {</span>
        <span class="gi">+  function each(iterator, context) {</span>
             var index = 0;
             try {
               this._each(function(value) {
                 iterator.call(context, value, index++);
               });
             } catch (e) {
               if (e != $break) throw e;
             }
             return this;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  eachSlice: function(number, iterator, context) {</span>
        <span class="gi">+  function eachSlice(number, iterator, context) {</span>
             var index = -number, slices = [], array = this.toArray();
             if (number &lt; 1) return array;
             while ((index += number) &lt; array.length)
               slices.push(array.slice(index, index+number));
             return slices.collect(iterator, context);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  all: function(iterator, context) {</span>
        <span class="gi">+  function all(iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var result = true;
             this.each(function(value, index) {
               result = result &amp;&amp; !!iterator.call(context, value, index);
               if (!result) throw $break;
             });
             return result;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  any: function(iterator, context) {</span>
        <span class="gi">+  function any(iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var result = false;
             this.each(function(value, index) {
               if (result = !!iterator.call(context, value, index))
                 throw $break;
             });
             return result;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  collect: function(iterator, context) {</span>
        <span class="gi">+  function collect(iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var results = [];
             this.each(function(value, index) {
               results.push(iterator.call(context, value, index));
             });
             return results;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  detect: function(iterator, context) {</span>
        <span class="gi">+  function detect(iterator, context) {</span>
             var result;
             this.each(function(value, index) {
               if (iterator.call(context, value, index)) {
                 result = value;
                 throw $break;
               }
             });
             return result;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  findAll: function(iterator, context) {</span>
        <span class="gi">+  function findAll(iterator, context) {</span>
             var results = [];
             this.each(function(value, index) {
               if (iterator.call(context, value, index))
                 results.push(value);
             });
             return results;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  grep: function(filter, iterator, context) {</span>
        <span class="gi">+  function grep(filter, iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var results = [];
         
             if (Object.isString(filter))
        <span class="gd">-      filter = new RegExp(filter);</span>
        <span class="gi">+      filter = new RegExp(RegExp.escape(filter));</span>
         
             this.each(function(value, index) {
               if (filter.match(value))
                 results.push(iterator.call(context, value, index));
             });
             return results;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  include: function(object) {</span>
        <span class="gi">+  function include(object) {</span>
             if (Object.isFunction(this.indexOf))
               if (this.indexOf(object) != -1) return true;
         
             var found = false;
             this.each(function(value) {
               if (value == object) {
                 found = true;
                 throw $break;
               }
             });
             return found;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  inGroupsOf: function(number, fillWith) {</span>
        <span class="gi">+  function inGroupsOf(number, fillWith) {</span>
             fillWith = Object.isUndefined(fillWith) ? null : fillWith;
             return this.eachSlice(number, function(slice) {
               while(slice.length &lt; number) slice.push(fillWith);
               return slice;
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  inject: function(memo, iterator, context) {</span>
        <span class="gi">+  function inject(memo, iterator, context) {</span>
             this.each(function(value, index) {
               memo = iterator.call(context, memo, value, index);
             });
             return memo;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  invoke: function(method) {</span>
        <span class="gi">+  function invoke(method) {</span>
             var args = $A(arguments).slice(1);
             return this.map(function(value) {
               return value[method].apply(value, args);
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  max: function(iterator, context) {</span>
        <span class="gi">+  function max(iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var result;
             this.each(function(value, index) {
               value = iterator.call(context, value, index);
               if (result == null || value &gt;= result)
                 result = value;
             });
             return result;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  min: function(iterator, context) {</span>
        <span class="gi">+  function min(iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var result;
             this.each(function(value, index) {
               value = iterator.call(context, value, index);
               if (result == null || value &lt; result)
                 result = value;
             });
             return result;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  partition: function(iterator, context) {</span>
        <span class="gi">+  function partition(iterator, context) {</span>
             iterator = iterator || Prototype.K;
             var trues = [], falses = [];
             this.each(function(value, index) {
               (iterator.call(context, value, index) ?
                 trues : falses).push(value);
             });
             return [trues, falses];
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  pluck: function(property) {</span>
        <span class="gi">+  function pluck(property) {</span>
             var results = [];
             this.each(function(value) {
               results.push(value[property]);
             });
             return results;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  reject: function(iterator, context) {</span>
        <span class="gi">+  function reject(iterator, context) {</span>
             var results = [];
             this.each(function(value, index) {
               if (!iterator.call(context, value, index))
                 results.push(value);
             });
             return results;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  sortBy: function(iterator, context) {</span>
        <span class="gi">+  function sortBy(iterator, context) {</span>
             return this.map(function(value, index) {
               return {
                 value: value,
                 criteria: iterator.call(context, value, index)
               };
             }).sort(function(left, right) {
               var a = left.criteria, b = right.criteria;
               return a &lt; b ? -1 : a &gt; b ? 1 : 0;
             }).pluck(&#39;value&#39;);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  toArray: function() {</span>
        <span class="gi">+  function toArray() {</span>
             return this.map();
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  zip: function() {</span>
        <span class="gi">+  function zip() {</span>
             var iterator = Prototype.K, args = $A(arguments);
             if (Object.isFunction(args.last()))
               iterator = args.pop();
         
             var collections = [this].concat(args).map($A);
             return this.map(function(value, index) {
               return iterator(collections.pluck(index));
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  size: function() {</span>
        <span class="gi">+  function size() {</span>
             return this.toArray().length;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  inspect: function() {</span>
        <span class="gi">+  function inspect() {</span>
             return &#39;#&lt;Enumerable:&#39; + this.toArray().inspect() + &#39;&gt;&#39;;
           }
        <span class="gd">-};</span>
         
        <span class="gd">-Object.extend(Enumerable, {</span>
        <span class="gd">-  map:     Enumerable.collect,</span>
        <span class="gd">-  find:    Enumerable.detect,</span>
        <span class="gd">-  select:  Enumerable.findAll,</span>
        <span class="gd">-  filter:  Enumerable.findAll,</span>
        <span class="gd">-  member:  Enumerable.include,</span>
        <span class="gd">-  entries: Enumerable.toArray,</span>
        <span class="gd">-  every:   Enumerable.all,</span>
        <span class="gd">-  some:    Enumerable.any</span>
        <span class="gd">-});</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    each:       each,</span>
        <span class="gi">+    eachSlice:  eachSlice,</span>
        <span class="gi">+    all:        all,</span>
        <span class="gi">+    every:      all,</span>
        <span class="gi">+    any:        any,</span>
        <span class="gi">+    some:       any,</span>
        <span class="gi">+    collect:    collect,</span>
        <span class="gi">+    map:        collect,</span>
        <span class="gi">+    detect:     detect,</span>
        <span class="gi">+    findAll:    findAll,</span>
        <span class="gi">+    select:     findAll,</span>
        <span class="gi">+    filter:     findAll,</span>
        <span class="gi">+    grep:       grep,</span>
        <span class="gi">+    include:    include,</span>
        <span class="gi">+    member:     include,</span>
        <span class="gi">+    inGroupsOf: inGroupsOf,</span>
        <span class="gi">+    inject:     inject,</span>
        <span class="gi">+    invoke:     invoke,</span>
        <span class="gi">+    max:        max,</span>
        <span class="gi">+    min:        min,</span>
        <span class="gi">+    partition:  partition,</span>
        <span class="gi">+    pluck:      pluck,</span>
        <span class="gi">+    reject:     reject,</span>
        <span class="gi">+    sortBy:     sortBy,</span>
        <span class="gi">+    toArray:    toArray,</span>
        <span class="gi">+    entries:    toArray,</span>
        <span class="gi">+    zip:        zip,</span>
        <span class="gi">+    size:       size,</span>
        <span class="gi">+    inspect:    inspect,</span>
        <span class="gi">+    find:       detect</span>
        <span class="gi">+  };</span>
        <span class="gi">+})();</span>
        <span class="gi">+</span>
         function $A(iterable) {
           if (!iterable) return [];
        <span class="gd">-  if (iterable.toArray) return iterable.toArray();</span>
        <span class="gi">+  if (&#39;toArray&#39; in Object(iterable)) return iterable.toArray();</span>
           var length = iterable.length || 0, results = new Array(length);
           while (length--) results[length] = iterable[length];
           return results;
         }
         
        <span class="gd">-if (Prototype.Browser.WebKit) {</span>
        <span class="gd">-  $A = function(iterable) {</span>
        <span class="gd">-    if (!iterable) return [];</span>
        <span class="gd">-    // In Safari, only use the `toArray` method if it&#39;s not a NodeList.</span>
        <span class="gd">-    // A NodeList is a function, has an function `item` property, and a numeric</span>
        <span class="gd">-    // `length` property. Adapted from Google Doctype.</span>
        <span class="gd">-    if (!(typeof iterable === &#39;function&#39; &amp;&amp; typeof iterable.length ===</span>
        <span class="gd">-        &#39;number&#39; &amp;&amp; typeof iterable.item === &#39;function&#39;) &amp;&amp; iterable.toArray)</span>
        <span class="gd">-      return iterable.toArray();</span>
        <span class="gd">-    var length = iterable.length || 0, results = new Array(length);</span>
        <span class="gd">-    while (length--) results[length] = iterable[length];</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  };</span>
        <span class="gi">+</span>
        <span class="gi">+function $w(string) {</span>
        <span class="gi">+  if (!Object.isString(string)) return [];</span>
        <span class="gi">+  string = string.strip();</span>
        <span class="gi">+  return string ? string.split(/\s+/) : [];</span>
         }
         
         Array.from = $A;
         
        <span class="gd">-Object.extend(Array.prototype, Enumerable);</span>
         
        <span class="gd">-if (!Array.prototype._reverse) Array.prototype._reverse = Array.prototype.reverse;</span>
        <span class="gi">+(function() {</span>
        <span class="gi">+  var arrayProto = Array.prototype,</span>
        <span class="gi">+      slice = arrayProto.slice,</span>
        <span class="gi">+      _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available</span>
         
        <span class="gd">-Object.extend(Array.prototype, {</span>
        <span class="gd">-  _each: function(iterator) {</span>
        <span class="gi">+  function each(iterator) {</span>
             for (var i = 0, length = this.length; i &lt; length; i++)
               iterator(this[i]);
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
        <span class="gi">+  if (!_each) _each = each;</span>
         
        <span class="gd">-  clear: function() {</span>
        <span class="gi">+  function clear() {</span>
             this.length = 0;
             return this;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  first: function() {</span>
        <span class="gi">+  function first() {</span>
             return this[0];
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  last: function() {</span>
        <span class="gi">+  function last() {</span>
             return this[this.length - 1];
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  compact: function() {</span>
        <span class="gi">+  function compact() {</span>
             return this.select(function(value) {
               return value != null;
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  flatten: function() {</span>
        <span class="gi">+  function flatten() {</span>
             return this.inject([], function(array, value) {
        <span class="gd">-      return array.concat(Object.isArray(value) ?</span>
        <span class="gd">-        value.flatten() : [value]);</span>
        <span class="gi">+      if (Object.isArray(value))</span>
        <span class="gi">+        return array.concat(value.flatten());</span>
        <span class="gi">+      array.push(value);</span>
        <span class="gi">+      return array;</span>
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  without: function() {</span>
        <span class="gd">-    var values = $A(arguments);</span>
        <span class="gi">+  function without() {</span>
        <span class="gi">+    var values = slice.call(arguments, 0);</span>
             return this.select(function(value) {
               return !values.include(value);
             });
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  reverse: function(inline) {</span>
        <span class="gd">-    return (inline !== false ? this : this.toArray())._reverse();</span>
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  reduce: function() {</span>
        <span class="gd">-    return this.length &gt; 1 ? this : this[0];</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function reverse(inline) {</span>
        <span class="gi">+    return (inline === false ? this.toArray() : this)._reverse();</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  uniq: function(sorted) {</span>
        <span class="gi">+  function uniq(sorted) {</span>
             return this.inject([], function(array, value, index) {
               if (0 == index || (sorted ? array.last() != value : !array.include(value)))
                 array.push(value);
               return array;
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  intersect: function(array) {</span>
        <span class="gi">+  function intersect(array) {</span>
             return this.uniq().findAll(function(item) {
               return array.detect(function(value) { return item === value });
             });
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  clone: function() {</span>
        <span class="gd">-    return [].concat(this);</span>
        <span class="gd">-  },</span>
         
        <span class="gd">-  size: function() {</span>
        <span class="gi">+  function clone() {</span>
        <span class="gi">+    return slice.call(this, 0);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function size() {</span>
             return this.length;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  inspect: function() {</span>
        <span class="gi">+  function inspect() {</span>
             return &#39;[&#39; + this.map(Object.inspect).join(&#39;, &#39;) + &#39;]&#39;;
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  toJSON: function() {</span>
        <span class="gd">-    var results = [];</span>
        <span class="gd">-    this.each(function(object) {</span>
        <span class="gd">-      var value = Object.toJSON(object);</span>
        <span class="gd">-      if (!Object.isUndefined(value)) results.push(value);</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return &#39;[&#39; + results.join(&#39;, &#39;) + &#39;]&#39;;</span>
           }
        <span class="gd">-});</span>
        <span class="gd">-</span>
        <span class="gd">-// use native browser JS 1.6 implementation if available</span>
        <span class="gd">-if (Object.isFunction(Array.prototype.forEach))</span>
        <span class="gd">-  Array.prototype._each = Array.prototype.forEach;</span>
        <span class="gd">-</span>
        <span class="gd">-if (!Array.prototype.indexOf) Array.prototype.indexOf = function(item, i) {</span>
        <span class="gd">-  i || (i = 0);</span>
        <span class="gd">-  var length = this.length;</span>
        <span class="gd">-  if (i &lt; 0) i = length + i;</span>
        <span class="gd">-  for (; i &lt; length; i++)</span>
        <span class="gd">-    if (this[i] === item) return i;</span>
        <span class="gd">-  return -1;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-if (!Array.prototype.lastIndexOf) Array.prototype.lastIndexOf = function(item, i) {</span>
        <span class="gd">-  i = isNaN(i) ? this.length : (i &lt; 0 ? this.length + i : i) + 1;</span>
        <span class="gd">-  var n = this.slice(0, i).reverse().indexOf(item);</span>
        <span class="gd">-  return (n &lt; 0) ? n : i - n - 1;</span>
        <span class="gd">-};</span>
        <span class="gd">-</span>
        <span class="gd">-Array.prototype.toArray = Array.prototype.clone;</span>
         
        <span class="gd">-function $w(string) {</span>
        <span class="gd">-  if (!Object.isString(string)) return [];</span>
        <span class="gd">-  string = string.strip();</span>
        <span class="gd">-  return string ? string.split(/\s+/) : [];</span>
        <span class="gd">-}</span>
        <span class="gi">+  function indexOf(item, i) {</span>
        <span class="gi">+    i || (i = 0);</span>
        <span class="gi">+    var length = this.length;</span>
        <span class="gi">+    if (i &lt; 0) i = length + i;</span>
        <span class="gi">+    for (; i &lt; length; i++)</span>
        <span class="gi">+      if (this[i] === item) return i;</span>
        <span class="gi">+    return -1;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function lastIndexOf(item, i) {</span>
        <span class="gi">+    i = isNaN(i) ? this.length : (i &lt; 0 ? this.length + i : i) + 1;</span>
        <span class="gi">+    var n = this.slice(0, i).reverse().indexOf(item);</span>
        <span class="gi">+    return (n &lt; 0) ? n : i - n - 1;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-if (Prototype.Browser.Opera){</span>
        <span class="gd">-  Array.prototype.concat = function() {</span>
        <span class="gd">-    var array = [];</span>
        <span class="gd">-    for (var i = 0, length = this.length; i &lt; length; i++) array.push(this[i]);</span>
        <span class="gi">+  function concat() {</span>
        <span class="gi">+    var array = slice.call(this, 0), item;</span>
             for (var i = 0, length = arguments.length; i &lt; length; i++) {
        <span class="gd">-      if (Object.isArray(arguments[i])) {</span>
        <span class="gd">-        for (var j = 0, arrayLength = arguments[i].length; j &lt; arrayLength; j++)</span>
        <span class="gd">-          array.push(arguments[i][j]);</span>
        <span class="gi">+      item = arguments[i];</span>
        <span class="gi">+      if (Object.isArray(item) &amp;&amp; !(&#39;callee&#39; in item)) {</span>
        <span class="gi">+        for (var j = 0, arrayLength = item.length; j &lt; arrayLength; j++)</span>
        <span class="gi">+          array.push(item[j]);</span>
               } else {
        <span class="gd">-        array.push(arguments[i]);</span>
        <span class="gi">+        array.push(item);</span>
               }
             }
             return array;
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-Object.extend(Number.prototype, {</span>
        <span class="gd">-  toColorPart: function() {</span>
        <span class="gd">-    return this.toPaddedString(2, 16);</span>
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  succ: function() {</span>
        <span class="gd">-    return this + 1;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  Object.extend(arrayProto, Enumerable);</span>
         
        <span class="gd">-  times: function(iterator, context) {</span>
        <span class="gd">-    $R(0, this, true).each(iterator, context);</span>
        <span class="gd">-    return this;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  if (!arrayProto._reverse)</span>
        <span class="gi">+    arrayProto._reverse = arrayProto.reverse;</span>
         
        <span class="gd">-  toPaddedString: function(length, radix) {</span>
        <span class="gd">-    var string = this.toString(radix || 10);</span>
        <span class="gd">-    return &#39;0&#39;.times(length - string.length) + string;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  Object.extend(arrayProto, {</span>
        <span class="gi">+    _each:     _each,</span>
        <span class="gi">+    clear:     clear,</span>
        <span class="gi">+    first:     first,</span>
        <span class="gi">+    last:      last,</span>
        <span class="gi">+    compact:   compact,</span>
        <span class="gi">+    flatten:   flatten,</span>
        <span class="gi">+    without:   without,</span>
        <span class="gi">+    reverse:   reverse,</span>
        <span class="gi">+    uniq:      uniq,</span>
        <span class="gi">+    intersect: intersect,</span>
        <span class="gi">+    clone:     clone,</span>
        <span class="gi">+    toArray:   clone,</span>
        <span class="gi">+    size:      size,</span>
        <span class="gi">+    inspect:   inspect</span>
        <span class="gi">+  });</span>
         
        <span class="gd">-  toJSON: function() {</span>
        <span class="gd">-    return isFinite(this) ? this.toString() : &#39;null&#39;;</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gi">+  var CONCAT_ARGUMENTS_BUGGY = (function() {</span>
        <span class="gi">+    return [].concat(arguments)[0][0] !== 1;</span>
        <span class="gi">+  })(1,2)</span>
         
        <span class="gd">-$w(&#39;abs round ceil floor&#39;).each(function(method){</span>
        <span class="gd">-  Number.prototype[method] = Math[method].methodize();</span>
        <span class="gd">-});</span>
        <span class="gi">+  if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;</span>
        <span class="gi">+  if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;</span>
        <span class="gi">+})();</span>
         function $H(object) {
           return new Hash(object);
         };
         
         var Hash = Class.create(Enumerable, (function() {
        <span class="gi">+  function initialize(object) {</span>
        <span class="gi">+    this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  function toQueryPair(key, value) {</span>
        <span class="gd">-    if (Object.isUndefined(value)) return key;</span>
        <span class="gd">-    return key + &#39;=&#39; + encodeURIComponent(String.interpret(value));</span>
        <span class="gi">+</span>
        <span class="gi">+  function _each(iterator) {</span>
        <span class="gi">+    for (var key in this._object) {</span>
        <span class="gi">+      var value = this._object[key], pair = [key, value];</span>
        <span class="gi">+      pair.key = key;</span>
        <span class="gi">+      pair.value = value;</span>
        <span class="gi">+      iterator(pair);</span>
        <span class="gi">+    }</span>
           }
         
        <span class="gd">-  return {</span>
        <span class="gd">-    initialize: function(object) {</span>
        <span class="gd">-      this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function set(key, value) {</span>
        <span class="gi">+    return this._object[key] = value;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    _each: function(iterator) {</span>
        <span class="gd">-      for (var key in this._object) {</span>
        <span class="gd">-        var value = this._object[key], pair = [key, value];</span>
        <span class="gd">-        pair.key = key;</span>
        <span class="gd">-        pair.value = value;</span>
        <span class="gd">-        iterator(pair);</span>
        <span class="gd">-      }</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function get(key) {</span>
        <span class="gi">+    if (this._object[key] !== Object.prototype[key])</span>
        <span class="gi">+      return this._object[key];</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    set: function(key, value) {</span>
        <span class="gd">-      return this._object[key] = value;</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function unset(key) {</span>
        <span class="gi">+    var value = this._object[key];</span>
        <span class="gi">+    delete this._object[key];</span>
        <span class="gi">+    return value;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    get: function(key) {</span>
        <span class="gd">-      // simulating poorly supported hasOwnProperty</span>
        <span class="gd">-      if (this._object[key] !== Object.prototype[key])</span>
        <span class="gd">-        return this._object[key];</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function toObject() {</span>
        <span class="gi">+    return Object.clone(this._object);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    unset: function(key) {</span>
        <span class="gd">-      var value = this._object[key];</span>
        <span class="gd">-      delete this._object[key];</span>
        <span class="gd">-      return value;</span>
        <span class="gd">-    },</span>
         
        <span class="gd">-    toObject: function() {</span>
        <span class="gd">-      return Object.clone(this._object);</span>
        <span class="gd">-    },</span>
         
        <span class="gd">-    keys: function() {</span>
        <span class="gd">-      return this.pluck(&#39;key&#39;);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function keys() {</span>
        <span class="gi">+    return this.pluck(&#39;key&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    values: function() {</span>
        <span class="gd">-      return this.pluck(&#39;value&#39;);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function values() {</span>
        <span class="gi">+    return this.pluck(&#39;value&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    index: function(value) {</span>
        <span class="gd">-      var match = this.detect(function(pair) {</span>
        <span class="gd">-        return pair.value === value;</span>
        <span class="gd">-      });</span>
        <span class="gd">-      return match &amp;&amp; match.key;</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function index(value) {</span>
        <span class="gi">+    var match = this.detect(function(pair) {</span>
        <span class="gi">+      return pair.value === value;</span>
        <span class="gi">+    });</span>
        <span class="gi">+    return match &amp;&amp; match.key;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    merge: function(object) {</span>
        <span class="gd">-      return this.clone().update(object);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function merge(object) {</span>
        <span class="gi">+    return this.clone().update(object);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    update: function(object) {</span>
        <span class="gd">-      return new Hash(object).inject(this, function(result, pair) {</span>
        <span class="gd">-        result.set(pair.key, pair.value);</span>
        <span class="gd">-        return result;</span>
        <span class="gd">-      });</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function update(object) {</span>
        <span class="gi">+    return new Hash(object).inject(this, function(result, pair) {</span>
        <span class="gi">+      result.set(pair.key, pair.value);</span>
        <span class="gi">+      return result;</span>
        <span class="gi">+    });</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    toQueryString: function() {</span>
        <span class="gd">-      return this.inject([], function(results, pair) {</span>
        <span class="gd">-        var key = encodeURIComponent(pair.key), values = pair.value;</span>
        <span class="gd">-</span>
        <span class="gd">-        if (values &amp;&amp; typeof values == &#39;object&#39;) {</span>
        <span class="gd">-          if (Object.isArray(values))</span>
        <span class="gd">-            return results.concat(values.map(toQueryPair.curry(key)));</span>
        <span class="gd">-        } else results.push(toQueryPair(key, values));</span>
        <span class="gd">-        return results;</span>
        <span class="gd">-      }).join(&#39;&amp;&#39;);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function toQueryPair(key, value) {</span>
        <span class="gi">+    if (Object.isUndefined(value)) return key;</span>
        <span class="gi">+    return key + &#39;=&#39; + encodeURIComponent(String.interpret(value));</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    inspect: function() {</span>
        <span class="gd">-      return &#39;#&lt;Hash:{&#39; + this.map(function(pair) {</span>
        <span class="gd">-        return pair.map(Object.inspect).join(&#39;: &#39;);</span>
        <span class="gd">-      }).join(&#39;, &#39;) + &#39;}&gt;&#39;;</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function toQueryString() {</span>
        <span class="gi">+    return this.inject([], function(results, pair) {</span>
        <span class="gi">+      var key = encodeURIComponent(pair.key), values = pair.value;</span>
        <span class="gi">+</span>
        <span class="gi">+      if (values &amp;&amp; typeof values == &#39;object&#39;) {</span>
        <span class="gi">+        if (Object.isArray(values))</span>
        <span class="gi">+          return results.concat(values.map(toQueryPair.curry(key)));</span>
        <span class="gi">+      } else results.push(toQueryPair(key, values));</span>
        <span class="gi">+      return results;</span>
        <span class="gi">+    }).join(&#39;&amp;&#39;);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    toJSON: function() {</span>
        <span class="gd">-      return Object.toJSON(this.toObject());</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function inspect() {</span>
        <span class="gi">+    return &#39;#&lt;Hash:{&#39; + this.map(function(pair) {</span>
        <span class="gi">+      return pair.map(Object.inspect).join(&#39;: &#39;);</span>
        <span class="gi">+    }).join(&#39;, &#39;) + &#39;}&gt;&#39;;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    clone: function() {</span>
        <span class="gd">-      return new Hash(this);</span>
        <span class="gd">-    }</span>
        <span class="gi">+  function clone() {</span>
        <span class="gi">+    return new Hash(this);</span>
           }
        <span class="gi">+</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    initialize:             initialize,</span>
        <span class="gi">+    _each:                  _each,</span>
        <span class="gi">+    set:                    set,</span>
        <span class="gi">+    get:                    get,</span>
        <span class="gi">+    unset:                  unset,</span>
        <span class="gi">+    toObject:               toObject,</span>
        <span class="gi">+    toTemplateReplacements: toObject,</span>
        <span class="gi">+    keys:                   keys,</span>
        <span class="gi">+    values:                 values,</span>
        <span class="gi">+    index:                  index,</span>
        <span class="gi">+    merge:                  merge,</span>
        <span class="gi">+    update:                 update,</span>
        <span class="gi">+    toQueryString:          toQueryString,</span>
        <span class="gi">+    inspect:                inspect,</span>
        <span class="gi">+    toJSON:                 toObject,</span>
        <span class="gi">+    clone:                  clone</span>
        <span class="gi">+  };</span>
         })());
         
        <span class="gd">-Hash.prototype.toTemplateReplacements = Hash.prototype.toObject;</span>
         Hash.from = $H;
        <span class="gd">-var ObjectRange = Class.create(Enumerable, {</span>
        <span class="gd">-  initialize: function(start, end, exclusive) {</span>
        <span class="gi">+Object.extend(Number.prototype, (function() {</span>
        <span class="gi">+  function toColorPart() {</span>
        <span class="gi">+    return this.toPaddedString(2, 16);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function succ() {</span>
        <span class="gi">+    return this + 1;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function times(iterator, context) {</span>
        <span class="gi">+    $R(0, this, true).each(iterator, context);</span>
        <span class="gi">+    return this;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function toPaddedString(length, radix) {</span>
        <span class="gi">+    var string = this.toString(radix || 10);</span>
        <span class="gi">+    return &#39;0&#39;.times(length - string.length) + string;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function abs() {</span>
        <span class="gi">+    return Math.abs(this);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function round() {</span>
        <span class="gi">+    return Math.round(this);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function ceil() {</span>
        <span class="gi">+    return Math.ceil(this);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function floor() {</span>
        <span class="gi">+    return Math.floor(this);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    toColorPart:    toColorPart,</span>
        <span class="gi">+    succ:           succ,</span>
        <span class="gi">+    times:          times,</span>
        <span class="gi">+    toPaddedString: toPaddedString,</span>
        <span class="gi">+    abs:            abs,</span>
        <span class="gi">+    round:          round,</span>
        <span class="gi">+    ceil:           ceil,</span>
        <span class="gi">+    floor:          floor</span>
        <span class="gi">+  };</span>
        <span class="gi">+})());</span>
        <span class="gi">+</span>
        <span class="gi">+function $R(start, end, exclusive) {</span>
        <span class="gi">+  return new ObjectRange(start, end, exclusive);</span>
        <span class="gi">+}</span>
        <span class="gi">+</span>
        <span class="gi">+var ObjectRange = Class.create(Enumerable, (function() {</span>
        <span class="gi">+  function initialize(start, end, exclusive) {</span>
             this.start = start;
             this.end = end;
             this.exclusive = exclusive;
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  _each: function(iterator) {</span>
        <span class="gi">+  function _each(iterator) {</span>
             var value = this.start;
             while (this.include(value)) {
               iterator(value);
               value = value.succ();
             }
        <span class="gd">-  },</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-  include: function(value) {</span>
        <span class="gi">+  function include(value) {</span>
             if (value &lt; this.start)
               return false;
             if (this.exclusive)
               return value &lt; this.end;
             return value &lt;= this.end;
           }
        <span class="gd">-});</span>
         
        <span class="gd">-var $R = function(start, end, exclusive) {</span>
        <span class="gd">-  return new ObjectRange(start, end, exclusive);</span>
        <span class="gd">-};</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    initialize: initialize,</span>
        <span class="gi">+    _each:      _each,</span>
        <span class="gi">+    include:    include</span>
        <span class="gi">+  };</span>
        <span class="gi">+})());</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
         
         var Ajax = {
           getTransport: function() {
             return Try.these(
               function() {return new XMLHttpRequest()},
               function() {return new ActiveXObject(&#39;Msxml2.XMLHTTP&#39;)},
               function() {return new ActiveXObject(&#39;Microsoft.XMLHTTP&#39;)}
             ) || false;
           },
         
           activeRequestCount: 0
         };
         
         Ajax.Responders = {
           responders: [],
         
           _each: function(iterator) {
             this.responders._each(iterator);
           },
         
           register: function(responder) {
             if (!this.include(responder))
               this.responders.push(responder);
           },
         
           unregister: function(responder) {
             this.responders = this.responders.without(responder);
           },
         
           dispatch: function(callback, request, transport, json) {
             this.each(function(responder) {
               if (Object.isFunction(responder[callback])) {
                 try {
                   responder[callback].apply(responder, [request, transport, json]);
                 } catch (e) { }
               }
             });
           }
         };
         
         Object.extend(Ajax.Responders, Enumerable);
         
         Ajax.Responders.register({
           onCreate:   function() { Ajax.activeRequestCount++ },
           onComplete: function() { Ajax.activeRequestCount-- }
         });
        <span class="gd">-</span>
         Ajax.Base = Class.create({
           initialize: function(options) {
             this.options = {
               method:       &#39;post&#39;,
               asynchronous: true,
               contentType:  &#39;application/x-www-form-urlencoded&#39;,
               encoding:     &#39;UTF-8&#39;,
               parameters:   &#39;&#39;,
               evalJSON:     true,
               evalJS:       true
             };
             Object.extend(this.options, options || { });
         
             this.options.method = this.options.method.toLowerCase();
         
             if (Object.isString(this.options.parameters))
               this.options.parameters = this.options.parameters.toQueryParams();
             else if (Object.isHash(this.options.parameters))
               this.options.parameters = this.options.parameters.toObject();
           }
         });
        <span class="gd">-</span>
         Ajax.Request = Class.create(Ajax.Base, {
           _complete: false,
         
           initialize: function($super, url, options) {
             $super(options);
             this.transport = Ajax.getTransport();
             this.request(url);
           },
         
           request: function(url) {
             this.url = url;
             this.method = this.options.method;
             var params = Object.clone(this.options.parameters);
         
             if (![&#39;get&#39;, &#39;post&#39;].include(this.method)) {
        <span class="gd">-      // simulate other verbs over post</span>
               params[&#39;_method&#39;] = this.method;
               this.method = &#39;post&#39;;
             }
         
             this.parameters = params;
         
             if (params = Object.toQueryString(params)) {
        <span class="gd">-      // when GET, append parameters to URL</span>
               if (this.method == &#39;get&#39;)
                 this.url += (this.url.include(&#39;?&#39;) ? &#39;&amp;&#39; : &#39;?&#39;) + params;
               else if (/Konqueror|Safari|KHTML/.test(navigator.userAgent))
                 params += &#39;&amp;_=&#39;;
             }
         
             try {
               var response = new Ajax.Response(this);
               if (this.options.onCreate) this.options.onCreate(response);
               Ajax.Responders.dispatch(&#39;onCreate&#39;, this, response);
         
               this.transport.open(this.method.toUpperCase(), this.url,
                 this.options.asynchronous);
         
               if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);
         
               this.transport.onreadystatechange = this.onStateChange.bind(this);
               this.setRequestHeaders();
         
               this.body = this.method == &#39;post&#39; ? (this.options.postBody || params) : null;
               this.transport.send(this.body);
         
               /* Force Firefox to handle ready state 4 for synchronous requests */
               if (!this.options.asynchronous &amp;&amp; this.transport.overrideMimeType)
                 this.onStateChange();
         
             }
             catch (e) {
               this.dispatchException(e);
             }
           },
         
           onStateChange: function() {
             var readyState = this.transport.readyState;
             if (readyState &gt; 1 &amp;&amp; !((readyState == 4) &amp;&amp; this._complete))
               this.respondToReadyState(this.transport.readyState);
           },
         
           setRequestHeaders: function() {
             var headers = {
               &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;,
               &#39;X-Prototype-Version&#39;: Prototype.Version,
               &#39;Accept&#39;: &#39;text/javascript, text/html, application/xml, text/xml, */*&#39;
             };
         
             if (this.method == &#39;post&#39;) {
               headers[&#39;Content-type&#39;] = this.options.contentType +
                 (this.options.encoding ? &#39;; charset=&#39; + this.options.encoding : &#39;&#39;);
         
               /* Force &quot;Connection: close&quot; for older Mozilla browsers to work
                * around a bug where XMLHttpRequest sends an incorrect
                * Content-length header. See Mozilla Bugzilla #246651.
                */
               if (this.transport.overrideMimeType &amp;&amp;
                   (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] &lt; 2005)
                     headers[&#39;Connection&#39;] = &#39;close&#39;;
             }
         
        <span class="gd">-    // user-defined headers</span>
             if (typeof this.options.requestHeaders == &#39;object&#39;) {
               var extras = this.options.requestHeaders;
         
               if (Object.isFunction(extras.push))
                 for (var i = 0, length = extras.length; i &lt; length; i += 2)
                   headers[extras[i]] = extras[i+1];
               else
                 $H(extras).each(function(pair) { headers[pair.key] = pair.value });
             }
         
             for (var name in headers)
               this.transport.setRequestHeader(name, headers[name]);
           },
         
           success: function() {
             var status = this.getStatus();
             return !status || (status &gt;= 200 &amp;&amp; status &lt; 300);
           },
         
           getStatus: function() {
             try {
               return this.transport.status || 0;
             } catch (e) { return 0 }
           },
         
           respondToReadyState: function(readyState) {
             var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);
         
             if (state == &#39;Complete&#39;) {
               try {
                 this._complete = true;
                 (this.options[&#39;on&#39; + response.status]
                  || this.options[&#39;on&#39; + (this.success() ? &#39;Success&#39; : &#39;Failure&#39;)]
                  || Prototype.emptyFunction)(response, response.headerJSON);
               } catch (e) {
                 this.dispatchException(e);
               }
         
               var contentType = response.getHeader(&#39;Content-type&#39;);
               if (this.options.evalJS == &#39;force&#39;
                   || (this.options.evalJS &amp;&amp; this.isSameOrigin() &amp;&amp; contentType
                   &amp;&amp; contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
                 this.evalResponse();
             }
         
             try {
               (this.options[&#39;on&#39; + state] || Prototype.emptyFunction)(response, response.headerJSON);
               Ajax.Responders.dispatch(&#39;on&#39; + state, this, response, response.headerJSON);
             } catch (e) {
               this.dispatchException(e);
             }
         
             if (state == &#39;Complete&#39;) {
        <span class="gd">-      // avoid memory leak in MSIE: clean up</span>
               this.transport.onreadystatechange = Prototype.emptyFunction;
             }
           },
         
           isSameOrigin: function() {
             var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
             return !m || (m[0] == &#39;#{protocol}//#{domain}#{port}&#39;.interpolate({
               protocol: location.protocol,
               domain: document.domain,
               port: location.port ? &#39;:&#39; + location.port : &#39;&#39;
             }));
           },
         
           getHeader: function(name) {
             try {
               return this.transport.getResponseHeader(name) || null;
        <span class="gd">-    } catch (e) { return null }</span>
        <span class="gi">+    } catch (e) { return null; }</span>
           },
         
           evalResponse: function() {
             try {
               return eval((this.transport.responseText || &#39;&#39;).unfilterJSON());
             } catch (e) {
               this.dispatchException(e);
             }
           },
         
           dispatchException: function(exception) {
             (this.options.onException || Prototype.emptyFunction)(this, exception);
             Ajax.Responders.dispatch(&#39;onException&#39;, this, exception);
           }
         });
         
         Ajax.Request.Events =
           [&#39;Uninitialized&#39;, &#39;Loading&#39;, &#39;Loaded&#39;, &#39;Interactive&#39;, &#39;Complete&#39;];
         
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
         Ajax.Response = Class.create({
           initialize: function(request){
             this.request = request;
             var transport  = this.transport  = request.transport,
                 readyState = this.readyState = transport.readyState;
         
        <span class="gd">-    if((readyState &gt; 2 &amp;&amp; !Prototype.Browser.IE) || readyState == 4) {</span>
        <span class="gi">+    if ((readyState &gt; 2 &amp;&amp; !Prototype.Browser.IE) || readyState == 4) {</span>
               this.status       = this.getStatus();
               this.statusText   = this.getStatusText();
               this.responseText = String.interpret(transport.responseText);
               this.headerJSON   = this._getHeaderJSON();
             }
         
        <span class="gd">-    if(readyState == 4) {</span>
        <span class="gi">+    if (readyState == 4) {</span>
               var xml = transport.responseXML;
               this.responseXML  = Object.isUndefined(xml) ? null : xml;
               this.responseJSON = this._getResponseJSON();
             }
           },
         
           status:      0,
        <span class="gi">+</span>
           statusText: &#39;&#39;,
         
           getStatus: Ajax.Request.prototype.getStatus,
         
           getStatusText: function() {
             try {
               return this.transport.statusText || &#39;&#39;;
             } catch (e) { return &#39;&#39; }
           },
         
           getHeader: Ajax.Request.prototype.getHeader,
         
           getAllHeaders: function() {
             try {
               return this.getAllResponseHeaders();
             } catch (e) { return null }
           },
         
           getResponseHeader: function(name) {
             return this.transport.getResponseHeader(name);
           },
         
           getAllResponseHeaders: function() {
             return this.transport.getAllResponseHeaders();
           },
         
           _getHeaderJSON: function() {
             var json = this.getHeader(&#39;X-JSON&#39;);
             if (!json) return null;
             json = decodeURIComponent(escape(json));
             try {
               return json.evalJSON(this.request.options.sanitizeJSON ||
                 !this.request.isSameOrigin());
             } catch (e) {
               this.request.dispatchException(e);
             }
           },
         
           _getResponseJSON: function() {
             var options = this.request.options;
             if (!options.evalJSON || (options.evalJSON != &#39;force&#39; &amp;&amp;
               !(this.getHeader(&#39;Content-type&#39;) || &#39;&#39;).include(&#39;application/json&#39;)) ||
                 this.responseText.blank())
                   return null;
             try {
               return this.responseText.evalJSON(options.sanitizeJSON ||
                 !this.request.isSameOrigin());
             } catch (e) {
               this.request.dispatchException(e);
             }
           }
         });
         
         Ajax.Updater = Class.create(Ajax.Request, {
           initialize: function($super, container, url, options) {
             this.container = {
               success: (container.success || container),
               failure: (container.failure || (container.success ? null : container))
             };
         
             options = Object.clone(options);
             var onComplete = options.onComplete;
             options.onComplete = (function(response, json) {
               this.updateContent(response.responseText);
               if (Object.isFunction(onComplete)) onComplete(response, json);
             }).bind(this);
         
             $super(url, options);
           },
         
           updateContent: function(responseText) {
             var receiver = this.container[this.success() ? &#39;success&#39; : &#39;failure&#39;],
                 options = this.options;
         
             if (!options.evalScripts) responseText = responseText.stripScripts();
         
             if (receiver = $(receiver)) {
               if (options.insertion) {
                 if (Object.isString(options.insertion)) {
                   var insertion = { }; insertion[options.insertion] = responseText;
                   receiver.insert(insertion);
                 }
                 else options.insertion(receiver, responseText);
               }
               else receiver.update(responseText);
             }
           }
         });
         
         Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
           initialize: function($super, container, url, options) {
             $super(options);
             this.onComplete = this.options.onComplete;
         
             this.frequency = (this.options.frequency || 2);
             this.decay = (this.options.decay || 1);
         
             this.updater = { };
             this.container = container;
             this.url = url;
         
             this.start();
           },
         
           start: function() {
             this.options.onComplete = this.updateComplete.bind(this);
             this.onTimerEvent();
           },
         
           stop: function() {
             this.updater.options.onComplete = undefined;
             clearTimeout(this.timer);
             (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
           },
         
           updateComplete: function(response) {
             if (this.options.decay) {
               this.decay = (response.responseText == this.lastText ?
                 this.decay * this.options.decay : 1);
         
               this.lastText = response.responseText;
             }
             this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
           },
         
           onTimerEvent: function() {
             this.updater = new Ajax.Updater(this.container, this.url, this.options);
           }
         });
        <span class="gi">+</span>
        <span class="gi">+</span>
         function $(element) {
           if (arguments.length &gt; 1) {
             for (var i = 0, elements = [], length = arguments.length; i &lt; length; i++)
               elements.push($(arguments[i]));
             return elements;
           }
           if (Object.isString(element))
             element = document.getElementById(element);
           return Element.extend(element);
         }
         
         if (Prototype.BrowserFeatures.XPath) {
           document._getElementsByXPath = function(expression, parentElement) {
             var results = [];
             var query = document.evaluate(expression, $(parentElement) || document,
               null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
             for (var i = 0, length = query.snapshotLength; i &lt; length; i++)
               results.push(Element.extend(query.snapshotItem(i)));
             return results;
           };
         }
         
         /*--------------------------------------------------------------------------*/
         
        <span class="gd">-if (!window.Node) var Node = { };</span>
        <span class="gi">+if (!Node) var Node = { };</span>
         
         if (!Node.ELEMENT_NODE) {
        <span class="gd">-  // DOM level 2 ECMAScript Language Binding</span>
           Object.extend(Node, {
             ELEMENT_NODE: 1,
             ATTRIBUTE_NODE: 2,
             TEXT_NODE: 3,
             CDATA_SECTION_NODE: 4,
             ENTITY_REFERENCE_NODE: 5,
             ENTITY_NODE: 6,
             PROCESSING_INSTRUCTION_NODE: 7,
             COMMENT_NODE: 8,
             DOCUMENT_NODE: 9,
             DOCUMENT_TYPE_NODE: 10,
             DOCUMENT_FRAGMENT_NODE: 11,
             NOTATION_NODE: 12
           });
         }
         
        <span class="gd">-(function() {</span>
        <span class="gd">-  var element = this.Element;</span>
        <span class="gd">-  this.Element = function(tagName, attributes) {</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+(function(global) {</span>
        <span class="gi">+</span>
        <span class="gi">+  var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function(){</span>
        <span class="gi">+    try {</span>
        <span class="gi">+      var el = document.createElement(&#39;&lt;input name=&quot;x&quot;&gt;&#39;);</span>
        <span class="gi">+      return el.tagName.toLowerCase() === &#39;input&#39; &amp;&amp; el.name === &#39;x&#39;;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    catch(err) {</span>
        <span class="gi">+      return false;</span>
        <span class="gi">+    }</span>
        <span class="gi">+  })();</span>
        <span class="gi">+</span>
        <span class="gi">+  var element = global.Element;</span>
        <span class="gi">+</span>
        <span class="gi">+  global.Element = function(tagName, attributes) {</span>
             attributes = attributes || { };
             tagName = tagName.toLowerCase();
             var cache = Element.cache;
        <span class="gd">-    if (Prototype.Browser.IE &amp;&amp; attributes.name) {</span>
        <span class="gi">+    if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX &amp;&amp; attributes.name) {</span>
               tagName = &#39;&lt;&#39; + tagName + &#39; name=&quot;&#39; + attributes.name + &#39;&quot;&gt;&#39;;
               delete attributes.name;
               return Element.writeAttribute(document.createElement(tagName), attributes);
             }
             if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));
             return Element.writeAttribute(cache[tagName].cloneNode(false), attributes);
           };
        <span class="gd">-  Object.extend(this.Element, element || { });</span>
        <span class="gd">-  if (element) this.Element.prototype = element.prototype;</span>
        <span class="gd">-}).call(window);</span>
         
        <span class="gi">+  Object.extend(global.Element, element || { });</span>
        <span class="gi">+  if (element) global.Element.prototype = element.prototype;</span>
        <span class="gi">+</span>
        <span class="gi">+})(this);</span>
        <span class="gi">+</span>
        <span class="gi">+Element.idCounter = 1;</span>
         Element.cache = { };
         
        <span class="gi">+function purgeElement(element) {</span>
        <span class="gi">+  var uid = element._prototypeUID;</span>
        <span class="gi">+  if (uid) {</span>
        <span class="gi">+    Element.stopObserving(element);</span>
        <span class="gi">+    element._prototypeUID = void 0;</span>
        <span class="gi">+    delete Element.Storage[uid];</span>
        <span class="gi">+  }</span>
        <span class="gi">+}</span>
        <span class="gi">+</span>
         Element.Methods = {
           visible: function(element) {
             return $(element).style.display != &#39;none&#39;;
           },
         
           toggle: function(element) {
             element = $(element);
             Element[Element.visible(element) ? &#39;hide&#39; : &#39;show&#39;](element);
             return element;
           },
         
           hide: function(element) {
             element = $(element);
             element.style.display = &#39;none&#39;;
             return element;
           },
         
           show: function(element) {
             element = $(element);
             element.style.display = &#39;&#39;;
             return element;
           },
         
           remove: function(element) {
             element = $(element);
             element.parentNode.removeChild(element);
             return element;
           },
         
        <span class="gd">-  update: function(element, content) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gd">-    if (Object.isElement(content)) return element.update().insert(content);</span>
        <span class="gd">-    content = Object.toHTML(content);</span>
        <span class="gd">-    element.innerHTML = content.stripScripts();</span>
        <span class="gd">-    content.evalScripts.bind(content).defer();</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  update: (function(){</span>
         
        <span class="gd">-  replace: function(element, content) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gd">-    else if (!Object.isElement(content)) {</span>
        <span class="gd">-      content = Object.toHTML(content);</span>
        <span class="gd">-      var range = element.ownerDocument.createRange();</span>
        <span class="gd">-      range.selectNode(element);</span>
        <span class="gd">-      content.evalScripts.bind(content).defer();</span>
        <span class="gd">-      content = range.createContextualFragment(content.stripScripts());</span>
        <span class="gd">-    }</span>
        <span class="gd">-    element.parentNode.replaceChild(content, element);</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  },</span>
        <span class="gi">+    var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){</span>
        <span class="gi">+      var el = document.createElement(&quot;select&quot;),</span>
        <span class="gi">+          isBuggy = true;</span>
        <span class="gi">+      el.innerHTML = &quot;&lt;option value=\&quot;test\&quot;&gt;test&lt;/option&gt;&quot;;</span>
        <span class="gi">+      if (el.options &amp;&amp; el.options[0]) {</span>
        <span class="gi">+        isBuggy = el.options[0].nodeName.toUpperCase() !== &quot;OPTION&quot;;</span>
        <span class="gi">+      }</span>
        <span class="gi">+      el = null;</span>
        <span class="gi">+      return isBuggy;</span>
        <span class="gi">+    })();</span>
        <span class="gi">+</span>
        <span class="gi">+    var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){</span>
        <span class="gi">+      try {</span>
        <span class="gi">+        var el = document.createElement(&quot;table&quot;);</span>
        <span class="gi">+        if (el &amp;&amp; el.tBodies) {</span>
        <span class="gi">+          el.innerHTML = &quot;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;test&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&quot;;</span>
        <span class="gi">+          var isBuggy = typeof el.tBodies[0] == &quot;undefined&quot;;</span>
        <span class="gi">+          el = null;</span>
        <span class="gi">+          return isBuggy;</span>
        <span class="gi">+        }</span>
        <span class="gi">+      } catch (e) {</span>
        <span class="gi">+        return true;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    })();</span>
        <span class="gi">+</span>
        <span class="gi">+    var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {</span>
        <span class="gi">+      var s = document.createElement(&quot;script&quot;),</span>
        <span class="gi">+          isBuggy = false;</span>
        <span class="gi">+      try {</span>
        <span class="gi">+        s.appendChild(document.createTextNode(&quot;&quot;));</span>
        <span class="gi">+        isBuggy = !s.firstChild ||</span>
        <span class="gi">+          s.firstChild &amp;&amp; s.firstChild.nodeType !== 3;</span>
        <span class="gi">+      } catch (e) {</span>
        <span class="gi">+        isBuggy = true;</span>
        <span class="gi">+      }</span>
        <span class="gi">+      s = null;</span>
        <span class="gi">+      return isBuggy;</span>
        <span class="gi">+    })();</span>
        <span class="gi">+</span>
        <span class="gi">+    function update(element, content) {</span>
        <span class="gi">+      element = $(element);</span>
        <span class="gi">+</span>
        <span class="gi">+      var descendants = element.getElementsByTagName(&#39;*&#39;),</span>
        <span class="gi">+       i = descendants.length;</span>
        <span class="gi">+      while (i--) purgeElement(descendants[i]);</span>
        <span class="gi">+</span>
        <span class="gi">+      if (content &amp;&amp; content.toElement)</span>
        <span class="gi">+        content = content.toElement();</span>
        <span class="gi">+</span>
        <span class="gi">+      if (Object.isElement(content))</span>
        <span class="gi">+        return element.update().insert(content);</span>
        <span class="gi">+</span>
        <span class="gi">+      content = Object.toHTML(content);</span>
        <span class="gi">+</span>
        <span class="gi">+      var tagName = element.tagName.toUpperCase();</span>
        <span class="gi">+</span>
        <span class="gi">+      if (tagName === &#39;SCRIPT&#39; &amp;&amp; SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {</span>
        <span class="gi">+        element.text = content;</span>
        <span class="gi">+        return element;</span>
        <span class="gi">+      }</span>
        <span class="gi">+</span>
        <span class="gi">+      if (SELECT_ELEMENT_INNERHTML_BUGGY || TABLE_ELEMENT_INNERHTML_BUGGY) {</span>
        <span class="gi">+        if (tagName in Element._insertionTranslations.tags) {</span>
        <span class="gi">+          while (element.firstChild) {</span>
        <span class="gi">+            element.removeChild(element.firstChild);</span>
        <span class="gi">+          }</span>
        <span class="gi">+          Element._getContentFromAnonymousElement(tagName, content.stripScripts())</span>
        <span class="gi">+            .each(function(node) {</span>
        <span class="gi">+              element.appendChild(node)</span>
        <span class="gi">+            });</span>
        <span class="gi">+        }</span>
        <span class="gi">+        else {</span>
        <span class="gi">+          element.innerHTML = content.stripScripts();</span>
        <span class="gi">+        }</span>
        <span class="gi">+      }</span>
        <span class="gi">+      else {</span>
        <span class="gi">+        element.innerHTML = content.stripScripts();</span>
        <span class="gi">+      }</span>
        <span class="gi">+</span>
        <span class="gi">+      content.evalScripts.bind(content).defer();</span>
        <span class="gi">+      return element;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    return update;</span>
        <span class="gi">+  })(),</span>
        <span class="gi">+</span>
        <span class="gi">+  replace: function(element, content) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+    if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gi">+    else if (!Object.isElement(content)) {</span>
        <span class="gi">+      content = Object.toHTML(content);</span>
        <span class="gi">+      var range = element.ownerDocument.createRange();</span>
        <span class="gi">+      range.selectNode(element);</span>
        <span class="gi">+      content.evalScripts.bind(content).defer();</span>
        <span class="gi">+      content = range.createContextualFragment(content.stripScripts());</span>
        <span class="gi">+    }</span>
        <span class="gi">+    element.parentNode.replaceChild(content, element);</span>
        <span class="gi">+    return element;</span>
        <span class="gi">+  },</span>
         
           insert: function(element, insertions) {
             element = $(element);
         
             if (Object.isString(insertions) || Object.isNumber(insertions) ||
                 Object.isElement(insertions) || (insertions &amp;&amp; (insertions.toElement || insertions.toHTML)))
                   insertions = {bottom:insertions};
         
             var content, insert, tagName, childNodes;
         
             for (var position in insertions) {
               content  = insertions[position];
               position = position.toLowerCase();
               insert = Element._insertionTranslations[position];
         
               if (content &amp;&amp; content.toElement) content = content.toElement();
               if (Object.isElement(content)) {
                 insert(element, content);
                 continue;
               }
         
               content = Object.toHTML(content);
         
               tagName = ((position == &#39;before&#39; || position == &#39;after&#39;)
                 ? element.parentNode : element).tagName.toUpperCase();
         
               childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
         
               if (position == &#39;top&#39; || position == &#39;after&#39;) childNodes.reverse();
               childNodes.each(insert.curry(element));
         
               content.evalScripts.bind(content).defer();
             }
         
             return element;
           },
         
           wrap: function(element, wrapper, attributes) {
             element = $(element);
             if (Object.isElement(wrapper))
               $(wrapper).writeAttribute(attributes || { });
             else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
             else wrapper = new Element(&#39;div&#39;, wrapper);
             if (element.parentNode)
               element.parentNode.replaceChild(wrapper, element);
             wrapper.appendChild(element);
             return wrapper;
           },
         
           inspect: function(element) {
             element = $(element);
             var result = &#39;&lt;&#39; + element.tagName.toLowerCase();
             $H({&#39;id&#39;: &#39;id&#39;, &#39;className&#39;: &#39;class&#39;}).each(function(pair) {
        <span class="gd">-      var property = pair.first(), attribute = pair.last();</span>
        <span class="gd">-      var value = (element[property] || &#39;&#39;).toString();</span>
        <span class="gi">+      var property = pair.first(),</span>
        <span class="gi">+          attribute = pair.last(),</span>
        <span class="gi">+          value = (element[property] || &#39;&#39;).toString();</span>
               if (value) result += &#39; &#39; + attribute + &#39;=&#39; + value.inspect(true);
             });
             return result + &#39;&gt;&#39;;
           },
         
        <span class="gd">-  recursivelyCollect: function(element, property) {</span>
        <span class="gi">+  recursivelyCollect: function(element, property, maximumLength) {</span>
             element = $(element);
        <span class="gi">+    maximumLength = maximumLength || -1;</span>
             var elements = [];
        <span class="gd">-    while (element = element[property])</span>
        <span class="gi">+</span>
        <span class="gi">+    while (element = element[property]) {</span>
               if (element.nodeType == 1)
                 elements.push(Element.extend(element));
        <span class="gi">+      if (elements.length == maximumLength)</span>
        <span class="gi">+        break;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
             return elements;
           },
         
           ancestors: function(element) {
        <span class="gd">-    return $(element).recursivelyCollect(&#39;parentNode&#39;);</span>
        <span class="gi">+    return Element.recursivelyCollect(element, &#39;parentNode&#39;);</span>
           },
         
           descendants: function(element) {
        <span class="gd">-    return $(element).select(&quot;*&quot;);</span>
        <span class="gi">+    return Element.select(element, &quot;*&quot;);</span>
           },
         
           firstDescendant: function(element) {
             element = $(element).firstChild;
             while (element &amp;&amp; element.nodeType != 1) element = element.nextSibling;
             return $(element);
           },
         
           immediateDescendants: function(element) {
        <span class="gd">-    if (!(element = $(element).firstChild)) return [];</span>
        <span class="gd">-    while (element &amp;&amp; element.nodeType != 1) element = element.nextSibling;</span>
        <span class="gd">-    if (element) return [element].concat($(element).nextSiblings());</span>
        <span class="gd">-    return [];</span>
        <span class="gi">+    var results = [], child = $(element).firstChild;</span>
        <span class="gi">+    while (child) {</span>
        <span class="gi">+      if (child.nodeType === 1) {</span>
        <span class="gi">+        results.push(Element.extend(child));</span>
        <span class="gi">+      }</span>
        <span class="gi">+      child = child.nextSibling;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return results;</span>
           },
         
        <span class="gd">-  previousSiblings: function(element) {</span>
        <span class="gd">-    return $(element).recursivelyCollect(&#39;previousSibling&#39;);</span>
        <span class="gi">+  previousSiblings: function(element, maximumLength) {</span>
        <span class="gi">+    return Element.recursivelyCollect(element, &#39;previousSibling&#39;);</span>
           },
         
           nextSiblings: function(element) {
        <span class="gd">-    return $(element).recursivelyCollect(&#39;nextSibling&#39;);</span>
        <span class="gi">+    return Element.recursivelyCollect(element, &#39;nextSibling&#39;);</span>
           },
         
           siblings: function(element) {
             element = $(element);
        <span class="gd">-    return element.previousSiblings().reverse().concat(element.nextSiblings());</span>
        <span class="gi">+    return Element.previousSiblings(element).reverse()</span>
        <span class="gi">+      .concat(Element.nextSiblings(element));</span>
           },
         
           match: function(element, selector) {
        <span class="gi">+    element = $(element);</span>
             if (Object.isString(selector))
        <span class="gd">-      selector = new Selector(selector);</span>
        <span class="gd">-    return selector.match($(element));</span>
        <span class="gi">+      return Prototype.Selector.match(element, selector);</span>
        <span class="gi">+    return selector.match(element);</span>
           },
         
           up: function(element, expression, index) {
             element = $(element);
             if (arguments.length == 1) return $(element.parentNode);
        <span class="gd">-    var ancestors = element.ancestors();</span>
        <span class="gi">+    var ancestors = Element.ancestors(element);</span>
             return Object.isNumber(expression) ? ancestors[expression] :
        <span class="gd">-      Selector.findElement(ancestors, expression, index);</span>
        <span class="gi">+      Prototype.Selector.find(ancestors, expression, index);</span>
           },
         
           down: function(element, expression, index) {
             element = $(element);
        <span class="gd">-    if (arguments.length == 1) return element.firstDescendant();</span>
        <span class="gd">-    return Object.isNumber(expression) ? element.descendants()[expression] :</span>
        <span class="gi">+    if (arguments.length == 1) return Element.firstDescendant(element);</span>
        <span class="gi">+    return Object.isNumber(expression) ? Element.descendants(element)[expression] :</span>
               Element.select(element, expression)[index || 0];
           },
         
           previous: function(element, expression, index) {
             element = $(element);
        <span class="gd">-    if (arguments.length == 1) return $(Selector.handlers.previousElementSibling(element));</span>
        <span class="gd">-    var previousSiblings = element.previousSiblings();</span>
        <span class="gd">-    return Object.isNumber(expression) ? previousSiblings[expression] :</span>
        <span class="gd">-      Selector.findElement(previousSiblings, expression, index);</span>
        <span class="gi">+    if (Object.isNumber(expression)) index = expression, expression = false;</span>
        <span class="gi">+    if (!Object.isNumber(index)) index = 0;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (expression) {</span>
        <span class="gi">+      return Prototype.Selector.find(element.previousSiblings(), expression, index);</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      return element.recursivelyCollect(&quot;previousSibling&quot;, index + 1)[index];</span>
        <span class="gi">+    }</span>
           },
         
           next: function(element, expression, index) {
             element = $(element);
        <span class="gd">-    if (arguments.length == 1) return $(Selector.handlers.nextElementSibling(element));</span>
        <span class="gd">-    var nextSiblings = element.nextSiblings();</span>
        <span class="gd">-    return Object.isNumber(expression) ? nextSiblings[expression] :</span>
        <span class="gd">-      Selector.findElement(nextSiblings, expression, index);</span>
        <span class="gi">+    if (Object.isNumber(expression)) index = expression, expression = false;</span>
        <span class="gi">+    if (!Object.isNumber(index)) index = 0;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (expression) {</span>
        <span class="gi">+      return Prototype.Selector.find(element.nextSiblings(), expression, index);</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      var maximumLength = Object.isNumber(index) ? index + 1 : 1;</span>
        <span class="gi">+      return element.recursivelyCollect(&quot;nextSibling&quot;, index + 1)[index];</span>
        <span class="gi">+    }</span>
           },
         
        <span class="gd">-  select: function() {</span>
        <span class="gd">-    var args = $A(arguments), element = $(args.shift());</span>
        <span class="gd">-    return Selector.findChildElements(element, args);</span>
        <span class="gi">+</span>
        <span class="gi">+  select: function(element) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+    var expressions = Array.prototype.slice.call(arguments, 1).join(&#39;, &#39;);</span>
        <span class="gi">+    return Prototype.Selector.select(expressions, element);</span>
           },
         
        <span class="gd">-  adjacent: function() {</span>
        <span class="gd">-    var args = $A(arguments), element = $(args.shift());</span>
        <span class="gd">-    return Selector.findChildElements(element.parentNode, args).without(element);</span>
        <span class="gi">+  adjacent: function(element) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+    var expressions = Array.prototype.slice.call(arguments, 1).join(&#39;, &#39;);</span>
        <span class="gi">+    return Prototype.Selector.select(expressions, element.parentNode).without(element);</span>
           },
         
           identify: function(element) {
             element = $(element);
        <span class="gd">-    var id = element.readAttribute(&#39;id&#39;), self = arguments.callee;</span>
        <span class="gi">+    var id = Element.readAttribute(element, &#39;id&#39;);</span>
             if (id) return id;
        <span class="gd">-    do { id = &#39;anonymous_element_&#39; + self.counter++ } while ($(id));</span>
        <span class="gd">-    element.writeAttribute(&#39;id&#39;, id);</span>
        <span class="gi">+    do { id = &#39;anonymous_element_&#39; + Element.idCounter++ } while ($(id));</span>
        <span class="gi">+    Element.writeAttribute(element, &#39;id&#39;, id);</span>
             return id;
           },
         
           readAttribute: function(element, name) {
             element = $(element);
             if (Prototype.Browser.IE) {
               var t = Element._attributeTranslations.read;
               if (t.values[name]) return t.values[name](element, name);
               if (t.names[name]) name = t.names[name];
               if (name.include(&#39;:&#39;)) {
                 return (!element.attributes || !element.attributes[name]) ? null :
                  element.attributes[name].value;
               }
             }
             return element.getAttribute(name);
           },
         
           writeAttribute: function(element, name, value) {
             element = $(element);
             var attributes = { }, t = Element._attributeTranslations.write;
         
             if (typeof name == &#39;object&#39;) attributes = name;
             else attributes[name] = Object.isUndefined(value) ? true : value;
         
             for (var attr in attributes) {
               name = t.names[attr] || attr;
               value = attributes[attr];
               if (t.values[attr]) name = t.values[attr](element, value);
               if (value === false || value === null)
                 element.removeAttribute(name);
               else if (value === true)
                 element.setAttribute(name, name);
               else element.setAttribute(name, value);
             }
             return element;
           },
         
           getHeight: function(element) {
        <span class="gd">-    return $(element).getDimensions().height;</span>
        <span class="gi">+    return Element.getDimensions(element).height;</span>
           },
         
           getWidth: function(element) {
        <span class="gd">-    return $(element).getDimensions().width;</span>
        <span class="gi">+    return Element.getDimensions(element).width;</span>
           },
         
           classNames: function(element) {
             return new Element.ClassNames(element);
           },
         
           hasClassName: function(element, className) {
             if (!(element = $(element))) return;
             var elementClassName = element.className;
             return (elementClassName.length &gt; 0 &amp;&amp; (elementClassName == className ||
               new RegExp(&quot;(^|\\s)&quot; + className + &quot;(\\s|$)&quot;).test(elementClassName)));
           },
         
           addClassName: function(element, className) {
             if (!(element = $(element))) return;
        <span class="gd">-    if (!element.hasClassName(className))</span>
        <span class="gi">+    if (!Element.hasClassName(element, className))</span>
               element.className += (element.className ? &#39; &#39; : &#39;&#39;) + className;
             return element;
           },
         
           removeClassName: function(element, className) {
             if (!(element = $(element))) return;
             element.className = element.className.replace(
               new RegExp(&quot;(^|\\s+)&quot; + className + &quot;(\\s+|$)&quot;), &#39; &#39;).strip();
             return element;
           },
         
           toggleClassName: function(element, className) {
             if (!(element = $(element))) return;
        <span class="gd">-    return element[element.hasClassName(className) ?</span>
        <span class="gd">-      &#39;removeClassName&#39; : &#39;addClassName&#39;](className);</span>
        <span class="gi">+    return Element[Element.hasClassName(element, className) ?</span>
        <span class="gi">+      &#39;removeClassName&#39; : &#39;addClassName&#39;](element, className);</span>
           },
         
        <span class="gd">-  // removes whitespace-only text node children</span>
           cleanWhitespace: function(element) {
             element = $(element);
             var node = element.firstChild;
             while (node) {
               var nextNode = node.nextSibling;
               if (node.nodeType == 3 &amp;&amp; !/\S/.test(node.nodeValue))
                 element.removeChild(node);
               node = nextNode;
             }
             return element;
           },
         
           empty: function(element) {
             return $(element).innerHTML.blank();
           },
         
           descendantOf: function(element, ancestor) {
             element = $(element), ancestor = $(ancestor);
         
             if (element.compareDocumentPosition)
               return (element.compareDocumentPosition(ancestor) &amp; 8) === 8;
         
             if (ancestor.contains)
               return ancestor.contains(element) &amp;&amp; ancestor !== element;
         
             while (element = element.parentNode)
               if (element == ancestor) return true;
         
             return false;
           },
         
           scrollTo: function(element) {
             element = $(element);
        <span class="gd">-    var pos = element.cumulativeOffset();</span>
        <span class="gi">+    var pos = Element.cumulativeOffset(element);</span>
             window.scrollTo(pos[0], pos[1]);
             return element;
           },
         
           getStyle: function(element, style) {
             element = $(element);
             style = style == &#39;float&#39; ? &#39;cssFloat&#39; : style.camelize();
             var value = element.style[style];
             if (!value || value == &#39;auto&#39;) {
               var css = document.defaultView.getComputedStyle(element, null);
               value = css ? css[style] : null;
             }
             if (style == &#39;opacity&#39;) return value ? parseFloat(value) : 1.0;
             return value == &#39;auto&#39; ? null : value;
           },
         
           getOpacity: function(element) {
             return $(element).getStyle(&#39;opacity&#39;);
           },
         
           setStyle: function(element, styles) {
             element = $(element);
             var elementStyle = element.style, match;
             if (Object.isString(styles)) {
               element.style.cssText += &#39;;&#39; + styles;
               return styles.include(&#39;opacity&#39;) ?
                 element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;
             }
             for (var property in styles)
               if (property == &#39;opacity&#39;) element.setOpacity(styles[property]);
               else
                 elementStyle[(property == &#39;float&#39; || property == &#39;cssFloat&#39;) ?
                   (Object.isUndefined(elementStyle.styleFloat) ? &#39;cssFloat&#39; : &#39;styleFloat&#39;) :
                     property] = styles[property];
         
             return element;
           },
         
           setOpacity: function(element, value) {
             element = $(element);
             element.style.opacity = (value == 1 || value === &#39;&#39;) ? &#39;&#39; :
               (value &lt; 0.00001) ? 0 : value;
             return element;
           },
         
        <span class="gd">-  getDimensions: function(element) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-    var display = element.getStyle(&#39;display&#39;);</span>
        <span class="gd">-    if (display != &#39;none&#39; &amp;&amp; display != null) // Safari bug</span>
        <span class="gd">-      return {width: element.offsetWidth, height: element.offsetHeight};</span>
        <span class="gd">-</span>
        <span class="gd">-    // All *Width and *Height properties give 0 on elements with display none,</span>
        <span class="gd">-    // so enable the element temporarily</span>
        <span class="gd">-    var els = element.style;</span>
        <span class="gd">-    var originalVisibility = els.visibility;</span>
        <span class="gd">-    var originalPosition = els.position;</span>
        <span class="gd">-    var originalDisplay = els.display;</span>
        <span class="gd">-    els.visibility = &#39;hidden&#39;;</span>
        <span class="gd">-    els.position = &#39;absolute&#39;;</span>
        <span class="gd">-    els.display = &#39;block&#39;;</span>
        <span class="gd">-    var originalWidth = element.clientWidth;</span>
        <span class="gd">-    var originalHeight = element.clientHeight;</span>
        <span class="gd">-    els.display = originalDisplay;</span>
        <span class="gd">-    els.position = originalPosition;</span>
        <span class="gd">-    els.visibility = originalVisibility;</span>
        <span class="gd">-    return {width: originalWidth, height: originalHeight};</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
           makePositioned: function(element) {
             element = $(element);
             var pos = Element.getStyle(element, &#39;position&#39;);
             if (pos == &#39;static&#39; || !pos) {
               element._madePositioned = true;
               element.style.position = &#39;relative&#39;;
        <span class="gd">-      // Opera returns the offset relative to the positioning context, when an</span>
        <span class="gd">-      // element is position relative but top and left have not been defined</span>
               if (Prototype.Browser.Opera) {
                 element.style.top = 0;
                 element.style.left = 0;
               }
             }
             return element;
           },
         
           undoPositioned: function(element) {
             element = $(element);
             if (element._madePositioned) {
               element._madePositioned = undefined;
               element.style.position =
                 element.style.top =
                 element.style.left =
                 element.style.bottom =
                 element.style.right = &#39;&#39;;
             }
             return element;
           },
         
           makeClipping: function(element) {
             element = $(element);
             if (element._overflow) return element;
             element._overflow = Element.getStyle(element, &#39;overflow&#39;) || &#39;auto&#39;;
             if (element._overflow !== &#39;hidden&#39;)
               element.style.overflow = &#39;hidden&#39;;
             return element;
           },
         
           undoClipping: function(element) {
             element = $(element);
             if (!element._overflow) return element;
             element.style.overflow = element._overflow == &#39;auto&#39; ? &#39;&#39; : element._overflow;
             element._overflow = null;
             return element;
           },
         
           cumulativeOffset: function(element) {
             var valueT = 0, valueL = 0;
        <span class="gd">-    do {</span>
        <span class="gd">-      valueT += element.offsetTop  || 0;</span>
        <span class="gd">-      valueL += element.offsetLeft || 0;</span>
        <span class="gd">-      element = element.offsetParent;</span>
        <span class="gd">-    } while (element);</span>
        <span class="gi">+    if (element.parentNode) {</span>
        <span class="gi">+      do {</span>
        <span class="gi">+        valueT += element.offsetTop  || 0;</span>
        <span class="gi">+        valueL += element.offsetLeft || 0;</span>
        <span class="gi">+        element = element.offsetParent;</span>
        <span class="gi">+      } while (element);</span>
        <span class="gi">+    }</span>
             return Element._returnOffset(valueL, valueT);
           },
         
           positionedOffset: function(element) {
             var valueT = 0, valueL = 0;
             do {
               valueT += element.offsetTop  || 0;
               valueL += element.offsetLeft || 0;
               element = element.offsetParent;
               if (element) {
                 if (element.tagName.toUpperCase() == &#39;BODY&#39;) break;
                 var p = Element.getStyle(element, &#39;position&#39;);
                 if (p !== &#39;static&#39;) break;
               }
             } while (element);
             return Element._returnOffset(valueL, valueT);
           },
         
           absolutize: function(element) {
             element = $(element);
        <span class="gd">-    if (element.getStyle(&#39;position&#39;) == &#39;absolute&#39;) return element;</span>
        <span class="gd">-    // Position.prepare(); // To be done manually by Scripty when it needs it.</span>
        <span class="gi">+    if (Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) return element;</span>
         
        <span class="gd">-    var offsets = element.positionedOffset();</span>
        <span class="gd">-    var top     = offsets[1];</span>
        <span class="gd">-    var left    = offsets[0];</span>
        <span class="gd">-    var width   = element.clientWidth;</span>
        <span class="gd">-    var height  = element.clientHeight;</span>
        <span class="gi">+    var offsets = Element.positionedOffset(element),</span>
        <span class="gi">+        top     = offsets[1],</span>
        <span class="gi">+        left    = offsets[0],</span>
        <span class="gi">+        width   = element.clientWidth,</span>
        <span class="gi">+        height  = element.clientHeight;</span>
         
             element._originalLeft   = left - parseFloat(element.style.left  || 0);
             element._originalTop    = top  - parseFloat(element.style.top || 0);
             element._originalWidth  = element.style.width;
             element._originalHeight = element.style.height;
         
             element.style.position = &#39;absolute&#39;;
             element.style.top    = top + &#39;px&#39;;
             element.style.left   = left + &#39;px&#39;;
             element.style.width  = width + &#39;px&#39;;
             element.style.height = height + &#39;px&#39;;
             return element;
           },
         
           relativize: function(element) {
             element = $(element);
        <span class="gd">-    if (element.getStyle(&#39;position&#39;) == &#39;relative&#39;) return element;</span>
        <span class="gd">-    // Position.prepare(); // To be done manually by Scripty when it needs it.</span>
        <span class="gi">+    if (Element.getStyle(element, &#39;position&#39;) == &#39;relative&#39;) return element;</span>
         
             element.style.position = &#39;relative&#39;;
        <span class="gd">-    var top  = parseFloat(element.style.top  || 0) - (element._originalTop || 0);</span>
        <span class="gd">-    var left = parseFloat(element.style.left || 0) - (element._originalLeft || 0);</span>
        <span class="gi">+    var top  = parseFloat(element.style.top  || 0) - (element._originalTop || 0),</span>
        <span class="gi">+        left = parseFloat(element.style.left || 0) - (element._originalLeft || 0);</span>
         
             element.style.top    = top + &#39;px&#39;;
             element.style.left   = left + &#39;px&#39;;
             element.style.height = element._originalHeight;
             element.style.width  = element._originalWidth;
             return element;
           },
         
           cumulativeScrollOffset: function(element) {
             var valueT = 0, valueL = 0;
             do {
               valueT += element.scrollTop  || 0;
               valueL += element.scrollLeft || 0;
               element = element.parentNode;
             } while (element);
             return Element._returnOffset(valueL, valueT);
           },
         
           getOffsetParent: function(element) {
             if (element.offsetParent) return $(element.offsetParent);
             if (element == document.body) return $(element);
         
             while ((element = element.parentNode) &amp;&amp; element != document.body)
               if (Element.getStyle(element, &#39;position&#39;) != &#39;static&#39;)
                 return $(element);
         
             return $(document.body);
           },
         
           viewportOffset: function(forElement) {
        <span class="gd">-    var valueT = 0, valueL = 0;</span>
        <span class="gi">+    var valueT = 0,</span>
        <span class="gi">+        valueL = 0,</span>
        <span class="gi">+        element = forElement;</span>
         
        <span class="gd">-    var element = forElement;</span>
             do {
               valueT += element.offsetTop  || 0;
               valueL += element.offsetLeft || 0;
         
        <span class="gd">-      // Safari fix</span>
               if (element.offsetParent == document.body &amp;&amp;
                 Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) break;
         
             } while (element = element.offsetParent);
         
             element = forElement;
             do {
               if (!Prototype.Browser.Opera || (element.tagName &amp;&amp; (element.tagName.toUpperCase() == &#39;BODY&#39;))) {
                 valueT -= element.scrollTop  || 0;
                 valueL -= element.scrollLeft || 0;
               }
             } while (element = element.parentNode);
         
             return Element._returnOffset(valueL, valueT);
           },
         
           clonePosition: function(element, source) {
             var options = Object.extend({
               setLeft:    true,
               setTop:     true,
               setWidth:   true,
               setHeight:  true,
               offsetTop:  0,
               offsetLeft: 0
             }, arguments[2] || { });
         
        <span class="gd">-    // find page position of source</span>
             source = $(source);
        <span class="gd">-    var p = source.viewportOffset();</span>
        <span class="gi">+    var p = Element.viewportOffset(source), delta = [0, 0], parent = null;</span>
         
        <span class="gd">-    // find coordinate system to use</span>
             element = $(element);
        <span class="gd">-    var delta = [0, 0];</span>
        <span class="gd">-    var parent = null;</span>
        <span class="gd">-    // delta [0,0] will do fine with position: fixed elements,</span>
        <span class="gd">-    // position:absolute needs offsetParent deltas</span>
        <span class="gi">+</span>
             if (Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) {
        <span class="gd">-      parent = element.getOffsetParent();</span>
        <span class="gd">-      delta = parent.viewportOffset();</span>
        <span class="gi">+      parent = Element.getOffsetParent(element);</span>
        <span class="gi">+      delta = Element.viewportOffset(parent);</span>
             }
         
        <span class="gd">-    // correct by body offsets (fixes Safari)</span>
             if (parent == document.body) {
               delta[0] -= document.body.offsetLeft;
               delta[1] -= document.body.offsetTop;
             }
         
        <span class="gd">-    // set position</span>
             if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + &#39;px&#39;;
             if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + &#39;px&#39;;
             if (options.setWidth)  element.style.width = source.offsetWidth + &#39;px&#39;;
             if (options.setHeight) element.style.height = source.offsetHeight + &#39;px&#39;;
             return element;
           }
         };
         
        <span class="gd">-Element.Methods.identify.counter = 1;</span>
        <span class="gd">-</span>
         Object.extend(Element.Methods, {
           getElementsBySelector: Element.Methods.select,
        <span class="gi">+</span>
           childElements: Element.Methods.immediateDescendants
         });
         
         Element._attributeTranslations = {
           write: {
             names: {
               className: &#39;class&#39;,
               htmlFor:   &#39;for&#39;
             },
             values: { }
           }
         };
         
         if (Prototype.Browser.Opera) {
           Element.Methods.getStyle = Element.Methods.getStyle.wrap(
             function(proceed, element, style) {
               switch (style) {
                 case &#39;left&#39;: case &#39;top&#39;: case &#39;right&#39;: case &#39;bottom&#39;:
                   if (proceed(element, &#39;position&#39;) === &#39;static&#39;) return null;
                 case &#39;height&#39;: case &#39;width&#39;:
        <span class="gd">-          // returns &#39;0px&#39; for hidden elements; we want it to return null</span>
                   if (!Element.visible(element)) return null;
         
        <span class="gd">-          // returns the border-box dimensions rather than the content-box</span>
        <span class="gd">-          // dimensions, so we subtract padding and borders from the value</span>
                   var dim = parseInt(proceed(element, style), 10);
         
                   if (dim !== element[&#39;offset&#39; + style.capitalize()])
                     return dim + &#39;px&#39;;
         
                   var properties;
                   if (style === &#39;height&#39;) {
                     properties = [&#39;border-top-width&#39;, &#39;padding-top&#39;,
                      &#39;padding-bottom&#39;, &#39;border-bottom-width&#39;];
                   }
                   else {
                     properties = [&#39;border-left-width&#39;, &#39;padding-left&#39;,
                      &#39;padding-right&#39;, &#39;border-right-width&#39;];
                   }
                   return properties.inject(dim, function(memo, property) {
                     var val = proceed(element, property);
                     return val === null ? memo : memo - parseInt(val, 10);
                   }) + &#39;px&#39;;
                 default: return proceed(element, style);
               }
             }
           );
         
           Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
             function(proceed, element, attribute) {
               if (attribute === &#39;title&#39;) return element.title;
               return proceed(element, attribute);
             }
           );
         }
         
         else if (Prototype.Browser.IE) {
        <span class="gd">-  // IE doesn&#39;t report offsets correctly for static elements, so we change them</span>
        <span class="gd">-  // to &quot;relative&quot; to get the values, then change them back.</span>
           Element.Methods.getOffsetParent = Element.Methods.getOffsetParent.wrap(
             function(proceed, element) {
               element = $(element);
        <span class="gd">-      // IE throws an error if element is not in document</span>
        <span class="gd">-      try { element.offsetParent }</span>
        <span class="gd">-      catch(e) { return $(document.body) }</span>
        <span class="gi">+      if (!element.parentNode) return $(document.body);</span>
               var position = element.getStyle(&#39;position&#39;);
               if (position !== &#39;static&#39;) return proceed(element);
               element.setStyle({ position: &#39;relative&#39; });
               var value = proceed(element);
               element.setStyle({ position: position });
               return value;
             }
           );
         
           $w(&#39;positionedOffset viewportOffset&#39;).each(function(method) {
             Element.Methods[method] = Element.Methods[method].wrap(
               function(proceed, element) {
                 element = $(element);
        <span class="gd">-        try { element.offsetParent }</span>
        <span class="gd">-        catch(e) { return Element._returnOffset(0,0) }</span>
        <span class="gi">+        if (!element.parentNode) return Element._returnOffset(0, 0);</span>
                 var position = element.getStyle(&#39;position&#39;);
                 if (position !== &#39;static&#39;) return proceed(element);
        <span class="gd">-        // Trigger hasLayout on the offset parent so that IE6 reports</span>
        <span class="gd">-        // accurate offsetTop and offsetLeft values for position: fixed.</span>
                 var offsetParent = element.getOffsetParent();
                 if (offsetParent &amp;&amp; offsetParent.getStyle(&#39;position&#39;) === &#39;fixed&#39;)
                   offsetParent.setStyle({ zoom: 1 });
                 element.setStyle({ position: &#39;relative&#39; });
                 var value = proceed(element);
                 element.setStyle({ position: position });
                 return value;
               }
             );
           });
         
        <span class="gd">-  Element.Methods.cumulativeOffset = Element.Methods.cumulativeOffset.wrap(</span>
        <span class="gd">-    function(proceed, element) {</span>
        <span class="gd">-      try { element.offsetParent }</span>
        <span class="gd">-      catch(e) { return Element._returnOffset(0,0) }</span>
        <span class="gd">-      return proceed(element);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  );</span>
        <span class="gd">-</span>
           Element.Methods.getStyle = function(element, style) {
             element = $(element);
             style = (style == &#39;float&#39; || style == &#39;cssFloat&#39;) ? &#39;styleFloat&#39; : style.camelize();
             var value = element.style[style];
             if (!value &amp;&amp; element.currentStyle) value = element.currentStyle[style];
         
             if (style == &#39;opacity&#39;) {
               if (value = (element.getStyle(&#39;filter&#39;) || &#39;&#39;).match(/alpha\(opacity=(.*)\)/))
                 if (value[1]) return parseFloat(value[1]) / 100;
               return 1.0;
             }
         
             if (value == &#39;auto&#39;) {
               if ((style == &#39;width&#39; || style == &#39;height&#39;) &amp;&amp; (element.getStyle(&#39;display&#39;) != &#39;none&#39;))
                 return element[&#39;offset&#39; + style.capitalize()] + &#39;px&#39;;
               return null;
             }
             return value;
           };
         
           Element.Methods.setOpacity = function(element, value) {
             function stripAlpha(filter){
               return filter.replace(/alpha\([^\)]*\)/gi,&#39;&#39;);
             }
             element = $(element);
             var currentStyle = element.currentStyle;
             if ((currentStyle &amp;&amp; !currentStyle.hasLayout) ||
               (!currentStyle &amp;&amp; element.style.zoom == &#39;normal&#39;))
                 element.style.zoom = 1;
         
             var filter = element.getStyle(&#39;filter&#39;), style = element.style;
             if (value == 1 || value === &#39;&#39;) {
               (filter = stripAlpha(filter)) ?
                 style.filter = filter : style.removeAttribute(&#39;filter&#39;);
               return element;
             } else if (value &lt; 0.00001) value = 0;
             style.filter = stripAlpha(filter) +
               &#39;alpha(opacity=&#39; + (value * 100) + &#39;)&#39;;
             return element;
           };
         
        <span class="gd">-  Element._attributeTranslations = {</span>
        <span class="gd">-    read: {</span>
        <span class="gd">-      names: {</span>
        <span class="gd">-        &#39;class&#39;: &#39;className&#39;,</span>
        <span class="gd">-        &#39;for&#39;:   &#39;htmlFor&#39;</span>
        <span class="gd">-      },</span>
        <span class="gd">-      values: {</span>
        <span class="gd">-        _getAttr: function(element, attribute) {</span>
        <span class="gd">-          return element.getAttribute(attribute, 2);</span>
        <span class="gd">-        },</span>
        <span class="gd">-        _getAttrNode: function(element, attribute) {</span>
        <span class="gd">-          var node = element.getAttributeNode(attribute);</span>
        <span class="gd">-          return node ? node.value : &quot;&quot;;</span>
        <span class="gd">-        },</span>
        <span class="gd">-        _getEv: function(element, attribute) {</span>
        <span class="gd">-          attribute = element.getAttribute(attribute);</span>
        <span class="gd">-          return attribute ? attribute.toString().slice(23, -2) : null;</span>
        <span class="gd">-        },</span>
        <span class="gd">-        _flag: function(element, attribute) {</span>
        <span class="gd">-          return $(element).hasAttribute(attribute) ? attribute : null;</span>
        <span class="gd">-        },</span>
        <span class="gd">-        style: function(element) {</span>
        <span class="gd">-          return element.style.cssText.toLowerCase();</span>
        <span class="gi">+  Element._attributeTranslations = (function(){</span>
        <span class="gi">+</span>
        <span class="gi">+    var classProp = &#39;className&#39;,</span>
        <span class="gi">+        forProp = &#39;for&#39;,</span>
        <span class="gi">+        el = document.createElement(&#39;div&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+    el.setAttribute(classProp, &#39;x&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (el.className !== &#39;x&#39;) {</span>
        <span class="gi">+      el.setAttribute(&#39;class&#39;, &#39;x&#39;);</span>
        <span class="gi">+      if (el.className === &#39;x&#39;) {</span>
        <span class="gi">+        classProp = &#39;class&#39;;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
        <span class="gi">+    el = null;</span>
        <span class="gi">+</span>
        <span class="gi">+    el = document.createElement(&#39;label&#39;);</span>
        <span class="gi">+    el.setAttribute(forProp, &#39;x&#39;);</span>
        <span class="gi">+    if (el.htmlFor !== &#39;x&#39;) {</span>
        <span class="gi">+      el.setAttribute(&#39;htmlFor&#39;, &#39;x&#39;);</span>
        <span class="gi">+      if (el.htmlFor === &#39;x&#39;) {</span>
        <span class="gi">+        forProp = &#39;htmlFor&#39;;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
        <span class="gi">+    el = null;</span>
        <span class="gi">+</span>
        <span class="gi">+    return {</span>
        <span class="gi">+      read: {</span>
        <span class="gi">+        names: {</span>
        <span class="gi">+          &#39;class&#39;:      classProp,</span>
        <span class="gi">+          &#39;className&#39;:  classProp,</span>
        <span class="gi">+          &#39;for&#39;:        forProp,</span>
        <span class="gi">+          &#39;htmlFor&#39;:    forProp</span>
                 },
        <span class="gd">-        title: function(element) {</span>
        <span class="gd">-          return element.title;</span>
        <span class="gi">+        values: {</span>
        <span class="gi">+          _getAttr: function(element, attribute) {</span>
        <span class="gi">+            return element.getAttribute(attribute);</span>
        <span class="gi">+          },</span>
        <span class="gi">+          _getAttr2: function(element, attribute) {</span>
        <span class="gi">+            return element.getAttribute(attribute, 2);</span>
        <span class="gi">+          },</span>
        <span class="gi">+          _getAttrNode: function(element, attribute) {</span>
        <span class="gi">+            var node = element.getAttributeNode(attribute);</span>
        <span class="gi">+            return node ? node.value : &quot;&quot;;</span>
        <span class="gi">+          },</span>
        <span class="gi">+          _getEv: (function(){</span>
        <span class="gi">+</span>
        <span class="gi">+            var el = document.createElement(&#39;div&#39;), f;</span>
        <span class="gi">+            el.onclick = Prototype.emptyFunction;</span>
        <span class="gi">+            var value = el.getAttribute(&#39;onclick&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+            if (String(value).indexOf(&#39;{&#39;) &gt; -1) {</span>
        <span class="gi">+              f = function(element, attribute) {</span>
        <span class="gi">+                attribute = element.getAttribute(attribute);</span>
        <span class="gi">+                if (!attribute) return null;</span>
        <span class="gi">+                attribute = attribute.toString();</span>
        <span class="gi">+                attribute = attribute.split(&#39;{&#39;)[1];</span>
        <span class="gi">+                attribute = attribute.split(&#39;}&#39;)[0];</span>
        <span class="gi">+                return attribute.strip();</span>
        <span class="gi">+              };</span>
        <span class="gi">+            }</span>
        <span class="gi">+            else if (value === &#39;&#39;) {</span>
        <span class="gi">+              f = function(element, attribute) {</span>
        <span class="gi">+                attribute = element.getAttribute(attribute);</span>
        <span class="gi">+                if (!attribute) return null;</span>
        <span class="gi">+                return attribute.strip();</span>
        <span class="gi">+              };</span>
        <span class="gi">+            }</span>
        <span class="gi">+            el = null;</span>
        <span class="gi">+            return f;</span>
        <span class="gi">+          })(),</span>
        <span class="gi">+          _flag: function(element, attribute) {</span>
        <span class="gi">+            return $(element).hasAttribute(attribute) ? attribute : null;</span>
        <span class="gi">+          },</span>
        <span class="gi">+          style: function(element) {</span>
        <span class="gi">+            return element.style.cssText.toLowerCase();</span>
        <span class="gi">+          },</span>
        <span class="gi">+          title: function(element) {</span>
        <span class="gi">+            return element.title;</span>
        <span class="gi">+          }</span>
                 }
               }
             }
        <span class="gd">-  };</span>
        <span class="gi">+  })();</span>
         
           Element._attributeTranslations.write = {
             names: Object.extend({
               cellpadding: &#39;cellPadding&#39;,
               cellspacing: &#39;cellSpacing&#39;
             }, Element._attributeTranslations.read.names),
             values: {
               checked: function(element, value) {
                 element.checked = !!value;
               },
         
               style: function(element, value) {
                 element.style.cssText = value ? value : &#39;&#39;;
               }
             }
           };
         
           Element._attributeTranslations.has = {};
         
           $w(&#39;colSpan rowSpan vAlign dateTime accessKey tabIndex &#39; +
               &#39;encType maxLength readOnly longDesc frameBorder&#39;).each(function(attr) {
             Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
             Element._attributeTranslations.has[attr.toLowerCase()] = attr;
           });
         
           (function(v) {
             Object.extend(v, {
        <span class="gd">-      href:        v._getAttr,</span>
        <span class="gd">-      src:         v._getAttr,</span>
        <span class="gi">+      href:        v._getAttr2,</span>
        <span class="gi">+      src:         v._getAttr2,</span>
               type:        v._getAttr,
               action:      v._getAttrNode,
               disabled:    v._flag,
               checked:     v._flag,
               readonly:    v._flag,
               multiple:    v._flag,
               onload:      v._getEv,
               onunload:    v._getEv,
               onclick:     v._getEv,
               ondblclick:  v._getEv,
               onmousedown: v._getEv,
               onmouseup:   v._getEv,
               onmouseover: v._getEv,
               onmousemove: v._getEv,
               onmouseout:  v._getEv,
               onfocus:     v._getEv,
               onblur:      v._getEv,
               onkeypress:  v._getEv,
               onkeydown:   v._getEv,
               onkeyup:     v._getEv,
               onsubmit:    v._getEv,
               onreset:     v._getEv,
               onselect:    v._getEv,
               onchange:    v._getEv
             });
           })(Element._attributeTranslations.read.values);
        <span class="gi">+</span>
        <span class="gi">+  if (Prototype.BrowserFeatures.ElementExtensions) {</span>
        <span class="gi">+    (function() {</span>
        <span class="gi">+      function _descendants(element) {</span>
        <span class="gi">+        var nodes = element.getElementsByTagName(&#39;*&#39;), results = [];</span>
        <span class="gi">+        for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gi">+          if (node.tagName !== &quot;!&quot;) // Filter out comment nodes.</span>
        <span class="gi">+            results.push(node);</span>
        <span class="gi">+        return results;</span>
        <span class="gi">+      }</span>
        <span class="gi">+</span>
        <span class="gi">+      Element.Methods.down = function(element, expression, index) {</span>
        <span class="gi">+        element = $(element);</span>
        <span class="gi">+        if (arguments.length == 1) return element.firstDescendant();</span>
        <span class="gi">+        return Object.isNumber(expression) ? _descendants(element)[expression] :</span>
        <span class="gi">+          Element.select(element, expression)[index || 0];</span>
        <span class="gi">+      }</span>
        <span class="gi">+    })();</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
         }
         
         else if (Prototype.Browser.Gecko &amp;&amp; /rv:1\.8\.0/.test(navigator.userAgent)) {
           Element.Methods.setOpacity = function(element, value) {
             element = $(element);
             element.style.opacity = (value == 1) ? 0.999999 :
               (value === &#39;&#39;) ? &#39;&#39; : (value &lt; 0.00001) ? 0 : value;
             return element;
           };
         }
         
         else if (Prototype.Browser.WebKit) {
           Element.Methods.setOpacity = function(element, value) {
             element = $(element);
             element.style.opacity = (value == 1 || value === &#39;&#39;) ? &#39;&#39; :
               (value &lt; 0.00001) ? 0 : value;
         
             if (value == 1)
        <span class="gd">-      if(element.tagName.toUpperCase() == &#39;IMG&#39; &amp;&amp; element.width) {</span>
        <span class="gi">+      if (element.tagName.toUpperCase() == &#39;IMG&#39; &amp;&amp; element.width) {</span>
                 element.width++; element.width--;
               } else try {
                 var n = document.createTextNode(&#39; &#39;);
                 element.appendChild(n);
                 element.removeChild(n);
               } catch (e) { }
         
             return element;
           };
         
        <span class="gd">-  // Safari returns margins on body which is incorrect if the child is absolutely</span>
        <span class="gd">-  // positioned.  For performance reasons, redefine Element#cumulativeOffset for</span>
        <span class="gd">-  // KHTML/WebKit only.</span>
           Element.Methods.cumulativeOffset = function(element) {
             var valueT = 0, valueL = 0;
             do {
               valueT += element.offsetTop  || 0;
               valueL += element.offsetLeft || 0;
               if (element.offsetParent == document.body)
                 if (Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) break;
         
               element = element.offsetParent;
             } while (element);
         
             return Element._returnOffset(valueL, valueT);
           };
         }
         
        <span class="gd">-if (Prototype.Browser.IE || Prototype.Browser.Opera) {</span>
        <span class="gd">-  // IE and Opera are missing .innerHTML support for TABLE-related and SELECT elements</span>
        <span class="gd">-  Element.Methods.update = function(element, content) {</span>
        <span class="gd">-    element = $(element);</span>
        <span class="gd">-</span>
        <span class="gd">-    if (content &amp;&amp; content.toElement) content = content.toElement();</span>
        <span class="gd">-    if (Object.isElement(content)) return element.update().insert(content);</span>
        <span class="gd">-</span>
        <span class="gd">-    content = Object.toHTML(content);</span>
        <span class="gd">-    var tagName = element.tagName.toUpperCase();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (tagName in Element._insertionTranslations.tags) {</span>
        <span class="gd">-      $A(element.childNodes).each(function(node) { element.removeChild(node) });</span>
        <span class="gd">-      Element._getContentFromAnonymousElement(tagName, content.stripScripts())</span>
        <span class="gd">-        .each(function(node) { element.appendChild(node) });</span>
        <span class="gd">-    }</span>
        <span class="gd">-    else element.innerHTML = content.stripScripts();</span>
        <span class="gd">-</span>
        <span class="gd">-    content.evalScripts.bind(content).defer();</span>
        <span class="gd">-    return element;</span>
        <span class="gd">-  };</span>
        <span class="gd">-}</span>
        <span class="gd">-</span>
        <span class="gd">-if (&#39;outerHTML&#39; in document.createElement(&#39;div&#39;)) {</span>
        <span class="gi">+if (&#39;outerHTML&#39; in document.documentElement) {</span>
           Element.Methods.replace = function(element, content) {
             element = $(element);
         
             if (content &amp;&amp; content.toElement) content = content.toElement();
             if (Object.isElement(content)) {
               element.parentNode.replaceChild(content, element);
               return element;
             }
         
             content = Object.toHTML(content);
             var parent = element.parentNode, tagName = parent.tagName.toUpperCase();
         
             if (Element._insertionTranslations.tags[tagName]) {
        <span class="gd">-      var nextSibling = element.next();</span>
        <span class="gd">-      var fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());</span>
        <span class="gi">+      var nextSibling = element.next(),</span>
        <span class="gi">+          fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());</span>
               parent.removeChild(element);
               if (nextSibling)
                 fragments.each(function(node) { parent.insertBefore(node, nextSibling) });
               else
                 fragments.each(function(node) { parent.appendChild(node) });
             }
             else element.outerHTML = content.stripScripts();
         
             content.evalScripts.bind(content).defer();
             return element;
           };
         }
         
         Element._returnOffset = function(l, t) {
           var result = [l, t];
           result.left = l;
           result.top = t;
           return result;
         };
         
         Element._getContentFromAnonymousElement = function(tagName, html) {
        <span class="gd">-  var div = new Element(&#39;div&#39;), t = Element._insertionTranslations.tags[tagName];</span>
        <span class="gi">+  var div = new Element(&#39;div&#39;),</span>
        <span class="gi">+      t = Element._insertionTranslations.tags[tagName];</span>
           if (t) {
             div.innerHTML = t[0] + html + t[1];
        <span class="gd">-    t[2].times(function() { div = div.firstChild });</span>
        <span class="gd">-  } else div.innerHTML = html;</span>
        <span class="gi">+    for (var i = t[2]; i--; ) {</span>
        <span class="gi">+      div = div.firstChild;</span>
        <span class="gi">+    }</span>
        <span class="gi">+  }</span>
        <span class="gi">+  else {</span>
        <span class="gi">+    div.innerHTML = html;</span>
        <span class="gi">+  }</span>
           return $A(div.childNodes);
         };
         
         Element._insertionTranslations = {
           before: function(element, node) {
             element.parentNode.insertBefore(node, element);
           },
           top: function(element, node) {
             element.insertBefore(node, element.firstChild);
           },
           bottom: function(element, node) {
             element.appendChild(node);
           },
           after: function(element, node) {
             element.parentNode.insertBefore(node, element.nextSibling);
           },
           tags: {
             TABLE:  [&#39;&lt;table&gt;&#39;,                &#39;&lt;/table&gt;&#39;,                   1],
             TBODY:  [&#39;&lt;table&gt;&lt;tbody&gt;&#39;,         &#39;&lt;/tbody&gt;&lt;/table&gt;&#39;,           2],
             TR:     [&#39;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&#39;,     &#39;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#39;,      3],
             TD:     [&#39;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&#39;, &#39;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#39;, 4],
             SELECT: [&#39;&lt;select&gt;&#39;,               &#39;&lt;/select&gt;&#39;,                  1]
           }
         };
         
         (function() {
        <span class="gd">-  Object.extend(this.tags, {</span>
        <span class="gd">-    THEAD: this.tags.TBODY,</span>
        <span class="gd">-    TFOOT: this.tags.TBODY,</span>
        <span class="gd">-    TH:    this.tags.TD</span>
        <span class="gi">+  var tags = Element._insertionTranslations.tags;</span>
        <span class="gi">+  Object.extend(tags, {</span>
        <span class="gi">+    THEAD: tags.TBODY,</span>
        <span class="gi">+    TFOOT: tags.TBODY,</span>
        <span class="gi">+    TH:    tags.TD</span>
           });
        <span class="gd">-}).call(Element._insertionTranslations);</span>
        <span class="gi">+})();</span>
         
         Element.Methods.Simulated = {
           hasAttribute: function(element, attribute) {
             attribute = Element._attributeTranslations.has[attribute] || attribute;
             var node = $(element).getAttributeNode(attribute);
             return !!(node &amp;&amp; node.specified);
           }
         };
         
         Element.Methods.ByTag = { };
         
         Object.extend(Element, Element.Methods);
         
        <span class="gd">-if (!Prototype.BrowserFeatures.ElementExtensions &amp;&amp;</span>
        <span class="gd">-    document.createElement(&#39;div&#39;)[&#39;__proto__&#39;]) {</span>
        <span class="gd">-  window.HTMLElement = { };</span>
        <span class="gd">-  window.HTMLElement.prototype = document.createElement(&#39;div&#39;)[&#39;__proto__&#39;];</span>
        <span class="gd">-  Prototype.BrowserFeatures.ElementExtensions = true;</span>
        <span class="gd">-}</span>
        <span class="gi">+(function(div) {</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!Prototype.BrowserFeatures.ElementExtensions &amp;&amp; div[&#39;__proto__&#39;]) {</span>
        <span class="gi">+    window.HTMLElement = { };</span>
        <span class="gi">+    window.HTMLElement.prototype = div[&#39;__proto__&#39;];</span>
        <span class="gi">+    Prototype.BrowserFeatures.ElementExtensions = true;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  div = null;</span>
        <span class="gi">+</span>
        <span class="gi">+})(document.createElement(&#39;div&#39;));</span>
         
         Element.extend = (function() {
        <span class="gd">-  if (Prototype.BrowserFeatures.SpecificElementExtensions)</span>
        <span class="gi">+</span>
        <span class="gi">+  function checkDeficiency(tagName) {</span>
        <span class="gi">+    if (typeof window.Element != &#39;undefined&#39;) {</span>
        <span class="gi">+      var proto = window.Element.prototype;</span>
        <span class="gi">+      if (proto) {</span>
        <span class="gi">+        var id = &#39;_&#39; + (Math.random()+&#39;&#39;).slice(2),</span>
        <span class="gi">+            el = document.createElement(tagName);</span>
        <span class="gi">+        proto[id] = &#39;x&#39;;</span>
        <span class="gi">+        var isBuggy = (el[id] !== &#39;x&#39;);</span>
        <span class="gi">+        delete proto[id];</span>
        <span class="gi">+        el = null;</span>
        <span class="gi">+        return isBuggy;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return false;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function extendElementWith(element, methods) {</span>
        <span class="gi">+    for (var property in methods) {</span>
        <span class="gi">+      var value = methods[property];</span>
        <span class="gi">+      if (Object.isFunction(value) &amp;&amp; !(property in element))</span>
        <span class="gi">+        element[property] = value.methodize();</span>
        <span class="gi">+    }</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency(&#39;object&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+  if (Prototype.BrowserFeatures.SpecificElementExtensions) {</span>
        <span class="gi">+    if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) {</span>
        <span class="gi">+      return function(element) {</span>
        <span class="gi">+        if (element &amp;&amp; typeof element._extendedByPrototype == &#39;undefined&#39;) {</span>
        <span class="gi">+          var t = element.tagName;</span>
        <span class="gi">+          if (t &amp;&amp; (/^(?:object|applet|embed)$/i.test(t))) {</span>
        <span class="gi">+            extendElementWith(element, Element.Methods);</span>
        <span class="gi">+            extendElementWith(element, Element.Methods.Simulated);</span>
        <span class="gi">+            extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);</span>
        <span class="gi">+          }</span>
        <span class="gi">+        }</span>
        <span class="gi">+        return element;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
             return Prototype.K;
        <span class="gi">+  }</span>
         
           var Methods = { }, ByTag = Element.Methods.ByTag;
         
           var extend = Object.extend(function(element) {
        <span class="gd">-    if (!element || element._extendedByPrototype ||</span>
        <span class="gi">+    if (!element || typeof element._extendedByPrototype != &#39;undefined&#39; ||</span>
                 element.nodeType != 1 || element == window) return element;
         
             var methods = Object.clone(Methods),
        <span class="gd">-      tagName = element.tagName.toUpperCase(), property, value;</span>
        <span class="gi">+        tagName = element.tagName.toUpperCase();</span>
         
        <span class="gd">-    // extend methods for specific tags</span>
             if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);
         
        <span class="gd">-    for (property in methods) {</span>
        <span class="gd">-      value = methods[property];</span>
        <span class="gd">-      if (Object.isFunction(value) &amp;&amp; !(property in element))</span>
        <span class="gd">-        element[property] = value.methodize();</span>
        <span class="gd">-    }</span>
        <span class="gi">+    extendElementWith(element, methods);</span>
         
             element._extendedByPrototype = Prototype.emptyFunction;
             return element;
         
           }, {
             refresh: function() {
        <span class="gd">-      // extend methods for all tags (Safari doesn&#39;t need this)</span>
               if (!Prototype.BrowserFeatures.ElementExtensions) {
                 Object.extend(Methods, Element.Methods);
                 Object.extend(Methods, Element.Methods.Simulated);
               }
             }
           });
         
           extend.refresh();
           return extend;
         })();
         
        <span class="gd">-Element.hasAttribute = function(element, attribute) {</span>
        <span class="gd">-  if (element.hasAttribute) return element.hasAttribute(attribute);</span>
        <span class="gd">-  return Element.Methods.Simulated.hasAttribute(element, attribute);</span>
        <span class="gd">-};</span>
        <span class="gi">+if (document.documentElement.hasAttribute) {</span>
        <span class="gi">+  Element.hasAttribute = function(element, attribute) {</span>
        <span class="gi">+    return element.hasAttribute(attribute);</span>
        <span class="gi">+  };</span>
        <span class="gi">+}</span>
        <span class="gi">+else {</span>
        <span class="gi">+  Element.hasAttribute = Element.Methods.Simulated.hasAttribute;</span>
        <span class="gi">+}</span>
         
         Element.addMethods = function(methods) {
           var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;
         
           if (!methods) {
             Object.extend(Form, Form.Methods);
             Object.extend(Form.Element, Form.Element.Methods);
             Object.extend(Element.Methods.ByTag, {
               &quot;FORM&quot;:     Object.clone(Form.Methods),
               &quot;INPUT&quot;:    Object.clone(Form.Element.Methods),
               &quot;SELECT&quot;:   Object.clone(Form.Element.Methods),
               &quot;TEXTAREA&quot;: Object.clone(Form.Element.Methods)
             });
           }
         
           if (arguments.length == 2) {
             var tagName = methods;
             methods = arguments[1];
           }
         
           if (!tagName) Object.extend(Element.Methods, methods || { });
           else {
             if (Object.isArray(tagName)) tagName.each(extend);
             else extend(tagName);
           }
         
           function extend(tagName) {
             tagName = tagName.toUpperCase();
             if (!Element.Methods.ByTag[tagName])
               Element.Methods.ByTag[tagName] = { };
             Object.extend(Element.Methods.ByTag[tagName], methods);
           }
         
           function copy(methods, destination, onlyIfAbsent) {
             onlyIfAbsent = onlyIfAbsent || false;
             for (var property in methods) {
               var value = methods[property];
               if (!Object.isFunction(value)) continue;
               if (!onlyIfAbsent || !(property in destination))
                 destination[property] = value.methodize();
             }
           }
         
           function findDOMClass(tagName) {
             var klass;
             var trans = {
               &quot;OPTGROUP&quot;: &quot;OptGroup&quot;, &quot;TEXTAREA&quot;: &quot;TextArea&quot;, &quot;P&quot;: &quot;Paragraph&quot;,
               &quot;FIELDSET&quot;: &quot;FieldSet&quot;, &quot;UL&quot;: &quot;UList&quot;, &quot;OL&quot;: &quot;OList&quot;, &quot;DL&quot;: &quot;DList&quot;,
               &quot;DIR&quot;: &quot;Directory&quot;, &quot;H1&quot;: &quot;Heading&quot;, &quot;H2&quot;: &quot;Heading&quot;, &quot;H3&quot;: &quot;Heading&quot;,
               &quot;H4&quot;: &quot;Heading&quot;, &quot;H5&quot;: &quot;Heading&quot;, &quot;H6&quot;: &quot;Heading&quot;, &quot;Q&quot;: &quot;Quote&quot;,
               &quot;INS&quot;: &quot;Mod&quot;, &quot;DEL&quot;: &quot;Mod&quot;, &quot;A&quot;: &quot;Anchor&quot;, &quot;IMG&quot;: &quot;Image&quot;, &quot;CAPTION&quot;:
               &quot;TableCaption&quot;, &quot;COL&quot;: &quot;TableCol&quot;, &quot;COLGROUP&quot;: &quot;TableCol&quot;, &quot;THEAD&quot;:
               &quot;TableSection&quot;, &quot;TFOOT&quot;: &quot;TableSection&quot;, &quot;TBODY&quot;: &quot;TableSection&quot;, &quot;TR&quot;:
               &quot;TableRow&quot;, &quot;TH&quot;: &quot;TableCell&quot;, &quot;TD&quot;: &quot;TableCell&quot;, &quot;FRAMESET&quot;:
               &quot;FrameSet&quot;, &quot;IFRAME&quot;: &quot;IFrame&quot;
             };
             if (trans[tagName]) klass = &#39;HTML&#39; + trans[tagName] + &#39;Element&#39;;
             if (window[klass]) return window[klass];
             klass = &#39;HTML&#39; + tagName + &#39;Element&#39;;
             if (window[klass]) return window[klass];
             klass = &#39;HTML&#39; + tagName.capitalize() + &#39;Element&#39;;
             if (window[klass]) return window[klass];
         
        <span class="gd">-    window[klass] = { };</span>
        <span class="gd">-    window[klass].prototype = document.createElement(tagName)[&#39;__proto__&#39;];</span>
        <span class="gd">-    return window[klass];</span>
        <span class="gi">+    var element = document.createElement(tagName),</span>
        <span class="gi">+        proto = element[&#39;__proto__&#39;] || element.constructor.prototype;</span>
        <span class="gi">+</span>
        <span class="gi">+    element = null;</span>
        <span class="gi">+    return proto;</span>
           }
         
        <span class="gi">+  var elementPrototype = window.HTMLElement ? HTMLElement.prototype :</span>
        <span class="gi">+   Element.prototype;</span>
        <span class="gi">+</span>
           if (F.ElementExtensions) {
        <span class="gd">-    copy(Element.Methods, HTMLElement.prototype);</span>
        <span class="gd">-    copy(Element.Methods.Simulated, HTMLElement.prototype, true);</span>
        <span class="gi">+    copy(Element.Methods, elementPrototype);</span>
        <span class="gi">+    copy(Element.Methods.Simulated, elementPrototype, true);</span>
           }
         
           if (F.SpecificElementExtensions) {
             for (var tag in Element.Methods.ByTag) {
               var klass = findDOMClass(tag);
               if (Object.isUndefined(klass)) continue;
               copy(T[tag], klass.prototype);
             }
           }
         
           Object.extend(Element, Element.Methods);
           delete Element.ByTag;
         
           if (Element.extend.refresh) Element.extend.refresh();
           Element.cache = { };
         };
         
        <span class="gd">-document.viewport = {</span>
        <span class="gd">-  getDimensions: function() {</span>
        <span class="gd">-    var dimensions = { }, B = Prototype.Browser;</span>
        <span class="gd">-    $w(&#39;width height&#39;).each(function(d) {</span>
        <span class="gd">-      var D = d.capitalize();</span>
        <span class="gd">-      if (B.WebKit &amp;&amp; !document.evaluate) {</span>
        <span class="gd">-        // Safari &lt;3.0 needs self.innerWidth/Height</span>
        <span class="gd">-        dimensions[d] = self[&#39;inner&#39; + D];</span>
        <span class="gd">-      } else if (B.Opera &amp;&amp; parseFloat(window.opera.version()) &lt; 9.5) {</span>
        <span class="gd">-        // Opera &lt;9.5 needs document.body.clientWidth/Height</span>
        <span class="gd">-        dimensions[d] = document.body[&#39;client&#39; + D]</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        dimensions[d] = document.documentElement[&#39;client&#39; + D];</span>
        <span class="gd">-      }</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return dimensions;</span>
        <span class="gd">-  },</span>
         
        <span class="gd">-  getWidth: function() {</span>
        <span class="gd">-    return this.getDimensions().width;</span>
        <span class="gd">-  },</span>
        <span class="gi">+document.viewport = {</span>
         
        <span class="gd">-  getHeight: function() {</span>
        <span class="gd">-    return this.getDimensions().height;</span>
        <span class="gi">+  getDimensions: function() {</span>
        <span class="gi">+    return { width: this.getWidth(), height: this.getHeight() };</span>
           },
         
           getScrollOffsets: function() {
             return Element._returnOffset(
               window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
        <span class="gd">-      window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop);</span>
        <span class="gi">+      window.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop);</span>
           }
         };
        <span class="gd">-/* Portions of the Selector class are derived from Jack Slocum&#39;s DomQuery,</span>
        <span class="gd">- * part of YUI-Ext version 0.40, distributed under the terms of an MIT-style</span>
        <span class="gd">- * license.  Please see http://www.yui-ext.com/ for more information. */</span>
        <span class="gd">-</span>
        <span class="gd">-var Selector = Class.create({</span>
        <span class="gd">-  initialize: function(expression) {</span>
        <span class="gd">-    this.expression = expression.strip();</span>
        <span class="gd">-</span>
        <span class="gd">-    if (this.shouldUseSelectorsAPI()) {</span>
        <span class="gd">-      this.mode = &#39;selectorsAPI&#39;;</span>
        <span class="gd">-    } else if (this.shouldUseXPath()) {</span>
        <span class="gd">-      this.mode = &#39;xpath&#39;;</span>
        <span class="gd">-      this.compileXPathMatcher();</span>
        <span class="gd">-    } else {</span>
        <span class="gd">-      this.mode = &quot;normal&quot;;</span>
        <span class="gd">-      this.compileMatcher();</span>
        <span class="gd">-    }</span>
         
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  shouldUseXPath: function() {</span>
        <span class="gd">-    if (!Prototype.BrowserFeatures.XPath) return false;</span>
        <span class="gi">+(function(viewport) {</span>
        <span class="gi">+  var B = Prototype.Browser, doc = document, element, property = {};</span>
         
        <span class="gd">-    var e = this.expression;</span>
        <span class="gi">+  function getRootElement() {</span>
        <span class="gi">+    if (B.WebKit &amp;&amp; !doc.evaluate)</span>
        <span class="gi">+      return document;</span>
         
        <span class="gd">-    // Safari 3 chokes on :*-of-type and :empty</span>
        <span class="gd">-    if (Prototype.Browser.WebKit &amp;&amp;</span>
        <span class="gd">-     (e.include(&quot;-of-type&quot;) || e.include(&quot;:empty&quot;)))</span>
        <span class="gd">-      return false;</span>
        <span class="gi">+    if (B.Opera &amp;&amp; window.parseFloat(window.opera.version()) &lt; 9.5)</span>
        <span class="gi">+      return document.body;</span>
         
        <span class="gd">-    // XPath can&#39;t do namespaced attributes, nor can it read</span>
        <span class="gd">-    // the &quot;checked&quot; property from DOM nodes</span>
        <span class="gd">-    if ((/(\[[\w-]*?:|:checked)/).test(e))</span>
        <span class="gd">-      return false;</span>
        <span class="gi">+    return document.documentElement;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    return true;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  function define(D) {</span>
        <span class="gi">+    if (!element) element = getRootElement();</span>
         
        <span class="gd">-  shouldUseSelectorsAPI: function() {</span>
        <span class="gd">-    if (!Prototype.BrowserFeatures.SelectorsAPI) return false;</span>
        <span class="gi">+    property[D] = &#39;client&#39; + D;</span>
         
        <span class="gd">-    if (!Selector._div) Selector._div = new Element(&#39;div&#39;);</span>
        <span class="gi">+    viewport[&#39;get&#39; + D] = function() { return element[property[D]] };</span>
        <span class="gi">+    return viewport[&#39;get&#39; + D]();</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    // Make sure the browser treats the selector as valid. Test on an</span>
        <span class="gd">-    // isolated element to minimize cost of this check.</span>
        <span class="gd">-    try {</span>
        <span class="gd">-      Selector._div.querySelector(this.expression);</span>
        <span class="gd">-    } catch(e) {</span>
        <span class="gd">-      return false;</span>
        <span class="gd">-    }</span>
        <span class="gi">+  viewport.getWidth  = define.curry(&#39;Width&#39;);</span>
         
        <span class="gd">-    return true;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  viewport.getHeight = define.curry(&#39;Height&#39;);</span>
        <span class="gi">+})(document.viewport);</span>
         
        <span class="gd">-  compileMatcher: function() {</span>
        <span class="gd">-    var e = this.expression, ps = Selector.patterns, h = Selector.handlers,</span>
        <span class="gd">-        c = Selector.criteria, le, p, m;</span>
         
        <span class="gd">-    if (Selector._cache[e]) {</span>
        <span class="gd">-      this.matcher = Selector._cache[e];</span>
        <span class="gd">-      return;</span>
        <span class="gd">-    }</span>
        <span class="gi">+Element.Storage = {</span>
        <span class="gi">+  UID: 1</span>
        <span class="gi">+};</span>
         
        <span class="gd">-    this.matcher = [&quot;this.matcher = function(root) {&quot;,</span>
        <span class="gd">-                    &quot;var r = root, h = Selector.handlers, c = false, n;&quot;];</span>
        <span class="gi">+Element.addMethods({</span>
        <span class="gi">+  getStorage: function(element) {</span>
        <span class="gi">+    if (!(element = $(element))) return;</span>
         
        <span class="gd">-    while (e &amp;&amp; le != e &amp;&amp; (/\S/).test(e)) {</span>
        <span class="gd">-      le = e;</span>
        <span class="gd">-      for (var i in ps) {</span>
        <span class="gd">-        p = ps[i];</span>
        <span class="gd">-        if (m = e.match(p)) {</span>
        <span class="gd">-          this.matcher.push(Object.isFunction(c[i]) ? c[i](m) :</span>
        <span class="gd">-            new Template(c[i]).evaluate(m));</span>
        <span class="gd">-          e = e.replace(m[0], &#39;&#39;);</span>
        <span class="gd">-          break;</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gi">+    var uid;</span>
        <span class="gi">+    if (element === window) {</span>
        <span class="gi">+      uid = 0;</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      if (typeof element._prototypeUID === &quot;undefined&quot;)</span>
        <span class="gi">+        element._prototypeUID = Element.Storage.UID++;</span>
        <span class="gi">+      uid = element._prototypeUID;</span>
             }
         
        <span class="gd">-    this.matcher.push(&quot;return h.unique(n);\n}&quot;);</span>
        <span class="gd">-    eval(this.matcher.join(&#39;\n&#39;));</span>
        <span class="gd">-    Selector._cache[this.expression] = this.matcher;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  compileXPathMatcher: function() {</span>
        <span class="gd">-    var e = this.expression, ps = Selector.patterns,</span>
        <span class="gd">-        x = Selector.xpath, le, m;</span>
        <span class="gd">-</span>
        <span class="gd">-    if (Selector._cache[e]) {</span>
        <span class="gd">-      this.xpath = Selector._cache[e]; return;</span>
        <span class="gd">-    }</span>
        <span class="gd">-</span>
        <span class="gd">-    this.matcher = [&#39;.//*&#39;];</span>
        <span class="gd">-    while (e &amp;&amp; le != e &amp;&amp; (/\S/).test(e)) {</span>
        <span class="gd">-      le = e;</span>
        <span class="gd">-      for (var i in ps) {</span>
        <span class="gd">-        if (m = e.match(ps[i])) {</span>
        <span class="gd">-          this.matcher.push(Object.isFunction(x[i]) ? x[i](m) :</span>
        <span class="gd">-            new Template(x[i]).evaluate(m));</span>
        <span class="gd">-          e = e.replace(m[0], &#39;&#39;);</span>
        <span class="gd">-          break;</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-    }</span>
        <span class="gi">+    if (!Element.Storage[uid])</span>
        <span class="gi">+      Element.Storage[uid] = $H();</span>
         
        <span class="gd">-    this.xpath = this.matcher.join(&#39;&#39;);</span>
        <span class="gd">-    Selector._cache[this.expression] = this.xpath;</span>
        <span class="gi">+    return Element.Storage[uid];</span>
           },
         
        <span class="gd">-  findElements: function(root) {</span>
        <span class="gd">-    root = root || document;</span>
        <span class="gd">-    var e = this.expression, results;</span>
        <span class="gd">-</span>
        <span class="gd">-    switch (this.mode) {</span>
        <span class="gd">-      case &#39;selectorsAPI&#39;:</span>
        <span class="gd">-        // querySelectorAll queries document-wide, then filters to descendants</span>
        <span class="gd">-        // of the context element. That&#39;s not what we want.</span>
        <span class="gd">-        // Add an explicit context to the selector if necessary.</span>
        <span class="gd">-        if (root !== document) {</span>
        <span class="gd">-          var oldId = root.id, id = $(root).identify();</span>
        <span class="gd">-          e = &quot;#&quot; + id + &quot; &quot; + e;</span>
        <span class="gd">-        }</span>
        <span class="gd">-</span>
        <span class="gd">-        results = $A(root.querySelectorAll(e)).map(Element.extend);</span>
        <span class="gd">-        root.id = oldId;</span>
        <span class="gi">+  store: function(element, key, value) {</span>
        <span class="gi">+    if (!(element = $(element))) return;</span>
         
        <span class="gd">-        return results;</span>
        <span class="gd">-      case &#39;xpath&#39;:</span>
        <span class="gd">-        return document._getElementsByXPath(this.xpath, root);</span>
        <span class="gd">-      default:</span>
        <span class="gd">-       return this.matcher(root);</span>
        <span class="gi">+    if (arguments.length === 2) {</span>
        <span class="gi">+      Element.getStorage(element).update(key);</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      Element.getStorage(element).set(key, value);</span>
             }
        <span class="gi">+</span>
        <span class="gi">+    return element;</span>
           },
         
        <span class="gd">-  match: function(element) {</span>
        <span class="gd">-    this.tokens = [];</span>
        <span class="gi">+  retrieve: function(element, key, defaultValue) {</span>
        <span class="gi">+    if (!(element = $(element))) return;</span>
        <span class="gi">+    var hash = Element.getStorage(element), value = hash.get(key);</span>
         
        <span class="gd">-    var e = this.expression, ps = Selector.patterns, as = Selector.assertions;</span>
        <span class="gd">-    var le, p, m;</span>
        <span class="gd">-</span>
        <span class="gd">-    while (e &amp;&amp; le !== e &amp;&amp; (/\S/).test(e)) {</span>
        <span class="gd">-      le = e;</span>
        <span class="gd">-      for (var i in ps) {</span>
        <span class="gd">-        p = ps[i];</span>
        <span class="gd">-        if (m = e.match(p)) {</span>
        <span class="gd">-          // use the Selector.assertions methods unless the selector</span>
        <span class="gd">-          // is too complex.</span>
        <span class="gd">-          if (as[i]) {</span>
        <span class="gd">-            this.tokens.push([i, Object.clone(m)]);</span>
        <span class="gd">-            e = e.replace(m[0], &#39;&#39;);</span>
        <span class="gd">-          } else {</span>
        <span class="gd">-            // reluctantly do a document-wide search</span>
        <span class="gd">-            // and look for a match in the array</span>
        <span class="gd">-            return this.findElements(document).include(element);</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gi">+    if (Object.isUndefined(value)) {</span>
        <span class="gi">+      hash.set(key, defaultValue);</span>
        <span class="gi">+      value = defaultValue;</span>
             }
         
        <span class="gd">-    var match = true, name, matches;</span>
        <span class="gd">-    for (var i = 0, token; token = this.tokens[i]; i++) {</span>
        <span class="gd">-      name = token[0], matches = token[1];</span>
        <span class="gd">-      if (!Selector.assertions[name](element, matches)) {</span>
        <span class="gd">-        match = false; break;</span>
        <span class="gi">+    return value;</span>
        <span class="gi">+  },</span>
        <span class="gi">+</span>
        <span class="gi">+  clone: function(element, deep) {</span>
        <span class="gi">+    if (!(element = $(element))) return;</span>
        <span class="gi">+    var clone = element.cloneNode(deep);</span>
        <span class="gi">+    clone._prototypeUID = void 0;</span>
        <span class="gi">+    if (deep) {</span>
        <span class="gi">+      var descendants = Element.select(clone, &#39;*&#39;),</span>
        <span class="gi">+          i = descendants.length;</span>
        <span class="gi">+      while (i--) {</span>
        <span class="gi">+        descendants[i]._prototypeUID = void 0;</span>
               }
             }
        <span class="gd">-</span>
        <span class="gd">-    return match;</span>
        <span class="gi">+    return Element.extend(clone);</span>
           },
         
        <span class="gd">-  toString: function() {</span>
        <span class="gd">-    return this.expression;</span>
        <span class="gd">-  },</span>
        <span class="gi">+  purge: function(element) {</span>
        <span class="gi">+    if (!(element = $(element))) return;</span>
        <span class="gi">+    purgeElement(element);</span>
        <span class="gi">+</span>
        <span class="gi">+    var descendants = element.getElementsByTagName(&#39;*&#39;),</span>
        <span class="gi">+     i = descendants.length;</span>
        <span class="gi">+</span>
        <span class="gi">+    while (i--) purgeElement(descendants[i]);</span>
         
        <span class="gd">-  inspect: function() {</span>
        <span class="gd">-    return &quot;#&lt;Selector:&quot; + this.expression.inspect() + &quot;&gt;&quot;;</span>
        <span class="gi">+    return null;</span>
           }
         });
         
        <span class="gd">-Object.extend(Selector, {</span>
        <span class="gd">-  _cache: { },</span>
        <span class="gi">+(function() {</span>
         
        <span class="gd">-  xpath: {</span>
        <span class="gd">-    descendant:   &quot;//*&quot;,</span>
        <span class="gd">-    child:        &quot;/*&quot;,</span>
        <span class="gd">-    adjacent:     &quot;/following-sibling::*[1]&quot;,</span>
        <span class="gd">-    laterSibling: &#39;/following-sibling::*&#39;,</span>
        <span class="gd">-    tagName:      function(m) {</span>
        <span class="gd">-      if (m[1] == &#39;*&#39;) return &#39;&#39;;</span>
        <span class="gd">-      return &quot;[local-name()=&#39;&quot; + m[1].toLowerCase() +</span>
        <span class="gd">-             &quot;&#39; or local-name()=&#39;&quot; + m[1].toUpperCase() + &quot;&#39;]&quot;;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    className:    &quot;[contains(concat(&#39; &#39;, @class, &#39; &#39;), &#39; #{1} &#39;)]&quot;,</span>
        <span class="gd">-    id:           &quot;[@id=&#39;#{1}&#39;]&quot;,</span>
        <span class="gd">-    attrPresence: function(m) {</span>
        <span class="gd">-      m[1] = m[1].toLowerCase();</span>
        <span class="gd">-      return new Template(&quot;[@#{1}]&quot;).evaluate(m);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    attr: function(m) {</span>
        <span class="gd">-      m[1] = m[1].toLowerCase();</span>
        <span class="gd">-      m[3] = m[5] || m[6];</span>
        <span class="gd">-      return new Template(Selector.xpath.operators[m[2]]).evaluate(m);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    pseudo: function(m) {</span>
        <span class="gd">-      var h = Selector.xpath.pseudos[m[1]];</span>
        <span class="gd">-      if (!h) return &#39;&#39;;</span>
        <span class="gd">-      if (Object.isFunction(h)) return h(m);</span>
        <span class="gd">-      return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    operators: {</span>
        <span class="gd">-      &#39;=&#39;:  &quot;[@#{1}=&#39;#{3}&#39;]&quot;,</span>
        <span class="gd">-      &#39;!=&#39;: &quot;[@#{1}!=&#39;#{3}&#39;]&quot;,</span>
        <span class="gd">-      &#39;^=&#39;: &quot;[starts-with(@#{1}, &#39;#{3}&#39;)]&quot;,</span>
        <span class="gd">-      &#39;$=&#39;: &quot;[substring(@#{1}, (string-length(@#{1}) - string-length(&#39;#{3}&#39;) + 1))=&#39;#{3}&#39;]&quot;,</span>
        <span class="gd">-      &#39;*=&#39;: &quot;[contains(@#{1}, &#39;#{3}&#39;)]&quot;,</span>
        <span class="gd">-      &#39;~=&#39;: &quot;[contains(concat(&#39; &#39;, @#{1}, &#39; &#39;), &#39; #{3} &#39;)]&quot;,</span>
        <span class="gd">-      &#39;|=&#39;: &quot;[contains(concat(&#39;-&#39;, @#{1}, &#39;-&#39;), &#39;-#{3}-&#39;)]&quot;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    pseudos: {</span>
        <span class="gd">-      &#39;first-child&#39;: &#39;[not(preceding-sibling::*)]&#39;,</span>
        <span class="gd">-      &#39;last-child&#39;:  &#39;[not(following-sibling::*)]&#39;,</span>
        <span class="gd">-      &#39;only-child&#39;:  &#39;[not(preceding-sibling::* or following-sibling::*)]&#39;,</span>
        <span class="gd">-      &#39;empty&#39;:       &quot;[count(*) = 0 and (count(text()) = 0)]&quot;,</span>
        <span class="gd">-      &#39;checked&#39;:     &quot;[@checked]&quot;,</span>
        <span class="gd">-      &#39;disabled&#39;:    &quot;[(@disabled) and (@type!=&#39;hidden&#39;)]&quot;,</span>
        <span class="gd">-      &#39;enabled&#39;:     &quot;[not(@disabled) and (@type!=&#39;hidden&#39;)]&quot;,</span>
        <span class="gd">-      &#39;not&#39;: function(m) {</span>
        <span class="gd">-        var e = m[6], p = Selector.patterns,</span>
        <span class="gd">-            x = Selector.xpath, le, v;</span>
        <span class="gd">-</span>
        <span class="gd">-        var exclusion = [];</span>
        <span class="gd">-        while (e &amp;&amp; le != e &amp;&amp; (/\S/).test(e)) {</span>
        <span class="gd">-          le = e;</span>
        <span class="gd">-          for (var i in p) {</span>
        <span class="gd">-            if (m = e.match(p[i])) {</span>
        <span class="gd">-              v = Object.isFunction(x[i]) ? x[i](m) : new Template(x[i]).evaluate(m);</span>
        <span class="gd">-              exclusion.push(&quot;(&quot; + v.substring(1, v.length - 1) + &quot;)&quot;);</span>
        <span class="gd">-              e = e.replace(m[0], &#39;&#39;);</span>
        <span class="gd">-              break;</span>
        <span class="gd">-            }</span>
        <span class="gd">-          }</span>
        <span class="gd">-        }</span>
        <span class="gd">-        return &quot;[not(&quot; + exclusion.join(&quot; and &quot;) + &quot;)]&quot;;</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;nth-child&#39;:      function(m) {</span>
        <span class="gd">-        return Selector.xpath.pseudos.nth(&quot;(count(./preceding-sibling::*) + 1) &quot;, m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;nth-last-child&#39;: function(m) {</span>
        <span class="gd">-        return Selector.xpath.pseudos.nth(&quot;(count(./following-sibling::*) + 1) &quot;, m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;nth-of-type&#39;:    function(m) {</span>
        <span class="gd">-        return Selector.xpath.pseudos.nth(&quot;position() &quot;, m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;nth-last-of-type&#39;: function(m) {</span>
        <span class="gd">-        return Selector.xpath.pseudos.nth(&quot;(last() + 1 - position()) &quot;, m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;first-of-type&#39;:  function(m) {</span>
        <span class="gd">-        m[6] = &quot;1&quot;; return Selector.xpath.pseudos[&#39;nth-of-type&#39;](m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;last-of-type&#39;:   function(m) {</span>
        <span class="gd">-        m[6] = &quot;1&quot;; return Selector.xpath.pseudos[&#39;nth-last-of-type&#39;](m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      &#39;only-of-type&#39;:   function(m) {</span>
        <span class="gd">-        var p = Selector.xpath.pseudos; return p[&#39;first-of-type&#39;](m) + p[&#39;last-of-type&#39;](m);</span>
        <span class="gd">-      },</span>
        <span class="gd">-      nth: function(fragment, m) {</span>
        <span class="gd">-        var mm, formula = m[6], predicate;</span>
        <span class="gd">-        if (formula == &#39;even&#39;) formula = &#39;2n+0&#39;;</span>
        <span class="gd">-        if (formula == &#39;odd&#39;)  formula = &#39;2n+1&#39;;</span>
        <span class="gd">-        if (mm = formula.match(/^(\d+)$/)) // digit only</span>
        <span class="gd">-          return &#39;[&#39; + fragment + &quot;= &quot; + mm[1] + &#39;]&#39;;</span>
        <span class="gd">-        if (mm = formula.match(/^(-?\d*)?n(([+-])(\d+))?/)) { // an+b</span>
        <span class="gd">-          if (mm[1] == &quot;-&quot;) mm[1] = -1;</span>
        <span class="gd">-          var a = mm[1] ? Number(mm[1]) : 1;</span>
        <span class="gd">-          var b = mm[2] ? Number(mm[2]) : 0;</span>
        <span class="gd">-          predicate = &quot;[((#{fragment} - #{b}) mod #{a} = 0) and &quot; +</span>
        <span class="gd">-          &quot;((#{fragment} - #{b}) div #{a} &gt;= 0)]&quot;;</span>
        <span class="gd">-          return new Template(predicate).evaluate({</span>
        <span class="gd">-            fragment: fragment, a: a, b: b });</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gi">+  function toDecimal(pctString) {</span>
        <span class="gi">+    var match = pctString.match(/^(\d+)%?$/i);</span>
        <span class="gi">+    if (!match) return null;</span>
        <span class="gi">+    return (Number(match[1]) / 100);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function getPixelValue(value, property) {</span>
        <span class="gi">+    if (Object.isElement(value)) {</span>
        <span class="gi">+      element = value;</span>
        <span class="gi">+      value = element.getStyle(property);</span>
        <span class="gi">+    }</span>
        <span class="gi">+    if (value === null) {</span>
        <span class="gi">+      return null;</span>
             }
        <span class="gd">-  },</span>
         
        <span class="gd">-  criteria: {</span>
        <span class="gd">-    tagName:      &#39;n = h.tagName(n, r, &quot;#{1}&quot;, c);      c = false;&#39;,</span>
        <span class="gd">-    className:    &#39;n = h.className(n, r, &quot;#{1}&quot;, c);    c = false;&#39;,</span>
        <span class="gd">-    id:           &#39;n = h.id(n, r, &quot;#{1}&quot;, c);           c = false;&#39;,</span>
        <span class="gd">-    attrPresence: &#39;n = h.attrPresence(n, r, &quot;#{1}&quot;, c); c = false;&#39;,</span>
        <span class="gd">-    attr: function(m) {</span>
        <span class="gd">-      m[3] = (m[5] || m[6]);</span>
        <span class="gd">-      return new Template(&#39;n = h.attr(n, r, &quot;#{1}&quot;, &quot;#{3}&quot;, &quot;#{2}&quot;, c); c = false;&#39;).evaluate(m);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    pseudo: function(m) {</span>
        <span class="gd">-      if (m[6]) m[6] = m[6].replace(/&quot;/g, &#39;\\&quot;&#39;);</span>
        <span class="gd">-      return new Template(&#39;n = h.pseudo(n, &quot;#{1}&quot;, &quot;#{6}&quot;, r, c); c = false;&#39;).evaluate(m);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    descendant:   &#39;c = &quot;descendant&quot;;&#39;,</span>
        <span class="gd">-    child:        &#39;c = &quot;child&quot;;&#39;,</span>
        <span class="gd">-    adjacent:     &#39;c = &quot;adjacent&quot;;&#39;,</span>
        <span class="gd">-    laterSibling: &#39;c = &quot;laterSibling&quot;;&#39;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  patterns: {</span>
        <span class="gd">-    // combinators must be listed first</span>
        <span class="gd">-    // (and descendant needs to be last combinator)</span>
        <span class="gd">-    laterSibling: /^\s*~\s*/,</span>
        <span class="gd">-    child:        /^\s*&gt;\s*/,</span>
        <span class="gd">-    adjacent:     /^\s*\+\s*/,</span>
        <span class="gd">-    descendant:   /^\s/,</span>
        <span class="gd">-</span>
        <span class="gd">-    // selectors follow</span>
        <span class="gd">-    tagName:      /^\s*(\*|[\w\-]+)(\b|$)?/,</span>
        <span class="gd">-    id:           /^#([\w\-\*]+)(\b|$)/,</span>
        <span class="gd">-    className:    /^\.([\w\-\*]+)(\b|$)/,</span>
        <span class="gd">-    pseudo:</span>
        <span class="gd">-/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~&gt;]))/,</span>
        <span class="gd">-    attrPresence: /^\[((?:[\w]+:)?[\w]+)\]/,</span>
        <span class="gd">-    attr:         /\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*(([&#39;&quot;])([^\4]*?)\4|([^&#39;&quot;][^\]]*?)))?\]/</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  // for Selector.match and Element#match</span>
        <span class="gd">-  assertions: {</span>
        <span class="gd">-    tagName: function(element, matches) {</span>
        <span class="gd">-      return matches[1].toUpperCase() == element.tagName.toUpperCase();</span>
        <span class="gd">-    },</span>
        <span class="gi">+    if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {</span>
        <span class="gi">+      return window.parseFloat(value);</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-    className: function(element, matches) {</span>
        <span class="gd">-      return Element.hasClassName(element, matches[1]);</span>
        <span class="gd">-    },</span>
        <span class="gi">+    if (/\d/.test(value) &amp;&amp; element.runtimeStyle) {</span>
        <span class="gi">+      var style = element.style.left, rStyle = element.runtimeStyle.left;</span>
        <span class="gi">+      element.runtimeStyle.left = element.currentStyle.left;</span>
        <span class="gi">+      element.style.left = value || 0;</span>
        <span class="gi">+      value = element.style.pixelLeft;</span>
        <span class="gi">+      element.style.left = style;</span>
        <span class="gi">+      element.runtimeStyle.left = rStyle;</span>
         
        <span class="gd">-    id: function(element, matches) {</span>
        <span class="gd">-      return element.id === matches[1];</span>
        <span class="gd">-    },</span>
        <span class="gi">+      return value;</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-    attrPresence: function(element, matches) {</span>
        <span class="gd">-      return Element.hasAttribute(element, matches[1]);</span>
        <span class="gd">-    },</span>
        <span class="gi">+    if (value.include(&#39;%&#39;)) {</span>
        <span class="gi">+      var decimal = toDecimal(value);</span>
        <span class="gi">+      var whole;</span>
        <span class="gi">+      if (property.include(&#39;left&#39;) || property.include(&#39;right&#39;) ||</span>
        <span class="gi">+       property.include(&#39;width&#39;)) {</span>
        <span class="gi">+        whole = $(element.parentNode).measure(&#39;width&#39;);</span>
        <span class="gi">+      } else if (property.include(&#39;top&#39;) || property.include(&#39;bottom&#39;) ||</span>
        <span class="gi">+       property.include(&#39;height&#39;)) {</span>
        <span class="gi">+        whole = $(element.parentNode).measure(&#39;height&#39;);</span>
        <span class="gi">+      }</span>
         
        <span class="gd">-    attr: function(element, matches) {</span>
        <span class="gd">-      var nodeValue = Element.readAttribute(element, matches[1]);</span>
        <span class="gd">-      return nodeValue &amp;&amp; Selector.operators[matches[2]](nodeValue, matches[5] || matches[6]);</span>
        <span class="gi">+      return whole * decimal;</span>
             }
        <span class="gd">-  },</span>
         
        <span class="gd">-  handlers: {</span>
        <span class="gd">-    // UTILITY FUNCTIONS</span>
        <span class="gd">-    // joins two collections</span>
        <span class="gd">-    concat: function(a, b) {</span>
        <span class="gd">-      for (var i = 0, node; node = b[i]; i++)</span>
        <span class="gd">-        a.push(node);</span>
        <span class="gd">-      return a;</span>
        <span class="gd">-    },</span>
        <span class="gi">+    return 0;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    // marks an array of nodes for counting</span>
        <span class="gd">-    mark: function(nodes) {</span>
        <span class="gd">-      var _true = Prototype.emptyFunction;</span>
        <span class="gd">-      for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-        node._countedByPrototype = _true;</span>
        <span class="gd">-      return nodes;</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function toCSSPixels(number) {</span>
        <span class="gi">+    if (Object.isString(number) &amp;&amp; number.endsWith(&#39;px&#39;)) {</span>
        <span class="gi">+      return number;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return number + &#39;px&#39;;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    unmark: function(nodes) {</span>
        <span class="gd">-      for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-        node._countedByPrototype = undefined;</span>
        <span class="gd">-      return nodes;</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function isDisplayed(element) {</span>
        <span class="gi">+    var originalElement = element;</span>
        <span class="gi">+    while (element &amp;&amp; element.parentNode) {</span>
        <span class="gi">+      var display = element.getStyle(&#39;display&#39;);</span>
        <span class="gi">+      if (display === &#39;none&#39;) {</span>
        <span class="gi">+        return false;</span>
        <span class="gi">+      }</span>
        <span class="gi">+      element = $(element.parentNode);</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return true;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    // mark each child node with its position (for nth calls)</span>
        <span class="gd">-    // &quot;ofType&quot; flag indicates whether we&#39;re indexing for nth-of-type</span>
        <span class="gd">-    // rather than nth-child</span>
        <span class="gd">-    index: function(parentNode, reverse, ofType) {</span>
        <span class="gd">-      parentNode._countedByPrototype = Prototype.emptyFunction;</span>
        <span class="gd">-      if (reverse) {</span>
        <span class="gd">-        for (var nodes = parentNode.childNodes, i = nodes.length - 1, j = 1; i &gt;= 0; i--) {</span>
        <span class="gd">-          var node = nodes[i];</span>
        <span class="gd">-          if (node.nodeType == 1 &amp;&amp; (!ofType || node._countedByPrototype)) node.nodeIndex = j++;</span>
        <span class="gd">-        }</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        for (var i = 0, j = 1, nodes = parentNode.childNodes; node = nodes[i]; i++)</span>
        <span class="gd">-          if (node.nodeType == 1 &amp;&amp; (!ofType || node._countedByPrototype)) node.nodeIndex = j++;</span>
        <span class="gi">+  var hasLayout = Prototype.K;</span>
        <span class="gi">+  if (&#39;currentStyle&#39; in document.documentElement) {</span>
        <span class="gi">+    hasLayout = function(element) {</span>
        <span class="gi">+      if (!element.currentStyle.hasLayout) {</span>
        <span class="gi">+        element.style.zoom = 1;</span>
        <span class="gi">+      }</span>
        <span class="gi">+      return element;</span>
        <span class="gi">+    };</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function cssNameFor(key) {</span>
        <span class="gi">+    if (key.include(&#39;border&#39;)) key = key + &#39;-width&#39;;</span>
        <span class="gi">+    return key.camelize();</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  Element.Layout = Class.create(Hash, {</span>
        <span class="gi">+    initialize: function($super, element, preCompute) {</span>
        <span class="gi">+      $super();</span>
        <span class="gi">+      this.element = $(element);</span>
        <span class="gi">+</span>
        <span class="gi">+      Element.Layout.PROPERTIES.each( function(property) {</span>
        <span class="gi">+        this._set(property, null);</span>
        <span class="gi">+      }, this);</span>
        <span class="gi">+</span>
        <span class="gi">+      if (preCompute) {</span>
        <span class="gi">+        this._preComputing = true;</span>
        <span class="gi">+        this._begin();</span>
        <span class="gi">+        Element.Layout.PROPERTIES.each( this._compute, this );</span>
        <span class="gi">+        this._end();</span>
        <span class="gi">+        this._preComputing = false;</span>
               }
             },
         
        <span class="gd">-    // filters out duplicates and extends all nodes</span>
        <span class="gd">-    unique: function(nodes) {</span>
        <span class="gd">-      if (nodes.length == 0) return nodes;</span>
        <span class="gd">-      var results = [], n;</span>
        <span class="gd">-      for (var i = 0, l = nodes.length; i &lt; l; i++)</span>
        <span class="gd">-        if (!(n = nodes[i])._countedByPrototype) {</span>
        <span class="gd">-          n._countedByPrototype = Prototype.emptyFunction;</span>
        <span class="gd">-          results.push(Element.extend(n));</span>
        <span class="gd">-        }</span>
        <span class="gd">-      return Selector.handlers.unmark(results);</span>
        <span class="gi">+    _set: function(property, value) {</span>
        <span class="gi">+      return Hash.prototype.set.call(this, property, value);</span>
             },
         
        <span class="gd">-    // COMBINATOR FUNCTIONS</span>
        <span class="gd">-    descendant: function(nodes) {</span>
        <span class="gd">-      var h = Selector.handlers;</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        h.concat(results, node.getElementsByTagName(&#39;*&#39;));</span>
        <span class="gd">-      return results;</span>
        <span class="gi">+    set: function(property, value) {</span>
        <span class="gi">+      throw &quot;Properties of Element.Layout are read-only.&quot;;</span>
             },
         
        <span class="gd">-    child: function(nodes) {</span>
        <span class="gd">-      var h = Selector.handlers;</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++) {</span>
        <span class="gd">-        for (var j = 0, child; child = node.childNodes[j]; j++)</span>
        <span class="gd">-          if (child.nodeType == 1 &amp;&amp; child.tagName != &#39;!&#39;) results.push(child);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return results;</span>
        <span class="gi">+    get: function($super, property) {</span>
        <span class="gi">+      var value = $super(property);</span>
        <span class="gi">+      return value === null ? this._compute(property) : value;</span>
             },
         
        <span class="gd">-    adjacent: function(nodes) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++) {</span>
        <span class="gd">-        var next = this.nextElementSibling(node);</span>
        <span class="gd">-        if (next) results.push(next);</span>
        <span class="gi">+    _begin: function() {</span>
        <span class="gi">+      if (this._prepared) return;</span>
        <span class="gi">+</span>
        <span class="gi">+      var element = this.element;</span>
        <span class="gi">+      if (isDisplayed(element)) {</span>
        <span class="gi">+        this._prepared = true;</span>
        <span class="gi">+        return;</span>
               }
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
         
        <span class="gd">-    laterSibling: function(nodes) {</span>
        <span class="gd">-      var h = Selector.handlers;</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        h.concat(results, Element.nextSiblings(node));</span>
        <span class="gd">-      return results;</span>
        <span class="gi">+      var originalStyles = {</span>
        <span class="gi">+        position:   element.style.position   || &#39;&#39;,</span>
        <span class="gi">+        width:      element.style.width      || &#39;&#39;,</span>
        <span class="gi">+        visibility: element.style.visibility || &#39;&#39;,</span>
        <span class="gi">+        display:    element.style.display    || &#39;&#39;</span>
        <span class="gi">+      };</span>
        <span class="gi">+</span>
        <span class="gi">+      element.store(&#39;prototype_original_styles&#39;, originalStyles);</span>
        <span class="gi">+</span>
        <span class="gi">+      var position = element.getStyle(&#39;position&#39;),</span>
        <span class="gi">+       width = element.getStyle(&#39;width&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+      element.setStyle({</span>
        <span class="gi">+        position:   &#39;absolute&#39;,</span>
        <span class="gi">+        visibility: &#39;hidden&#39;,</span>
        <span class="gi">+        display:    &#39;block&#39;</span>
        <span class="gi">+      });</span>
        <span class="gi">+</span>
        <span class="gi">+      var positionedWidth = element.getStyle(&#39;width&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+      var newWidth;</span>
        <span class="gi">+      if (width &amp;&amp; (positionedWidth === width)) {</span>
        <span class="gi">+        newWidth = getPixelValue(width);</span>
        <span class="gi">+      } else if (width &amp;&amp; (position === &#39;absolute&#39; || position === &#39;fixed&#39;)) {</span>
        <span class="gi">+        newWidth = getPixelValue(width);</span>
        <span class="gi">+      } else {</span>
        <span class="gi">+        var parent = element.parentNode, pLayout = $(parent).getLayout();</span>
        <span class="gi">+</span>
        <span class="gi">+        newWidth = pLayout.get(&#39;width&#39;) -</span>
        <span class="gi">+         this.get(&#39;margin-left&#39;) -</span>
        <span class="gi">+         this.get(&#39;border-left&#39;) -</span>
        <span class="gi">+         this.get(&#39;padding-left&#39;) -</span>
        <span class="gi">+         this.get(&#39;padding-right&#39;) -</span>
        <span class="gi">+         this.get(&#39;border-right&#39;) -</span>
        <span class="gi">+         this.get(&#39;margin-right&#39;);</span>
        <span class="gi">+      }</span>
        <span class="gi">+</span>
        <span class="gi">+      element.setStyle({ width: newWidth + &#39;px&#39; });</span>
        <span class="gi">+</span>
        <span class="gi">+      this._prepared = true;</span>
             },
         
        <span class="gd">-    nextElementSibling: function(node) {</span>
        <span class="gd">-      while (node = node.nextSibling)</span>
        <span class="gd">-        if (node.nodeType == 1) return node;</span>
        <span class="gd">-      return null;</span>
        <span class="gi">+    _end: function() {</span>
        <span class="gi">+      var element = this.element;</span>
        <span class="gi">+      var originalStyles = element.retrieve(&#39;prototype_original_styles&#39;);</span>
        <span class="gi">+      element.store(&#39;prototype_original_styles&#39;, null);</span>
        <span class="gi">+      element.setStyle(originalStyles);</span>
        <span class="gi">+      this._prepared = false;</span>
             },
         
        <span class="gd">-    previousElementSibling: function(node) {</span>
        <span class="gd">-      while (node = node.previousSibling)</span>
        <span class="gd">-        if (node.nodeType == 1) return node;</span>
        <span class="gd">-      return null;</span>
        <span class="gi">+    _compute: function(property) {</span>
        <span class="gi">+      var COMPUTATIONS = Element.Layout.COMPUTATIONS;</span>
        <span class="gi">+      if (!(property in COMPUTATIONS)) {</span>
        <span class="gi">+        throw &quot;Property not found.&quot;;</span>
        <span class="gi">+      }</span>
        <span class="gi">+      return this._set(property, COMPUTATIONS[property].call(this, this.element));</span>
             },
         
        <span class="gd">-    // TOKEN FUNCTIONS</span>
        <span class="gd">-    tagName: function(nodes, root, tagName, combinator) {</span>
        <span class="gd">-      var uTagName = tagName.toUpperCase();</span>
        <span class="gd">-      var results = [], h = Selector.handlers;</span>
        <span class="gd">-      if (nodes) {</span>
        <span class="gd">-        if (combinator) {</span>
        <span class="gd">-          // fastlane for ordinary descendant combinators</span>
        <span class="gd">-          if (combinator == &quot;descendant&quot;) {</span>
        <span class="gd">-            for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-              h.concat(results, node.getElementsByTagName(tagName));</span>
        <span class="gd">-            return results;</span>
        <span class="gd">-          } else nodes = this[combinator](nodes);</span>
        <span class="gd">-          if (tagName == &quot;*&quot;) return nodes;</span>
        <span class="gd">-        }</span>
        <span class="gd">-        for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-          if (node.tagName.toUpperCase() === uTagName) results.push(node);</span>
        <span class="gd">-        return results;</span>
        <span class="gd">-      } else return root.getElementsByTagName(tagName);</span>
        <span class="gi">+    toObject: function() {</span>
        <span class="gi">+      var args = $A(arguments);</span>
        <span class="gi">+      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :</span>
        <span class="gi">+       args.join(&#39; &#39;).split(&#39; &#39;);</span>
        <span class="gi">+      var obj = {};</span>
        <span class="gi">+      keys.each( function(key) {</span>
        <span class="gi">+        if (!Element.Layout.PROPERTIES.include(key)) return;</span>
        <span class="gi">+        var value = this.get(key);</span>
        <span class="gi">+        if (value != null) obj[key] = value;</span>
        <span class="gi">+      }, this);</span>
        <span class="gi">+      return obj;</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    toHash: function() {</span>
        <span class="gi">+      var obj = this.toObject.apply(this, arguments);</span>
        <span class="gi">+      return new Hash(obj);</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    toCSS: function() {</span>
        <span class="gi">+      var args = $A(arguments);</span>
        <span class="gi">+      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :</span>
        <span class="gi">+       args.join(&#39; &#39;).split(&#39; &#39;);</span>
        <span class="gi">+      var css = {};</span>
        <span class="gi">+</span>
        <span class="gi">+      keys.each( function(key) {</span>
        <span class="gi">+        if (!Element.Layout.PROPERTIES.include(key)) return;</span>
        <span class="gi">+        if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;</span>
        <span class="gi">+</span>
        <span class="gi">+        var value = this.get(key);</span>
        <span class="gi">+        if (value != null) css[cssNameFor(key)] = value + &#39;px&#39;;</span>
        <span class="gi">+      }, this);</span>
        <span class="gi">+      return css;</span>
             },
         
        <span class="gd">-    id: function(nodes, root, id, combinator) {</span>
        <span class="gd">-      var targetNode = $(id), h = Selector.handlers;</span>
        <span class="gd">-      if (!targetNode) return [];</span>
        <span class="gd">-      if (!nodes &amp;&amp; root == document) return [targetNode];</span>
        <span class="gd">-      if (nodes) {</span>
        <span class="gd">-        if (combinator) {</span>
        <span class="gd">-          if (combinator == &#39;child&#39;) {</span>
        <span class="gd">-            for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-              if (targetNode.parentNode == node) return [targetNode];</span>
        <span class="gd">-          } else if (combinator == &#39;descendant&#39;) {</span>
        <span class="gd">-            for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-              if (Element.descendantOf(targetNode, node)) return [targetNode];</span>
        <span class="gd">-          } else if (combinator == &#39;adjacent&#39;) {</span>
        <span class="gd">-            for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-              if (Selector.handlers.previousElementSibling(targetNode) == node)</span>
        <span class="gd">-                return [targetNode];</span>
        <span class="gd">-          } else nodes = h[combinator](nodes);</span>
        <span class="gd">-        }</span>
        <span class="gd">-        for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-          if (node == targetNode) return [targetNode];</span>
        <span class="gd">-        return [];</span>
        <span class="gi">+    inspect: function() {</span>
        <span class="gi">+      return &quot;#&lt;Element.Layout&gt;&quot;;</span>
        <span class="gi">+    }</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  Object.extend(Element.Layout, {</span>
        <span class="gi">+    PROPERTIES: $w(&#39;height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height&#39;),</span>
        <span class="gi">+</span>
        <span class="gi">+    COMPOSITE_PROPERTIES: $w(&#39;padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height&#39;),</span>
        <span class="gi">+</span>
        <span class="gi">+    COMPUTATIONS: {</span>
        <span class="gi">+      &#39;height&#39;: function(element) {</span>
        <span class="gi">+        if (!this._preComputing) this._begin();</span>
        <span class="gi">+</span>
        <span class="gi">+        var bHeight = this.get(&#39;border-box-height&#39;);</span>
        <span class="gi">+        if (bHeight &lt;= 0) return 0;</span>
        <span class="gi">+</span>
        <span class="gi">+        var bTop = this.get(&#39;border-top&#39;),</span>
        <span class="gi">+         bBottom = this.get(&#39;border-bottom&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        var pTop = this.get(&#39;padding-top&#39;),</span>
        <span class="gi">+         pBottom = this.get(&#39;padding-bottom&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        if (!this._preComputing) this._end();</span>
        <span class="gi">+</span>
        <span class="gi">+        return bHeight - bTop - bBottom - pTop - pBottom;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;width&#39;: function(element) {</span>
        <span class="gi">+        if (!this._preComputing) this._begin();</span>
        <span class="gi">+</span>
        <span class="gi">+        var bWidth = this.get(&#39;border-box-width&#39;);</span>
        <span class="gi">+        if (bWidth &lt;= 0) return 0;</span>
        <span class="gi">+</span>
        <span class="gi">+        var bLeft = this.get(&#39;border-left&#39;),</span>
        <span class="gi">+         bRight = this.get(&#39;border-right&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        var pLeft = this.get(&#39;padding-left&#39;),</span>
        <span class="gi">+         pRight = this.get(&#39;padding-right&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        if (!this._preComputing) this._end();</span>
        <span class="gi">+</span>
        <span class="gi">+        return bWidth - bLeft - bRight - pLeft - pRight;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;padding-box-height&#39;: function(element) {</span>
        <span class="gi">+        var height = this.get(&#39;height&#39;),</span>
        <span class="gi">+         pTop = this.get(&#39;padding-top&#39;),</span>
        <span class="gi">+         pBottom = this.get(&#39;padding-bottom&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        return height + pTop + pBottom;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;padding-box-width&#39;: function(element) {</span>
        <span class="gi">+        var width = this.get(&#39;width&#39;),</span>
        <span class="gi">+         pLeft = this.get(&#39;padding-left&#39;),</span>
        <span class="gi">+         pRight = this.get(&#39;padding-right&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        return width + pLeft + pRight;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;border-box-height&#39;: function(element) {</span>
        <span class="gi">+        return element.offsetHeight;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;border-box-width&#39;: function(element) {</span>
        <span class="gi">+        return element.offsetWidth;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;margin-box-height&#39;: function(element) {</span>
        <span class="gi">+        var bHeight = this.get(&#39;border-box-height&#39;),</span>
        <span class="gi">+         mTop = this.get(&#39;margin-top&#39;),</span>
        <span class="gi">+         mBottom = this.get(&#39;margin-bottom&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        if (bHeight &lt;= 0) return 0;</span>
        <span class="gi">+</span>
        <span class="gi">+        return bHeight + mTop + mBottom;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;margin-box-width&#39;: function(element) {</span>
        <span class="gi">+        var bWidth = this.get(&#39;border-box-width&#39;),</span>
        <span class="gi">+         mLeft = this.get(&#39;margin-left&#39;),</span>
        <span class="gi">+         mRight = this.get(&#39;margin-right&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        if (bWidth &lt;= 0) return 0;</span>
        <span class="gi">+</span>
        <span class="gi">+        return bWidth + mLeft + mRight;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;top&#39;: function(element) {</span>
        <span class="gi">+        var offset = element.positionedOffset();</span>
        <span class="gi">+        return offset.top;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;bottom&#39;: function(element) {</span>
        <span class="gi">+        var offset = element.positionedOffset(),</span>
        <span class="gi">+         parent = element.getOffsetParent(),</span>
        <span class="gi">+         pHeight = parent.measure(&#39;height&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        var mHeight = this.get(&#39;border-box-height&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        return pHeight - mHeight - offset.top;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;left&#39;: function(element) {</span>
        <span class="gi">+        var offset = element.positionedOffset();</span>
        <span class="gi">+        return offset.left;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;right&#39;: function(element) {</span>
        <span class="gi">+        var offset = element.positionedOffset(),</span>
        <span class="gi">+         parent = element.getOffsetParent(),</span>
        <span class="gi">+         pWidth = parent.measure(&#39;width&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        var mWidth = this.get(&#39;border-box-width&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        return pWidth - mWidth - offset.left;</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;padding-top&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;paddingTop&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;padding-bottom&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;paddingBottom&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;padding-left&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;paddingLeft&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;padding-right&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;paddingRight&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;border-top&#39;: function(element) {</span>
        <span class="gi">+        return Object.isNumber(element.clientTop) ? element.clientTop :</span>
        <span class="gi">+         getPixelValue(element, &#39;borderTopWidth&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;border-bottom&#39;: function(element) {</span>
        <span class="gi">+        return Object.isNumber(element.clientBottom) ? element.clientBottom :</span>
        <span class="gi">+         getPixelValue(element, &#39;borderBottomWidth&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;border-left&#39;: function(element) {</span>
        <span class="gi">+        return Object.isNumber(element.clientLeft) ? element.clientLeft :</span>
        <span class="gi">+         getPixelValue(element, &#39;borderLeftWidth&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;border-right&#39;: function(element) {</span>
        <span class="gi">+        return Object.isNumber(element.clientRight) ? element.clientRight :</span>
        <span class="gi">+         getPixelValue(element, &#39;borderRightWidth&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;margin-top&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;marginTop&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;margin-bottom&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;marginBottom&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;margin-left&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;marginLeft&#39;);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;margin-right&#39;: function(element) {</span>
        <span class="gi">+        return getPixelValue(element, &#39;marginRight&#39;);</span>
               }
        <span class="gd">-      return (targetNode &amp;&amp; Element.descendantOf(targetNode, root)) ? [targetNode] : [];</span>
        <span class="gi">+    }</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  if (&#39;getBoundingClientRect&#39; in document.documentElement) {</span>
        <span class="gi">+    Object.extend(Element.Layout.COMPUTATIONS, {</span>
        <span class="gi">+      &#39;right&#39;: function(element) {</span>
        <span class="gi">+        var parent = hasLayout(element.getOffsetParent());</span>
        <span class="gi">+        var rect = element.getBoundingClientRect(),</span>
        <span class="gi">+         pRect = parent.getBoundingClientRect();</span>
        <span class="gi">+</span>
        <span class="gi">+        return (pRect.right - rect.right).round();</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      &#39;bottom&#39;: function(element) {</span>
        <span class="gi">+        var parent = hasLayout(element.getOffsetParent());</span>
        <span class="gi">+        var rect = element.getBoundingClientRect(),</span>
        <span class="gi">+         pRect = parent.getBoundingClientRect();</span>
        <span class="gi">+</span>
        <span class="gi">+        return (pRect.bottom - rect.bottom).round();</span>
        <span class="gi">+      }</span>
        <span class="gi">+    });</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  Element.Offset = Class.create({</span>
        <span class="gi">+    initialize: function(left, top) {</span>
        <span class="gi">+      this.left = left.round();</span>
        <span class="gi">+      this.top  = top.round();</span>
        <span class="gi">+</span>
        <span class="gi">+      this[0] = this.left;</span>
        <span class="gi">+      this[1] = this.top;</span>
             },
         
        <span class="gd">-    className: function(nodes, root, className, combinator) {</span>
        <span class="gd">-      if (nodes &amp;&amp; combinator) nodes = this[combinator](nodes);</span>
        <span class="gd">-      return Selector.handlers.byClassName(nodes, root, className);</span>
        <span class="gi">+    relativeTo: function(offset) {</span>
        <span class="gi">+      return new Element.Offset(</span>
        <span class="gi">+        this.left - offset.left,</span>
        <span class="gi">+        this.top  - offset.top</span>
        <span class="gi">+      );</span>
             },
         
        <span class="gd">-    byClassName: function(nodes, root, className) {</span>
        <span class="gd">-      if (!nodes) nodes = Selector.handlers.descendant([root]);</span>
        <span class="gd">-      var needle = &#39; &#39; + className + &#39; &#39;;</span>
        <span class="gd">-      for (var i = 0, results = [], node, nodeClassName; node = nodes[i]; i++) {</span>
        <span class="gd">-        nodeClassName = node.className;</span>
        <span class="gd">-        if (nodeClassName.length == 0) continue;</span>
        <span class="gd">-        if (nodeClassName == className || (&#39; &#39; + nodeClassName + &#39; &#39;).include(needle))</span>
        <span class="gd">-          results.push(node);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return results;</span>
        <span class="gi">+    inspect: function() {</span>
        <span class="gi">+      return &quot;#&lt;Element.Offset left: #{left} top: #{top}&gt;&quot;.interpolate(this);</span>
             },
         
        <span class="gd">-    attrPresence: function(nodes, root, attr, combinator) {</span>
        <span class="gd">-      if (!nodes) nodes = root.getElementsByTagName(&quot;*&quot;);</span>
        <span class="gd">-      if (nodes &amp;&amp; combinator) nodes = this[combinator](nodes);</span>
        <span class="gd">-      var results = [];</span>
        <span class="gd">-      for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-        if (Element.hasAttribute(node, attr)) results.push(node);</span>
        <span class="gd">-      return results;</span>
        <span class="gi">+    toString: function() {</span>
        <span class="gi">+      return &quot;[#{left}, #{top}]&quot;.interpolate(this);</span>
             },
         
        <span class="gd">-    attr: function(nodes, root, attr, value, operator, combinator) {</span>
        <span class="gd">-      if (!nodes) nodes = root.getElementsByTagName(&quot;*&quot;);</span>
        <span class="gd">-      if (nodes &amp;&amp; combinator) nodes = this[combinator](nodes);</span>
        <span class="gd">-      var handler = Selector.operators[operator], results = [];</span>
        <span class="gd">-      for (var i = 0, node; node = nodes[i]; i++) {</span>
        <span class="gd">-        var nodeValue = Element.readAttribute(node, attr);</span>
        <span class="gd">-        if (nodeValue === null) continue;</span>
        <span class="gd">-        if (handler(nodeValue, value)) results.push(node);</span>
        <span class="gi">+    toArray: function() {</span>
        <span class="gi">+      return [this.left, this.top];</span>
        <span class="gi">+    }</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  function getLayout(element, preCompute) {</span>
        <span class="gi">+    return new Element.Layout(element, preCompute);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function measure(element, property) {</span>
        <span class="gi">+    return $(element).getLayout().get(property);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function getDimensions(element) {</span>
        <span class="gi">+    var layout = $(element).getLayout();</span>
        <span class="gi">+    return {</span>
        <span class="gi">+      width:  layout.get(&#39;width&#39;),</span>
        <span class="gi">+      height: layout.get(&#39;height&#39;)</span>
        <span class="gi">+    };</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function getOffsetParent(element) {</span>
        <span class="gi">+    if (isDetached(element)) return $(document.body);</span>
        <span class="gi">+</span>
        <span class="gi">+    var isInline = (Element.getStyle(element, &#39;display&#39;) === &#39;inline&#39;);</span>
        <span class="gi">+    if (!isInline &amp;&amp; element.offsetParent) return $(element.offsetParent);</span>
        <span class="gi">+    if (element === document.body) return $(element);</span>
        <span class="gi">+</span>
        <span class="gi">+    while ((element = element.parentNode) &amp;&amp; element !== document.body) {</span>
        <span class="gi">+      if (Element.getStyle(element, &#39;position&#39;) !== &#39;static&#39;) {</span>
        <span class="gi">+        return (element.nodeName === &#39;HTML&#39;) ? $(document.body) : $(element);</span>
               }
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    return $(document.body);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  function cumulativeOffset(element) {</span>
        <span class="gi">+    var valueT = 0, valueL = 0;</span>
        <span class="gi">+    do {</span>
        <span class="gi">+      valueT += element.offsetTop  || 0;</span>
        <span class="gi">+      valueL += element.offsetLeft || 0;</span>
        <span class="gi">+      element = element.offsetParent;</span>
        <span class="gi">+    } while (element);</span>
        <span class="gi">+    return new Element.Offset(valueL, valueT);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function positionedOffset(element) {</span>
        <span class="gi">+    var layout = element.getLayout();</span>
        <span class="gi">+</span>
        <span class="gi">+    var valueT = 0, valueL = 0;</span>
        <span class="gi">+    do {</span>
        <span class="gi">+      valueT += element.offsetTop  || 0;</span>
        <span class="gi">+      valueL += element.offsetLeft || 0;</span>
        <span class="gi">+      element = element.offsetParent;</span>
        <span class="gi">+      if (element) {</span>
        <span class="gi">+        if (isBody(element)) break;</span>
        <span class="gi">+        var p = Element.getStyle(element, &#39;position&#39;);</span>
        <span class="gi">+        if (p !== &#39;static&#39;) break;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    } while (element);</span>
        <span class="gi">+</span>
        <span class="gi">+    valueL -= layout.get(&#39;margin-top&#39;);</span>
        <span class="gi">+    valueT -= layout.get(&#39;margin-left&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+    return new Element.Offset(valueL, valueT);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function cumulativeScrollOffset(element) {</span>
        <span class="gi">+    var valueT = 0, valueL = 0;</span>
        <span class="gi">+    do {</span>
        <span class="gi">+      valueT += element.scrollTop  || 0;</span>
        <span class="gi">+      valueL += element.scrollLeft || 0;</span>
        <span class="gi">+      element = element.parentNode;</span>
        <span class="gi">+    } while (element);</span>
        <span class="gi">+    return new Element.Offset(valueL, valueT);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function viewportOffset(forElement) {</span>
        <span class="gi">+    var valueT = 0, valueL = 0, docBody = document.body;</span>
        <span class="gi">+</span>
        <span class="gi">+    var element = forElement;</span>
        <span class="gi">+    do {</span>
        <span class="gi">+      valueT += element.offsetTop  || 0;</span>
        <span class="gi">+      valueL += element.offsetLeft || 0;</span>
        <span class="gi">+      if (element.offsetParent == docBody &amp;&amp;</span>
        <span class="gi">+        Element.getStyle(element, &#39;position&#39;) == &#39;absolute&#39;) break;</span>
        <span class="gi">+    } while (element = element.offsetParent);</span>
        <span class="gi">+</span>
        <span class="gi">+    element = forElement;</span>
        <span class="gi">+    do {</span>
        <span class="gi">+      if (element != docBody) {</span>
        <span class="gi">+        valueT -= element.scrollTop  || 0;</span>
        <span class="gi">+        valueL -= element.scrollLeft || 0;</span>
        <span class="gi">+      }</span>
        <span class="gi">+    } while (element = element.parentNode);</span>
        <span class="gi">+    return new Element.Offset(valueL, valueT);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function absolutize(element) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (Element.getStyle(element, &#39;position&#39;) === &#39;absolute&#39;) {</span>
        <span class="gi">+      return element;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    var offsetParent = getOffsetParent(element);</span>
        <span class="gi">+    var eOffset = element.viewportOffset(),</span>
        <span class="gi">+     pOffset = offsetParent.viewportOffset();</span>
        <span class="gi">+</span>
        <span class="gi">+    var offset = eOffset.relativeTo(pOffset);</span>
        <span class="gi">+    var layout = element.getLayout();</span>
        <span class="gi">+</span>
        <span class="gi">+    element.store(&#39;prototype_absolutize_original_styles&#39;, {</span>
        <span class="gi">+      left:   element.getStyle(&#39;left&#39;),</span>
        <span class="gi">+      top:    element.getStyle(&#39;top&#39;),</span>
        <span class="gi">+      width:  element.getStyle(&#39;width&#39;),</span>
        <span class="gi">+      height: element.getStyle(&#39;height&#39;)</span>
        <span class="gi">+    });</span>
        <span class="gi">+</span>
        <span class="gi">+    element.setStyle({</span>
        <span class="gi">+      position: &#39;absolute&#39;,</span>
        <span class="gi">+      top:    offset.top + &#39;px&#39;,</span>
        <span class="gi">+      left:   offset.left + &#39;px&#39;,</span>
        <span class="gi">+      width:  layout.get(&#39;width&#39;) + &#39;px&#39;,</span>
        <span class="gi">+      height: layout.get(&#39;height&#39;) + &#39;px&#39;</span>
        <span class="gi">+    });</span>
        <span class="gi">+</span>
        <span class="gi">+    return element;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function relativize(element) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+    if (Element.getStyle(element, &#39;position&#39;) === &#39;relative&#39;) {</span>
        <span class="gi">+      return element;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    var originalStyles =</span>
        <span class="gi">+     element.retrieve(&#39;prototype_absolutize_original_styles&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (originalStyles) element.setStyle(originalStyles);</span>
        <span class="gi">+    return element;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  Element.addMethods({</span>
        <span class="gi">+    getLayout:              getLayout,</span>
        <span class="gi">+    measure:                measure,</span>
        <span class="gi">+    getDimensions:          getDimensions,</span>
        <span class="gi">+    getOffsetParent:        getOffsetParent,</span>
        <span class="gi">+    cumulativeOffset:       cumulativeOffset,</span>
        <span class="gi">+    positionedOffset:       positionedOffset,</span>
        <span class="gi">+    cumulativeScrollOffset: cumulativeScrollOffset,</span>
        <span class="gi">+    viewportOffset:         viewportOffset,</span>
        <span class="gi">+    absolutize:             absolutize,</span>
        <span class="gi">+    relativize:             relativize</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  function isBody(element) {</span>
        <span class="gi">+    return element.nodeName.toUpperCase() === &#39;BODY&#39;;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function isDetached(element) {</span>
        <span class="gi">+    return element !== document.body &amp;&amp;</span>
        <span class="gi">+     !Element.descendantOf(element, document.body);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  if (&#39;getBoundingClientRect&#39; in document.documentElement) {</span>
        <span class="gi">+    Element.addMethods({</span>
        <span class="gi">+      viewportOffset: function(element) {</span>
        <span class="gi">+        element = $(element);</span>
        <span class="gi">+        if (isDetached(element)) return new Element.Offset(0, 0);</span>
        <span class="gi">+</span>
        <span class="gi">+        var rect  = element.getBoundingClientRect(),</span>
        <span class="gi">+         docEl = document.documentElement;</span>
        <span class="gi">+        return new Element.Offset(rect.left - docEl.clientLeft,</span>
        <span class="gi">+         rect.top - docEl.clientTop);</span>
        <span class="gi">+      },</span>
        <span class="gi">+</span>
        <span class="gi">+      positionedOffset: function(element) {</span>
        <span class="gi">+        element = $(element);</span>
        <span class="gi">+        var parent = element.getOffsetParent();</span>
        <span class="gi">+        if (isDetached(element)) return new Element.Offset(0, 0);</span>
        <span class="gi">+</span>
        <span class="gi">+        if (element.offsetParent &amp;&amp;</span>
        <span class="gi">+         element.offsetParent.nodeName.toUpperCase() === &#39;HTML&#39;) {</span>
        <span class="gi">+          return positionedOffset(element);</span>
        <span class="gi">+        }</span>
        <span class="gi">+</span>
        <span class="gi">+        var eOffset = element.viewportOffset(),</span>
        <span class="gi">+         pOffset = isBody(parent) ? viewportOffset(parent) :</span>
        <span class="gi">+          parent.viewportOffset();</span>
        <span class="gi">+        var retOffset = eOffset.relativeTo(pOffset);</span>
        <span class="gi">+</span>
        <span class="gi">+        var layout = element.getLayout();</span>
        <span class="gi">+        var top  = retOffset.top  - layout.get(&#39;margin-top&#39;);</span>
        <span class="gi">+        var left = retOffset.left - layout.get(&#39;margin-left&#39;);</span>
        <span class="gi">+</span>
        <span class="gi">+        return new Element.Offset(left, top);</span>
        <span class="gi">+      }</span>
        <span class="gi">+    });</span>
        <span class="gi">+  }</span>
        <span class="gi">+})();</span>
        <span class="gi">+window.$$ = function() {</span>
        <span class="gi">+  var expression = $A(arguments).join(&#39;, &#39;);</span>
        <span class="gi">+  return Prototype.Selector.select(expression, document);</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+Prototype.Selector = (function() {</span>
        <span class="gi">+</span>
        <span class="gi">+  function select() {</span>
        <span class="gi">+    throw new Error(&#39;Method &quot;Prototype.Selector.select&quot; must be defined.&#39;);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function match() {</span>
        <span class="gi">+    throw new Error(&#39;Method &quot;Prototype.Selector.match&quot; must be defined.&#39;);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function find(elements, expression, index) {</span>
        <span class="gi">+    index = index || 0;</span>
        <span class="gi">+    var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;</span>
        <span class="gi">+</span>
        <span class="gi">+    for (i = 0; i &lt; length; i++) {</span>
        <span class="gi">+      if (match(elements[i], expression) &amp;&amp; index == matchIndex++) {</span>
        <span class="gi">+        return Element.extend(elements[i]);</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function extendElements(elements) {</span>
        <span class="gi">+    for (var i = 0, length = elements.length; i &lt; length; i++) {</span>
        <span class="gi">+      Element.extend(elements[i]);</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return elements;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  var K = Prototype.K;</span>
        <span class="gi">+</span>
        <span class="gi">+  return {</span>
        <span class="gi">+    select: select,</span>
        <span class="gi">+    match: match,</span>
        <span class="gi">+    find: find,</span>
        <span class="gi">+    extendElements: (Element.extend === K) ? K : extendElements,</span>
        <span class="gi">+    extendElement: Element.extend</span>
        <span class="gi">+  };</span>
        <span class="gi">+})();</span>
        <span class="gi">+Prototype._original_property = window.Sizzle;</span>
        <span class="gi">+/*!</span>
        <span class="gi">+ * Sizzle CSS Selector Engine - v1.0</span>
        <span class="gi">+ *  Copyright 2009, The Dojo Foundation</span>
        <span class="gi">+ *  Released under the MIT, BSD, and GPL Licenses.</span>
        <span class="gi">+ *  More information: http://sizzlejs.com/</span>
        <span class="gi">+ */</span>
        <span class="gi">+(function(){</span>
        <span class="gi">+</span>
        <span class="gi">+var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|[&#39;&quot;][^&#39;&quot;]*[&#39;&quot;]|[^[\]&#39;&quot;]+)+\]|\\.|[^ &gt;+~,(\[\\]+)+|[&gt;+~])(\s*,\s*)?((?:.|\r|\n)*)/g,</span>
        <span class="gi">+	done = 0,</span>
        <span class="gi">+	toString = Object.prototype.toString,</span>
        <span class="gi">+	hasDuplicate = false,</span>
        <span class="gi">+	baseHasDuplicate = true;</span>
        <span class="gi">+</span>
        <span class="gi">+[0, 0].sort(function(){</span>
        <span class="gi">+	baseHasDuplicate = false;</span>
        <span class="gi">+	return 0;</span>
        <span class="gi">+});</span>
        <span class="gi">+</span>
        <span class="gi">+var Sizzle = function(selector, context, results, seed) {</span>
        <span class="gi">+	results = results || [];</span>
        <span class="gi">+	var origContext = context = context || document;</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( context.nodeType !== 1 &amp;&amp; context.nodeType !== 9 ) {</span>
        <span class="gi">+		return [];</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( !selector || typeof selector !== &quot;string&quot; ) {</span>
        <span class="gi">+		return results;</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	var parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context),</span>
        <span class="gi">+		soFar = selector;</span>
        <span class="gi">+</span>
        <span class="gi">+	while ( (chunker.exec(&quot;&quot;), m = chunker.exec(soFar)) !== null ) {</span>
        <span class="gi">+		soFar = m[3];</span>
        <span class="gi">+</span>
        <span class="gi">+		parts.push( m[1] );</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( m[2] ) {</span>
        <span class="gi">+			extra = m[3];</span>
        <span class="gi">+			break;</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( parts.length &gt; 1 &amp;&amp; origPOS.exec( selector ) ) {</span>
        <span class="gi">+		if ( parts.length === 2 &amp;&amp; Expr.relative[ parts[0] ] ) {</span>
        <span class="gi">+			set = posProcess( parts[0] + parts[1], context );</span>
        <span class="gi">+		} else {</span>
        <span class="gi">+			set = Expr.relative[ parts[0] ] ?</span>
        <span class="gi">+				[ context ] :</span>
        <span class="gi">+				Sizzle( parts.shift(), context );</span>
        <span class="gi">+</span>
        <span class="gi">+			while ( parts.length ) {</span>
        <span class="gi">+				selector = parts.shift();</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( Expr.relative[ selector ] )</span>
        <span class="gi">+					selector += parts.shift();</span>
        <span class="gi">+</span>
        <span class="gi">+				set = posProcess( selector, set );</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+	} else {</span>
        <span class="gi">+		if ( !seed &amp;&amp; parts.length &gt; 1 &amp;&amp; context.nodeType === 9 &amp;&amp; !contextXML &amp;&amp;</span>
        <span class="gi">+				Expr.match.ID.test(parts[0]) &amp;&amp; !Expr.match.ID.test(parts[parts.length - 1]) ) {</span>
        <span class="gi">+			var ret = Sizzle.find( parts.shift(), context, contextXML );</span>
        <span class="gi">+			context = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( context ) {</span>
        <span class="gi">+			var ret = seed ?</span>
        <span class="gi">+				{ expr: parts.pop(), set: makeArray(seed) } :</span>
        <span class="gi">+				Sizzle.find( parts.pop(), parts.length === 1 &amp;&amp; (parts[0] === &quot;~&quot; || parts[0] === &quot;+&quot;) &amp;&amp; context.parentNode ? context.parentNode : context, contextXML );</span>
        <span class="gi">+			set = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( parts.length &gt; 0 ) {</span>
        <span class="gi">+				checkSet = makeArray(set);</span>
        <span class="gi">+			} else {</span>
        <span class="gi">+				prune = false;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			while ( parts.length ) {</span>
        <span class="gi">+				var cur = parts.pop(), pop = cur;</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( !Expr.relative[ cur ] ) {</span>
        <span class="gi">+					cur = &quot;&quot;;</span>
        <span class="gi">+				} else {</span>
        <span class="gi">+					pop = parts.pop();</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( pop == null ) {</span>
        <span class="gi">+					pop = context;</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				Expr.relative[ cur ]( checkSet, pop, contextXML );</span>
        <span class="gi">+			}</span>
        <span class="gi">+		} else {</span>
        <span class="gi">+			checkSet = parts = [];</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( !checkSet ) {</span>
        <span class="gi">+		checkSet = set;</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( !checkSet ) {</span>
        <span class="gi">+		throw &quot;Syntax error, unrecognized expression: &quot; + (cur || selector);</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( toString.call(checkSet) === &quot;[object Array]&quot; ) {</span>
        <span class="gi">+		if ( !prune ) {</span>
        <span class="gi">+			results.push.apply( results, checkSet );</span>
        <span class="gi">+		} else if ( context &amp;&amp; context.nodeType === 1 ) {</span>
        <span class="gi">+			for ( var i = 0; checkSet[i] != null; i++ ) {</span>
        <span class="gi">+				if ( checkSet[i] &amp;&amp; (checkSet[i] === true || checkSet[i].nodeType === 1 &amp;&amp; contains(context, checkSet[i])) ) {</span>
        <span class="gi">+					results.push( set[i] );</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		} else {</span>
        <span class="gi">+			for ( var i = 0; checkSet[i] != null; i++ ) {</span>
        <span class="gi">+				if ( checkSet[i] &amp;&amp; checkSet[i].nodeType === 1 ) {</span>
        <span class="gi">+					results.push( set[i] );</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+	} else {</span>
        <span class="gi">+		makeArray( checkSet, results );</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( extra ) {</span>
        <span class="gi">+		Sizzle( extra, origContext, results, seed );</span>
        <span class="gi">+		Sizzle.uniqueSort( results );</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	return results;</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+Sizzle.uniqueSort = function(results){</span>
        <span class="gi">+	if ( sortOrder ) {</span>
        <span class="gi">+		hasDuplicate = baseHasDuplicate;</span>
        <span class="gi">+		results.sort(sortOrder);</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( hasDuplicate ) {</span>
        <span class="gi">+			for ( var i = 1; i &lt; results.length; i++ ) {</span>
        <span class="gi">+				if ( results[i] === results[i-1] ) {</span>
        <span class="gi">+					results.splice(i--, 1);</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	return results;</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+Sizzle.matches = function(expr, set){</span>
        <span class="gi">+	return Sizzle(expr, null, null, set);</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+Sizzle.find = function(expr, context, isXML){</span>
        <span class="gi">+	var set, match;</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( !expr ) {</span>
        <span class="gi">+		return [];</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	for ( var i = 0, l = Expr.order.length; i &lt; l; i++ ) {</span>
        <span class="gi">+		var type = Expr.order[i], match;</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( (match = Expr.leftMatch[ type ].exec( expr )) ) {</span>
        <span class="gi">+			var left = match[1];</span>
        <span class="gi">+			match.splice(1,1);</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( left.substr( left.length - 1 ) !== &quot;\\&quot; ) {</span>
        <span class="gi">+				match[1] = (match[1] || &quot;&quot;).replace(/\\/g, &quot;&quot;);</span>
        <span class="gi">+				set = Expr.find[ type ]( match, context, isXML );</span>
        <span class="gi">+				if ( set != null ) {</span>
        <span class="gi">+					expr = expr.replace( Expr.match[ type ], &quot;&quot; );</span>
        <span class="gi">+					break;</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( !set ) {</span>
        <span class="gi">+		set = context.getElementsByTagName(&quot;*&quot;);</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	return {set: set, expr: expr};</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+Sizzle.filter = function(expr, set, inplace, not){</span>
        <span class="gi">+	var old = expr, result = [], curLoop = set, match, anyFound,</span>
        <span class="gi">+		isXMLFilter = set &amp;&amp; set[0] &amp;&amp; isXML(set[0]);</span>
        <span class="gi">+</span>
        <span class="gi">+	while ( expr &amp;&amp; set.length ) {</span>
        <span class="gi">+		for ( var type in Expr.filter ) {</span>
        <span class="gi">+			if ( (match = Expr.match[ type ].exec( expr )) != null ) {</span>
        <span class="gi">+				var filter = Expr.filter[ type ], found, item;</span>
        <span class="gi">+				anyFound = false;</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( curLoop == result ) {</span>
        <span class="gi">+					result = [];</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( Expr.preFilter[ type ] ) {</span>
        <span class="gi">+					match = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );</span>
        <span class="gi">+</span>
        <span class="gi">+					if ( !match ) {</span>
        <span class="gi">+						anyFound = found = true;</span>
        <span class="gi">+					} else if ( match === true ) {</span>
        <span class="gi">+						continue;</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( match ) {</span>
        <span class="gi">+					for ( var i = 0; (item = curLoop[i]) != null; i++ ) {</span>
        <span class="gi">+						if ( item ) {</span>
        <span class="gi">+							found = filter( item, match, i, curLoop );</span>
        <span class="gi">+							var pass = not ^ !!found;</span>
        <span class="gi">+</span>
        <span class="gi">+							if ( inplace &amp;&amp; found != null ) {</span>
        <span class="gi">+								if ( pass ) {</span>
        <span class="gi">+									anyFound = true;</span>
        <span class="gi">+								} else {</span>
        <span class="gi">+									curLoop[i] = false;</span>
        <span class="gi">+								}</span>
        <span class="gi">+							} else if ( pass ) {</span>
        <span class="gi">+								result.push( item );</span>
        <span class="gi">+								anyFound = true;</span>
        <span class="gi">+							}</span>
        <span class="gi">+						}</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( found !== undefined ) {</span>
        <span class="gi">+					if ( !inplace ) {</span>
        <span class="gi">+						curLoop = result;</span>
        <span class="gi">+					}</span>
        <span class="gi">+</span>
        <span class="gi">+					expr = expr.replace( Expr.match[ type ], &quot;&quot; );</span>
        <span class="gi">+</span>
        <span class="gi">+					if ( !anyFound ) {</span>
        <span class="gi">+						return [];</span>
        <span class="gi">+					}</span>
        <span class="gi">+</span>
        <span class="gi">+					break;</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( expr == old ) {</span>
        <span class="gi">+			if ( anyFound == null ) {</span>
        <span class="gi">+				throw &quot;Syntax error, unrecognized expression: &quot; + expr;</span>
        <span class="gi">+			} else {</span>
        <span class="gi">+				break;</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		old = expr;</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	return curLoop;</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+var Expr = Sizzle.selectors = {</span>
        <span class="gi">+	order: [ &quot;ID&quot;, &quot;NAME&quot;, &quot;TAG&quot; ],</span>
        <span class="gi">+	match: {</span>
        <span class="gi">+		ID: /#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,</span>
        <span class="gi">+		CLASS: /\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,</span>
        <span class="gi">+		NAME: /\[name=[&#39;&quot;]*((?:[\w\u00c0-\uFFFF-]|\\.)+)[&#39;&quot;]*\]/,</span>
        <span class="gi">+		ATTR: /\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*([&#39;&quot;]*)(.*?)\3|)\s*\]/,</span>
        <span class="gi">+		TAG: /^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,</span>
        <span class="gi">+		CHILD: /:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,</span>
        <span class="gi">+		POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,</span>
        <span class="gi">+		PSEUDO: /:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\(([&#39;&quot;]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/</span>
        <span class="gi">+	},</span>
        <span class="gi">+	leftMatch: {},</span>
        <span class="gi">+	attrMap: {</span>
        <span class="gi">+		&quot;class&quot;: &quot;className&quot;,</span>
        <span class="gi">+		&quot;for&quot;: &quot;htmlFor&quot;</span>
        <span class="gi">+	},</span>
        <span class="gi">+	attrHandle: {</span>
        <span class="gi">+		href: function(elem){</span>
        <span class="gi">+			return elem.getAttribute(&quot;href&quot;);</span>
        <span class="gi">+		}</span>
        <span class="gi">+	},</span>
        <span class="gi">+	relative: {</span>
        <span class="gi">+		&quot;+&quot;: function(checkSet, part, isXML){</span>
        <span class="gi">+			var isPartStr = typeof part === &quot;string&quot;,</span>
        <span class="gi">+				isTag = isPartStr &amp;&amp; !/\W/.test(part),</span>
        <span class="gi">+				isPartStrNotTag = isPartStr &amp;&amp; !isTag;</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( isTag &amp;&amp; !isXML ) {</span>
        <span class="gi">+				part = part.toUpperCase();</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			for ( var i = 0, l = checkSet.length, elem; i &lt; l; i++ ) {</span>
        <span class="gi">+				if ( (elem = checkSet[i]) ) {</span>
        <span class="gi">+					while ( (elem = elem.previousSibling) &amp;&amp; elem.nodeType !== 1 ) {}</span>
        <span class="gi">+</span>
        <span class="gi">+					checkSet[i] = isPartStrNotTag || elem &amp;&amp; elem.nodeName === part ?</span>
        <span class="gi">+						elem || false :</span>
        <span class="gi">+						elem === part;</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( isPartStrNotTag ) {</span>
        <span class="gi">+				Sizzle.filter( part, checkSet, true );</span>
        <span class="gi">+			}</span>
        <span class="gi">+		},</span>
        <span class="gi">+		&quot;&gt;&quot;: function(checkSet, part, isXML){</span>
        <span class="gi">+			var isPartStr = typeof part === &quot;string&quot;;</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( isPartStr &amp;&amp; !/\W/.test(part) ) {</span>
        <span class="gi">+				part = isXML ? part : part.toUpperCase();</span>
        <span class="gi">+</span>
        <span class="gi">+				for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gi">+					var elem = checkSet[i];</span>
        <span class="gi">+					if ( elem ) {</span>
        <span class="gi">+						var parent = elem.parentNode;</span>
        <span class="gi">+						checkSet[i] = parent.nodeName === part ? parent : false;</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+			} else {</span>
        <span class="gi">+				for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gi">+					var elem = checkSet[i];</span>
        <span class="gi">+					if ( elem ) {</span>
        <span class="gi">+						checkSet[i] = isPartStr ?</span>
        <span class="gi">+							elem.parentNode :</span>
        <span class="gi">+							elem.parentNode === part;</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( isPartStr ) {</span>
        <span class="gi">+					Sizzle.filter( part, checkSet, true );</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		},</span>
        <span class="gi">+		&quot;&quot;: function(checkSet, part, isXML){</span>
        <span class="gi">+			var doneName = done++, checkFn = dirCheck;</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( !/\W/.test(part) ) {</span>
        <span class="gi">+				var nodeCheck = part = isXML ? part : part.toUpperCase();</span>
        <span class="gi">+				checkFn = dirNodeCheck;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			checkFn(&quot;parentNode&quot;, part, doneName, checkSet, nodeCheck, isXML);</span>
        <span class="gi">+		},</span>
        <span class="gi">+		&quot;~&quot;: function(checkSet, part, isXML){</span>
        <span class="gi">+			var doneName = done++, checkFn = dirCheck;</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( typeof part === &quot;string&quot; &amp;&amp; !/\W/.test(part) ) {</span>
        <span class="gi">+				var nodeCheck = part = isXML ? part : part.toUpperCase();</span>
        <span class="gi">+				checkFn = dirNodeCheck;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			checkFn(&quot;previousSibling&quot;, part, doneName, checkSet, nodeCheck, isXML);</span>
        <span class="gi">+		}</span>
        <span class="gi">+	},</span>
        <span class="gi">+	find: {</span>
        <span class="gi">+		ID: function(match, context, isXML){</span>
        <span class="gi">+			if ( typeof context.getElementById !== &quot;undefined&quot; &amp;&amp; !isXML ) {</span>
        <span class="gi">+				var m = context.getElementById(match[1]);</span>
        <span class="gi">+				return m ? [m] : [];</span>
        <span class="gi">+			}</span>
        <span class="gi">+		},</span>
        <span class="gi">+		NAME: function(match, context, isXML){</span>
        <span class="gi">+			if ( typeof context.getElementsByName !== &quot;undefined&quot; ) {</span>
        <span class="gi">+				var ret = [], results = context.getElementsByName(match[1]);</span>
        <span class="gi">+</span>
        <span class="gi">+				for ( var i = 0, l = results.length; i &lt; l; i++ ) {</span>
        <span class="gi">+					if ( results[i].getAttribute(&quot;name&quot;) === match[1] ) {</span>
        <span class="gi">+						ret.push( results[i] );</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				return ret.length === 0 ? null : ret;</span>
        <span class="gi">+			}</span>
        <span class="gi">+		},</span>
        <span class="gi">+		TAG: function(match, context){</span>
        <span class="gi">+			return context.getElementsByTagName(match[1]);</span>
        <span class="gi">+		}</span>
        <span class="gi">+	},</span>
        <span class="gi">+	preFilter: {</span>
        <span class="gi">+		CLASS: function(match, curLoop, inplace, result, not, isXML){</span>
        <span class="gi">+			match = &quot; &quot; + match[1].replace(/\\/g, &quot;&quot;) + &quot; &quot;;</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( isXML ) {</span>
        <span class="gi">+				return match;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			for ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {</span>
        <span class="gi">+				if ( elem ) {</span>
        <span class="gi">+					if ( not ^ (elem.className &amp;&amp; (&quot; &quot; + elem.className + &quot; &quot;).indexOf(match) &gt;= 0) ) {</span>
        <span class="gi">+						if ( !inplace )</span>
        <span class="gi">+							result.push( elem );</span>
        <span class="gi">+					} else if ( inplace ) {</span>
        <span class="gi">+						curLoop[i] = false;</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			return false;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		ID: function(match){</span>
        <span class="gi">+			return match[1].replace(/\\/g, &quot;&quot;);</span>
        <span class="gi">+		},</span>
        <span class="gi">+		TAG: function(match, curLoop){</span>
        <span class="gi">+			for ( var i = 0; curLoop[i] === false; i++ ){}</span>
        <span class="gi">+			return curLoop[i] &amp;&amp; isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();</span>
        <span class="gi">+		},</span>
        <span class="gi">+		CHILD: function(match){</span>
        <span class="gi">+			if ( match[1] == &quot;nth&quot; ) {</span>
        <span class="gi">+				var test = /(-?)(\d*)n((?:\+|-)?\d*)/.exec(</span>
        <span class="gi">+					match[2] == &quot;even&quot; &amp;&amp; &quot;2n&quot; || match[2] == &quot;odd&quot; &amp;&amp; &quot;2n+1&quot; ||</span>
        <span class="gi">+					!/\D/.test( match[2] ) &amp;&amp; &quot;0n+&quot; + match[2] || match[2]);</span>
        <span class="gi">+</span>
        <span class="gi">+				match[2] = (test[1] + (test[2] || 1)) - 0;</span>
        <span class="gi">+				match[3] = test[3] - 0;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			match[0] = done++;</span>
        <span class="gi">+</span>
        <span class="gi">+			return match;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		ATTR: function(match, curLoop, inplace, result, not, isXML){</span>
        <span class="gi">+			var name = match[1].replace(/\\/g, &quot;&quot;);</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( !isXML &amp;&amp; Expr.attrMap[name] ) {</span>
        <span class="gi">+				match[1] = Expr.attrMap[name];</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( match[2] === &quot;~=&quot; ) {</span>
        <span class="gi">+				match[4] = &quot; &quot; + match[4] + &quot; &quot;;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			return match;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		PSEUDO: function(match, curLoop, inplace, result, not){</span>
        <span class="gi">+			if ( match[1] === &quot;not&quot; ) {</span>
        <span class="gi">+				if ( ( chunker.exec(match[3]) || &quot;&quot; ).length &gt; 1 || /^\w/.test(match[3]) ) {</span>
        <span class="gi">+					match[3] = Sizzle(match[3], null, null, curLoop);</span>
        <span class="gi">+				} else {</span>
        <span class="gi">+					var ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);</span>
        <span class="gi">+					if ( !inplace ) {</span>
        <span class="gi">+						result.push.apply( result, ret );</span>
        <span class="gi">+					}</span>
        <span class="gi">+					return false;</span>
        <span class="gi">+				}</span>
        <span class="gi">+			} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {</span>
        <span class="gi">+				return true;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			return match;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		POS: function(match){</span>
        <span class="gi">+			match.unshift( true );</span>
        <span class="gi">+			return match;</span>
        <span class="gi">+		}</span>
        <span class="gi">+	},</span>
        <span class="gi">+	filters: {</span>
        <span class="gi">+		enabled: function(elem){</span>
        <span class="gi">+			return elem.disabled === false &amp;&amp; elem.type !== &quot;hidden&quot;;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		disabled: function(elem){</span>
        <span class="gi">+			return elem.disabled === true;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		checked: function(elem){</span>
        <span class="gi">+			return elem.checked === true;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		selected: function(elem){</span>
        <span class="gi">+			elem.parentNode.selectedIndex;</span>
        <span class="gi">+			return elem.selected === true;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		parent: function(elem){</span>
        <span class="gi">+			return !!elem.firstChild;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		empty: function(elem){</span>
        <span class="gi">+			return !elem.firstChild;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		has: function(elem, i, match){</span>
        <span class="gi">+			return !!Sizzle( match[3], elem ).length;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		header: function(elem){</span>
        <span class="gi">+			return /h\d/i.test( elem.nodeName );</span>
        <span class="gi">+		},</span>
        <span class="gi">+		text: function(elem){</span>
        <span class="gi">+			return &quot;text&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		radio: function(elem){</span>
        <span class="gi">+			return &quot;radio&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		checkbox: function(elem){</span>
        <span class="gi">+			return &quot;checkbox&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		file: function(elem){</span>
        <span class="gi">+			return &quot;file&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		password: function(elem){</span>
        <span class="gi">+			return &quot;password&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		submit: function(elem){</span>
        <span class="gi">+			return &quot;submit&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		image: function(elem){</span>
        <span class="gi">+			return &quot;image&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		reset: function(elem){</span>
        <span class="gi">+			return &quot;reset&quot; === elem.type;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		button: function(elem){</span>
        <span class="gi">+			return &quot;button&quot; === elem.type || elem.nodeName.toUpperCase() === &quot;BUTTON&quot;;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		input: function(elem){</span>
        <span class="gi">+			return /input|select|textarea|button/i.test(elem.nodeName);</span>
        <span class="gi">+		}</span>
        <span class="gi">+	},</span>
        <span class="gi">+	setFilters: {</span>
        <span class="gi">+		first: function(elem, i){</span>
        <span class="gi">+			return i === 0;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		last: function(elem, i, match, array){</span>
        <span class="gi">+			return i === array.length - 1;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		even: function(elem, i){</span>
        <span class="gi">+			return i % 2 === 0;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		odd: function(elem, i){</span>
        <span class="gi">+			return i % 2 === 1;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		lt: function(elem, i, match){</span>
        <span class="gi">+			return i &lt; match[3] - 0;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		gt: function(elem, i, match){</span>
        <span class="gi">+			return i &gt; match[3] - 0;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		nth: function(elem, i, match){</span>
        <span class="gi">+			return match[3] - 0 == i;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		eq: function(elem, i, match){</span>
        <span class="gi">+			return match[3] - 0 == i;</span>
        <span class="gi">+		}</span>
        <span class="gi">+	},</span>
        <span class="gi">+	filter: {</span>
        <span class="gi">+		PSEUDO: function(elem, match, i, array){</span>
        <span class="gi">+			var name = match[1], filter = Expr.filters[ name ];</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( filter ) {</span>
        <span class="gi">+				return filter( elem, i, match, array );</span>
        <span class="gi">+			} else if ( name === &quot;contains&quot; ) {</span>
        <span class="gi">+				return (elem.textContent || elem.innerText || &quot;&quot;).indexOf(match[3]) &gt;= 0;</span>
        <span class="gi">+			} else if ( name === &quot;not&quot; ) {</span>
        <span class="gi">+				var not = match[3];</span>
        <span class="gi">+</span>
        <span class="gi">+				for ( var i = 0, l = not.length; i &lt; l; i++ ) {</span>
        <span class="gi">+					if ( not[i] === elem ) {</span>
        <span class="gi">+						return false;</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				return true;</span>
        <span class="gi">+			}</span>
        <span class="gi">+		},</span>
        <span class="gi">+		CHILD: function(elem, match){</span>
        <span class="gi">+			var type = match[1], node = elem;</span>
        <span class="gi">+			switch (type) {</span>
        <span class="gi">+				case &#39;only&#39;:</span>
        <span class="gi">+				case &#39;first&#39;:</span>
        <span class="gi">+					while ( (node = node.previousSibling) )  {</span>
        <span class="gi">+						if ( node.nodeType === 1 ) return false;</span>
        <span class="gi">+					}</span>
        <span class="gi">+					if ( type == &#39;first&#39;) return true;</span>
        <span class="gi">+					node = elem;</span>
        <span class="gi">+				case &#39;last&#39;:</span>
        <span class="gi">+					while ( (node = node.nextSibling) )  {</span>
        <span class="gi">+						if ( node.nodeType === 1 ) return false;</span>
        <span class="gi">+					}</span>
        <span class="gi">+					return true;</span>
        <span class="gi">+				case &#39;nth&#39;:</span>
        <span class="gi">+					var first = match[2], last = match[3];</span>
        <span class="gi">+</span>
        <span class="gi">+					if ( first == 1 &amp;&amp; last == 0 ) {</span>
        <span class="gi">+						return true;</span>
        <span class="gi">+					}</span>
        <span class="gi">+</span>
        <span class="gi">+					var doneName = match[0],</span>
        <span class="gi">+						parent = elem.parentNode;</span>
        <span class="gi">+</span>
        <span class="gi">+					if ( parent &amp;&amp; (parent.sizcache !== doneName || !elem.nodeIndex) ) {</span>
        <span class="gi">+						var count = 0;</span>
        <span class="gi">+						for ( node = parent.firstChild; node; node = node.nextSibling ) {</span>
        <span class="gi">+							if ( node.nodeType === 1 ) {</span>
        <span class="gi">+								node.nodeIndex = ++count;</span>
        <span class="gi">+							}</span>
        <span class="gi">+						}</span>
        <span class="gi">+						parent.sizcache = doneName;</span>
        <span class="gi">+					}</span>
        <span class="gi">+</span>
        <span class="gi">+					var diff = elem.nodeIndex - last;</span>
        <span class="gi">+					if ( first == 0 ) {</span>
        <span class="gi">+						return diff == 0;</span>
        <span class="gi">+					} else {</span>
        <span class="gi">+						return ( diff % first == 0 &amp;&amp; diff / first &gt;= 0 );</span>
        <span class="gi">+					}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		},</span>
        <span class="gi">+		ID: function(elem, match){</span>
        <span class="gi">+			return elem.nodeType === 1 &amp;&amp; elem.getAttribute(&quot;id&quot;) === match;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		TAG: function(elem, match){</span>
        <span class="gi">+			return (match === &quot;*&quot; &amp;&amp; elem.nodeType === 1) || elem.nodeName === match;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		CLASS: function(elem, match){</span>
        <span class="gi">+			return (&quot; &quot; + (elem.className || elem.getAttribute(&quot;class&quot;)) + &quot; &quot;)</span>
        <span class="gi">+				.indexOf( match ) &gt; -1;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		ATTR: function(elem, match){</span>
        <span class="gi">+			var name = match[1],</span>
        <span class="gi">+				result = Expr.attrHandle[ name ] ?</span>
        <span class="gi">+					Expr.attrHandle[ name ]( elem ) :</span>
        <span class="gi">+					elem[ name ] != null ?</span>
        <span class="gi">+						elem[ name ] :</span>
        <span class="gi">+						elem.getAttribute( name ),</span>
        <span class="gi">+				value = result + &quot;&quot;,</span>
        <span class="gi">+				type = match[2],</span>
        <span class="gi">+				check = match[4];</span>
        <span class="gi">+</span>
        <span class="gi">+			return result == null ?</span>
        <span class="gi">+				type === &quot;!=&quot; :</span>
        <span class="gi">+				type === &quot;=&quot; ?</span>
        <span class="gi">+				value === check :</span>
        <span class="gi">+				type === &quot;*=&quot; ?</span>
        <span class="gi">+				value.indexOf(check) &gt;= 0 :</span>
        <span class="gi">+				type === &quot;~=&quot; ?</span>
        <span class="gi">+				(&quot; &quot; + value + &quot; &quot;).indexOf(check) &gt;= 0 :</span>
        <span class="gi">+				!check ?</span>
        <span class="gi">+				value &amp;&amp; result !== false :</span>
        <span class="gi">+				type === &quot;!=&quot; ?</span>
        <span class="gi">+				value != check :</span>
        <span class="gi">+				type === &quot;^=&quot; ?</span>
        <span class="gi">+				value.indexOf(check) === 0 :</span>
        <span class="gi">+				type === &quot;$=&quot; ?</span>
        <span class="gi">+				value.substr(value.length - check.length) === check :</span>
        <span class="gi">+				type === &quot;|=&quot; ?</span>
        <span class="gi">+				value === check || value.substr(0, check.length + 1) === check + &quot;-&quot; :</span>
        <span class="gi">+				false;</span>
        <span class="gi">+		},</span>
        <span class="gi">+		POS: function(elem, match, i, array){</span>
        <span class="gi">+			var name = match[2], filter = Expr.setFilters[ name ];</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( filter ) {</span>
        <span class="gi">+				return filter( elem, i, match, array );</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+var origPOS = Expr.match.POS;</span>
        <span class="gi">+</span>
        <span class="gi">+for ( var type in Expr.match ) {</span>
        <span class="gi">+	Expr.match[ type ] = new RegExp( Expr.match[ type ].source + /(?![^\[]*\])(?![^\(]*\))/.source );</span>
        <span class="gi">+	Expr.leftMatch[ type ] = new RegExp( /(^(?:.|\r|\n)*?)/.source + Expr.match[ type ].source );</span>
        <span class="gi">+}</span>
        <span class="gi">+</span>
        <span class="gi">+var makeArray = function(array, results) {</span>
        <span class="gi">+	array = Array.prototype.slice.call( array, 0 );</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( results ) {</span>
        <span class="gi">+		results.push.apply( results, array );</span>
        <span class="gi">+		return results;</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	return array;</span>
        <span class="gi">+};</span>
        <span class="gi">+</span>
        <span class="gi">+try {</span>
        <span class="gi">+	Array.prototype.slice.call( document.documentElement.childNodes, 0 );</span>
        <span class="gi">+</span>
        <span class="gi">+} catch(e){</span>
        <span class="gi">+	makeArray = function(array, results) {</span>
        <span class="gi">+		var ret = results || [];</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( toString.call(array) === &quot;[object Array]&quot; ) {</span>
        <span class="gi">+			Array.prototype.push.apply( ret, array );</span>
        <span class="gi">+		} else {</span>
        <span class="gi">+			if ( typeof array.length === &quot;number&quot; ) {</span>
        <span class="gi">+				for ( var i = 0, l = array.length; i &lt; l; i++ ) {</span>
        <span class="gi">+					ret.push( array[i] );</span>
        <span class="gi">+				}</span>
        <span class="gi">+			} else {</span>
        <span class="gi">+				for ( var i = 0; array[i]; i++ ) {</span>
        <span class="gi">+					ret.push( array[i] );</span>
        <span class="gi">+				}</span>
        <span class="gi">+			}</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		return ret;</span>
        <span class="gi">+	};</span>
        <span class="gi">+}</span>
        <span class="gi">+</span>
        <span class="gi">+var sortOrder;</span>
        <span class="gi">+</span>
        <span class="gi">+if ( document.documentElement.compareDocumentPosition ) {</span>
        <span class="gi">+	sortOrder = function( a, b ) {</span>
        <span class="gi">+		if ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {</span>
        <span class="gi">+			if ( a == b ) {</span>
        <span class="gi">+				hasDuplicate = true;</span>
        <span class="gi">+			}</span>
        <span class="gi">+			return 0;</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		var ret = a.compareDocumentPosition(b) &amp; 4 ? -1 : a === b ? 0 : 1;</span>
        <span class="gi">+		if ( ret === 0 ) {</span>
        <span class="gi">+			hasDuplicate = true;</span>
        <span class="gi">+		}</span>
        <span class="gi">+		return ret;</span>
        <span class="gi">+	};</span>
        <span class="gi">+} else if ( &quot;sourceIndex&quot; in document.documentElement ) {</span>
        <span class="gi">+	sortOrder = function( a, b ) {</span>
        <span class="gi">+		if ( !a.sourceIndex || !b.sourceIndex ) {</span>
        <span class="gi">+			if ( a == b ) {</span>
        <span class="gi">+				hasDuplicate = true;</span>
        <span class="gi">+			}</span>
        <span class="gi">+			return 0;</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		var ret = a.sourceIndex - b.sourceIndex;</span>
        <span class="gi">+		if ( ret === 0 ) {</span>
        <span class="gi">+			hasDuplicate = true;</span>
        <span class="gi">+		}</span>
        <span class="gi">+		return ret;</span>
        <span class="gi">+	};</span>
        <span class="gi">+} else if ( document.createRange ) {</span>
        <span class="gi">+	sortOrder = function( a, b ) {</span>
        <span class="gi">+		if ( !a.ownerDocument || !b.ownerDocument ) {</span>
        <span class="gi">+			if ( a == b ) {</span>
        <span class="gi">+				hasDuplicate = true;</span>
        <span class="gi">+			}</span>
        <span class="gi">+			return 0;</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		var aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();</span>
        <span class="gi">+		aRange.setStart(a, 0);</span>
        <span class="gi">+		aRange.setEnd(a, 0);</span>
        <span class="gi">+		bRange.setStart(b, 0);</span>
        <span class="gi">+		bRange.setEnd(b, 0);</span>
        <span class="gi">+		var ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);</span>
        <span class="gi">+		if ( ret === 0 ) {</span>
        <span class="gi">+			hasDuplicate = true;</span>
        <span class="gi">+		}</span>
        <span class="gi">+		return ret;</span>
        <span class="gi">+	};</span>
        <span class="gi">+}</span>
        <span class="gi">+</span>
        <span class="gi">+(function(){</span>
        <span class="gi">+	var form = document.createElement(&quot;div&quot;),</span>
        <span class="gi">+		id = &quot;script&quot; + (new Date).getTime();</span>
        <span class="gi">+	form.innerHTML = &quot;&lt;a name=&#39;&quot; + id + &quot;&#39;/&gt;&quot;;</span>
        <span class="gi">+</span>
        <span class="gi">+	var root = document.documentElement;</span>
        <span class="gi">+	root.insertBefore( form, root.firstChild );</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( !!document.getElementById( id ) ) {</span>
        <span class="gi">+		Expr.find.ID = function(match, context, isXML){</span>
        <span class="gi">+			if ( typeof context.getElementById !== &quot;undefined&quot; &amp;&amp; !isXML ) {</span>
        <span class="gi">+				var m = context.getElementById(match[1]);</span>
        <span class="gi">+				return m ? m.id === match[1] || typeof m.getAttributeNode !== &quot;undefined&quot; &amp;&amp; m.getAttributeNode(&quot;id&quot;).nodeValue === match[1] ? [m] : undefined : [];</span>
        <span class="gi">+			}</span>
        <span class="gi">+		};</span>
        <span class="gi">+</span>
        <span class="gi">+		Expr.filter.ID = function(elem, match){</span>
        <span class="gi">+			var node = typeof elem.getAttributeNode !== &quot;undefined&quot; &amp;&amp; elem.getAttributeNode(&quot;id&quot;);</span>
        <span class="gi">+			return elem.nodeType === 1 &amp;&amp; node &amp;&amp; node.nodeValue === match;</span>
        <span class="gi">+		};</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	root.removeChild( form );</span>
        <span class="gi">+	root = form = null; // release memory in IE</span>
        <span class="gi">+})();</span>
        <span class="gi">+</span>
        <span class="gi">+(function(){</span>
        <span class="gi">+</span>
        <span class="gi">+	var div = document.createElement(&quot;div&quot;);</span>
        <span class="gi">+	div.appendChild( document.createComment(&quot;&quot;) );</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( div.getElementsByTagName(&quot;*&quot;).length &gt; 0 ) {</span>
        <span class="gi">+		Expr.find.TAG = function(match, context){</span>
        <span class="gi">+			var results = context.getElementsByTagName(match[1]);</span>
        <span class="gi">+</span>
        <span class="gi">+			if ( match[1] === &quot;*&quot; ) {</span>
        <span class="gi">+				var tmp = [];</span>
        <span class="gi">+</span>
        <span class="gi">+				for ( var i = 0; results[i]; i++ ) {</span>
        <span class="gi">+					if ( results[i].nodeType === 1 ) {</span>
        <span class="gi">+						tmp.push( results[i] );</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				results = tmp;</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			return results;</span>
        <span class="gi">+		};</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	div.innerHTML = &quot;&lt;a href=&#39;#&#39;&gt;&lt;/a&gt;&quot;;</span>
        <span class="gi">+	if ( div.firstChild &amp;&amp; typeof div.firstChild.getAttribute !== &quot;undefined&quot; &amp;&amp;</span>
        <span class="gi">+			div.firstChild.getAttribute(&quot;href&quot;) !== &quot;#&quot; ) {</span>
        <span class="gi">+		Expr.attrHandle.href = function(elem){</span>
        <span class="gi">+			return elem.getAttribute(&quot;href&quot;, 2);</span>
        <span class="gi">+		};</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	div = null; // release memory in IE</span>
        <span class="gi">+})();</span>
        <span class="gi">+</span>
        <span class="gi">+if ( document.querySelectorAll ) (function(){</span>
        <span class="gi">+	var oldSizzle = Sizzle, div = document.createElement(&quot;div&quot;);</span>
        <span class="gi">+	div.innerHTML = &quot;&lt;p class=&#39;TEST&#39;&gt;&lt;/p&gt;&quot;;</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( div.querySelectorAll &amp;&amp; div.querySelectorAll(&quot;.TEST&quot;).length === 0 ) {</span>
        <span class="gi">+		return;</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	Sizzle = function(query, context, extra, seed){</span>
        <span class="gi">+		context = context || document;</span>
        <span class="gi">+</span>
        <span class="gi">+		if ( !seed &amp;&amp; context.nodeType === 9 &amp;&amp; !isXML(context) ) {</span>
        <span class="gi">+			try {</span>
        <span class="gi">+				return makeArray( context.querySelectorAll(query), extra );</span>
        <span class="gi">+			} catch(e){}</span>
        <span class="gi">+		}</span>
        <span class="gi">+</span>
        <span class="gi">+		return oldSizzle(query, context, extra, seed);</span>
        <span class="gi">+	};</span>
        <span class="gi">+</span>
        <span class="gi">+	for ( var prop in oldSizzle ) {</span>
        <span class="gi">+		Sizzle[ prop ] = oldSizzle[ prop ];</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	div = null; // release memory in IE</span>
        <span class="gi">+})();</span>
        <span class="gi">+</span>
        <span class="gi">+if ( document.getElementsByClassName &amp;&amp; document.documentElement.getElementsByClassName ) (function(){</span>
        <span class="gi">+	var div = document.createElement(&quot;div&quot;);</span>
        <span class="gi">+	div.innerHTML = &quot;&lt;div class=&#39;test e&#39;&gt;&lt;/div&gt;&lt;div class=&#39;test&#39;&gt;&lt;/div&gt;&quot;;</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( div.getElementsByClassName(&quot;e&quot;).length === 0 )</span>
        <span class="gi">+		return;</span>
        <span class="gi">+</span>
        <span class="gi">+	div.lastChild.className = &quot;e&quot;;</span>
        <span class="gi">+</span>
        <span class="gi">+	if ( div.getElementsByClassName(&quot;e&quot;).length === 1 )</span>
        <span class="gi">+		return;</span>
        <span class="gi">+</span>
        <span class="gi">+	Expr.order.splice(1, 0, &quot;CLASS&quot;);</span>
        <span class="gi">+	Expr.find.CLASS = function(match, context, isXML) {</span>
        <span class="gi">+		if ( typeof context.getElementsByClassName !== &quot;undefined&quot; &amp;&amp; !isXML ) {</span>
        <span class="gi">+			return context.getElementsByClassName(match[1]);</span>
        <span class="gi">+		}</span>
        <span class="gi">+	};</span>
         
        <span class="gd">-    pseudo: function(nodes, name, value, root, combinator) {</span>
        <span class="gd">-      if (nodes &amp;&amp; combinator) nodes = this[combinator](nodes);</span>
        <span class="gd">-      if (!nodes) nodes = root.getElementsByTagName(&quot;*&quot;);</span>
        <span class="gd">-      return Selector.pseudos[name](nodes, value, root);</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gi">+	div = null; // release memory in IE</span>
        <span class="gi">+})();</span>
         
        <span class="gd">-  pseudos: {</span>
        <span class="gd">-    &#39;first-child&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++) {</span>
        <span class="gd">-        if (Selector.handlers.previousElementSibling(node)) continue;</span>
        <span class="gd">-          results.push(node);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;last-child&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++) {</span>
        <span class="gd">-        if (Selector.handlers.nextElementSibling(node)) continue;</span>
        <span class="gd">-          results.push(node);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;only-child&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      var h = Selector.handlers;</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        if (!h.previousElementSibling(node) &amp;&amp; !h.nextElementSibling(node))</span>
        <span class="gd">-          results.push(node);</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;nth-child&#39;:        function(nodes, formula, root) {</span>
        <span class="gd">-      return Selector.pseudos.nth(nodes, formula, root);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;nth-last-child&#39;:   function(nodes, formula, root) {</span>
        <span class="gd">-      return Selector.pseudos.nth(nodes, formula, root, true);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;nth-of-type&#39;:      function(nodes, formula, root) {</span>
        <span class="gd">-      return Selector.pseudos.nth(nodes, formula, root, false, true);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;nth-last-of-type&#39;: function(nodes, formula, root) {</span>
        <span class="gd">-      return Selector.pseudos.nth(nodes, formula, root, true, true);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;first-of-type&#39;:    function(nodes, formula, root) {</span>
        <span class="gd">-      return Selector.pseudos.nth(nodes, &quot;1&quot;, root, false, true);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;last-of-type&#39;:     function(nodes, formula, root) {</span>
        <span class="gd">-      return Selector.pseudos.nth(nodes, &quot;1&quot;, root, true, true);</span>
        <span class="gd">-    },</span>
        <span class="gd">-    &#39;only-of-type&#39;:     function(nodes, formula, root) {</span>
        <span class="gd">-      var p = Selector.pseudos;</span>
        <span class="gd">-      return p[&#39;last-of-type&#39;](p[&#39;first-of-type&#39;](nodes, formula, root), formula, root);</span>
        <span class="gd">-    },</span>
        <span class="gi">+function dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {</span>
        <span class="gi">+	var sibDir = dir == &quot;previousSibling&quot; &amp;&amp; !isXML;</span>
        <span class="gi">+	for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gi">+		var elem = checkSet[i];</span>
        <span class="gi">+		if ( elem ) {</span>
        <span class="gi">+			if ( sibDir &amp;&amp; elem.nodeType === 1 ){</span>
        <span class="gi">+				elem.sizcache = doneName;</span>
        <span class="gi">+				elem.sizset = i;</span>
        <span class="gi">+			}</span>
        <span class="gi">+			elem = elem[dir];</span>
        <span class="gi">+			var match = false;</span>
        <span class="gi">+</span>
        <span class="gi">+			while ( elem ) {</span>
        <span class="gi">+				if ( elem.sizcache === doneName ) {</span>
        <span class="gi">+					match = checkSet[elem.sizset];</span>
        <span class="gi">+					break;</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( elem.nodeType === 1 &amp;&amp; !isXML ){</span>
        <span class="gi">+					elem.sizcache = doneName;</span>
        <span class="gi">+					elem.sizset = i;</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( elem.nodeName === cur ) {</span>
        <span class="gi">+					match = elem;</span>
        <span class="gi">+					break;</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				elem = elem[dir];</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			checkSet[i] = match;</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+}</span>
         
        <span class="gd">-    // handles the an+b logic</span>
        <span class="gd">-    getIndices: function(a, b, total) {</span>
        <span class="gd">-      if (a == 0) return b &gt; 0 ? [b] : [];</span>
        <span class="gd">-      return $R(1, total).inject([], function(memo, i) {</span>
        <span class="gd">-        if (0 == (i - b) % a &amp;&amp; (i - b) / a &gt;= 0) memo.push(i);</span>
        <span class="gd">-        return memo;</span>
        <span class="gd">-      });</span>
        <span class="gd">-    },</span>
        <span class="gi">+function dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {</span>
        <span class="gi">+	var sibDir = dir == &quot;previousSibling&quot; &amp;&amp; !isXML;</span>
        <span class="gi">+	for ( var i = 0, l = checkSet.length; i &lt; l; i++ ) {</span>
        <span class="gi">+		var elem = checkSet[i];</span>
        <span class="gi">+		if ( elem ) {</span>
        <span class="gi">+			if ( sibDir &amp;&amp; elem.nodeType === 1 ) {</span>
        <span class="gi">+				elem.sizcache = doneName;</span>
        <span class="gi">+				elem.sizset = i;</span>
        <span class="gi">+			}</span>
        <span class="gi">+			elem = elem[dir];</span>
        <span class="gi">+			var match = false;</span>
        <span class="gi">+</span>
        <span class="gi">+			while ( elem ) {</span>
        <span class="gi">+				if ( elem.sizcache === doneName ) {</span>
        <span class="gi">+					match = checkSet[elem.sizset];</span>
        <span class="gi">+					break;</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				if ( elem.nodeType === 1 ) {</span>
        <span class="gi">+					if ( !isXML ) {</span>
        <span class="gi">+						elem.sizcache = doneName;</span>
        <span class="gi">+						elem.sizset = i;</span>
        <span class="gi">+					}</span>
        <span class="gi">+					if ( typeof cur !== &quot;string&quot; ) {</span>
        <span class="gi">+						if ( elem === cur ) {</span>
        <span class="gi">+							match = true;</span>
        <span class="gi">+							break;</span>
        <span class="gi">+						}</span>
        <span class="gi">+</span>
        <span class="gi">+					} else if ( Sizzle.filter( cur, [elem] ).length &gt; 0 ) {</span>
        <span class="gi">+						match = elem;</span>
        <span class="gi">+						break;</span>
        <span class="gi">+					}</span>
        <span class="gi">+				}</span>
        <span class="gi">+</span>
        <span class="gi">+				elem = elem[dir];</span>
        <span class="gi">+			}</span>
        <span class="gi">+</span>
        <span class="gi">+			checkSet[i] = match;</span>
        <span class="gi">+		}</span>
        <span class="gi">+	}</span>
        <span class="gi">+}</span>
         
        <span class="gd">-    // handles nth(-last)-child, nth(-last)-of-type, and (first|last)-of-type</span>
        <span class="gd">-    nth: function(nodes, formula, root, reverse, ofType) {</span>
        <span class="gd">-      if (nodes.length == 0) return [];</span>
        <span class="gd">-      if (formula == &#39;even&#39;) formula = &#39;2n+0&#39;;</span>
        <span class="gd">-      if (formula == &#39;odd&#39;)  formula = &#39;2n+1&#39;;</span>
        <span class="gd">-      var h = Selector.handlers, results = [], indexed = [], m;</span>
        <span class="gd">-      h.mark(nodes);</span>
        <span class="gd">-      for (var i = 0, node; node = nodes[i]; i++) {</span>
        <span class="gd">-        if (!node.parentNode._countedByPrototype) {</span>
        <span class="gd">-          h.index(node.parentNode, reverse, ofType);</span>
        <span class="gd">-          indexed.push(node.parentNode);</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-      if (formula.match(/^\d+$/)) { // just a number</span>
        <span class="gd">-        formula = Number(formula);</span>
        <span class="gd">-        for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-          if (node.nodeIndex == formula) results.push(node);</span>
        <span class="gd">-      } else if (m = formula.match(/^(-?\d*)?n(([+-])(\d+))?/)) { // an+b</span>
        <span class="gd">-        if (m[1] == &quot;-&quot;) m[1] = -1;</span>
        <span class="gd">-        var a = m[1] ? Number(m[1]) : 1;</span>
        <span class="gd">-        var b = m[2] ? Number(m[2]) : 0;</span>
        <span class="gd">-        var indices = Selector.pseudos.getIndices(a, b, nodes.length);</span>
        <span class="gd">-        for (var i = 0, node, l = indices.length; node = nodes[i]; i++) {</span>
        <span class="gd">-          for (var j = 0; j &lt; l; j++)</span>
        <span class="gd">-            if (node.nodeIndex == indices[j]) results.push(node);</span>
        <span class="gd">-        }</span>
        <span class="gd">-      }</span>
        <span class="gd">-      h.unmark(nodes);</span>
        <span class="gd">-      h.unmark(indexed);</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gi">+var contains = document.compareDocumentPosition ?  function(a, b){</span>
        <span class="gi">+	return a.compareDocumentPosition(b) &amp; 16;</span>
        <span class="gi">+} : function(a, b){</span>
        <span class="gi">+	return a !== b &amp;&amp; (a.contains ? a.contains(b) : true);</span>
        <span class="gi">+};</span>
         
        <span class="gd">-    &#39;empty&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++) {</span>
        <span class="gd">-        // IE treats comments as element nodes</span>
        <span class="gd">-        if (node.tagName == &#39;!&#39; || node.firstChild) continue;</span>
        <span class="gd">-        results.push(node);</span>
        <span class="gd">-      }</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gi">+var isXML = function(elem){</span>
        <span class="gi">+	return elem.nodeType === 9 &amp;&amp; elem.documentElement.nodeName !== &quot;HTML&quot; ||</span>
        <span class="gi">+		!!elem.ownerDocument &amp;&amp; elem.ownerDocument.documentElement.nodeName !== &quot;HTML&quot;;</span>
        <span class="gi">+};</span>
         
        <span class="gd">-    &#39;not&#39;: function(nodes, selector, root) {</span>
        <span class="gd">-      var h = Selector.handlers, selectorType, m;</span>
        <span class="gd">-      var exclusions = new Selector(selector).findElements(root);</span>
        <span class="gd">-      h.mark(exclusions);</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        if (!node._countedByPrototype) results.push(node);</span>
        <span class="gd">-      h.unmark(exclusions);</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gi">+var posProcess = function(selector, context){</span>
        <span class="gi">+	var tmpSet = [], later = &quot;&quot;, match,</span>
        <span class="gi">+		root = context.nodeType ? [context] : context;</span>
        <span class="gi">+</span>
        <span class="gi">+	while ( (match = Expr.match.PSEUDO.exec( selector )) ) {</span>
        <span class="gi">+		later += match[0];</span>
        <span class="gi">+		selector = selector.replace( Expr.match.PSEUDO, &quot;&quot; );</span>
        <span class="gi">+	}</span>
        <span class="gi">+</span>
        <span class="gi">+	selector = Expr.relative[selector] ? selector + &quot;*&quot; : selector;</span>
        <span class="gi">+</span>
        <span class="gi">+	for ( var i = 0, l = root.length; i &lt; l; i++ ) {</span>
        <span class="gi">+		Sizzle( selector, root[i], tmpSet );</span>
        <span class="gi">+	}</span>
         
        <span class="gd">-    &#39;enabled&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        if (!node.disabled &amp;&amp; (!node.type || node.type !== &#39;hidden&#39;))</span>
        <span class="gd">-          results.push(node);</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
        <span class="gi">+	return Sizzle.filter( later, tmpSet );</span>
        <span class="gi">+};</span>
         
        <span class="gd">-    &#39;disabled&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        if (node.disabled) results.push(node);</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    },</span>
         
        <span class="gd">-    &#39;checked&#39;: function(nodes, value, root) {</span>
        <span class="gd">-      for (var i = 0, results = [], node; node = nodes[i]; i++)</span>
        <span class="gd">-        if (node.checked) results.push(node);</span>
        <span class="gd">-      return results;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  },</span>
        <span class="gi">+window.Sizzle = Sizzle;</span>
         
        <span class="gd">-  operators: {</span>
        <span class="gd">-    &#39;=&#39;:  function(nv, v) { return nv == v; },</span>
        <span class="gd">-    &#39;!=&#39;: function(nv, v) { return nv != v; },</span>
        <span class="gd">-    &#39;^=&#39;: function(nv, v) { return nv == v || nv &amp;&amp; nv.startsWith(v); },</span>
        <span class="gd">-    &#39;$=&#39;: function(nv, v) { return nv == v || nv &amp;&amp; nv.endsWith(v); },</span>
        <span class="gd">-    &#39;*=&#39;: function(nv, v) { return nv == v || nv &amp;&amp; nv.include(v); },</span>
        <span class="gd">-    &#39;$=&#39;: function(nv, v) { return nv.endsWith(v); },</span>
        <span class="gd">-    &#39;*=&#39;: function(nv, v) { return nv.include(v); },</span>
        <span class="gd">-    &#39;~=&#39;: function(nv, v) { return (&#39; &#39; + nv + &#39; &#39;).include(&#39; &#39; + v + &#39; &#39;); },</span>
        <span class="gd">-    &#39;|=&#39;: function(nv, v) { return (&#39;-&#39; + (nv || &quot;&quot;).toUpperCase() +</span>
        <span class="gd">-     &#39;-&#39;).include(&#39;-&#39; + (v || &quot;&quot;).toUpperCase() + &#39;-&#39;); }</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  split: function(expression) {</span>
        <span class="gd">-    var expressions = [];</span>
        <span class="gd">-    expression.scan(/(([\w#:.~&gt;+()\s-]+|\*|\[.*?\])+)\s*(,|$)/, function(m) {</span>
        <span class="gd">-      expressions.push(m[1].strip());</span>
        <span class="gd">-    });</span>
        <span class="gd">-    return expressions;</span>
        <span class="gd">-  },</span>
        <span class="gd">-</span>
        <span class="gd">-  matchElements: function(elements, expression) {</span>
        <span class="gd">-    var matches = $$(expression), h = Selector.handlers;</span>
        <span class="gd">-    h.mark(matches);</span>
        <span class="gd">-    for (var i = 0, results = [], element; element = elements[i]; i++)</span>
        <span class="gd">-      if (element._countedByPrototype) results.push(element);</span>
        <span class="gd">-    h.unmark(matches);</span>
        <span class="gd">-    return results;</span>
        <span class="gd">-  },</span>
        <span class="gi">+})();</span>
         
        <span class="gd">-  findElement: function(elements, expression, index) {</span>
        <span class="gd">-    if (Object.isNumber(expression)) {</span>
        <span class="gd">-      index = expression; expression = false;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return Selector.matchElements(elements, expression || &#39;*&#39;)[index || 0];</span>
        <span class="gd">-  },</span>
        <span class="gi">+;(function(engine) {</span>
        <span class="gi">+  var extendElements = Prototype.Selector.extendElements;</span>
         
        <span class="gd">-  findChildElements: function(element, expressions) {</span>
        <span class="gd">-    expressions = Selector.split(expressions.join(&#39;,&#39;));</span>
        <span class="gd">-    var results = [], h = Selector.handlers;</span>
        <span class="gd">-    for (var i = 0, l = expressions.length, selector; i &lt; l; i++) {</span>
        <span class="gd">-      selector = new Selector(expressions[i].strip());</span>
        <span class="gd">-      h.concat(results, selector.findElements(element));</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return (l &gt; 1) ? h.unique(results) : results;</span>
        <span class="gi">+  function select(selector, scope) {</span>
        <span class="gi">+    return extendElements(engine(selector, scope || document));</span>
           }
        <span class="gd">-});</span>
         
        <span class="gd">-if (Prototype.Browser.IE) {</span>
        <span class="gd">-  Object.extend(Selector.handlers, {</span>
        <span class="gd">-    // IE returns comment nodes on getElementsByTagName(&quot;*&quot;).</span>
        <span class="gd">-    // Filter them out.</span>
        <span class="gd">-    concat: function(a, b) {</span>
        <span class="gd">-      for (var i = 0, node; node = b[i]; i++)</span>
        <span class="gd">-        if (node.tagName !== &quot;!&quot;) a.push(node);</span>
        <span class="gd">-      return a;</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function match(element, selector) {</span>
        <span class="gi">+    return engine.matches(selector, [element]).length == 1;</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    // IE improperly serializes _countedByPrototype in (inner|outer)HTML.</span>
        <span class="gd">-    unmark: function(nodes) {</span>
        <span class="gd">-      for (var i = 0, node; node = nodes[i]; i++)</span>
        <span class="gd">-        node.removeAttribute(&#39;_countedByPrototype&#39;);</span>
        <span class="gd">-      return nodes;</span>
        <span class="gd">-    }</span>
        <span class="gd">-  });</span>
        <span class="gd">-}</span>
        <span class="gi">+  Prototype.Selector.engine = engine;</span>
        <span class="gi">+  Prototype.Selector.select = select;</span>
        <span class="gi">+  Prototype.Selector.match = match;</span>
        <span class="gi">+})(Sizzle);</span>
        <span class="gi">+</span>
        <span class="gi">+window.Sizzle = Prototype._original_property;</span>
        <span class="gi">+delete Prototype._original_property;</span>
         
        <span class="gd">-function $$() {</span>
        <span class="gd">-  return Selector.findChildElements(document, $A(arguments));</span>
        <span class="gd">-}</span>
         var Form = {
           reset: function(form) {
        <span class="gd">-    $(form).reset();</span>
        <span class="gi">+    form = $(form);</span>
        <span class="gi">+    form.reset();</span>
             return form;
           },
         
           serializeElements: function(elements, options) {
             if (typeof options != &#39;object&#39;) options = { hash: !!options };
             else if (Object.isUndefined(options.hash)) options.hash = true;
             var key, value, submitted = false, submit = options.submit;
         
             var data = elements.inject({ }, function(result, element) {
               if (!element.disabled &amp;&amp; element.name) {
                 key = element.name; value = $(element).getValue();
                 if (value != null &amp;&amp; element.type != &#39;file&#39; &amp;&amp; (element.type != &#39;submit&#39; || (!submitted &amp;&amp;
                     submit !== false &amp;&amp; (!submit || key == submit) &amp;&amp; (submitted = true)))) {
                   if (key in result) {
        <span class="gd">-            // a key is already present; construct an array of values</span>
                     if (!Object.isArray(result[key])) result[key] = [result[key]];
                     result[key].push(value);
                   }
                   else result[key] = value;
                 }
               }
               return result;
             });
         
             return options.hash ? data : Object.toQueryString(data);
           }
         };
         
         Form.Methods = {
           serialize: function(form, options) {
             return Form.serializeElements(Form.getElements(form), options);
           },
         
           getElements: function(form) {
        <span class="gd">-    return $A($(form).getElementsByTagName(&#39;*&#39;)).inject([],</span>
        <span class="gd">-      function(elements, child) {</span>
        <span class="gd">-        if (Form.Element.Serializers[child.tagName.toLowerCase()])</span>
        <span class="gd">-          elements.push(Element.extend(child));</span>
        <span class="gd">-        return elements;</span>
        <span class="gd">-      }</span>
        <span class="gd">-    );</span>
        <span class="gi">+    var elements = $(form).getElementsByTagName(&#39;*&#39;),</span>
        <span class="gi">+        element,</span>
        <span class="gi">+        arr = [ ],</span>
        <span class="gi">+        serializers = Form.Element.Serializers;</span>
        <span class="gi">+    for (var i = 0; element = elements[i]; i++) {</span>
        <span class="gi">+      arr.push(element);</span>
        <span class="gi">+    }</span>
        <span class="gi">+    return arr.inject([], function(elements, child) {</span>
        <span class="gi">+      if (serializers[child.tagName.toLowerCase()])</span>
        <span class="gi">+        elements.push(Element.extend(child));</span>
        <span class="gi">+      return elements;</span>
        <span class="gi">+    })</span>
           },
         
           getInputs: function(form, typeName, name) {
             form = $(form);
             var inputs = form.getElementsByTagName(&#39;input&#39;);
         
             if (!typeName &amp;&amp; !name) return $A(inputs).map(Element.extend);
         
             for (var i = 0, matchingInputs = [], length = inputs.length; i &lt; length; i++) {
               var input = inputs[i];
               if ((typeName &amp;&amp; input.type != typeName) || (name &amp;&amp; input.name != name))
                 continue;
               matchingInputs.push(Element.extend(input));
             }
         
             return matchingInputs;
           },
         
           disable: function(form) {
             form = $(form);
             Form.getElements(form).invoke(&#39;disable&#39;);
             return form;
           },
         
           enable: function(form) {
             form = $(form);
             Form.getElements(form).invoke(&#39;enable&#39;);
             return form;
           },
         
           findFirstElement: function(form) {
             var elements = $(form).getElements().findAll(function(element) {
               return &#39;hidden&#39; != element.type &amp;&amp; !element.disabled;
             });
             var firstByIndex = elements.findAll(function(element) {
               return element.hasAttribute(&#39;tabIndex&#39;) &amp;&amp; element.tabIndex &gt;= 0;
             }).sortBy(function(element) { return element.tabIndex }).first();
         
             return firstByIndex ? firstByIndex : elements.find(function(element) {
        <span class="gd">-      return [&#39;input&#39;, &#39;select&#39;, &#39;textarea&#39;].include(element.tagName.toLowerCase());</span>
        <span class="gi">+      return /^(?:input|select|textarea)$/i.test(element.tagName);</span>
             });
           },
         
           focusFirstElement: function(form) {
             form = $(form);
             form.findFirstElement().activate();
             return form;
           },
         
           request: function(form, options) {
             form = $(form), options = Object.clone(options || { });
         
             var params = options.parameters, action = form.readAttribute(&#39;action&#39;) || &#39;&#39;;
             if (action.blank()) action = window.location.href;
             options.parameters = form.serialize(true);
         
             if (params) {
               if (Object.isString(params)) params = params.toQueryParams();
               Object.extend(options.parameters, params);
             }
         
             if (form.hasAttribute(&#39;method&#39;) &amp;&amp; !options.method)
               options.method = form.method;
         
             return new Ajax.Request(action, options);
           }
         };
         
         /*--------------------------------------------------------------------------*/
         
        <span class="gi">+</span>
         Form.Element = {
           focus: function(element) {
             $(element).focus();
             return element;
           },
         
           select: function(element) {
             $(element).select();
             return element;
           }
         };
         
         Form.Element.Methods = {
        <span class="gi">+</span>
           serialize: function(element) {
             element = $(element);
             if (!element.disabled &amp;&amp; element.name) {
               var value = element.getValue();
               if (value != undefined) {
                 var pair = { };
                 pair[element.name] = value;
                 return Object.toQueryString(pair);
               }
             }
             return &#39;&#39;;
           },
         
           getValue: function(element) {
             element = $(element);
             var method = element.tagName.toLowerCase();
             return Form.Element.Serializers[method](element);
           },
         
           setValue: function(element, value) {
             element = $(element);
             var method = element.tagName.toLowerCase();
             Form.Element.Serializers[method](element, value);
             return element;
           },
         
           clear: function(element) {
             $(element).value = &#39;&#39;;
             return element;
           },
         
           present: function(element) {
             return $(element).value != &#39;&#39;;
           },
         
           activate: function(element) {
             element = $(element);
             try {
               element.focus();
               if (element.select &amp;&amp; (element.tagName.toLowerCase() != &#39;input&#39; ||
        <span class="gd">-          ![&#39;button&#39;, &#39;reset&#39;, &#39;submit&#39;].include(element.type)))</span>
        <span class="gi">+          !(/^(?:button|reset|submit)$/i.test(element.type))))</span>
                 element.select();
             } catch (e) { }
             return element;
           },
         
           disable: function(element) {
             element = $(element);
             element.disabled = true;
             return element;
           },
         
           enable: function(element) {
             element = $(element);
             element.disabled = false;
             return element;
           }
         };
         
         /*--------------------------------------------------------------------------*/
         
         var Field = Form.Element;
        <span class="gi">+</span>
         var $F = Form.Element.Methods.getValue;
         
         /*--------------------------------------------------------------------------*/
         
         Form.Element.Serializers = {
           input: function(element, value) {
             switch (element.type.toLowerCase()) {
               case &#39;checkbox&#39;:
               case &#39;radio&#39;:
                 return Form.Element.Serializers.inputSelector(element, value);
               default:
                 return Form.Element.Serializers.textarea(element, value);
             }
           },
         
           inputSelector: function(element, value) {
             if (Object.isUndefined(value)) return element.checked ? element.value : null;
             else element.checked = !!value;
           },
         
           textarea: function(element, value) {
             if (Object.isUndefined(value)) return element.value;
             else element.value = value;
           },
         
           select: function(element, value) {
             if (Object.isUndefined(value))
               return this[element.type == &#39;select-one&#39; ?
                 &#39;selectOne&#39; : &#39;selectMany&#39;](element);
             else {
               var opt, currentValue, single = !Object.isArray(value);
               for (var i = 0, length = element.length; i &lt; length; i++) {
                 opt = element.options[i];
                 currentValue = this.optionValue(opt);
                 if (single) {
                   if (currentValue == value) {
                     opt.selected = true;
                     return;
                   }
                 }
                 else opt.selected = value.include(currentValue);
               }
             }
           },
         
           selectOne: function(element) {
             var index = element.selectedIndex;
             return index &gt;= 0 ? this.optionValue(element.options[index]) : null;
           },
         
           selectMany: function(element) {
             var values, length = element.length;
             if (!length) return null;
         
             for (var i = 0, values = []; i &lt; length; i++) {
               var opt = element.options[i];
               if (opt.selected) values.push(this.optionValue(opt));
             }
             return values;
           },
         
           optionValue: function(opt) {
        <span class="gd">-    // extend element because hasAttribute may not be native</span>
             return Element.extend(opt).hasAttribute(&#39;value&#39;) ? opt.value : opt.text;
           }
         };
         
         /*--------------------------------------------------------------------------*/
         
        <span class="gi">+</span>
         Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
           initialize: function($super, element, frequency, callback) {
             $super(callback, frequency);
             this.element   = $(element);
             this.lastValue = this.getValue();
           },
         
           execute: function() {
             var value = this.getValue();
             if (Object.isString(this.lastValue) &amp;&amp; Object.isString(value) ?
                 this.lastValue != value : String(this.lastValue) != String(value)) {
               this.callback(this.element, value);
               this.lastValue = value;
             }
           }
         });
         
         Form.Element.Observer = Class.create(Abstract.TimedObserver, {
           getValue: function() {
             return Form.Element.getValue(this.element);
           }
         });
         
         Form.Observer = Class.create(Abstract.TimedObserver, {
           getValue: function() {
             return Form.serialize(this.element);
           }
         });
         
         /*--------------------------------------------------------------------------*/
         
         Abstract.EventObserver = Class.create({
           initialize: function(element, callback) {
             this.element  = $(element);
             this.callback = callback;
         
             this.lastValue = this.getValue();
             if (this.element.tagName.toLowerCase() == &#39;form&#39;)
               this.registerFormCallbacks();
             else
               this.registerCallback(this.element);
           },
         
           onElementEvent: function() {
             var value = this.getValue();
             if (this.lastValue != value) {
               this.callback(this.element, value);
               this.lastValue = value;
             }
           },
         
           registerFormCallbacks: function() {
             Form.getElements(this.element).each(this.registerCallback, this);
           },
         
           registerCallback: function(element) {
             if (element.type) {
               switch (element.type.toLowerCase()) {
                 case &#39;checkbox&#39;:
                 case &#39;radio&#39;:
                   Event.observe(element, &#39;click&#39;, this.onElementEvent.bind(this));
                   break;
                 default:
                   Event.observe(element, &#39;change&#39;, this.onElementEvent.bind(this));
                   break;
               }
             }
           }
         });
         
         Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
           getValue: function() {
             return Form.Element.getValue(this.element);
           }
         });
         
         Form.EventObserver = Class.create(Abstract.EventObserver, {
           getValue: function() {
             return Form.serialize(this.element);
           }
         });
        <span class="gd">-if (!window.Event) var Event = { };</span>
        <span class="gi">+(function() {</span>
         
        <span class="gd">-Object.extend(Event, {</span>
        <span class="gd">-  KEY_BACKSPACE: 8,</span>
        <span class="gd">-  KEY_TAB:       9,</span>
        <span class="gd">-  KEY_RETURN:   13,</span>
        <span class="gd">-  KEY_ESC:      27,</span>
        <span class="gd">-  KEY_LEFT:     37,</span>
        <span class="gd">-  KEY_UP:       38,</span>
        <span class="gd">-  KEY_RIGHT:    39,</span>
        <span class="gd">-  KEY_DOWN:     40,</span>
        <span class="gd">-  KEY_DELETE:   46,</span>
        <span class="gd">-  KEY_HOME:     36,</span>
        <span class="gd">-  KEY_END:      35,</span>
        <span class="gd">-  KEY_PAGEUP:   33,</span>
        <span class="gd">-  KEY_PAGEDOWN: 34,</span>
        <span class="gd">-  KEY_INSERT:   45,</span>
        <span class="gd">-</span>
        <span class="gd">-  cache: { },</span>
        <span class="gd">-</span>
        <span class="gd">-  relatedTarget: function(event) {</span>
        <span class="gd">-    var element;</span>
        <span class="gd">-    switch(event.type) {</span>
        <span class="gd">-      case &#39;mouseover&#39;: element = event.fromElement; break;</span>
        <span class="gd">-      case &#39;mouseout&#39;:  element = event.toElement;   break;</span>
        <span class="gd">-      default: return null;</span>
        <span class="gd">-    }</span>
        <span class="gd">-    return Element.extend(element);</span>
        <span class="gd">-  }</span>
        <span class="gd">-});</span>
        <span class="gi">+  var Event = {</span>
        <span class="gi">+    KEY_BACKSPACE: 8,</span>
        <span class="gi">+    KEY_TAB:       9,</span>
        <span class="gi">+    KEY_RETURN:   13,</span>
        <span class="gi">+    KEY_ESC:      27,</span>
        <span class="gi">+    KEY_LEFT:     37,</span>
        <span class="gi">+    KEY_UP:       38,</span>
        <span class="gi">+    KEY_RIGHT:    39,</span>
        <span class="gi">+    KEY_DOWN:     40,</span>
        <span class="gi">+    KEY_DELETE:   46,</span>
        <span class="gi">+    KEY_HOME:     36,</span>
        <span class="gi">+    KEY_END:      35,</span>
        <span class="gi">+    KEY_PAGEUP:   33,</span>
        <span class="gi">+    KEY_PAGEDOWN: 34,</span>
        <span class="gi">+    KEY_INSERT:   45,</span>
        <span class="gi">+</span>
        <span class="gi">+    cache: {}</span>
        <span class="gi">+  };</span>
         
        <span class="gd">-Event.Methods = (function() {</span>
        <span class="gd">-  var isButton;</span>
        <span class="gi">+  var docEl = document.documentElement;</span>
        <span class="gi">+  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = &#39;onmouseenter&#39; in docEl</span>
        <span class="gi">+    &amp;&amp; &#39;onmouseleave&#39; in docEl;</span>
         
        <span class="gi">+  var _isButton;</span>
           if (Prototype.Browser.IE) {
             var buttonMap = { 0: 1, 1: 4, 2: 2 };
        <span class="gd">-    isButton = function(event, code) {</span>
        <span class="gd">-      return event.button == buttonMap[code];</span>
        <span class="gi">+    _isButton = function(event, code) {</span>
        <span class="gi">+      return event.button === buttonMap[code];</span>
             };
        <span class="gd">-</span>
           } else if (Prototype.Browser.WebKit) {
        <span class="gd">-    isButton = function(event, code) {</span>
        <span class="gi">+    _isButton = function(event, code) {</span>
               switch (code) {
                 case 0: return event.which == 1 &amp;&amp; !event.metaKey;
                 case 1: return event.which == 1 &amp;&amp; event.metaKey;
                 default: return false;
               }
             };
        <span class="gd">-</span>
           } else {
        <span class="gd">-    isButton = function(event, code) {</span>
        <span class="gi">+    _isButton = function(event, code) {</span>
               return event.which ? (event.which === code + 1) : (event.button === code);
             };
           }
         
        <span class="gd">-  return {</span>
        <span class="gd">-    isLeftClick:   function(event) { return isButton(event, 0) },</span>
        <span class="gd">-    isMiddleClick: function(event) { return isButton(event, 1) },</span>
        <span class="gd">-    isRightClick:  function(event) { return isButton(event, 2) },</span>
        <span class="gd">-</span>
        <span class="gd">-    element: function(event) {</span>
        <span class="gd">-      event = Event.extend(event);</span>
        <span class="gd">-</span>
        <span class="gd">-      var node          = event.target,</span>
        <span class="gd">-          type          = event.type,</span>
        <span class="gd">-          currentTarget = event.currentTarget;</span>
        <span class="gd">-</span>
        <span class="gd">-      if (currentTarget &amp;&amp; currentTarget.tagName) {</span>
        <span class="gd">-        // Firefox screws up the &quot;click&quot; event when moving between radio buttons</span>
        <span class="gd">-        // via arrow keys. It also screws up the &quot;load&quot; and &quot;error&quot; events on images,</span>
        <span class="gd">-        // reporting the document as the target instead of the original image.</span>
        <span class="gd">-        if (type === &#39;load&#39; || type === &#39;error&#39; ||</span>
        <span class="gd">-          (type === &#39;click&#39; &amp;&amp; currentTarget.tagName.toLowerCase() === &#39;input&#39;</span>
        <span class="gd">-            &amp;&amp; currentTarget.type === &#39;radio&#39;))</span>
        <span class="gd">-              node = currentTarget;</span>
        <span class="gd">-      }</span>
        <span class="gd">-      if (node.nodeType == Node.TEXT_NODE) node = node.parentNode;</span>
        <span class="gd">-      return Element.extend(node);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function isLeftClick(event)   { return _isButton(event, 0) }</span>
         
        <span class="gd">-    findElement: function(event, expression) {</span>
        <span class="gd">-      var element = Event.element(event);</span>
        <span class="gd">-      if (!expression) return element;</span>
        <span class="gd">-      var elements = [element].concat(element.ancestors());</span>
        <span class="gd">-      return Selector.findElement(elements, expression, 0);</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function isMiddleClick(event) { return _isButton(event, 1) }</span>
         
        <span class="gd">-    pointer: function(event) {</span>
        <span class="gd">-      var docElement = document.documentElement,</span>
        <span class="gd">-      body = document.body || { scrollLeft: 0, scrollTop: 0 };</span>
        <span class="gd">-      return {</span>
        <span class="gd">-        x: event.pageX || (event.clientX +</span>
        <span class="gd">-          (docElement.scrollLeft || body.scrollLeft) -</span>
        <span class="gd">-          (docElement.clientLeft || 0)),</span>
        <span class="gd">-        y: event.pageY || (event.clientY +</span>
        <span class="gd">-          (docElement.scrollTop || body.scrollTop) -</span>
        <span class="gd">-          (docElement.clientTop || 0))</span>
        <span class="gd">-      };</span>
        <span class="gd">-    },</span>
        <span class="gi">+  function isRightClick(event)  { return _isButton(event, 2) }</span>
        <span class="gi">+</span>
        <span class="gi">+  function element(event) {</span>
        <span class="gi">+    event = Event.extend(event);</span>
        <span class="gi">+</span>
        <span class="gi">+    var node = event.target, type = event.type,</span>
        <span class="gi">+     currentTarget = event.currentTarget;</span>
         
        <span class="gd">-    pointerX: function(event) { return Event.pointer(event).x },</span>
        <span class="gd">-    pointerY: function(event) { return Event.pointer(event).y },</span>
        <span class="gi">+    if (currentTarget &amp;&amp; currentTarget.tagName) {</span>
        <span class="gi">+      if (type === &#39;load&#39; || type === &#39;error&#39; ||</span>
        <span class="gi">+        (type === &#39;click&#39; &amp;&amp; currentTarget.tagName.toLowerCase() === &#39;input&#39;</span>
        <span class="gi">+          &amp;&amp; currentTarget.type === &#39;radio&#39;))</span>
        <span class="gi">+            node = currentTarget;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    if (node.nodeType == Node.TEXT_NODE)</span>
        <span class="gi">+      node = node.parentNode;</span>
        <span class="gi">+</span>
        <span class="gi">+    return Element.extend(node);</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    stop: function(event) {</span>
        <span class="gd">-      Event.extend(event);</span>
        <span class="gd">-      event.preventDefault();</span>
        <span class="gd">-      event.stopPropagation();</span>
        <span class="gd">-      event.stopped = true;</span>
        <span class="gi">+  function findElement(event, expression) {</span>
        <span class="gi">+    var element = Event.element(event);</span>
        <span class="gi">+    if (!expression) return element;</span>
        <span class="gi">+    while (element) {</span>
        <span class="gi">+      if (Object.isElement(element) &amp;&amp; Prototype.Selector.match(element, expression)) {</span>
        <span class="gi">+        return Element.extend(element);</span>
        <span class="gi">+      }</span>
        <span class="gi">+      element = element.parentNode;</span>
             }
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function pointer(event) {</span>
        <span class="gi">+    return { x: pointerX(event), y: pointerY(event) };</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function pointerX(event) {</span>
        <span class="gi">+    var docElement = document.documentElement,</span>
        <span class="gi">+     body = document.body || { scrollLeft: 0 };</span>
        <span class="gi">+</span>
        <span class="gi">+    return event.pageX || (event.clientX +</span>
        <span class="gi">+      (docElement.scrollLeft || body.scrollLeft) -</span>
        <span class="gi">+      (docElement.clientLeft || 0));</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function pointerY(event) {</span>
        <span class="gi">+    var docElement = document.documentElement,</span>
        <span class="gi">+     body = document.body || { scrollTop: 0 };</span>
        <span class="gi">+</span>
        <span class="gi">+    return  event.pageY || (event.clientY +</span>
        <span class="gi">+       (docElement.scrollTop || body.scrollTop) -</span>
        <span class="gi">+       (docElement.clientTop || 0));</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  function stop(event) {</span>
        <span class="gi">+    Event.extend(event);</span>
        <span class="gi">+    event.preventDefault();</span>
        <span class="gi">+    event.stopPropagation();</span>
        <span class="gi">+</span>
        <span class="gi">+    event.stopped = true;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  Event.Methods = {</span>
        <span class="gi">+    isLeftClick: isLeftClick,</span>
        <span class="gi">+    isMiddleClick: isMiddleClick,</span>
        <span class="gi">+    isRightClick: isRightClick,</span>
        <span class="gi">+</span>
        <span class="gi">+    element: element,</span>
        <span class="gi">+    findElement: findElement,</span>
        <span class="gi">+</span>
        <span class="gi">+    pointer: pointer,</span>
        <span class="gi">+    pointerX: pointerX,</span>
        <span class="gi">+    pointerY: pointerY,</span>
        <span class="gi">+</span>
        <span class="gi">+    stop: stop</span>
           };
        <span class="gd">-})();</span>
         
        <span class="gd">-Event.extend = (function() {</span>
        <span class="gi">+</span>
           var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
             m[name] = Event.Methods[name].methodize();
             return m;
           });
         
           if (Prototype.Browser.IE) {
        <span class="gi">+    function _relatedTarget(event) {</span>
        <span class="gi">+      var element;</span>
        <span class="gi">+      switch (event.type) {</span>
        <span class="gi">+        case &#39;mouseover&#39;: element = event.fromElement; break;</span>
        <span class="gi">+        case &#39;mouseout&#39;:  element = event.toElement;   break;</span>
        <span class="gi">+        default: return null;</span>
        <span class="gi">+      }</span>
        <span class="gi">+      return Element.extend(element);</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
             Object.extend(methods, {
               stopPropagation: function() { this.cancelBubble = true },
               preventDefault:  function() { this.returnValue = false },
        <span class="gd">-      inspect: function() { return &quot;[object Event]&quot; }</span>
        <span class="gi">+      inspect: function() { return &#39;[object Event]&#39; }</span>
             });
         
        <span class="gd">-    return function(event) {</span>
        <span class="gi">+    Event.extend = function(event, element) {</span>
               if (!event) return false;
               if (event._extendedByPrototype) return event;
         
               event._extendedByPrototype = Prototype.emptyFunction;
               var pointer = Event.pointer(event);
        <span class="gi">+</span>
               Object.extend(event, {
        <span class="gd">-        target: event.srcElement,</span>
        <span class="gd">-        relatedTarget: Event.relatedTarget(event),</span>
        <span class="gi">+        target: event.srcElement || element,</span>
        <span class="gi">+        relatedTarget: _relatedTarget(event),</span>
                 pageX:  pointer.x,
                 pageY:  pointer.y
               });
        <span class="gi">+</span>
               return Object.extend(event, methods);
             };
        <span class="gd">-</span>
           } else {
        <span class="gd">-    Event.prototype = Event.prototype || document.createEvent(&quot;HTMLEvents&quot;)[&#39;__proto__&#39;];</span>
        <span class="gi">+    Event.prototype = window.Event.prototype || document.createEvent(&#39;HTMLEvents&#39;).__proto__;</span>
             Object.extend(Event.prototype, methods);
        <span class="gd">-    return Prototype.K;</span>
        <span class="gi">+    Event.extend = Prototype.K;</span>
           }
        <span class="gd">-})();</span>
         
        <span class="gd">-Object.extend(Event, (function() {</span>
        <span class="gd">-  var cache = Event.cache;</span>
        <span class="gd">-</span>
        <span class="gd">-  function getEventID(element) {</span>
        <span class="gd">-    if (element._prototypeEventID) return element._prototypeEventID[0];</span>
        <span class="gd">-    arguments.callee.id = arguments.callee.id || 1;</span>
        <span class="gd">-    return element._prototypeEventID = [++arguments.callee.id];</span>
        <span class="gd">-  }</span>
        <span class="gi">+  function _createResponder(element, eventName, handler) {</span>
        <span class="gi">+    var registry = Element.retrieve(element, &#39;prototype_event_registry&#39;);</span>
         
        <span class="gd">-  function getDOMEventName(eventName) {</span>
        <span class="gd">-    if (eventName &amp;&amp; eventName.include(&#39;:&#39;)) return &quot;dataavailable&quot;;</span>
        <span class="gd">-    return eventName;</span>
        <span class="gd">-  }</span>
        <span class="gi">+    if (Object.isUndefined(registry)) {</span>
        <span class="gi">+      CACHE.push(element);</span>
        <span class="gi">+      registry = Element.retrieve(element, &#39;prototype_event_registry&#39;, $H());</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-  function getCacheForID(id) {</span>
        <span class="gd">-    return cache[id] = cache[id] || { };</span>
        <span class="gd">-  }</span>
        <span class="gi">+    var respondersForEvent = registry.get(eventName);</span>
        <span class="gi">+    if (Object.isUndefined(respondersForEvent)) {</span>
        <span class="gi">+      respondersForEvent = [];</span>
        <span class="gi">+      registry.set(eventName, respondersForEvent);</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-  function getWrappersForEventName(id, eventName) {</span>
        <span class="gd">-    var c = getCacheForID(id);</span>
        <span class="gd">-    return c[eventName] = c[eventName] || [];</span>
        <span class="gd">-  }</span>
        <span class="gi">+    if (respondersForEvent.pluck(&#39;handler&#39;).include(handler)) return false;</span>
         
        <span class="gd">-  function createWrapper(element, eventName, handler) {</span>
        <span class="gd">-    var id = getEventID(element);</span>
        <span class="gd">-    var c = getWrappersForEventName(id, eventName);</span>
        <span class="gd">-    if (c.pluck(&quot;handler&quot;).include(handler)) return false;</span>
        <span class="gi">+    var responder;</span>
        <span class="gi">+    if (eventName.include(&quot;:&quot;)) {</span>
        <span class="gi">+      responder = function(event) {</span>
        <span class="gi">+        if (Object.isUndefined(event.eventName))</span>
        <span class="gi">+          return false;</span>
         
        <span class="gd">-    var wrapper = function(event) {</span>
        <span class="gd">-      if (!Event || !Event.extend ||</span>
        <span class="gd">-        (event.eventName &amp;&amp; event.eventName != eventName))</span>
        <span class="gi">+        if (event.eventName !== eventName)</span>
                   return false;
         
        <span class="gd">-      Event.extend(event);</span>
        <span class="gd">-      handler.call(element, event);</span>
        <span class="gd">-    };</span>
        <span class="gi">+        Event.extend(event, element);</span>
        <span class="gi">+        handler.call(element, event);</span>
        <span class="gi">+      };</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &amp;&amp;</span>
        <span class="gi">+       (eventName === &quot;mouseenter&quot; || eventName === &quot;mouseleave&quot;)) {</span>
        <span class="gi">+        if (eventName === &quot;mouseenter&quot; || eventName === &quot;mouseleave&quot;) {</span>
        <span class="gi">+          responder = function(event) {</span>
        <span class="gi">+            Event.extend(event, element);</span>
        <span class="gi">+</span>
        <span class="gi">+            var parent = event.relatedTarget;</span>
        <span class="gi">+            while (parent &amp;&amp; parent !== element) {</span>
        <span class="gi">+              try { parent = parent.parentNode; }</span>
        <span class="gi">+              catch(e) { parent = element; }</span>
        <span class="gi">+            }</span>
         
        <span class="gd">-    wrapper.handler = handler;</span>
        <span class="gd">-    c.push(wrapper);</span>
        <span class="gd">-    return wrapper;</span>
        <span class="gd">-  }</span>
        <span class="gi">+            if (parent === element) return;</span>
         
        <span class="gd">-  function findWrapper(id, eventName, handler) {</span>
        <span class="gd">-    var c = getWrappersForEventName(id, eventName);</span>
        <span class="gd">-    return c.find(function(wrapper) { return wrapper.handler == handler });</span>
        <span class="gd">-  }</span>
        <span class="gi">+            handler.call(element, event);</span>
        <span class="gi">+          };</span>
        <span class="gi">+        }</span>
        <span class="gi">+      } else {</span>
        <span class="gi">+        responder = function(event) {</span>
        <span class="gi">+          Event.extend(event, element);</span>
        <span class="gi">+          handler.call(element, event);</span>
        <span class="gi">+        };</span>
        <span class="gi">+      }</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-  function destroyWrapper(id, eventName, handler) {</span>
        <span class="gd">-    var c = getCacheForID(id);</span>
        <span class="gd">-    if (!c[eventName]) return false;</span>
        <span class="gd">-    c[eventName] = c[eventName].without(findWrapper(id, eventName, handler));</span>
        <span class="gi">+    responder.handler = handler;</span>
        <span class="gi">+    respondersForEvent.push(responder);</span>
        <span class="gi">+    return responder;</span>
           }
         
        <span class="gd">-  function destroyCache() {</span>
        <span class="gd">-    for (var id in cache)</span>
        <span class="gd">-      for (var eventName in cache[id])</span>
        <span class="gd">-        cache[id][eventName] = null;</span>
        <span class="gi">+  function _destroyCache() {</span>
        <span class="gi">+    for (var i = 0, length = CACHE.length; i &lt; length; i++) {</span>
        <span class="gi">+      Event.stopObserving(CACHE[i]);</span>
        <span class="gi">+      CACHE[i] = null;</span>
        <span class="gi">+    }</span>
           }
         
        <span class="gi">+  var CACHE = [];</span>
         
        <span class="gd">-  // Internet Explorer needs to remove event handlers on page unload</span>
        <span class="gd">-  // in order to avoid memory leaks.</span>
        <span class="gd">-  if (window.attachEvent) {</span>
        <span class="gd">-    window.attachEvent(&quot;onunload&quot;, destroyCache);</span>
        <span class="gd">-  }</span>
        <span class="gi">+  if (Prototype.Browser.IE)</span>
        <span class="gi">+    window.attachEvent(&#39;onunload&#39;, _destroyCache);</span>
         
        <span class="gd">-  // Safari has a dummy event handler on page unload so that it won&#39;t</span>
        <span class="gd">-  // use its bfcache. Safari &lt;= 3.1 has an issue with restoring the &quot;document&quot;</span>
        <span class="gd">-  // object when page is returned to via the back button using its bfcache.</span>
        <span class="gd">-  if (Prototype.Browser.WebKit) {</span>
        <span class="gi">+  if (Prototype.Browser.WebKit)</span>
             window.addEventListener(&#39;unload&#39;, Prototype.emptyFunction, false);
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  var _getDOMEventName = Prototype.K,</span>
        <span class="gi">+      translations = { mouseenter: &quot;mouseover&quot;, mouseleave: &quot;mouseout&quot; };</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) {</span>
        <span class="gi">+    _getDOMEventName = function(eventName) {</span>
        <span class="gi">+      return (translations[eventName] || eventName);</span>
        <span class="gi">+    };</span>
           }
         
        <span class="gd">-  return {</span>
        <span class="gd">-    observe: function(element, eventName, handler) {</span>
        <span class="gd">-      element = $(element);</span>
        <span class="gd">-      var name = getDOMEventName(eventName);</span>
        <span class="gi">+  function observe(element, eventName, handler) {</span>
        <span class="gi">+    element = $(element);</span>
         
        <span class="gd">-      var wrapper = createWrapper(element, eventName, handler);</span>
        <span class="gd">-      if (!wrapper) return element;</span>
        <span class="gi">+    var responder = _createResponder(element, eventName, handler);</span>
         
        <span class="gd">-      if (element.addEventListener) {</span>
        <span class="gd">-        element.addEventListener(name, wrapper, false);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        element.attachEvent(&quot;on&quot; + name, wrapper);</span>
        <span class="gi">+    if (!responder) return element;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (eventName.include(&#39;:&#39;)) {</span>
        <span class="gi">+      if (element.addEventListener)</span>
        <span class="gi">+        element.addEventListener(&quot;dataavailable&quot;, responder, false);</span>
        <span class="gi">+      else {</span>
        <span class="gi">+        element.attachEvent(&quot;ondataavailable&quot;, responder);</span>
        <span class="gi">+        element.attachEvent(&quot;onfilterchange&quot;, responder);</span>
               }
        <span class="gi">+    } else {</span>
        <span class="gi">+      var actualEventName = _getDOMEventName(eventName);</span>
        <span class="gi">+</span>
        <span class="gi">+      if (element.addEventListener)</span>
        <span class="gi">+        element.addEventListener(actualEventName, responder, false);</span>
        <span class="gi">+      else</span>
        <span class="gi">+        element.attachEvent(&quot;on&quot; + actualEventName, responder);</span>
        <span class="gi">+    }</span>
         
        <span class="gi">+    return element;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function stopObserving(element, eventName, handler) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+</span>
        <span class="gi">+    var registry = Element.retrieve(element, &#39;prototype_event_registry&#39;);</span>
        <span class="gi">+    if (!registry) return element;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (!eventName) {</span>
        <span class="gi">+      registry.each( function(pair) {</span>
        <span class="gi">+        var eventName = pair.key;</span>
        <span class="gi">+        stopObserving(element, eventName);</span>
        <span class="gi">+      });</span>
               return element;
        <span class="gd">-    },</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-    stopObserving: function(element, eventName, handler) {</span>
        <span class="gd">-      element = $(element);</span>
        <span class="gd">-      var id = getEventID(element), name = getDOMEventName(eventName);</span>
        <span class="gi">+    var responders = registry.get(eventName);</span>
        <span class="gi">+    if (!responders) return element;</span>
         
        <span class="gd">-      if (!handler &amp;&amp; eventName) {</span>
        <span class="gd">-        getWrappersForEventName(id, eventName).each(function(wrapper) {</span>
        <span class="gd">-          element.stopObserving(eventName, wrapper.handler);</span>
        <span class="gd">-        });</span>
        <span class="gd">-        return element;</span>
        <span class="gi">+    if (!handler) {</span>
        <span class="gi">+      responders.each(function(r) {</span>
        <span class="gi">+        stopObserving(element, eventName, r.handler);</span>
        <span class="gi">+      });</span>
        <span class="gi">+      return element;</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-      } else if (!eventName) {</span>
        <span class="gd">-        Object.keys(getCacheForID(id)).each(function(eventName) {</span>
        <span class="gd">-          element.stopObserving(eventName);</span>
        <span class="gd">-        });</span>
        <span class="gd">-        return element;</span>
        <span class="gi">+    var responder = responders.find( function(r) { return r.handler === handler; });</span>
        <span class="gi">+    if (!responder) return element;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (eventName.include(&#39;:&#39;)) {</span>
        <span class="gi">+      if (element.removeEventListener)</span>
        <span class="gi">+        element.removeEventListener(&quot;dataavailable&quot;, responder, false);</span>
        <span class="gi">+      else {</span>
        <span class="gi">+        element.detachEvent(&quot;ondataavailable&quot;, responder);</span>
        <span class="gi">+        element.detachEvent(&quot;onfilterchange&quot;,  responder);</span>
               }
        <span class="gi">+    } else {</span>
        <span class="gi">+      var actualEventName = _getDOMEventName(eventName);</span>
        <span class="gi">+      if (element.removeEventListener)</span>
        <span class="gi">+        element.removeEventListener(actualEventName, responder, false);</span>
        <span class="gi">+      else</span>
        <span class="gi">+        element.detachEvent(&#39;on&#39; + actualEventName, responder);</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-      var wrapper = findWrapper(id, eventName, handler);</span>
        <span class="gd">-      if (!wrapper) return element;</span>
        <span class="gi">+    registry.set(eventName, responders.without(responder));</span>
         
        <span class="gd">-      if (element.removeEventListener) {</span>
        <span class="gd">-        element.removeEventListener(name, wrapper, false);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        element.detachEvent(&quot;on&quot; + name, wrapper);</span>
        <span class="gd">-      }</span>
        <span class="gi">+    return element;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function fire(element, eventName, memo, bubble) {</span>
        <span class="gi">+    element = $(element);</span>
         
        <span class="gd">-      destroyWrapper(id, eventName, handler);</span>
        <span class="gi">+    if (Object.isUndefined(bubble))</span>
        <span class="gi">+      bubble = true;</span>
         
        <span class="gd">-      return element;</span>
        <span class="gd">-    },</span>
        <span class="gi">+    if (element == document &amp;&amp; document.createEvent &amp;&amp; !element.dispatchEvent)</span>
        <span class="gi">+      element = document.documentElement;</span>
         
        <span class="gd">-    fire: function(element, eventName, memo) {</span>
        <span class="gd">-      element = $(element);</span>
        <span class="gd">-      if (element == document &amp;&amp; document.createEvent &amp;&amp; !element.dispatchEvent)</span>
        <span class="gd">-        element = document.documentElement;</span>
        <span class="gi">+    var event;</span>
        <span class="gi">+    if (document.createEvent) {</span>
        <span class="gi">+      event = document.createEvent(&#39;HTMLEvents&#39;);</span>
        <span class="gi">+      event.initEvent(&#39;dataavailable&#39;, true, true);</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      event = document.createEventObject();</span>
        <span class="gi">+      event.eventType = bubble ? &#39;ondataavailable&#39; : &#39;onfilterchange&#39;;</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-      var event;</span>
        <span class="gd">-      if (document.createEvent) {</span>
        <span class="gd">-        event = document.createEvent(&quot;HTMLEvents&quot;);</span>
        <span class="gd">-        event.initEvent(&quot;dataavailable&quot;, true, true);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        event = document.createEventObject();</span>
        <span class="gd">-        event.eventType = &quot;ondataavailable&quot;;</span>
        <span class="gd">-      }</span>
        <span class="gi">+    event.eventName = eventName;</span>
        <span class="gi">+    event.memo = memo || { };</span>
         
        <span class="gd">-      event.eventName = eventName;</span>
        <span class="gd">-      event.memo = memo || { };</span>
        <span class="gi">+    if (document.createEvent)</span>
        <span class="gi">+      element.dispatchEvent(event);</span>
        <span class="gi">+    else</span>
        <span class="gi">+      element.fireEvent(event.eventType, event);</span>
         
        <span class="gd">-      if (document.createEvent) {</span>
        <span class="gd">-        element.dispatchEvent(event);</span>
        <span class="gd">-      } else {</span>
        <span class="gd">-        element.fireEvent(event.eventType, event);</span>
        <span class="gd">-      }</span>
        <span class="gi">+    return Event.extend(event);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  Event.Handler = Class.create({</span>
        <span class="gi">+    initialize: function(element, eventName, selector, callback) {</span>
        <span class="gi">+      this.element   = $(element);</span>
        <span class="gi">+      this.eventName = eventName;</span>
        <span class="gi">+      this.selector  = selector;</span>
        <span class="gi">+      this.callback  = callback;</span>
        <span class="gi">+      this.handler   = this.handleEvent.bind(this);</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    start: function() {</span>
        <span class="gi">+      Event.observe(this.element, this.eventName, this.handler);</span>
        <span class="gi">+      return this;</span>
        <span class="gi">+    },</span>
         
        <span class="gd">-      return Event.extend(event);</span>
        <span class="gi">+    stop: function() {</span>
        <span class="gi">+      Event.stopObserving(this.element, this.eventName, this.handler);</span>
        <span class="gi">+      return this;</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    handleEvent: function(event) {</span>
        <span class="gi">+      var element = event.findElement(this.selector);</span>
        <span class="gi">+      if (element) this.callback.call(this.element, event, element);</span>
             }
        <span class="gd">-  };</span>
        <span class="gd">-})());</span>
        <span class="gi">+  });</span>
         
        <span class="gd">-Object.extend(Event, Event.Methods);</span>
        <span class="gi">+  function on(element, eventName, selector, callback) {</span>
        <span class="gi">+    element = $(element);</span>
        <span class="gi">+    if (Object.isFunction(selector) &amp;&amp; Object.isUndefined(callback)) {</span>
        <span class="gi">+      callback = selector, selector = null;</span>
        <span class="gi">+    }</span>
         
        <span class="gd">-Element.addMethods({</span>
        <span class="gd">-  fire:          Event.fire,</span>
        <span class="gd">-  observe:       Event.observe,</span>
        <span class="gd">-  stopObserving: Event.stopObserving</span>
        <span class="gd">-});</span>
        <span class="gi">+    return new Event.Handler(element, eventName, selector, callback).start();</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-Object.extend(document, {</span>
        <span class="gd">-  fire:          Element.Methods.fire.methodize(),</span>
        <span class="gd">-  observe:       Element.Methods.observe.methodize(),</span>
        <span class="gd">-  stopObserving: Element.Methods.stopObserving.methodize(),</span>
        <span class="gd">-  loaded:        false</span>
        <span class="gd">-});</span>
        <span class="gi">+  Object.extend(Event, Event.Methods);</span>
        <span class="gi">+</span>
        <span class="gi">+  Object.extend(Event, {</span>
        <span class="gi">+    fire:          fire,</span>
        <span class="gi">+    observe:       observe,</span>
        <span class="gi">+    stopObserving: stopObserving,</span>
        <span class="gi">+    on:            on</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  Element.addMethods({</span>
        <span class="gi">+    fire:          fire,</span>
        <span class="gi">+</span>
        <span class="gi">+    observe:       observe,</span>
        <span class="gi">+</span>
        <span class="gi">+    stopObserving: stopObserving,</span>
        <span class="gi">+</span>
        <span class="gi">+    on:            on</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  Object.extend(document, {</span>
        <span class="gi">+    fire:          fire.methodize(),</span>
        <span class="gi">+</span>
        <span class="gi">+    observe:       observe.methodize(),</span>
        <span class="gi">+</span>
        <span class="gi">+    stopObserving: stopObserving.methodize(),</span>
        <span class="gi">+</span>
        <span class="gi">+    on:            on.methodize(),</span>
        <span class="gi">+</span>
        <span class="gi">+    loaded:        false</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  if (window.Event) Object.extend(window.Event, Event);</span>
        <span class="gi">+  else window.Event = Event;</span>
        <span class="gi">+})();</span>
         
         (function() {
           /* Support for the DOMContentLoaded event is based on work by Dan Webb,
        <span class="gd">-     Matthias Miller, Dean Edwards and John Resig. */</span>
        <span class="gi">+     Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */</span>
         
           var timer;
         
           function fireContentLoadedEvent() {
             if (document.loaded) return;
        <span class="gd">-    if (timer) window.clearInterval(timer);</span>
        <span class="gd">-    document.fire(&quot;dom:loaded&quot;);</span>
        <span class="gi">+    if (timer) window.clearTimeout(timer);</span>
             document.loaded = true;
        <span class="gi">+    document.fire(&#39;dom:loaded&#39;);</span>
           }
         
        <span class="gd">-  if (document.addEventListener) {</span>
        <span class="gd">-    if (Prototype.Browser.WebKit) {</span>
        <span class="gd">-      timer = window.setInterval(function() {</span>
        <span class="gd">-        if (/loaded|complete/.test(document.readyState))</span>
        <span class="gd">-          fireContentLoadedEvent();</span>
        <span class="gd">-      }, 0);</span>
        <span class="gd">-</span>
        <span class="gd">-      Event.observe(window, &quot;load&quot;, fireContentLoadedEvent);</span>
        <span class="gi">+  function checkReadyState() {</span>
        <span class="gi">+    if (document.readyState === &#39;complete&#39;) {</span>
        <span class="gi">+      document.stopObserving(&#39;readystatechange&#39;, checkReadyState);</span>
        <span class="gi">+      fireContentLoadedEvent();</span>
        <span class="gi">+    }</span>
        <span class="gi">+  }</span>
         
        <span class="gd">-    } else {</span>
        <span class="gd">-      document.addEventListener(&quot;DOMContentLoaded&quot;,</span>
        <span class="gd">-        fireContentLoadedEvent, false);</span>
        <span class="gi">+  function pollDoScroll() {</span>
        <span class="gi">+    try { document.documentElement.doScroll(&#39;left&#39;); }</span>
        <span class="gi">+    catch(e) {</span>
        <span class="gi">+      timer = pollDoScroll.defer();</span>
        <span class="gi">+      return;</span>
             }
        <span class="gi">+    fireContentLoadedEvent();</span>
        <span class="gi">+  }</span>
         
        <span class="gi">+  if (document.addEventListener) {</span>
        <span class="gi">+    document.addEventListener(&#39;DOMContentLoaded&#39;, fireContentLoadedEvent, false);</span>
           } else {
        <span class="gd">-    document.write(&quot;&lt;script id=__onDOMContentLoaded defer src=//:&gt;&lt;\/script&gt;&quot;);</span>
        <span class="gd">-    $(&quot;__onDOMContentLoaded&quot;).onreadystatechange = function() {</span>
        <span class="gd">-      if (this.readyState == &quot;complete&quot;) {</span>
        <span class="gd">-        this.onreadystatechange = null;</span>
        <span class="gd">-        fireContentLoadedEvent();</span>
        <span class="gd">-      }</span>
        <span class="gd">-    };</span>
        <span class="gi">+    document.observe(&#39;readystatechange&#39;, checkReadyState);</span>
        <span class="gi">+    if (window == top)</span>
        <span class="gi">+      timer = pollDoScroll.defer();</span>
           }
        <span class="gi">+</span>
        <span class="gi">+  Event.observe(window, &#39;load&#39;, fireContentLoadedEvent);</span>
         })();
        <span class="gi">+</span>
        <span class="gi">+Element.addMethods();</span>
        <span class="gi">+</span>
         /*------------------------------- DEPRECATED -------------------------------*/
         
         Hash.toQueryString = Object.toQueryString;
         
         var Toggle = { display: Element.toggle };
         
         Element.Methods.childOf = Element.Methods.descendantOf;
         
         var Insertion = {
           Before: function(element, content) {
             return Element.insert(element, {before:content});
           },
         
           Top: function(element, content) {
             return Element.insert(element, {top:content});
           },
         
           Bottom: function(element, content) {
             return Element.insert(element, {bottom:content});
           },
         
           After: function(element, content) {
             return Element.insert(element, {after:content});
           }
         };
         
         var $continue = new Error(&#39;&quot;throw $continue&quot; is deprecated, use &quot;return&quot; instead&#39;);
         
        <span class="gd">-// This should be moved to script.aculo.us; notice the deprecated methods</span>
        <span class="gd">-// further below, that map to the newer Element methods.</span>
         var Position = {
        <span class="gd">-  // set to true if needed, warning: firefox performance problems</span>
        <span class="gd">-  // NOT neeeded for page scrolling, only if draggable contained in</span>
        <span class="gd">-  // scrollable elements</span>
           includeScrollOffsets: false,
         
        <span class="gd">-  // must be called before calling withinIncludingScrolloffset, every time the</span>
        <span class="gd">-  // page is scrolled</span>
           prepare: function() {
             this.deltaX =  window.pageXOffset
                         || document.documentElement.scrollLeft
                         || document.body.scrollLeft
                         || 0;
             this.deltaY =  window.pageYOffset
                         || document.documentElement.scrollTop
                         || document.body.scrollTop
                         || 0;
           },
         
        <span class="gd">-  // caches x/y coordinate pair to use with overlap</span>
           within: function(element, x, y) {
             if (this.includeScrollOffsets)
               return this.withinIncludingScrolloffsets(element, x, y);
             this.xcomp = x;
             this.ycomp = y;
             this.offset = Element.cumulativeOffset(element);
         
             return (y &gt;= this.offset[1] &amp;&amp;
                     y &lt;  this.offset[1] + element.offsetHeight &amp;&amp;
                     x &gt;= this.offset[0] &amp;&amp;
                     x &lt;  this.offset[0] + element.offsetWidth);
           },
         
           withinIncludingScrolloffsets: function(element, x, y) {
             var offsetcache = Element.cumulativeScrollOffset(element);
         
             this.xcomp = x + offsetcache[0] - this.deltaX;
             this.ycomp = y + offsetcache[1] - this.deltaY;
             this.offset = Element.cumulativeOffset(element);
         
             return (this.ycomp &gt;= this.offset[1] &amp;&amp;
                     this.ycomp &lt;  this.offset[1] + element.offsetHeight &amp;&amp;
                     this.xcomp &gt;= this.offset[0] &amp;&amp;
                     this.xcomp &lt;  this.offset[0] + element.offsetWidth);
           },
         
        <span class="gd">-  // within must be called directly before</span>
           overlap: function(mode, element) {
             if (!mode) return 0;
             if (mode == &#39;vertical&#39;)
               return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
                 element.offsetHeight;
             if (mode == &#39;horizontal&#39;)
               return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
                 element.offsetWidth;
           },
         
        <span class="gd">-  // Deprecation layer -- use newer Element methods now (1.5.2).</span>
         
           cumulativeOffset: Element.Methods.cumulativeOffset,
         
           positionedOffset: Element.Methods.positionedOffset,
         
           absolutize: function(element) {
             Position.prepare();
             return Element.absolutize(element);
           },
         
           relativize: function(element) {
             Position.prepare();
             return Element.relativize(element);
           },
         
           realOffset: Element.Methods.cumulativeScrollOffset,
         
           offsetParent: Element.Methods.getOffsetParent,
         
           page: Element.Methods.viewportOffset,
         
           clone: function(source, target, options) {
             options = options || { };
             return Element.clonePosition(target, source, options);
           }
         };
         
         /*--------------------------------------------------------------------------*/
         
         if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
           function iter(name) {
             return name.blank() ? null : &quot;[contains(concat(&#39; &#39;, @class, &#39; &#39;), &#39; &quot; + name + &quot; &#39;)]&quot;;
           }
         
           instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
           function(element, className) {
             className = className.toString().strip();
             var cond = /\s/.test(className) ? $w(className).map(iter).join(&#39;&#39;) : iter(className);
             return cond ? document._getElementsByXPath(&#39;.//*&#39; + cond, element) : [];
           } : function(element, className) {
             className = className.toString().strip();
             var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
             if (!classNames &amp;&amp; !className) return elements;
         
             var nodes = $(element).getElementsByTagName(&#39;*&#39;);
             className = &#39; &#39; + className + &#39; &#39;;
         
             for (var i = 0, child, cn; child = nodes[i]; i++) {
               if (child.className &amp;&amp; (cn = &#39; &#39; + child.className + &#39; &#39;) &amp;&amp; (cn.include(className) ||
                   (classNames &amp;&amp; classNames.all(function(name) {
                     return !name.toString().blank() &amp;&amp; cn.include(&#39; &#39; + name + &#39; &#39;);
                   }))))
                 elements.push(Element.extend(child));
             }
             return elements;
           };
         
           return function(className, parentElement) {
             return $(parentElement || document.body).getElementsByClassName(className);
           };
         }(Element.Methods);
         
         /*--------------------------------------------------------------------------*/
         
         Element.ClassNames = Class.create();
         Element.ClassNames.prototype = {
           initialize: function(element) {
             this.element = $(element);
           },
         
           _each: function(iterator) {
             this.element.className.split(/\s+/).select(function(name) {
               return name.length &gt; 0;
             })._each(iterator);
           },
         
           set: function(className) {
             this.element.className = className;
           },
         
           add: function(classNameToAdd) {
             if (this.include(classNameToAdd)) return;
             this.set($A(this).concat(classNameToAdd).join(&#39; &#39;));
           },
         
           remove: function(classNameToRemove) {
             if (!this.include(classNameToRemove)) return;
             this.set($A(this).without(classNameToRemove).join(&#39; &#39;));
           },
         
           toString: function() {
             return $A(this).join(&#39; &#39;);
           }
         };
         
         Object.extend(Element.ClassNames.prototype, Enumerable);
         
         /*--------------------------------------------------------------------------*/
         
        <span class="gd">-Element.addMethods();</span>
        \ No newline at end of file
        <span class="gi">+(function() {</span>
        <span class="gi">+  window.Selector = Class.create({</span>
        <span class="gi">+    initialize: function(expression) {</span>
        <span class="gi">+      this.expression = expression.strip();</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    findElements: function(rootElement) {</span>
        <span class="gi">+      return Prototype.Selector.select(this.expression, rootElement);</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    match: function(element) {</span>
        <span class="gi">+      return Prototype.Selector.match(element, this.expression);</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    toString: function() {</span>
        <span class="gi">+      return this.expression;</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    inspect: function() {</span>
        <span class="gi">+      return &quot;#&lt;Selector: &quot; + this.expression + &quot;&gt;&quot;;</span>
        <span class="gi">+    }</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  Object.extend(Selector, {</span>
        <span class="gi">+    matchElements: function(elements, expression) {</span>
        <span class="gi">+      var match = Prototype.Selector.match,</span>
        <span class="gi">+          results = [];</span>
        <span class="gi">+</span>
        <span class="gi">+      for (var i = 0, length = elements.length; i &lt; length; i++) {</span>
        <span class="gi">+        var element = elements[i];</span>
        <span class="gi">+        if (match(element, expression)) {</span>
        <span class="gi">+          results.push(Element.extend(element));</span>
        <span class="gi">+        }</span>
        <span class="gi">+      }</span>
        <span class="gi">+      return results;</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    findElement: function(elements, expression, index) {</span>
        <span class="gi">+      index = index || 0;</span>
        <span class="gi">+      var matchIndex = 0, element;</span>
        <span class="gi">+      for (var i = 0, length = elements.length; i &lt; length; i++) {</span>
        <span class="gi">+        element = elements[i];</span>
        <span class="gi">+        if (Prototype.Selector.match(element, expression) &amp;&amp; index === matchIndex++) {</span>
        <span class="gi">+          return Element.extend(element);</span>
        <span class="gi">+        }</span>
        <span class="gi">+      }</span>
        <span class="gi">+    },</span>
        <span class="gi">+</span>
        <span class="gi">+    findChildElements: function(element, expressions) {</span>
        <span class="gi">+      var selector = expressions.toArray().join(&#39;, &#39;);</span>
        <span class="gi">+      return Prototype.Selector.select(selector, element || document);</span>
        <span class="gi">+    }</span>
        <span class="gi">+  });</span>
        <span class="gi">+})();</span>
        </pre></div>
        <h2 id='public-javascripts-rails-js'>public/javascripts/rails.js</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,175 @@</span>
        <span class="gi">+(function() {</span>
        <span class="gi">+  // Technique from Juriy Zaytsev</span>
        <span class="gi">+  // http://thinkweb2.com/projects/prototype/detecting-event-support-without-browser-sniffing/</span>
        <span class="gi">+  function isEventSupported(eventName) {</span>
        <span class="gi">+    var el = document.createElement(&#39;div&#39;);</span>
        <span class="gi">+    eventName = &#39;on&#39; + eventName;</span>
        <span class="gi">+    var isSupported = (eventName in el);</span>
        <span class="gi">+    if (!isSupported) {</span>
        <span class="gi">+      el.setAttribute(eventName, &#39;return;&#39;);</span>
        <span class="gi">+      isSupported = typeof el[eventName] == &#39;function&#39;;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    el = null;</span>
        <span class="gi">+    return isSupported;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function isForm(element) {</span>
        <span class="gi">+    return Object.isElement(element) &amp;&amp; element.nodeName.toUpperCase() == &#39;FORM&#39;</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function isInput(element) {</span>
        <span class="gi">+    if (Object.isElement(element)) {</span>
        <span class="gi">+      var name = element.nodeName.toUpperCase()</span>
        <span class="gi">+      return name == &#39;INPUT&#39; || name == &#39;SELECT&#39; || name == &#39;TEXTAREA&#39;</span>
        <span class="gi">+    }</span>
        <span class="gi">+    else return false</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  var submitBubbles = isEventSupported(&#39;submit&#39;),</span>
        <span class="gi">+      changeBubbles = isEventSupported(&#39;change&#39;)</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!submitBubbles || !changeBubbles) {</span>
        <span class="gi">+    // augment the Event.Handler class to observe custom events when needed</span>
        <span class="gi">+    Event.Handler.prototype.initialize = Event.Handler.prototype.initialize.wrap(</span>
        <span class="gi">+      function(init, element, eventName, selector, callback) {</span>
        <span class="gi">+        init(element, eventName, selector, callback)</span>
        <span class="gi">+        // is the handler being attached to an element that doesn&#39;t support this event?</span>
        <span class="gi">+        if ( (!submitBubbles &amp;&amp; this.eventName == &#39;submit&#39; &amp;&amp; !isForm(this.element)) ||</span>
        <span class="gi">+             (!changeBubbles &amp;&amp; this.eventName == &#39;change&#39; &amp;&amp; !isInput(this.element)) ) {</span>
        <span class="gi">+          // &quot;submit&quot; =&gt; &quot;emulated:submit&quot;</span>
        <span class="gi">+          this.eventName = &#39;emulated:&#39; + this.eventName</span>
        <span class="gi">+        }</span>
        <span class="gi">+      }</span>
        <span class="gi">+    )</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!submitBubbles) {</span>
        <span class="gi">+    // discover forms on the page by observing focus events which always bubble</span>
        <span class="gi">+    document.on(&#39;focusin&#39;, &#39;form&#39;, function(focusEvent, form) {</span>
        <span class="gi">+      // special handler for the real &quot;submit&quot; event (one-time operation)</span>
        <span class="gi">+      if (!form.retrieve(&#39;emulated:submit&#39;)) {</span>
        <span class="gi">+        form.on(&#39;submit&#39;, function(submitEvent) {</span>
        <span class="gi">+          var emulated = form.fire(&#39;emulated:submit&#39;, submitEvent, true)</span>
        <span class="gi">+          // if custom event received preventDefault, cancel the real one too</span>
        <span class="gi">+          if (emulated.returnValue === false) submitEvent.preventDefault()</span>
        <span class="gi">+        })</span>
        <span class="gi">+        form.store(&#39;emulated:submit&#39;, true)</span>
        <span class="gi">+      }</span>
        <span class="gi">+    })</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  if (!changeBubbles) {</span>
        <span class="gi">+    // discover form inputs on the page</span>
        <span class="gi">+    document.on(&#39;focusin&#39;, &#39;input, select, texarea&#39;, function(focusEvent, input) {</span>
        <span class="gi">+      // special handler for real &quot;change&quot; events</span>
        <span class="gi">+      if (!input.retrieve(&#39;emulated:change&#39;)) {</span>
        <span class="gi">+        input.on(&#39;change&#39;, function(changeEvent) {</span>
        <span class="gi">+          input.fire(&#39;emulated:change&#39;, changeEvent, true)</span>
        <span class="gi">+        })</span>
        <span class="gi">+        input.store(&#39;emulated:change&#39;, true)</span>
        <span class="gi">+      }</span>
        <span class="gi">+    })</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function handleRemote(element) {</span>
        <span class="gi">+    var method, url, params;</span>
        <span class="gi">+</span>
        <span class="gi">+    var event = element.fire(&quot;ajax:before&quot;);</span>
        <span class="gi">+    if (event.stopped) return false;</span>
        <span class="gi">+</span>
        <span class="gi">+    if (element.tagName.toLowerCase() === &#39;form&#39;) {</span>
        <span class="gi">+      method = element.readAttribute(&#39;method&#39;) || &#39;post&#39;;</span>
        <span class="gi">+      url    = element.readAttribute(&#39;action&#39;);</span>
        <span class="gi">+      params = element.serialize();</span>
        <span class="gi">+    } else {</span>
        <span class="gi">+      method = element.readAttribute(&#39;data-method&#39;) || &#39;get&#39;;</span>
        <span class="gi">+      url    = element.readAttribute(&#39;href&#39;);</span>
        <span class="gi">+      params = {};</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    new Ajax.Request(url, {</span>
        <span class="gi">+      method: method,</span>
        <span class="gi">+      parameters: params,</span>
        <span class="gi">+      evalScripts: true,</span>
        <span class="gi">+</span>
        <span class="gi">+      onComplete:    function(request) { element.fire(&quot;ajax:complete&quot;, request); },</span>
        <span class="gi">+      onSuccess:     function(request) { element.fire(&quot;ajax:success&quot;,  request); },</span>
        <span class="gi">+      onFailure:     function(request) { element.fire(&quot;ajax:failure&quot;,  request); }</span>
        <span class="gi">+    });</span>
        <span class="gi">+</span>
        <span class="gi">+    element.fire(&quot;ajax:after&quot;);</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+  function handleMethod(element) {</span>
        <span class="gi">+    var method = element.readAttribute(&#39;data-method&#39;),</span>
        <span class="gi">+        url = element.readAttribute(&#39;href&#39;),</span>
        <span class="gi">+        csrf_param = $$(&#39;meta[name=csrf-param]&#39;)[0],</span>
        <span class="gi">+        csrf_token = $$(&#39;meta[name=csrf-token]&#39;)[0];</span>
        <span class="gi">+</span>
        <span class="gi">+    var form = new Element(&#39;form&#39;, { method: &quot;POST&quot;, action: url, style: &quot;display: none;&quot; });</span>
        <span class="gi">+    element.parentNode.insert(form);</span>
        <span class="gi">+</span>
        <span class="gi">+    if (method !== &#39;post&#39;) {</span>
        <span class="gi">+      var field = new Element(&#39;input&#39;, { type: &#39;hidden&#39;, name: &#39;_method&#39;, value: method });</span>
        <span class="gi">+      form.insert(field);</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    if (csrf_param) {</span>
        <span class="gi">+      var param = csrf_param.readAttribute(&#39;content&#39;),</span>
        <span class="gi">+          token = csrf_token.readAttribute(&#39;content&#39;),</span>
        <span class="gi">+          field = new Element(&#39;input&#39;, { type: &#39;hidden&#39;, name: param, value: token });</span>
        <span class="gi">+      form.insert(field);</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    form.submit();</span>
        <span class="gi">+  }</span>
        <span class="gi">+</span>
        <span class="gi">+</span>
        <span class="gi">+  document.on(&quot;click&quot;, &quot;*[data-confirm]&quot;, function(event, element) {</span>
        <span class="gi">+    var message = element.readAttribute(&#39;data-confirm&#39;);</span>
        <span class="gi">+    if (!confirm(message)) event.stop();</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  document.on(&quot;click&quot;, &quot;a[data-remote]&quot;, function(event, element) {</span>
        <span class="gi">+    if (event.stopped) return;</span>
        <span class="gi">+    handleRemote(element);</span>
        <span class="gi">+    event.stop();</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  document.on(&quot;click&quot;, &quot;a[data-method]&quot;, function(event, element) {</span>
        <span class="gi">+    if (event.stopped) return;</span>
        <span class="gi">+    handleMethod(element);</span>
        <span class="gi">+    event.stop();</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  document.on(&quot;submit&quot;, function(event) {</span>
        <span class="gi">+    var element = event.findElement(),</span>
        <span class="gi">+        message = element.readAttribute(&#39;data-confirm&#39;);</span>
        <span class="gi">+    if (message &amp;&amp; !confirm(message)) {</span>
        <span class="gi">+      event.stop();</span>
        <span class="gi">+      return false;</span>
        <span class="gi">+    }</span>
        <span class="gi">+</span>
        <span class="gi">+    var inputs = element.select(&quot;input[type=submit][data-disable-with]&quot;);</span>
        <span class="gi">+    inputs.each(function(input) {</span>
        <span class="gi">+      input.disabled = true;</span>
        <span class="gi">+      input.writeAttribute(&#39;data-original-value&#39;, input.value);</span>
        <span class="gi">+      input.value = input.readAttribute(&#39;data-disable-with&#39;);</span>
        <span class="gi">+    });</span>
        <span class="gi">+</span>
        <span class="gi">+    var element = event.findElement(&quot;form[data-remote]&quot;);</span>
        <span class="gi">+    if (element) {</span>
        <span class="gi">+      handleRemote(element);</span>
        <span class="gi">+      event.stop();</span>
        <span class="gi">+    }</span>
        <span class="gi">+  });</span>
        <span class="gi">+</span>
        <span class="gi">+  document.on(&quot;ajax:after&quot;, &quot;form&quot;, function(event, element) {</span>
        <span class="gi">+    var inputs = element.select(&quot;input[type=submit][disabled=true][data-disable-with]&quot;);</span>
        <span class="gi">+    inputs.each(function(input) {</span>
        <span class="gi">+      input.value = input.readAttribute(&#39;data-original-value&#39;);</span>
        <span class="gi">+      input.removeAttribute(&#39;data-original-value&#39;);</span>
        <span class="gi">+      input.disabled = false;</span>
        <span class="gi">+    });</span>
        <span class="gi">+  });</span>
        <span class="gi">+})();</span>
        </pre></div>
        <h2 id='script-about'>script/about</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,4 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-$LOAD_PATH.unshift &quot;#{RAILTIES_PATH}/builtin/rails_info&quot;</span>
        <span class="gd">-require &#39;commands/about&#39;</span>
        </pre></div>
        <h2 id='script-console'>script/console</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/console&#39;</span>
        </pre></div>
        <h2 id='script-dbconsole'>script/dbconsole</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/dbconsole&#39;</span>
        </pre></div>
        <h2 id='script-destroy'>script/destroy</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/destroy&#39;</span>
        </pre></div>
        <h2 id='script-generate'>script/generate</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/generate&#39;</span>
        </pre></div>
        <h2 id='script-performance-benchmarker'>script/performance/benchmarker</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/performance/benchmarker&#39;</span>
        </pre></div>
        <h2 id='script-performance-profiler'>script/performance/profiler</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/performance/profiler&#39;</span>
        </pre></div>
        <h2 id='script-plugin'>script/plugin</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/plugin&#39;</span>
        </pre></div>
        <h2 id='script-rails'>script/rails</h2>
        <div class="highlight"><pre><span class="gu">@@ -0,0 +1,6 @@</span>
        <span class="gi">+#!/usr/bin/env ruby</span>
        <span class="gi">+# This command will automatically be run when you run &quot;rails&quot; with Rails 3 gems installed from the root of your application.</span>
        <span class="gi">+</span>
        <span class="gi">+APP_PATH = File.expand_path(&#39;../../config/application&#39;,  __FILE__)</span>
        <span class="gi">+require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gi">+require &#39;rails/commands&#39;</span>
        </pre></div>
        <h2 id='script-runner'>script/runner</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/runner&#39;</span>
        </pre></div>
        <h2 id='script-server'>script/server</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,3 +0,0 @@</span>
        <span class="gd">-#!/usr/bin/env ruby</span>
        <span class="gd">-require File.expand_path(&#39;../../config/boot&#39;,  __FILE__)</span>
        <span class="gd">-require &#39;commands/server&#39;</span>
        </pre></div>
        <h2 id='test-performance-browsing_test-rb'>test/performance/browsing_test.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,9 +1,9 @@</span>
         require &#39;test_helper&#39;
        <span class="gd">-require &#39;performance_test_help&#39;</span>
        <span class="gi">+require &#39;rails/performance_test_help&#39;</span>
         
         # Profiling results for each test method are written to tmp/performance.
        <span class="gd">-class BrowsingTest &lt; ActionController::PerformanceTest</span>
        <span class="gi">+class BrowsingTest &lt; ActionDispatch::PerformanceTest</span>
           def test_homepage
             get &#39;/&#39;
           end
         end
        </pre></div>
        <h2 id='test-test_helper-rb'>test/test_helper.rb</h2>
        <div class="highlight"><pre><span class="gu">@@ -1,38 +1,13 @@</span>
         ENV[&quot;RAILS_ENV&quot;] = &quot;test&quot;
        <span class="gd">-require File.expand_path(File.dirname(__FILE__) + &quot;/../config/environment&quot;)</span>
        <span class="gd">-require &#39;test_help&#39;</span>
        <span class="gi">+require File.expand_path(&#39;../../config/environment&#39;, __FILE__)</span>
        <span class="gi">+require &#39;rails/test_help&#39;</span>
         
         class ActiveSupport::TestCase
        <span class="gd">-  # Transactional fixtures accelerate your tests by wrapping each test method</span>
        <span class="gd">-  # in a transaction that&#39;s rolled back on completion.  This ensures that the</span>
        <span class="gd">-  # test database remains unchanged so your fixtures don&#39;t have to be reloaded</span>
        <span class="gd">-  # between every test method.  Fewer database queries means faster tests.</span>
        <span class="gd">-  #</span>
        <span class="gd">-  # Read Mike Clark&#39;s excellent walkthrough at</span>
        <span class="gd">-  #   http://clarkware.com/cgi/blosxom/2005/10/24#Rails10FastTesting</span>
        <span class="gd">-  #</span>
        <span class="gd">-  # Every Active Record database supports transactions except MyISAM tables</span>
        <span class="gd">-  # in MySQL.  Turn off transactional fixtures in this case; however, if you</span>
        <span class="gd">-  # don&#39;t care one way or the other, switching from MyISAM to InnoDB tables</span>
        <span class="gd">-  # is recommended.</span>
        <span class="gd">-  #</span>
        <span class="gd">-  # The only drawback to using transactional fixtures is when you actually </span>
        <span class="gd">-  # need to test transactions.  Since your test is bracketed by a transaction,</span>
        <span class="gd">-  # any transactions started in your code will be automatically rolled back.</span>
        <span class="gd">-  self.use_transactional_fixtures = true</span>
        <span class="gd">-</span>
        <span class="gd">-  # Instantiated fixtures are slow, but give you @david where otherwise you</span>
        <span class="gd">-  # would need people(:david).  If you don&#39;t want to migrate your existing</span>
        <span class="gd">-  # test cases which use the @david style and don&#39;t mind the speed hit (each</span>
        <span class="gd">-  # instantiated fixtures translates to a database query per test method),</span>
        <span class="gd">-  # then set this back to true.</span>
        <span class="gd">-  self.use_instantiated_fixtures  = false</span>
        <span class="gd">-</span>
           # Setup all fixtures in test/fixtures/*.(yml|csv) for all tests in alphabetical order.
           #
           # Note: You&#39;ll currently still have to declare fixtures explicitly in integration tests
           # -- they do not yet inherit this setting
           fixtures :all
         
           # Add more helper methods to be used by all tests here...
         end
        </pre></div>
      </div>
    </div>
    <a href='https://github.com/jswanner/RailsDiff'>
      <img alt='Fork me on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png' style='position: absolute; top: 0; right: 0; border: 0;'>
    </a>
    <script src='/assets/app.js'></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7325596-4']);
      _gaq.push(['_setSiteSpeedSampleRate', 100]);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = 'http://www.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
